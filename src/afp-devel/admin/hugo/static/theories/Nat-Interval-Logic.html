<div id="IL_Interval">
<div class="head">
<h1>Theory IL_Interval</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IL_Interval.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Intervals and operations for temporal logic declarations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IL_Interval
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../List-Infinite/InfiniteSet2.html">List-Infinite.InfiniteSet2</a>"</span>
  <span class="quoted">"<a href="../List-Infinite/SetIntervalStep.html">List-Infinite.SetIntervalStep</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Time intervals -- definitions and basic lemmata›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> Time <span class="main">=</span> <span class="quoted">nat</span>

<span class="comment1">(* Time interval *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> iT <span class="main">=</span> <span class="quoted"><span class="quoted">"Time set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Infinite interval starting at some natural <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">iFROM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">…]</span>"</span><span class="main">)</span> <span class="comment1">(* [n, ∞) *)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">…]</span></span> <span class="main">≡</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">..}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finite interval starting at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and ending at some natural <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">iTILL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[…</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="comment1">(* [0, n] *)</span> <span class="comment1">(* Equivalent to [0…,n] *)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[…</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">{..</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finite bounded interval containing the naturals between 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">d</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes the difference between left and right interval bound.
  The number of elements is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">d</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> so that an empty interval cannot be defined.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">iIN</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> nat <span class="main">⇒</span> iT"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">…,</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="comment1">(* [n, n+d] *)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">…,</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">}</span>"</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Infinite modulo interval containing all naturals
  having the same division remainder modulo <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and beginning at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">iMOD</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> nat <span class="main">⇒</span> iT"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1">[</span> _<span class="keyword1">,</span> <span class="keyword1">mod</span> _ <span class="keyword1">]</span>"</span> <span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">,</span></span> <span class="keyword1"><span class="free">mod</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> <span class="bound">x</span><span class="main">}</span>"</span></span> 


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finite bounded modulo interval containing all naturals
  having the same division remainder modulo <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, beginning at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  and ending after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> cycles at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  The number of elements is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">c</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> so that an empty interval cannot be defined.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">iMODb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> iT"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1">[</span> _<span class="keyword1">,</span> <span class="keyword1">mod</span> _<span class="keyword1">,</span> _ <span class="keyword1">]</span>"</span> <span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">,</span></span> <span class="keyword1"><span class="free">mod</span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Membership in an interval›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_defs <span class="main">=</span> iFROM_def iTILL_def iIN_def iMOD_def iMODb_def

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iFROM_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iTILL_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iIN_geD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iIN_leD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iMOD_modD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iMOD_geD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iMODb_modD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iMODb_geD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iMODb_leD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_iff <span class="main">=</span> iFROM_iff iTILL_iff iIN_iff iMOD_iff iMODb_iff

<span class="keyword1"><span class="command">lemmas</span></span> iT_drule <span class="main">=</span>
  iFROM_D
  iTILL_D
  iIN_geD iIN_leD
  iMOD_modD iMOD_geD
  iMODb_modD iMODb_geD iMODb_leD

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  iTILL_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  iIN_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  iMOD_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  iMODb_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(*
lemma "0 &lt; n ⟹ ∃x ∈ [n…,2*n]. x mod 2 = 0"
apply (simp add: iT_defs)
apply (rule_tac x="2*n" in bexI)
apply simp
apply simp
done
lemma "0 &lt; n ⟹ ∃x ∈ [n…,2*n]. x mod 2 = 0"
apply (simp add: iT_defs atLeastAtMost_def atLeast_def atMost_def Collect_conj_eq[symmetric])
apply (rule_tac x="2*n" in exI)
apply simp
done
*)</span>



<span class="keyword1"><span class="command">lemma</span></span> iIN_Suc_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  insert <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span>Suc <span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_Suc_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span>Suc <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_Suc_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_Suc_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  insert <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> Suc <span class="free">c</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> Suc <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> add_le_imp_le_right<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> insert <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">…,</span>Suc <span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> insert <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff mod_diff_self2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_self2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_diff_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">m</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">m</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_self2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> insert <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> Suc <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_pred_insert_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="improper">x</span> <span class="main">∈</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_iff iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_Suc_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">[</span>Suc <span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iFROM_pred_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_Suc_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">n</span> <span class="main">[</span>Suc <span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span>Suc <span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iIN_pred_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_Suc_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">r</span> <span class="main">[</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iMOD_pred_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">r</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">m</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_Suc_pred_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">r</span> <span class="main">[</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> Suc <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_pred_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">r</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">m</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_Suc_insert <span class="main">=</span>
  iIN_Suc_insert_conv
  iTILL_Suc_insert_conv
  iMODb_Suc_insert_conv
<span class="keyword1"><span class="command">lemmas</span></span> iT_pred_insert <span class="main">=</span>
  iFROM_pred_insert_conv
  iIN_pred_insert_conv
  iMOD_pred_insert_conv
  iMODb_pred_insert_conv
<span class="keyword1"><span class="command">lemmas</span></span> iT_Suc_pred_insert <span class="main">=</span>
  iFROM_Suc_pred_insert_conv
  iIN_Suc_pred_insert_conv
  iMOD_Suc_pred_insert_conv
  iMODb_Suc_pred_insert_conv

<span class="keyword1"><span class="command">lemma</span></span> iMOD_mem_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff mod_eq_imp_diff_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_mem_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff mod_eq_imp_diff_mod_0<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interval conversions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_0_iTILL_conv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def iIN_def atMost_atLeastAtMost_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iTILL_iTILL_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">]</span> <span class="main">-</span> <span class="main">[…</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTILL_iff iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_iTILL_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs atLeastAtMost_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_iTILL_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">r</span><span class="main">+</span><span class="free">m</span><span class="main">*</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_defs set_interval_defs<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_iIN_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="free">m</span><span class="main">*</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_defs set_interval_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iTILL_iIN_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">n'</span><span class="main">-</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs atLeastAtMost_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_iTILL_iMODb_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_sub_mod_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_right_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iIN_iMODb_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">d</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv iMOD_iTILL_iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iTILL_iTILL_conv Diff_Int_distrib iMOD_iTILL_iMODb_conv diff_add_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> spec<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal iMOD_iff iTILL_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_0 iMOD_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_def iIN_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_def iIN_0 set_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_0 <span class="main">=</span>
  iFROM_0
  iTILL_0
  iIN_0
  iMOD_0
  iMODb_mod_0
  iMODb_0

<span class="keyword1"><span class="command">lemma</span></span> iMOD_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> Suc <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Finiteness and emptiness of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_not_empty <span class="main">=</span> 
  iFROM_not_empty
  iTILL_not_empty
  iIN_not_empty
  iMOD_not_empty
  iMODb_not_empty

<span class="keyword1"><span class="command">lemma</span></span> 
  iTILL_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_0_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs infinite_atLeast<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_infinite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> infinite <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> infinite_nat_iff_asc_chain<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> n<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n</span><span class="main">+</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_finite <span class="main">=</span>
  iTILL_finite
  iIN_finite
  iMODb_finite iMOD_0_finite

<span class="keyword1"><span class="command">lemmas</span></span> iT_infinite <span class="main">=</span>
  iFROM_infinite
  iMOD_infinite


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Min›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Max›</span></span></span></span> element of an interval›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iTILL_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_Min<span class="main">:</span>   <span class="quoted"><span class="quoted">"iMin <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_Min<span class="main">:</span>  <span class="quoted"><span class="quoted">"iMin <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iMin_equality<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_Min <span class="main">=</span> 
  iIN_Min
  iTILL_Min
  iFROM_Min
  iMOD_Min
  iMODb_Min

<span class="keyword1"><span class="command">lemma</span></span> 
  iTILL_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span><span class="main">+</span><span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_0_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_equality<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff iT_finite<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_Max <span class="main">=</span>
  iTILL_Max
  iIN_Max
  iMODb_Max
  iMOD_0_Max

<span class="keyword1"><span class="command">lemma</span></span>
  iTILL_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"iMax <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> enat <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"iMax <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"iMax <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_0_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"iMax <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> enat <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"iMax <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_iMax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> iMax <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMax_def iT_finite iT_infinite iT_Max<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_iMax <span class="main">=</span>
  iTILL_iMax
  iIN_iMax
  iMODb_iMax
  iMOD_0_iMax
  iFROM_iMax
  iMOD_iMax


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Adding and subtracting constants to interval elements›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> Suc <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">x</span>  <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iTILL_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Suc <span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> Suc <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_plus_divisor_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_plus_divisor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_minus_divisor_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_def mod_diff_mult_self1<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_minus_divisor_mult2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMOD_minus_divisor_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> mod_eq_imp_diff_mod_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_minus_divisor<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_geD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMOD_minus_divisor_mult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMOD_modD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute iMOD_plus_divisor_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">corollary</span></span> iMOD_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span>Suc <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">split</span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute iMOD_minus_divisor_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_Suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_plus_divisor_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_plus_divisor_mult2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMODb_plus_divisor_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib
  mod_0_div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> mod_eq_imp_diff_mod_0<span class="main"><span class="main">]</span></span>
  add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_plus_divisor<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff less_mod_eq_imp_add_divisor_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_minus_divisor_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_def mod_diff_mult_self1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>Suc <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv iMOD_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv iMOD_1 iFROM_Suc iTILL_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv iMOD_minus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv iMOD_minus iTILL_minus<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_pred<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iFROM_plus_minus <span class="main">=</span>
  iFROM_plus
  iFROM_Suc
  iFROM_minus
  iFROM_pred

<span class="keyword1"><span class="command">lemmas</span></span> iTILL_plus_minus <span class="main">=</span>
  iTILL_plus
  iTILL_Suc
  iTILL_minus
  iTILL_pred

<span class="keyword1"><span class="command">lemmas</span></span> iIN_plus_minus <span class="main">=</span>
  iIN_plus
  iIN_Suc
  iTILL_minus
  iIN_pred

<span class="keyword1"><span class="command">lemmas</span></span> iMOD_plus_minus_divisor <span class="main">=</span>
  iMOD_plus_divisor_mult
  iMOD_plus_divisor
  iMOD_minus_divisor_mult
  iMOD_minus_divisor_mult2
  iMOD_minus_divisor

<span class="keyword1"><span class="command">lemmas</span></span> iMOD_plus_minus <span class="main">=</span>
  iMOD_plus
  iMOD_Suc
  iMOD_minus
  iMOD_pred

<span class="keyword1"><span class="command">lemmas</span></span> iMODb_plus_minus_divisor <span class="main">=</span>
  iMODb_plus_divisor_mult
  iMODb_plus_divisor_mult2
  iMODb_plus_divisor
  iMODb_minus_divisor_mult

<span class="keyword1"><span class="command">lemmas</span></span> iMODb_plus_minus <span class="main">=</span>
  iMODb_plus
  iMODb_Suc
  iMODb_minus
  iMODb_pred

<span class="keyword1"><span class="command">lemmas</span></span> iT_plus_minus <span class="main">=</span>
  iFROM_plus_minus
  iTILL_plus_minus
  iIN_plus_minus
  iMOD_plus_minus_divisor
  iMOD_plus_minus
  iMODb_plus_minus_divisor
  iMODb_plus_minus


<span class="comment1">(*
lemma "a ∈ [3…,2] ⟹ 3 ≤ a ∧ a ≤ 5"
by (simp add: iT_iff)
lemma "15 ∈ [5, mod 10]"
by (simp add: iT_iff)


lemma "n ∈ [15, mod 10] ⟹ n ∈ [5, mod 10]"
by (simp add: iT_iff)

lemma "[15, mod 10] ⊆ [5, mod 10]"
by (fastforce simp: iMOD_def)

lemma "n ≤ i ⟹ n ∈ […i]"
by (simp add: iT_iff)
lemma "∀n ∈ […i]. n ≤ i"
by (simp add: iT_iff)

lemma "∃n ∈ [2, mod 10].n ∉ [12, mod 10]"
apply (simp add: iT_defs)
apply (rule_tac x=2 in exI)
apply simp
done
*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relations between intervals›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmata›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Suc_in_imp_not_subset_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> Suc <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMOD_Suc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> Suc_in_imp_neq_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> Suc <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Suc_in_imp_not_subset_iMOD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_in_imp_not_subset_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> Suc <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_Suc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMODb_leD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">corollary</span></span> Suc_in_imp_neq_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> Suc <span class="free">n</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Suc_in_imp_not_subset_iMODb<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subset relation between intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iIN_iFROM_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_iTILL_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_iFROM_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">…]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_iTILL_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">r</span><span class="main">+</span><span class="free">m</span><span class="main">*</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_iIN_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">…,</span><span class="free">m</span><span class="main">*</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_iMOD_subset_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_subset_same <span class="main">=</span> 
  iIN_iFROM_subset_same
  iIN_iTILL_subset_same
  iMOD_iFROM_subset_same
  iMODb_iTILL_subset_same
  iMODb_iIN_subset_same
  iMODb_iTILL_subset_same
  iMODb_iMOD_subset_same

<span class="keyword1"><span class="command">lemma</span></span> iMODb_imp_iMOD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_subset_same<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_imp_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_singleton_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_singleton_conv iT_not_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">+</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_singleton_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_singleton_conv iMOD_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_singleton_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_singleton_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_singleton_conv iT_not_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">+</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_0 iMODb_mod_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_singleton_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  subset_singleton_conv iMODb_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_singleton_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_imp_divisor_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c'</span><span class="main">;</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> gr0_imp_self_le_mult1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r'</span><span class="main">+</span><span class="free">m'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_subset_imp_divisor_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_add_eq_imp_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_subset_imp_iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_imp_iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff iMODb_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mod_eq_mod_0_imp_mod_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> m'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_subset_imp_divisor_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_0_iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 singleton_subset_conv iMOD_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMin_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iFROM_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Suc_in_imp_not_subset_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n'</span></span><span class="main"><span class="main">…]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">n'</span><span class="main">+</span><span class="free">d'</span> <span class="main">≤</span> <span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMin_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Max_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_not_empty _ iIN_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_Min iIN_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iFROM_iff iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iTILL_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMin_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Suc_in_imp_not_subset_iMOD<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_Suc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_1 iIN_iFROM_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iMODb_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d'</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMODb_iMOD_subset_same<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iMOD_subset_conv iMODb_mod_1 iIN_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_mod_1 iIN_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iTILL_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iFROM_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iIN_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">≤</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMin_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iTILL_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Max_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iTILL_not_empty _ iIN_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv iTILL_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iIN_iMOD_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iMODb_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iIN_iMODb_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iFROM_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iFROM_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iIN_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iTILL_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>  <span class="main">∧</span>  <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 singleton_subset_conv iMOD_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>  <span class="main">∧</span>  <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>  <span class="main">∧</span>  <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMOD_subset_imp_divisor_mod_0<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mod_eq_mod_0_imp_mod_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_mod_0_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span><span class="main">=</span><span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m'</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iMODb_singleton_subset_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_0_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">0</span> <span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span><span class="main">=</span><span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m'</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iMODb_singleton_subset_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_0_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r'</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>  <span class="main">∧</span>  <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>  <span class="main">∧</span>  <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>  <span class="main">∧</span>
   <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_subset_imp_iMOD_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMOD_subset_imp_divisor_mod_0<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI_ex2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_not_empty<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Max_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_not_empty _ iMODb_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff iMODb_Min iMODb_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_subset_imp_iMODb_subset iMOD_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m'</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>  <span class="main">∧</span>  <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>  <span class="main">∧</span>  <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>  <span class="main">∧</span>
   <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iMODb_singleton_subset_conv linorder_not_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> add_less_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">m'</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c'</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_subset_conv'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c'</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>  <span class="main">∧</span>  <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>  <span class="main">∧</span>  <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI_ex2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_not_empty<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_Min iMOD_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span> <span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv iMODb_subset_imp_divisor_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_iMOD_subset_same<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_subset_conv <span class="main">=</span>
  iFROM_subset_conv
  iFROM_iMOD_subset_conv
  iTILL_subset_conv
  iTILL_iFROM_subset_conv
  iTILL_iIN_subset_conv
  iTILL_iMOD_subset_conv
  iTILL_iMODb_subset_conv
  iIN_subset_conv
  iIN_iFROM_subset_conv
  iIN_iTILL_subset_conv
  iIN_iMOD_subset_conv
  iIN_iMODb_subset_conv
  iMOD_subset_conv
  iMOD_iFROM_subset_conv
  iMODb_subset_conv'
  iMODb_subset_conv
  iMODb_iFROM_subset_conv
  iMODb_iIN_subset_conv
  iMODb_iTILL_subset_conv
  iMODb_iMOD_subset_conv

<span class="keyword1"><span class="command">lemma</span></span> iFROM_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_subset_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iFROM_iIN_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="free"><span class="free">n'</span></span> <span class="main"><span class="main">(</span></span>Suc <span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_iFROM_iTILL_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> not_iFROM_iIN_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iFROM_iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_in_imp_not_subset_iMOD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_iFROM_iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_not_subset_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iFROM_infinite iMODb_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">;</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_subset_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iTILL_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iIN_iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d'</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_in_imp_not_subset_iMODb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_iIN_iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d'</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Int_greatest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iIN_iTILL_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv not_iIN_iMODb_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n'</span></span><span class="main"><span class="main">+</span></span><span class="free"><span class="free">d'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iTILL_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iFROM_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iIN_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv iTILL_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iTILL_iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> not_iIN_iMOD_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iTILL_iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n'</span><span class="main">;</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> not_iIN_iMODb_subset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iFROM_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iMOD_iFROM_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iMOD_iIN_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_not_subset_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_infinite iIN_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iMOD_iTILL_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_not_subset_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_infinite iTILL_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_iMOD_iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m'</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_not_subset_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_infinite iMODb_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iFROM_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iMODb_iFROM_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iTILL_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iMODb_iTILL_subset_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iIN_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iIN_subset_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">m'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">…]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">y</span><span class="main">…]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iFROM_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iFROM_D<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">y</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">x</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iTILL_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iTILL_D<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">y</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span><span class="main">;</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_geD iMOD_modD mod_self<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span><span class="main">;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_trans'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">y</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span><span class="main">;</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">+</span> <span class="free">c</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">z</span> <span class="main">∈</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMODb_trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">c'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_geD<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">*</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_refl<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2 diff_mult_distrib2 minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Equality of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> set_eq_subset<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">=</span> <span class="free">d'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> set_eq_subset<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">n'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_eq_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">∧</span> <span class="free">m'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_singleton_eq_conv eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span> iMOD_0_eq_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_subset iMOD_subset_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_singleton_eq_conv eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_0_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_singleton_eq_conv eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">r</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="free">m'</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">c'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iMODb_singleton_eq_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_subset iMODb_subset_conv'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iFROM_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMOD_eq_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iIN_0_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0 eq_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> eq_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span> iMODb_singleton_eq_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iIN_eq_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_mod_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMODb_eq_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Inequality of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iIN_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iFROM_infinite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> iIN_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_iTILL_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">≠</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iFROM_iIN_neq<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_iMOD_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_in_imp_neq_iMOD iFROM_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">corollary</span></span> iFROM_iMODb_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> iFROM_infinite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_iMOD_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMOD_infinite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> iIN_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_iMODb_neq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_in_imp_neq_iMODb iIN_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iMODb_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_ge2_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0 iMODb_singleton_eq_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iMODb_neq2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iIN_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_iMOD_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_iMOD_neq<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_iMODb_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_iMODb_neq2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iMODb_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> iMOD_infinite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_neq <span class="main">=</span> 
  iFROM_iTILL_neq iFROM_iIN_neq iFROM_iMOD_neq iFROM_iMODb_neq
  iTILL_iIN_neq iTILL_iMOD_neq iTILL_iMODb_neq
  iIN_iMOD_neq  iIN_iMODb_neq iIN_iMODb_neq2
  iMOD_iMODb_neq


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Union and intersection of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span>min <span class="free">n</span> <span class="free">n'</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_union' min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_inter'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span>max <span class="free">n</span> <span class="free">n'</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iFROM_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_inter' max_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span>max <span class="free">n</span> <span class="free">n'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTILL_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_union' max_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iFROM_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_inter'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span>min <span class="free">n</span> <span class="free">n'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_inter' min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Union and intersection for iIN 
  only when there intersection is not empty and 
  none of them is other's subset,
  for instance: 
  ..  n    ..   n+d
  ..      n'    ..   n'+d'
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">;</span> <span class="free">n'</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">n'</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d'</span><span class="main">]</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="comment1">(* The case of the second interval starting directly after the first one *)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_append_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">+</span> <span class="free">d'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_append_union_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span>Suc <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="free">d'</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_append_union_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">+</span> <span class="free">d'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n'</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n'</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span>min <span class="free">n</span> <span class="free">n'</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_append_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iFROM_union min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_append_union_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iFROM_union min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_append_union_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iFROM_union min_eqL<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iIN_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span><span class="main">;</span> <span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n'</span> <span class="main">+</span> <span class="free">d'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">d'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n'</span><span class="main">…,</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">n'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>min <span class="free">r</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_union min_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inter'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>max <span class="free">r</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_inter max_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">r'</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">+</span> <span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_mult_distrib2 diff_mult_distrib2 minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_append_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_union<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_append_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> Suc <span class="free">c</span> <span class="main">⟧</span>  <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">=</span> <span class="main">[</span>min <span class="free">r</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>min <span class="free">r</span> <span class="free">r'</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_le_imp_le_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iMOD_append_union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> Suc <span class="free">c</span> <span class="main">⟧</span>  <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span> <span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_append_union' min_eqL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_append_union_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> Suc <span class="free">c</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> Suc <span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="free">c'</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> insert_absorb<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">c</span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">[</span></span> <span class="free"><span class="free">r</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">*</span></span> Suc <span class="free"><span class="free">c</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">c'</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span> add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMODb_Suc_pred_insert_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_append_union<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_append_union_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∪</span> <span class="main">[</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_append_union_Suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">c</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> Suc <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMODb_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r'</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">;</span> <span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">r'</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">r'</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> mod_eq_imp_diff_mod_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemmas</span></span> iT_union' <span class="main">=</span> 
  iFROM_union'
  iTILL_union'
  iMOD_union'
  iMODb_iMOD_append_union'
<span class="keyword1"><span class="command">lemmas</span></span> iT_union <span class="main">=</span>
  iFROM_union
  iTILL_union
  iTILL_iFROM_union
  iIN_union
  iIN_iFROM_union
  iMOD_union
  iMODb_union
<span class="keyword1"><span class="command">lemmas</span></span> iT_union_append <span class="main">=</span>
  iIN_append_union
  iIN_append_union_Suc
  iIN_append_union_pred
  iIN_iFROM_append_union
  iIN_iFROM_append_union_Suc
  iIN_iFROM_append_union_pred
  iMODb_append_union
  iMODb_iMOD_append_union
  iMODb_append_union_Suc
  iMODb_append_union_pred

<span class="keyword1"><span class="command">lemmas</span></span> iT_inter' <span class="main">=</span>
  iFROM_inter'
  iTILL_inter'
  iMOD_inter'
<span class="keyword1"><span class="command">lemmas</span></span> iT_inter <span class="main">=</span>
  iFROM_inter
  iTILL_inter
  iIN_inter
  iMOD_inter
  iMODb_inter


<span class="keyword1"><span class="command">lemma</span></span> mod_partition_Union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span><span class="main">.</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">…,</span><span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">UNIV</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">∩</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">A</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_add_diff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_mod_le_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_mod_partition_Union<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> finite <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span><span class="main">≤</span>Max <span class="free">A</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">.</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span><span class="main">*</span><span class="free">m</span><span class="main">…,</span><span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_partition_Union<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
  P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">⋃</span></span><span class="bound"><span class="bound">k</span></span><span class="main"><span class="main">≤</span></span>Max <span class="free"><span class="free">A</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">A</span></span> <span class="main"><span class="main">∩</span></span> <span class="main"><span class="main">[</span></span><span class="bound"><span class="bound">k</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">m</span></span><span class="main"><span class="main">…,</span></span><span class="free"><span class="free">m</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x x1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> in_imp_not_empty<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> Max_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_imp_le_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_le_pred<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_partition_is_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span><span class="main">;</span> <span class="free">k</span> <span class="main">≠</span> <span class="free">k'</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">…,</span><span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">∩</span>  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">k'</span> <span class="main">*</span> <span class="free">m</span><span class="main">…,</span><span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_not_in_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">≤</span> <span class="improper">x</span><span class="main">;</span> <span class="improper">x</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="improper">x</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">=</span> <span class="bound">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_less_imp_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cutting intervals›</span></span>

<span class="comment1">(*
lemma "[10…,5] ↓&lt; 12 = [10…,1]"
apply (simp add: iT_iff cut_less_def)
apply (simp add: iT_defs set_interval_defs Collect_conj_eq[symmetric])
apply fastforce
done
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">t</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> i_cut_defs iT_defs atMost_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[…</span><span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_le iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_le iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iFROM_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span><span class="main">-</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_cut_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span> <span class="main">-</span> <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_le iT_iff<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> iIN_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> 
  <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span><span class="main">+</span><span class="free">d</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span><span class="main">-</span><span class="free">n</span><span class="main">]</span>
  <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_cut_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span> <span class="main">-</span> <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_le iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">{}</span> 
  <span class="keyword1">else</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iMODb_0 iIN_0 i_cut_empty i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Min_empty iMOD_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_less set_eq_iff i_cut_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_eq_imp_diff_mod_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="improper">x</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_le_mono2<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> mod_le_divisor<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_sub_mod_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_cut_le iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 cut_le_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Min_empty iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Max_all iT_Max iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMOD_iTILL_iMODb_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Int_right iTILL_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_le1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_cut_le iT_iff iMODb_mod_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iTILL_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="main">[…</span><span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all iT_Max iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iTILL_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_cut_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[…</span><span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_less iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iFROM_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{}</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iFROM_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_cut_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_less<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iIN_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span> 
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="free">n</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty iT_Min <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Max_all iT_Max iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iIN_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iIN_cut_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_less iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iMOD_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iMODb_mod_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_cut_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_diff_Suc_div_conv mod_eq_imp_diff_mod_0 iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iMODb_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_less1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_cut_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_diff_Suc_div_conv mod_eq_imp_diff_mod_0 iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_le <span class="main">=</span>
  iTILL_cut_le
  iFROM_cut_le
  iIN_cut_le
  iMOD_cut_le
  iMODb_cut_le

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_le1 <span class="main">=</span>
  iTILL_cut_le1
  iFROM_cut_le1
  iIN_cut_le1
  iMOD_cut_le1
  iMODb_cut_le1

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_less <span class="main">=</span>
  iTILL_cut_less
  iFROM_cut_less
  iIN_cut_less
  iMOD_cut_less
  iMODb_cut_less

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_less1 <span class="main">=</span>
  iTILL_cut_less1
  iFROM_cut_less1
  iIN_cut_less1
  iMOD_cut_less1
  iMODb_cut_less1

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_le_less <span class="main">=</span>
  iTILL_cut_le
  iTILL_cut_less
  iFROM_cut_le
  iFROM_cut_less
  iIN_cut_le
  iIN_cut_less
  iMOD_cut_le
  iMOD_cut_less
  iMODb_cut_le
  iMODb_cut_less

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_le_less1 <span class="main">=</span>
  iTILL_cut_le1
  iTILL_cut_less1
  iFROM_cut_le1
  iFROM_cut_less1
  iIN_cut_le1
  iIN_cut_less1
  iMOD_cut_le1
  iMOD_cut_less1
  iMODb_cut_le1
  iMODb_cut_less1

<span class="keyword1"><span class="command">lemma</span></span> iTILL_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span><span class="main">…,</span><span class="free">n</span><span class="main">-</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span><span class="main">…,</span><span class="free">n</span><span class="main">-</span><span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_ge iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_ge iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…,</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_greater1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…,</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_greater iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_cut_greater iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iFROM_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">t</span><span class="main">…]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iFROM_cut_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_ge iT_iff<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> iFROM_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iFROM_cut_greater1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_cut_greater iT_iff<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> iIN_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="keyword1">else</span> 
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span><span class="main">+</span><span class="free">d</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">t</span><span class="main">…,</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">-</span><span class="free">t</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_cut_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span><span class="main">…,</span><span class="free">n</span><span class="main">+</span><span class="free">d</span><span class="main">-</span><span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_ge iT_iff<span class="main">)</span> 

<span class="keyword1"><span class="command">corollary</span></span> iIN_cut_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_ge iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iIN_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="keyword1">else</span> 
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">+</span><span class="free">d</span> <span class="keyword1">then</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…,</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="free">t</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_cut_greater1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span><span class="main">⟹</span>
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Suc <span class="free">t</span><span class="main">…,</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_cut_greater iT_iff<span class="main">)</span> 


<span class="comment1">(*
lemma "let m=5 in let r = 12 in let t = 16 in
  [r, mod m] ↓&gt; t = (
  if t &lt; r then [r, mod m] else
  if (m = 0 ∧ r ≤ t) then {}
  else [r + (t - r) div m * m + m, mod m])"
apply (simp add: Let_def)
oops
lemma "let m=5 in let r = 12 in let t = 16 in
  [r, mod m] ↓&gt; t = (
  if t &lt; r then [r, mod m] else
  if (m = 0 ∧ r ≤ t) then {}
  else [t + m - (t - r) mod m, mod m])"
apply (simp add: Let_def)
oops
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> mod_cut_greater_aux_t_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span><span class="main">;</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">t</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_add_diff add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mod_cut_greater_aux_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">(</span><span class="free">r</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> diff_mod_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_add_assoc2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_diff_mod_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min cut_greater_Min_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_le_dividend<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_add_assoc2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_diff_mod_eq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_diff_mod_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">+</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_cut_greater_aux_t_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_greater1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_cut_greater iT_iff mod_eq_imp_diff_mod_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_greater_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">=</span>
  <span class="free">c</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_cut_greater_aux_t_less less_imp_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> diff_diff_left<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty iT_Max iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Min_all iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_Int_left iMOD_cut_greater<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMOD_iTILL_iMODb_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_cut_greater_aux_le_x<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_cut_greater_aux<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_greater1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span> 
    <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_cut_greater iT_iff mod_eq_imp_diff_mod_0<span class="main">)</span>

<span class="comment1">(*
lemma "let m=5 in let r = 12 in let t = 17 in
  [r, mod m] ↓≥ t = (
  if t ≤ r then [r, mod m] else
  if m=0 then {}
  else [t + m - Suc ((t - Suc r) mod m), mod m])"
apply (simp add: Let_def)
oops
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_0_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_cut_greater_ge_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMOD_cut_greater<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_cut_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> 
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_cut_ge<span class="main">)</span>

<span class="comment1">(*
lemma "let m=5 in let r = 12 in let t = 21 in let c=5 in
  [r, mod m, c] ↓≥ t = (
    if t ≤ r then [r, mod m, c] else
    if r + m * c &lt; t then {} 
    else [t + m - Suc ((t - Suc r) mod m), mod m, c - (t + m - Suc r) div m])"
apply (simp add: Let_def)
oops
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Max_empty iT_Max iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Min_all iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mod_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_diff_Suc_div_conv mod_eq_diff_mod_0_conv diff_add_assoc2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_diff_mod_0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> add_le_imp_le_diff2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_diff_mod_0_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mod_eq_diff_mod_0_conv add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mod_pred mod_eq_diff_mod_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_Int_left iMOD_cut_ge<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMOD_iTILL_iMODb_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mod_cut_greater_aux_le_x<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">c</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">t</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">m</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="free"><span class="free">r</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">m</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_imp_less_or_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_cut_greater_aux<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(-)</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_add_assoc2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> Suc <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> <span class="free">r</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_diff1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_cut_ge1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="main">{}</span> 
    <span class="keyword1">else</span> <span class="main">[</span><span class="free">t</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iT_iff iIN_0 i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_cut_ge iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_imp_diff_mod_eq_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> <span class="free">r</span> <span class="main">+</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_add1_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_eq_imp_diff_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff iMOD_0 iIN_0 i_cut_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_0_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff iMODb_mod_0 iIN_0 i_cut_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_ge <span class="main">=</span>
  iTILL_cut_ge
  iFROM_cut_ge
  iIN_cut_ge
  iMOD_cut_ge
  iMODb_cut_ge

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_ge1 <span class="main">=</span>
  iTILL_cut_ge1
  iFROM_cut_ge1
  iIN_cut_ge1
  iMOD_cut_ge1
  iMODb_cut_ge1

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_greater <span class="main">=</span>
  iTILL_cut_greater
  iFROM_cut_greater
  iIN_cut_greater
  iMOD_cut_greater
  iMODb_cut_greater

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_greater1 <span class="main">=</span>
  iTILL_cut_greater1
  iFROM_cut_greater1
  iIN_cut_greater1
  iMOD_cut_greater1
  iMODb_cut_greater1

<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_ge_greater <span class="main">=</span>
  iTILL_cut_ge
  iTILL_cut_greater
  iFROM_cut_ge
  iFROM_cut_greater
  iIN_cut_ge
  iIN_cut_greater
  iMOD_cut_ge
  iMOD_cut_greater
  iMODb_cut_ge
  iMODb_cut_greater
<span class="keyword1"><span class="command">lemmas</span></span> iT_cut_ge_greater1 <span class="main">=</span>
  iTILL_cut_ge1
  iTILL_cut_greater1
  iFROM_cut_ge1
  iFROM_cut_greater1
  iIN_cut_ge1
  iIN_cut_greater1
  iMOD_cut_ge1
  iMOD_cut_greater1
  iMODb_cut_ge1
  iMODb_cut_greater1


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_infinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_infinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_card_if<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0_card iMOD_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> Suc <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_Suc_insert_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> card_insert_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_finite iT_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_card_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  card <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0_card iMODb_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_card <span class="main">=</span>
  iFROM_card
  iTILL_card
  iIN_card
  iMOD_card_if
  iMODb_card_if

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Cardinality with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>icard›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_infinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">=</span> eSuc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iT_card eSuc_enat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_infinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_icard_if<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> eSuc <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iT_infinite eSuc_enat iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> eSuc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite eSuc_enat iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iMODb_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_icard_if<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> enat <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_finite iMODb_card_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_icard <span class="main">=</span>
  iFROM_icard
  iTILL_icard
  iIN_icard
  iMOD_icard_if
  iMODb_icard_if


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inext›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>iprev›</span></span></span></span> with intervals›</span></span>

<span class="comment1">(*
lemma "inext 5 […10] = 6"
apply (simp add: inext_def)
apply (simp add: iT_iff)
apply (simp add: iT_cut_greater)
apply (simp add: iT_not_empty)
apply (simp add: iT_Min)
done
lemma "inext 12 […10] = 12"
apply (simp add: inext_def)
apply (simp add: iT_iff)
done

lemma "inext 5 [4…,5] = 6"
apply (simp add: inext_def)
apply (simp add: iT_iff)
apply (simp add: iT_cut_greater)
apply (simp add: iT_not_empty)
apply (simp add: iT_Min)
done
lemma "inext 14 [2, mod 4] = 18"
apply (simp add: inext_def)
apply safe
apply (simp add: iMOD_cut_greater iT_iff 
  iT_Min)
apply (simp add: iT_iff)
apply (simp add: iMOD_cut_greater iT_iff 
  iT_not_empty)
done

lemma "iprev 5 […10] = 4"
apply (simp add: iprev_def)
apply (simp add: iT_iff)
apply (simp add: i_cut_defs)
apply safe
apply (simp add: iT_iff)
apply (rule le_antisym)
apply (rule iffD2[OF Max_le_iff])
apply fastforce+
done
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> Suc <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> Suc <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> Suc <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs inext_atLeast inext_atMost inext_atLeastAtMost<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iFROM_iprev'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> iprev <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span>  <span class="main">⟹</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟹</span> iprev <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_iprev'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iprev_atLeast iprev_atMost iprev_atLeastAtMost<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_def iMOD_cut_greater iT_iff iT_Min iT_not_empty mod_eq_imp_diff_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_def iMOD_cut_less iT_iff iT_Max iT_not_empty minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mod_eq_imp_diff_mod_eq_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iprev'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> iprev <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 iprev_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iprev iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_def iMODb_cut_greater iT_iff iT_Min iT_not_empty mod_eq_imp_diff_mod_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_def iMODb_cut_less iT_iff iT_Max iT_not_empty minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_Suc_right <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_Suc_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mod_eq_imp_diff_mod_eq_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  iprev <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iprev_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev iT_iff less_mod_eq_imp_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_inext <span class="main">=</span>
  iFROM_inext
  iTILL_inext
  iIN_inext
  iMOD_inext
  iMODb_inext
<span class="keyword1"><span class="command">lemmas</span></span> iT_iprev <span class="main">=</span>
  iFROM_iprev'
  iFROM_iprev
  iTILL_iprev
  iIN_iprev
  iIN_iprev'
  iMOD_iprev
  iMOD_iprev'
  iMODb_iprev
  iMODb_iprev'

<span class="keyword1"><span class="command">lemma</span></span> iFROM_inext_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="keyword1">then</span> Suc <span class="free">t</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_inext not_in_inext_fix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_inext_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> Suc <span class="free">t</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_inext iT_finite iT_Max inext_ge_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_inext_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">then</span> Suc <span class="free">t</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_inext iT_iff not_in_inext_fix iT_finite iT_Max inext_ge_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext not_in_inext_fix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">+</span> <span class="free">m</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_inext iT_iff not_in_inext_fix iT_finite iT_Max inext_ge_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_inext_if <span class="main">=</span>
  iFROM_inext_if
  iTILL_inext_if
  iIN_inext_if
  iMOD_inext_if
  iMODb_inext_if

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iprev_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iprev iT_Min iprev_le_iMin<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_iprev_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_iprev not_in_iprev_fix<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iprev_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span>  <span class="keyword1">then</span> <span class="free">t</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iprev iT_iff not_in_iprev_fix iT_Min iprev_le_iMin<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMOD_iprev_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iprev iT_iff not_in_iprev_fix iT_Min iprev_le_iMin<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">else</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev iT_iff not_in_iprev_fix iT_Min iprev_le_iMin<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_iprev_if <span class="main">=</span>
  iFROM_iprev_if
  iTILL_iprev_if
  iIN_iprev_if
  iMOD_iprev_if
  iMODb_iprev_if

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The difference between an element and the next/previous element is constant
  if the element is different from Min/Max of the interval›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_inext_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_inext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iprev_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">-</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iprev <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iprev_diff_const'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟹</span> Suc <span class="free">t</span> <span class="main">-</span> iprev <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_iprev'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_inext_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_inext<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_iprev_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">-</span> iprev <span class="free">t</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_iprev<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_inext_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_inext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iprev_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">-</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iprev<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iprev_diff_const'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> Suc <span class="free">t</span> <span class="main">-</span> iprev <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iprev<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iprev_diff_const'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> iprev <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iprev'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iprev_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">-</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iprev iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_inext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev_diff_const'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> iprev <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev_diff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">-</span> iprev <span class="free">t</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_mod_eq_imp_add_divisor_le<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_inext_diff_const <span class="main">=</span>
  iFROM_inext_diff_const
  iTILL_inext_diff_const
  iIN_inext_diff_const
  iMOD_inext_diff_const
  iMODb_inext_diff_const
<span class="keyword1"><span class="command">lemmas</span></span> iT_iprev_diff_const <span class="main">=</span>
  iFROM_iprev_diff_const
  iFROM_iprev_diff_const'
  iTILL_iprev_diff_const
  iIN_iprev_diff_const
  iIN_iprev_diff_const'
  iMOD_iprev_diff_const'
  iMOD_iprev_diff_const
  iMODb_iprev_diff_const'
  iMODb_iprev_diff_const


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Mirroring of intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iIN_mirror_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"mirror_elem <span class="free">x</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_mirror_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"mirror_elem <span class="free">x</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_mirror_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"mirror_elem <span class="free">x</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mirror_elem_def nat_mirror_def iT_Min iT_Max<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_imirror_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r'</span> <span class="main">+</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟹</span> 
  imirror_bounds <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">-</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">m'</span> <span class="main">*</span> <span class="free">c'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff Bex_def imirror_bounds_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> diff_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_right_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_diff_right_eq<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_le_mono2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">+</span><span class="free">r</span><span class="main">-</span><span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_swap<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_conv2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mod_sub_eq_mod_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_right_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_imirror_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟹</span> imirror_bounds <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">-</span> <span class="free">n</span> <span class="main">-</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMODb_imirror_bounds<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_imirror_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟹</span> imirror_bounds <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">[</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span> <span class="main">-</span> <span class="free">n</span><span class="main">…,</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iIN_imirror_bounds<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_imirror_bounds <span class="main">=</span>
  iTILL_imirror_bounds
  iIN_imirror_bounds
  iMODb_imirror_bounds


<span class="keyword1"><span class="command">lemma</span></span> iMODb_imirror_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"imirror <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> imirror_eq_imirror_bounds iMODb_Min iMODb_Max iMODb_imirror_bounds<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_imirror_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"imirror <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMODb_imirror_ident<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_imirror_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"imirror <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_imirror_ident<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_imirror_ident <span class="main">=</span>
  iTILL_imirror_ident
  iIN_imirror_ident
  iMODb_imirror_ident


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">inext_nth</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">iprev_nth</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_inext_nth <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs inext_nth_atLeast<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_inext_nth <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs inext_nth_atLeastAtMost<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iprev_nth_atLeastAtMost<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_inext_nth_if <span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_inext_nth inext_nth_card_Max iT_finite iT_not_empty iT_Max iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iprev_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iprev_nth iprev_nth_card_iMin iT_finite iT_not_empty iT_Min iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_inext_nth <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def inext_nth_atMost<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_inext_nth_if <span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iIN_inext_nth_if<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def iprev_nth_atMost<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_iprev_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">n</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iIN_iprev_nth_if<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext_if iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 inext_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_inext_if iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_inext_nth inext_nth_card_Max iT_finite iT_not_empty iT_Max iT_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iprev_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev_if iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_iprev_nth_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">←</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iprev_nth iprev_nth_card_iMin iT_finite iT_not_empty iT_Min iT_card<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">→</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_inext_nth iFROM_inext_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iFROM_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟹</span> inext <span class="free">a</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> inext <span class="free">a</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_inext_if iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iMODb_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext_nth iMODb_inext_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_iMODb_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟹</span> inext <span class="free">a</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> inext <span class="free">a</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_inext_if iT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext_nth_Suc_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext_nth <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> inext_nth.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_inext_nth_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">→</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_inext_nth diff_mult_distrib mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_inext_nth_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span><span class="main">;</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">→</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">→</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_inext_nth diff_mult_distrib  mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction with intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="free">n</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">…]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_inext_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="free">n</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">…,</span></span><span class="free"><span class="free">d</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_inext_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">0</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">;</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">n</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[…</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_inext_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="free">r</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_inext_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="free">r</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">c</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_inext_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_rev_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">;</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">n</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iprev_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">…,</span></span><span class="free"><span class="free">d</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Max iT_finite iT_iprev_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_rev_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="free">n</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iprev_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[…</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Max iT_finite iT_iprev_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_rev_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span><span class="main">;</span> <span class="bound">k</span> <span class="main">≠</span> <span class="free">r</span><span class="main">;</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iprev_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">c</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Max iT_finite iT_iprev_if<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IL_IntervalOperators">
<div class="head">
<h1>Theory IL_IntervalOperators</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IL_IntOperator.thy
    Date:       Jan 2007
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic operators on natural intervals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IL_IntervalOperators
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IL_Interval.html">IL_Interval</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic operations with intervals›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Addition of and multiplication by constants›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iT_Plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iT_Mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> iT_Mult_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">(* Some examples *)</span>
<span class="comment1">(*
lemma "[…10]⊕5 = {5..15}"
apply (simp only: iIN_0_iTILL_conv[symmetric])
apply (simp add: iT_defs)
apply (simp add: iT_Plus_def)
apply (simp add: image_add_atLeastAtMost)
done

lemma "[1…,2] = {1,2,3}"
apply (simp add: iIN_def)
apply fastforce
done

lemma "[1…,2]⊗2 = {2,4,6}"
apply (simp add: iT_Mult_def iIN_def)
apply auto
done
lemma "[10…]⊗k = {x*k | x. 10 ≤ x}"
apply (simp add: iFROM_def iT_Mult_def)
by blast

lemma "[…4] ⊗ 10 = {0, 10, 20, 30, 40}"
apply (simp add: iT_Mult_def iTILL_def)
by auto
lemma "[…4] ⊗ 10 ⊕ 2 = {2, 12, 22, 32, 42}"
apply (simp add: iT_Plus_def iT_Mult_def iTILL_def)
by auto
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_image_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_image_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def image_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def image_mono<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Mult_0_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty iT_Mult_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_mem_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def image_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_mem_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_mem_iff_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_mem_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_mem_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">+</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">*</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def image_Un<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def image_Int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def image_Int mult_right_inj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">⊕</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">⊗</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Mult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def iT_Mult_def image_image add_mult_distrib<span class="main">)</span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊗</span> <span class="free">n1</span> <span class="main">⊗</span> <span class="free">n2</span> <span class="main">⊗</span> <span class="free">n3</span> <span class="main">⊗</span> <span class="free">n4</span> <span class="main">⊗</span> <span class="free">n5</span> <span class="main">⊗</span> <span class="free">n6</span> <span class="main">⊗</span> <span class="free">n7</span> <span class="main">=</span>
  <span class="free">i</span> <span class="main">⊗</span> <span class="free">n1</span> <span class="main">*</span> <span class="free">n2</span> <span class="main">*</span> <span class="free">n3</span> <span class="main">*</span> <span class="free">n4</span> <span class="main">*</span> <span class="free">n5</span> <span class="main">*</span> <span class="free">n6</span> <span class="main">*</span> <span class="free">n7</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">⊕</span> <span class="free">n2</span> <span class="main">⊕</span> <span class="free">n3</span> <span class="main">⊕</span> <span class="free">n4</span> <span class="main">⊕</span> <span class="free">n5</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">+</span> <span class="free">n2</span> <span class="main">+</span> <span class="free">n3</span> <span class="main">+</span> <span class="free">n4</span> <span class="main">+</span> <span class="free">n5</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">n2</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_assoc iT_Plus_Mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">⊗</span> <span class="free">m1</span> <span class="main">⊗</span> <span class="free">m2</span> <span class="main">⊕</span> <span class="free">n2</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊗</span> <span class="free">m1</span> <span class="main">*</span> <span class="free">m2</span> <span class="main">⊕</span> <span class="free">n1</span> <span class="main">*</span> <span class="free">m1</span> <span class="main">*</span> <span class="free">m2</span> <span class="main">+</span> <span class="free">n2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_assoc iT_Mult_assoc iT_Plus_Mult_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_finite_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def inj_on_finite_image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_0_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0_if iTILL_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_finite_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def inj_on_finite_image_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_imp_inj_on<span class="main"><span class="main">]</span></span> mult_right_inj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iMin <span class="free">I</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def iMin_mono2 mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iMin <span class="free">I</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def iMin_mono2 mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Max <span class="free">I</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def Max_mono2 mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Max <span class="free">I</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def Max_mono2 mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span>
  iMOD_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iFROM_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊗</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty iT_Mult_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_mult_0 <span class="main">=</span>
  iTILL_mult_0
  iFROM_mult_0
  iIN_mult_0
  iMOD_mult_0
  iMODb_mult_0

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="main">0</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊗</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span>
  iFROM_add_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_add_Min<span class="main">:</span>   <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_add_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_add_Min<span class="main">:</span>  <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_add_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty iT_Plus_Min iT_Min<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  iFROM_mult_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_mult_Min<span class="main">:</span>   <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_mult_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_mult_Min<span class="main">:</span>  <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_mult_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty iT_Mult_Min iT_Min<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> iT_add_Min <span class="main">=</span>
  iIN_add_Min
  iTILL_add_Min
  iFROM_add_Min
  iMOD_add_Min
  iMODb_add_Min

<span class="keyword1"><span class="command">lemmas</span></span> iT_mult_Min <span class="main">=</span>
  iIN_mult_Min
  iTILL_mult_Min
  iFROM_mult_Min
  iMOD_mult_Min
  iMODb_mult_Min


<span class="keyword1"><span class="command">lemma</span></span> iFROM_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">+</span><span class="free">k</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_def iT_Plus_def image_add_atLeast<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span><span class="main">+</span><span class="free">k</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_def iT_Plus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">i</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span><span class="main">…,</span><span class="free">i</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iMOD_def iT_Plus_def image_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_sub_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">+</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iIN_conv iT_Plus_Int iMOD_add iIN_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_add <span class="main">=</span>
  iMOD_add
  iMODb_add
  iFROM_add
  iIN_add
  iTILL_add
  iT_Plus_singleton

<span class="keyword1"><span class="command">lemma</span></span> iFROM_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iT_mult_0 iIN_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span> <span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">d</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iT_mult_0 iIN_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel add_mult_distrib mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span> <span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">,</span> <span class="free">n</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_mult<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span> <span class="free">r</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iT_mult_0 iIN_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_mult2_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span> <span class="free">r</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iT_mult_0 iIN_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_Int iMOD_mult iTILL_mult iMODb_iMOD_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Int_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Int_absorb2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv add_mult_distrib2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_mult <span class="main">=</span>
  iTILL_mult
  iFROM_mult
  iIN_mult
  iMOD_mult
  iMODb_mult
  iT_Mult_singleton


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Some conversions between intervals using constant addition and multiplication›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> UNIV <span class="main">⊕</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iFROM_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iT_mult_0 iTILL_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_mult iMOD_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">c</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iT_mult_0 iTILL_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_mult iMODb_add<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some examples showing the utility of iMODb\_conv›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">12</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span> <span class="numeral">42</span><span class="main">,</span> <span class="numeral">52</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹The direct proof without iMODb\_conv fails›</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">12</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span> <span class="numeral">42</span><span class="main">,</span> <span class="numeral">52</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iT_Mult_def iT_Plus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">12</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span> <span class="numeral">42</span><span class="main">,</span> <span class="numeral">52</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iT_Mult_def iT_Plus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atMost_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">,</span> <span class="free">r</span><span class="main">+</span><span class="free">m</span><span class="main">,</span> <span class="free">r</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="free">m</span><span class="main">,</span> <span class="free">r</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">m</span><span class="main">,</span> <span class="free">r</span><span class="main">+</span><span class="numeral">4</span><span class="main">*</span><span class="free">m</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iT_Mult_def iT_Plus_def atMost_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_Collect<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">2</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">32</span><span class="main">,</span> <span class="numeral">42</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_defs iT_Plus_def iT_Mult_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subtraction of constants›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iT_Plus_neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕-</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="free">⊕-</span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_mem_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_mem_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_image_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def cut_ge_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">+</span><span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Plus_neg_mem_iff cut_ge_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Max_less_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv cut_ge_Max_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_not_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv cut_ge_not_empty_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span>finite <span class="free">I</span> <span class="main">∧</span> Max <span class="free">I</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_ge_infinite_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span> <span class="main">⊕-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">b</span> <span class="main">⊕-</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_assoc add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> <span class="main">0</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv cut_ge_0_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Plus_neg_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊕-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff Bex_def cut_ge_mem_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Plus_neg_assoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊕-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff Bex_def cut_ge_mem_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x'</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Plus_le_cut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff Bex_def cut_ge_mem_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x'</span> <span class="main">=</span> <span class="improper">x</span> <span class="main">+</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_imp_diff_le le_add_diff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_Plus_le_Min_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="free">a</span> <span class="main">≤</span> iMin <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Plus_le_cut_eq cut_ge_Min_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Plus_ge_cut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕-</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv iT_Plus_def cut_cut_ge max_eqL<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> image_comp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_Plus_ge_Min_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span><span class="main">;</span> <span class="free">a</span> <span class="main">≤</span> iMin <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Plus_ge_cut_eq cut_ge_Min_all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Mult_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">n</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">⊕-</span> <span class="free">n</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Plus_neg_image_conv image_iff iT_Plus_def iT_Mult_def Bex_def cut_ge_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x'</span> <span class="main">*</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x'</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Plus_le_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> iMin <span class="free">I</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Plus_le_Min_eq iT_Plus_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Plus_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Plus_ge_cut_eq iT_Plus_neg_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Plus_neg_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_Plus_neg_assoc iT_Plus_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Max_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> Max <span class="free">I</span><span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="free">k</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Plus_neg_mem_iff singleton_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_singleton1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">-</span><span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_singleton2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_finite_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> inj_on_finite_image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> cut_geE inj_on_diff_nat<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_ge_finite_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_mono2 monoI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Max <span class="free">I</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_mono2 monoI cut_ge_finite cut_ge_Max_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Subtractions of constants from intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Plus_neg_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTILL_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Plus_neg_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_add_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_add_neg<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTILL_add_neg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">k</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iFROM_iTILL_conv iT_Plus_neg_Int iFROM_add_neg iTILL_add_neg iFROM_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_add_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_add_neg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_add_neg iIN_0_iTILL_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_add_neg3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Max_less_empty iT_finite iT_Max<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_0_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">}</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0<span class="main">)</span>

<span class="comment1">(*
lemma "[25, mod 10] ⊕- 32 = [3, mod 10]"
apply (rule set_eqI)
apply (simp add: iT_Plus_neg_mem_iff iMOD_iff)
apply (simp add: mod_add_eq[of _ 32] mod_Suc)
apply clarify
apply (rule iffI)
apply simp+
done
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_gr0_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="main">[</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_def iT_Plus_neg_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span> mod_sub_add le_diff_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span> mod_add_eq_mod_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_gr0_add_neg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 iT_Plus_neg_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_add_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_add_neg2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_add_neg<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMODb_mod_0_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span><span class="main">}</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0<span class="main">)</span>

<span class="comment1">(*
lemma "[25, mod 10, 5] ⊕- 32 = [3, mod 10, 4]"
apply (rule set_eqI)
apply (simp add: iMODb_conv iT_Plus_neg_mem_iff iT_Plus_mem_iff iT_Mult_mem_iff)
apply (case_tac "x &lt; 3", simp)
apply (simp add: linorder_not_less)
apply (rule_tac t="(x - 3) mod 10 = 0" and s="x mod 10 = 3" in subst)
 apply (simp add: mod_eq_diff_mod_0_conv[symmetric])
apply (rule_tac t="(7 + x) mod 10 = 0" and s="x mod 10 = 3" in subst)
 apply (simp add: mod_add1_eq_if[of 7])
apply (rule conj_cong[OF refl])
apply (simp add: div_add1_eq_if)
apply (simp add: div_diff1_eq1)
apply (simp add: iTILL_iff)
done

lemma "[25, mod 10, 5] ⊕- 32 = [3, mod 10, 4]"
apply (simp add: iT_Plus_neg_image_conv iMODb_cut_ge)
apply (simp add: iMODb_conv iT_Mult_def iT_Plus_def)
apply (rule_tac t=4 and s="Suc(Suc(Suc(Suc 0)))" in subst, simp)
apply (simp add: iTILL_def atMost_Suc)
done
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_add_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>
    <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">then</span>
      <span class="main">[</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>
      <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_iMOD_iIN_conv iT_Plus_neg_Int iMOD_add_neg iIN_add_neg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iIN_iMODb_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMOD_iTILL_iMODb_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sub_mod_div_eq_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_add_neg'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">then</span>
      <span class="keyword1">if</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>
        <span class="keyword1">then</span> <span class="main">[</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>
        <span class="keyword1">else</span> <span class="main">[</span> <span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">(</span><span class="free">k</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span> <span class="main">]</span>
      <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_add_diff_mod_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_diff1_eq_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  div_diff1_eq_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_add_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="main">-</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_add_neg2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">[</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_add_neg2_mod_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">[</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg'<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_add_neg2_mod_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">[</span> <span class="free">m</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="main">(</span><span class="free">k</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">)</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_add_neg3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">k</span>  <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_add_neg<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_add_neg <span class="main">=</span>
  iFROM_add_neg
  iIN_add_neg
  iTILL_add_neg
  iMOD_add_neg
  iMODb_add_neg
  iT_Plus_neg_singleton


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subtraction of intervals from constants›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iT_Minus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊖</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main"><span class="free">⊖</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_mem_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">-</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_image_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">k</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Minus_def cut_le_def image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Minus_cut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">10</span> <span class="main">⊖</span> <span class="main">[…</span><span class="numeral">3</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">7</span><span class="main">…,</span><span class="numeral">3</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv cut_le_def image_Collect<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_nat_iff_bounded_le2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_bound<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_less_Min_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> iMin <span class="free">I</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv cut_le_Min_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Min_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">&lt;</span> iMin <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv cut_le_empty_iff iMin_gr_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*
An example:
  100 ⊖ {60, 70, 80, 90, 95} = {5, 10, 20, 30, 40}
  imirror {60, 70, 80, 90, 95} = {60, 65, 75, 95, 95}
  {60, 65, 75, 85, 95} ⊕ 100 ⊕- (60 + 95)
  = {160, 165, 175, 185, 195} ⊕- 155
  = {5, 10, 20, 30, 40}

I ⊕ k ⊕- (iMin I + Max I))
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_imirror_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> imirror <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">⊕-</span> <span class="main">(</span>iMin <span class="free">I</span> <span class="main">+</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty cut_le_empty imirror_empty iT_Plus_empty iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> iMin <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_less_Min_empty cut_le_Min_empty imirror_empty iT_Plus_empty iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> cut_le_Min_not_empty<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv iT_Plus_neg_image_conv iT_Plus_neg_mem_iff iT_Plus_mem_iff imirror_iff image_iff Bex_def i_cut_mem_iff cut_le_Min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="improper">x'</span> <span class="main">+</span> iMin <span class="free">I</span> <span class="main">+</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc le_add_diff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> le_add_diff nat_cut_le_finite cut_leI trans_le_add2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> add_right_cancel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add2 nat_cut_le_finite cut_le_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_imirror_conv'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">=</span> imirror <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">⊕-</span> <span class="main">(</span>iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty cut_le_empty imirror_empty iT_Plus_empty iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> iMin <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_less_Min_empty cut_le_Min_empty imirror_empty iT_Plus_empty iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Min_not_empty cut_le_Min_eq iT_Minus_imirror_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Max_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff iMinI_ex2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> iMin <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">(</span>Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> nat_cut_le_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> cut_le_Min_not_empty<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMin_equality<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff nat_cut_le_Max_le <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_le_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cut_le_subset<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> Max_in<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv image_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> diff_le_mono2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_ge_iff cut_le_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Minus_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_cut_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">I</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iT_Minus_Minus_cut_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Minus_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">k</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_Minus_eq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset iTILL_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Max_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_finite iTILL_Max<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* An example:
  10 ⊖ (100 ⊖ {97,98,99,101,102}) = {7,8,9}
  1000 ⊖ (100 ⊖ {97,98,99,101,102, 998,1002}) = {997,998,999}
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span> <span class="main">⊕-</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv iT_Plus_image_conv iT_Plus_neg_image_conv image_iff Bex_def i_cut_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Plus_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty iT_Minus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff iT_Plus_empty_iff iT_Plus_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Plus_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊖</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv iT_Plus_image_conv image_iff Bex_def i_cut_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Plus_cut_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_mem_iff iT_Minus_mem_iff cut_le_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Plus_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊖</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Minus_Plus_cut_assoc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Plus_assoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">⊆</span> <span class="main">[…</span><span class="free">k</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊖</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty iT_Plus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_Plus_assoc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset iTILL_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Max_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_finite iTILL_Max<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Minus_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">k</span> <span class="main">-</span> <span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv cut_le_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iT_Minus_singleton1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">k</span><span class="main">-</span><span class="free">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iT_Minus_singleton2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_singleton<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_sub_eq_mod_swap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_sub1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_sub<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_sub2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iTILL_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">…,</span><span class="free">n</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[…</span><span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Minus_mem_iff iT_iff<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_sub1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">…,</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_sub<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iTILL_sub2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_sub iIN_0_iTILL_conv<span class="main">)</span>

<span class="comment1">(* An example: 30 ⊖ [2, mod 10] = {8,18,28} *)</span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[</span> <span class="free">k</span> <span class="main">-</span> <span class="free">r</span> <span class="main">-</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iT_Minus_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Minus_Int<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_sub iTILL_sub<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="free">r</span> <span class="main">-</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> add_le_imp_le_diff2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_conv2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_le_dividend<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> diff_diff_left<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_iMOD_iIN_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_assoc minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iIN_inter<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iff mod_diff_mult_self2 diff_diff_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> diff_diff_left<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb2 iMODb_iTILL_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_sub1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_sub iMODb_mod_0<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_sub2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_sub3<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span> <span class="free">k</span> <span class="main">-</span> <span class="free">r</span> <span class="main">-</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_sub<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMOD_sub iMODb_mod_1 iIN_0_iTILL_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_sub1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">k</span><span class="main">-</span><span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_sub<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iFROM_sub_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iFROM_sub<span class="main">)</span>


<span class="comment1">(* Examples:
  10 ⊖ [2…,3] = {3,4,5,6,7,8}
  10 ⊖ [7…,5] = {0,1,2,3}
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iMODb_sub<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1 iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_sub1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_sub<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_sub2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">[…</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_sub iIN_0_iTILL_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_sub3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_sub<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_sub <span class="main">=</span>
  iFROM_sub
  iIN_sub
  iTILL_sub
  iMOD_sub
  iMODb_sub
  iT_Minus_singleton


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Division of intervals by constants›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity and injectivity of artithmetic operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_right_strict_mono_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> strict_mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_right_strict_mono_on<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">y</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">+</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mod_eq_imp_add_divisor_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMOD_div_right_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_on_imp_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_mult_div_right_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_is_0 mult_eq_0_iff <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_div_right_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_mult_div_right_inj_on2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_mult_div_right_inj_on<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_right_strict_mono_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> strict_mono_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_div_right_strict_mono_on iMODb_iMOD_subset_same<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_div_right_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_on_imp_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_mult_div_right_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMOD_mult_div_right_inj_on iMODb_iMOD_subset_same<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_mult_div_right_inj_on2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mult_div_right_inj_on<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iT_Div</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> Time <span class="main">⇒</span> iT"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊘</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="free">⊘</span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_image_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def image_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Div_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iT_Div_0_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span>
  iFROM_div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_div_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iT_not_empty<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_div_0 <span class="main">=</span>
  iTILL_div_0
  iFROM_div_0
  iIN_div_0
  iMOD_div_0
  iMODb_div_0

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊘</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mem_iff_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_0_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mem_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mem_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iT_Div_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mem_iff_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">x</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iT_Div_mem_iff iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less_div_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> less_eq_le_pred<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_imp_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="comment1">(* Examples:
  {1,2,3,4} ⊘ 3 ∩ {5,6,7} ⊘ 3 = {0,1} ∩ {1,2} = {1}
  ({1,2,3,4} ∩ {5,6,7}) ⊘ 3 = {} ⊘ 3 = {}
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> not_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">k</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⊘</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="bound">A</span> <span class="main">⊘</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="bound">B</span> <span class="main">⊘</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span>
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">3</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subset_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def subset_image_Int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iFROM_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> iMin <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_iT_Div_Int<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans iMin_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> iMin <span class="free">A</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff Bex_def iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMin_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">corollary</span></span> iTILL_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_iT_Div_Int<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iIN_iT_Div_Int_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff Bex_def iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_mod_0_imp_div_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_partition_iT_Div_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iIN_iT_Div_Int_mod_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_sub_1_div_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le pred_less_eq_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span> <span class="main">⊗</span> <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">*</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">*</span><span class="free">x</span><span class="main">,</span> <span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">corollary</span></span> mod_partition_iT_Div_Int2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> mod_partition_iT_Div_Int <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mod_partition_iT_Div_Int_one_segment<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> mod_partition_iT_Div_Int<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> mod_partition_iT_Div_Int_one_segment2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mod_partition_iT_Div_Int2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> mod_partition_iT_Div_Int2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊘</span> <span class="free">a</span> <span class="main">⊘</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def image_image div_mult2_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊘</span> <span class="free">a</span> <span class="main">⊘</span> <span class="free">b</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">b</span> <span class="main">⊘</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_assoc mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Div_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def iT_Div_def image_image<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_Div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span>  <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> iT_Mult_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iT_Mult_Div_self<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_Mult_self<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_def iT_Div_def image_image image_iff div_mult_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_Div_distrib_mod_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Div_def iT_Plus_def image_image image_iff div_add1_eq1<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_Div_distrib_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">n</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">=</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">⊕</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_0 iT_Div_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_Div_distrib_mod_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iMin <span class="free">I</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def iMin_mono2 mono_def div_le_mono<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span>
  iFROM_div_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_div_Min<span class="main">:</span>   <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_div_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_div_Min<span class="main">:</span>  <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_div_Min<span class="main">:</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty iT_Div_Min iT_Min<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_div_Min <span class="main">=</span>
  iFROM_div_Min
  iIN_div_Min
  iTILL_div_Min
  iMOD_div_Min
  iMODb_div_Min

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Max <span class="free">I</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def Max_mono2 mono_def div_le_mono<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span>
  iIN_div_Max<span class="main">:</span>   <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTILL_div_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_div_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty iT_finite iT_Div_Max iT_Max<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_0_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0_if iTILL_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_infinite_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> infinite <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> infinite <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> infinite_image_imp_infinite<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_nat_iff_unbounded_le image_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x1</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x2</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Div_finite_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Div_infinite_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iFROM_div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Div_def image_iff Bex_def iFROM_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">k</span> <span class="main">*</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> le_diff_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> minus_mod_eq_mult_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iIN_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span> <span class="free">d</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Div_def image_iff Bex_def iIN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> div_add1_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_diff_conv le_diff_conv2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_le_dividend<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">*</span> <span class="improper">x</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> less_imp_le_pred<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mult_le_mono2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> le_diff_conv2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> diff_le_mono2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_div_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span> <span class="free">d</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_def add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> div_add1_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> div_add1_eq2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_div_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_div_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_div_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span> Suc <span class="main">(</span><span class="free">d</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_div_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iIN_div_mod_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span><span class="free">d</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_div_eq1<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iTILL_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
   <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[…</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iIN_div_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Div_mem_iff Bex_def iT_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"
  <span class="keyword1">if</span> <span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="keyword1">else</span>
    <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">m</span><span class="main">)</span> <span class="main">+</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="main">-</span> <span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_conv add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_add_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> div_less order_less_le_trans mod_less_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> diff_add_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> div_mult_self1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_less<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_diff_less<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_add_diff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_add_assoc2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_le_add1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">corollary</span></span> iMOD_div_self<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">…]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_div_ge<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 iT_Div_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hypsubst_thin</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMOD_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">⊕</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">r</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_add mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="improper">q</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iT_Plus_Div_distrib_mod_less<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iMOD_mult iMOD_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mod_factor_imp_mod_0<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_Div<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mod_self<span class="main"><span class="main">]</span></span> iT_Mult_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_self<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">m</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">m</span><span class="main">…,</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iTILL_iT_Div_Int<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> div_mult_self1 div_mult_self2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mod_le_imp_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_div_self iTILL_div iFROM_iTILL_iIN_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">-</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_div_self<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> le_neq_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 iT_Div_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> Suc <span class="improper">c</span> <span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="improper">c</span> <span class="main">]</span> <span class="main">∪</span> <span class="main">{</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="improper">c</span> <span class="main">+</span> <span class="free">m</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMODb_append_union_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_0 iIN_0 add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Div_Un<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span> add.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="improper">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insert_absorb<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iff div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="improper">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="improper">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">-</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_Suc_insert_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iMODb_div_ge_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span>
  <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">…,</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_div_ge div_add1_eq_if<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">,</span> <span class="free">c</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iMODb_iMOD_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iTILL_iT_Div_Int<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_def iMOD_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mod_le_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mod_add1_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_mod_mult_right_0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mod_eq_mod_0_imp_mod_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_div iTILL_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iTILL_iMODb_conv div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.assoc iMODb_mod_0 iMOD_0 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_div <span class="main">=</span>
  iTILL_div
  iFROM_div
  iIN_div
  iMOD_div
  iMODb_div
  iT_Div_singleton

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This lemma is valid for all <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,i. e., also for k with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">m</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">k</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">c</span><span class="main">;</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">r'</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≠</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"iMin"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Min iT_not_empty iT_Div_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c'</span> <span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMODb_singleton_eq_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Max"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iIN_0 iT_Max iT_Div_Max iT_Div_finite_iff iT_Div_not_empty iT_finite iT_not_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_add1_eq_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">=</span> <span class="free">c</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">A</span></span><span class="main"><span class="main">.</span></span> card <span class="bound"><span class="bound">A</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_div_right_inj_on<span class="main"><span class="main">]</span></span> iMODb_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_div_right_strict_mono_on<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMODb_inext_nth_diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_Min iT_not_empty iT_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def inext_nth_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_not_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_inext_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_mod_gr0_is_0_not_ex0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">c</span><span class="main">;</span> <span class="free">r</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">r'</span> <span class="bound">m'</span> <span class="bound">c'</span><span class="main">.</span> <span class="main">[</span><span class="bound">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m'</span><span class="main">,</span> <span class="bound">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> r'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span>
  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMODb_div_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less_imp_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Max"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Max iT_Div_Max iT_Div_finite_iff iT_Div_not_empty iT_finite iT_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span> div_eq_0_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_mod_gr0_not_ex__arith_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x1</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">x1</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">x2</span> <span class="main">-</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="free">x3</span> <span class="main">+</span> <span class="free">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">x2</span> <span class="main">+</span> <span class="free">x3</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_le_mono1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">m</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_le_divisor<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_imp_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_mod_gr0_not_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">r'</span> <span class="bound">m'</span> <span class="bound">c'</span><span class="main">.</span> <span class="main">[</span><span class="bound">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m'</span><span class="main">,</span> <span class="bound">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_div_mod_gr0_is_0_not_ex0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> r'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span>
  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMODb_div_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less_imp_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Max"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Max iT_Div_Max iT_Div_finite_iff iT_Div_not_empty iT_finite iT_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult1_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">_</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">c</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_eq_imp_iMODb_div_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span><span class="main">;</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">iMin</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_Min iMOD_not_empty iMOD_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_div_right_strict_mono_on<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> strict_mono_on_imp_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMODb_div_right_strict_mono_on<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">∈</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span> <span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">]</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_cut_le1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_image<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_cut_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_0_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">c</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span> <span class="keyword1"><span class="keyword1">div</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">c</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">m</span><span class="main">;</span> <span class="main">[</span><span class="free">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">r'</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_div_eq_imp_iMODb_div_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_div_unique<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_mod_gr0_not_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r'</span> <span class="bound">m'</span><span class="main">.</span> <span class="main">[</span><span class="bound">r'</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m'</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">r'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span>
  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMOD_div_eq_imp_iMODb_div_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less_imp_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_div_mod_gr0_not_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interval cut operators with arithmetic interval operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  iT_Plus_cut_le2<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Plus_cut_less2<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Plus_cut_ge2<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Plus_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iT_Plus_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_empty_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_cut_le2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty iT_Plus_empty cut_less_empty_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_cut_less2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_0_all cut_ge_all_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_cut_ge2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_all_iff iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_cut_greater2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">t</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span>
  iT_Mult_cut_le2<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Mult_cut_less2<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Mult_cut_ge2<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Mult_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iT_Mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff cut_le_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mod_le_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">I</span> <span class="main">↓&lt;</span> Suc <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> iT_Mult_cut_less2 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff cut_less_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> less_Suc_eq_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> le_imp_less_or_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_mod_0_imp_div_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff cut_greater_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mod_ge_imp_div_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">I</span> <span class="main">↓≥</span> Suc <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> iT_Mult_cut_ge2 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff iT_Mult_mem_iff cut_ge_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_leI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_mod_greater_imp_div_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_le_lessD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_less_imp_le<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(↓≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(↓≥)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_cut_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sub_left_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Int_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_less2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iT_Plus_neg_Max_less_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cut_less_Max_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_less_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(↓&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(↓≥)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_cut_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sub_left_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Int_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_0_all iT_Plus_neg_cut_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(↓≥)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(↓≥)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_cut_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sub_left_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Int_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(↓&gt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(↓≥)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_cut_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sub_left_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_Int_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_cut_le2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> le_add2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_cut_less2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_cut_ge2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_cut_greater2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_less2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> iT_Minus_cut_less2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> iT_Minus_cut_ge2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> iT_Minus_cut_greater2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">t</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_le<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_Div_mem_iff Bex_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_le_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_0_empty iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_less_le_conv iT_Div_cut_le diff_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff i_cut_mem_iff iT_Div_mem_iff Bex_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_div_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_ge_greater_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iT_Div_cut_ge add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> iT_Div_cut_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_less2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> iT_Div_cut_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_ge2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> iT_Div_cut_ge<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_cut_greater2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊘</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> iT_Div_cut_greater<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">t</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inext›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>iprev›</span></span></span></span> with interval operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"inext <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inext <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Plus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inext_image2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_right_strict_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"iprev <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>iprev <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Plus_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iprev_image2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_right_strict_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_inext2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> inext <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inext <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_inext<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_prev2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> iprev <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>iprev <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_iprev<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"inext <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inext <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty inext_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0 inext_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def inext_image2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_right_strict_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"iprev <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>iprev <span class="free">n</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty iprev_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0 iprev_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_def iprev_image2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_right_strict_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_inext2_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inext <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>inext <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty inext_empty div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0 inext_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> iT_Mult_inext <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_inext_fix iT_Mult_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iprev2_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span>iprev <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span> <span class="keyword1">else</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty iprev_empty div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0 iprev_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> iT_Mult_iprev <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_iprev_fix iT_Mult_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Mult_inext2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> inext <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inext <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_inext2_if<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Mult_iprev2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">n</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> iprev <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>iprev <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_iprev2_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> inext <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> inext <span class="free">n</span> <span class="free">I</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty inext_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inext_cut_ge_conv<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_image<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cut_ge_Int_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Int_lower2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sub_left_strict_mono_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_inext_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  iprev <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iprev <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty i_cut_empty iprev_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_le_iMin<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iprev_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iT_Plus_neg_mem_iff2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iprev_image<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cut_ge_Int_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_on_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Int_lower2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sub_left_strict_mono_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> cut_ge_not_in_imp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_iprev_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_inext2<span class="main">:</span> <span class="quoted"><span class="quoted">"inext <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> inext <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_inext<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> le_add2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Plus_neg_iprev2<span class="main">:</span> <span class="quoted"><span class="quoted">"iprev <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> iprev <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Plus_neg_iprev<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> iprev <span class="free">n</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff cut_le_Min_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_imirror_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_inext2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> iMin <span class="free">I</span> <span class="main">+</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans_le_add2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_le_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_add_assoc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> add_diff_assoc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> iT_Plus_inext<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Min_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">I</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> nat_mirror_def mirror_elem_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_imirror_iprev_conv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_le_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_cut_le_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mirror_elem_def nat_mirror_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iprev_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"iMin <span class="main"><span class="main">(</span></span><span class="free"><span class="free">I</span></span> <span class="main"><span class="main">↓≤</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> Max <span class="main"><span class="main">(</span></span><span class="free"><span class="free">I</span></span> <span class="main"><span class="main">↓≤</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="free">n</span> <span class="main">∉</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_inext_fix not_in_iprev_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Minus_inext2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">n</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> iprev <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Minus_inext<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">k</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> inext <span class="free">n</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff cut_le_Min_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Minus_cut_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_refl<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iT_Minus_inext2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">k</span></span> <span class="main"><span class="main">⊖</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">I</span></span> <span class="main"><span class="main">↓≤</span></span> <span class="free"><span class="free">k</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Minus_cut_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> diff_diff_cancel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iprev_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iprev2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="free">n</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> inext <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> iT_Minus_iprev<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">k</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_iprev<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_iprev<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_not_empty_iff iT_Plus_neg_not_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_cut_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">I</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Plus_neg_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_ge_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_not_empty_iff iT_Plus_neg_not_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_Max cut_ge_Max_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_iprev<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff cut_le_Min_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Min<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_cut_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">I</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_inext<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_le_bound<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iprev_nth_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_le_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty_iff cut_le_Min_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Max cut_le_Min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_iprev<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_le_bound<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inext_nth_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_ge_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0 inext_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inext_nth_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mod_inext_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0 inext_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inext_nth_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mod_eq_div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_ge_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0 iprev_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iprev_nth_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mod_iprev_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">←</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0 iprev_nth_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iprev_nth_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ mod_eq_div_right_strict_mono_on<span class="main"><span class="main">]</span></span><span class="main">)</span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality of intervals with interval operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Plus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_imp_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_right_inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Mult_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_imp_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cut_ge_Int_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Int_lower2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sub_left_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_card_le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_ge_card<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_ge_finite_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cut_le_Int_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Int_lower2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sub_right_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_card_le<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iT_Minus_card<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> cut_le_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_0_card_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_empty iT_Div_0 iTILL_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Int_empty_sum<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">{}</span> <span class="main">∩</span> <span class="main">(</span><span class="free">I</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_eq_0_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_atMost<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mod_partition_card<span class="main">:</span><span class="quoted"><span class="quoted">"
  card <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0 iTILL_0 iT_Div_0_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff Bex_def iIN_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_less_imp_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less_imp_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_conv_count<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff_Int<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_conv_count2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_conv_count<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le iIN_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_less_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Max <span class="free"><span class="free">I</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Max_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_partition_count_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> Suc <span class="free">n</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">=</span>
  <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span>Suc <span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">{</span>Suc <span class="free">n</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span> less_Suc_eq_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_disj_distribR<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">I</span><span class="main">.</span><span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="bound">I</span><span class="main">;</span> Max <span class="bound">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span>
  card <span class="main">(</span><span class="bound">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span>
    <span class="keyword1">if</span> <span class="bound">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_conv_count2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_eq_0_conv iIN_0_iTILL_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_1_singleton_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_partition_count_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="improper">n</span> <span class="main">∧</span> <span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span><span class="improper">x</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊆</span> <span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Int_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_iTILL_subset_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_conv add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="main">]</span></span> iTILL_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="improper">n</span> <span class="main">⟹</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Int_commute<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_def cut_le_Int_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_le_Max_all<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_Max diff_le_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
  <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="improper">n</span> <span class="main">∧</span> <span class="improper">I</span> <span class="main">∩</span> <span class="main">(</span><span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">=</span>
  <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="improper">n</span> <span class="main">∧</span> <span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Div_card_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">I</span><span class="main">.</span><span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="bound">I</span><span class="main">;</span> Max <span class="bound">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span>
  card <span class="main">(</span><span class="bound">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>Suc <span class="free">n</span><span class="main">.</span>
    <span class="keyword1">if</span> <span class="bound">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_Suc_atMost iT_Div_card<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> iT_Div_Max_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span>
  card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Max <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">.</span>
    <span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def card_image_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"
  inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> card <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Div_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> card_image<span class="main">)</span>

<span class="comment1">(*
lemma "let I=[…19] in
  d ∈ {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21} ⟶
  card I div d ≤ card (I ⊘ d)"
apply (simp add: Let_def iTILL_card iTILL_div)
done
lemma "let I=[…19] in
  d ∈ {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21} ⟶
  card I div d + (if card I mod d ≠ 0 then 1 else 0) ≤ card (I ⊘ d)"
apply (simp add: Let_def iTILL_card iTILL_div)
done
lemma "let I=[5…,19] in
  d ∈ {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21} ⟶
  card I div d + (if card I mod d ≠ 0 then 1 else 0) ≤ card (I ⊘ d)"
apply (simp add: Let_def iIN_card iIN_div)
done
*)</span>


<span class="comment1">(* ToDo: to be moved to Util_Div *)</span>

<span class="keyword1"><span class="command">lemma</span></span> mod_Suc'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Suc <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> le_neq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_less_divisor<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> Suc_leI<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> div_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Suc <span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Suc <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> le_imp_less_or_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_add1_eq2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> le_neq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_less_divisor<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> Suc_leI<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> div_add1_eq1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> div_Suc'<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Suc <span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span> <span class="keyword1">else</span> Suc <span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> le_neq_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_less_divisor<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> Suc_leI<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card_ge_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⋀</span><span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="bound">I</span><span class="main">;</span> Max <span class="bound">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span>
  card <span class="bound">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="bound">I</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="bound">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="improper">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_le_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_eq_0_conv'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_singleton card_singleton <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_le_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Suc_le_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">d</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_card_le_Max<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"card <span class="improper">I</span> <span class="main">≠</span> <span class="free">d</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">∪</span> <span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span>Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_union<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Int_absorb2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv iTILL_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_atMost_Max_le_conv le_less_div_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> less_eq_le_pred<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span>Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> card_Un_disjoint<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_iff_in_not_in1 iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_mod_partition_card <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Int_card2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_card<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Int_card2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_finite<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_card<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> order_le_less<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Max_Int_le2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iTILL_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iT_Div_Un<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span>Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> card_Un_disjoint<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mod_partition_iT_Div_Int_one_segment<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">+</span><span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> mod_partition_iT_Div_Int2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjoint_iff_in_not_in1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_div_mod_eq_0<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_sub_1_div_conv iIN_0_iTILL_conv iIN_0 iTILL_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iT_Div_mod_partition_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_le_divisor_imp_le_Suc_div<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_leD1<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Int_card2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_finite<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> le_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Int_card2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iIN_finite<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">I</span><span class="main">=</span><span class="improper">I</span> <span class="main">∩</span> <span class="main">[…</span><span class="improper">n</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="keyword1">in</span>
  card <span class="bound">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="bound">I</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="improper">I</span> <span class="main">∩</span> <span class="main">[</span>Suc <span class="improper">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="free">d</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_add1_eq1_mod_0_left<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_le_divisor_imp_le_Suc_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"
  card <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="free">I</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_card_ge_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Div_card_ge_div<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> card <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iT_Div_card_ge<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> add_leD1<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  There is no better lower bound function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">i</span></span> <span class="main"><span class="main">⊘</span></span> <span class="free"><span class="free">d</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"card <span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as arguments.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Div_card_ge__is_maximal_lower_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">I</span> <span class="bound">d</span><span class="main">.</span> card <span class="bound">I</span> <span class="keyword1">div</span> <span class="bound">d</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="bound">I</span> <span class="keyword1">mod</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>card <span class="bound">I</span><span class="main">)</span> <span class="bound">d</span> <span class="main">∧</span>
        <span class="free">f</span> <span class="main">(</span>card <span class="bound">I</span><span class="main">)</span> <span class="bound">d</span> <span class="main">≤</span> card <span class="main">(</span><span class="bound">I</span> <span class="main">⊘</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">f</span> <span class="main">(</span>card <span class="main">(</span><span class="free">I</span><span class="main">::</span>nat set<span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> card <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="free">I</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_card iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[…</span>card <span class="free">I</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> not_empty_card_gr0_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTILL_card iTILL_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_sub_1_div_conv<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> card <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> div_le_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_diff1_eq1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_def icard_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iT_Mult_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> icard_image<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_imp_inj_on<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_finite_iff cut_ge_finite icard_finite iT_Plus_neg_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_finite_iff nat_cut_ge_finite_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_icard_le<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_finite_iff icard_finite iT_Plus_neg_card_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Minus_finite nat_cut_le_finite iT_Minus_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_icard_le<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">≤</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Minus_finite iT_Minus_card_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_0_icard_if<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> enat <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Div_0_finite iT_Div_0_card_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_mod_partition_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"
  icard <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
  enat <span class="main">(</span><span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="free">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0_finite<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff iIN_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Div_mod_partition_card<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> finite <span class="free">I</span> <span class="main">⟹</span> Max <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span>
  icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">I</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Div_finite_iff iT_Div_card<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Div_Max_icard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span>
  icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">I</span>
    <span class="keyword1">then</span> enat <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span>Max <span class="free">I</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">I</span> <span class="main">∩</span> <span class="main">[</span><span class="bound">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">…,</span><span class="free">d</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_icard<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_icard_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff icard_finite iT_Div_card_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_icard_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span> <span class="free">I</span> <span class="main">⟹</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> icard <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_def icard_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_icard_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="free">I</span> <span class="keyword1">div</span> <span class="main">(</span>enat <span class="free">d</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="keyword1">if</span> icard <span class="free">I</span> <span class="keyword1">mod</span> <span class="main">(</span>enat <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite iT_Div_0_finite<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"icard <span class="free">I</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_0_card_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0_card_if icard_infinite_conv infinite_imp_nonempty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff icard_finite iT_Div_card_ge<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iT_Div_icard_ge_div<span class="main">:</span> <span class="quoted"><span class="quoted">"icard <span class="free">I</span> <span class="keyword1">div</span> <span class="main">(</span>enat <span class="free">d</span><span class="main">)</span> <span class="main">≤</span> icard <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iT_Div_icard_ge<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iadd_ileD1<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Div_icard_ge__is_maximal_lower_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">I</span> <span class="bound">d</span><span class="main">.</span> icard <span class="bound">I</span> <span class="keyword1">div</span> <span class="main">(</span>enat <span class="bound">d</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="keyword1">if</span> icard <span class="bound">I</span> <span class="keyword1">mod</span> <span class="main">(</span>enat <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>
        <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>icard <span class="bound">I</span><span class="main">)</span> <span class="bound">d</span> <span class="main">∧</span>
        <span class="free">f</span> <span class="main">(</span>icard <span class="bound">I</span><span class="main">)</span> <span class="bound">d</span> <span class="main">≤</span> icard <span class="main">(</span><span class="bound">I</span> <span class="main">⊘</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">f</span> <span class="main">(</span>icard <span class="main">(</span><span class="free">I</span><span class="main">::</span>nat set<span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span>
  icard <span class="free">I</span> <span class="keyword1">div</span> <span class="main">(</span>enat <span class="free">d</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="keyword1">if</span> icard <span class="free">I</span> <span class="keyword1">mod</span> <span class="main">(</span>enat <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0_icard_if icard_0_eq<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> zero_enat_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> iT_Div_finite_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> the_enat <span class="main">(</span><span class="free">f</span> <span class="main">(</span>enat <span class="bound">c</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iT_Div_card_ge__is_maximal_lower_bound<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> I' d'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">d'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">d'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idiv_by_0 imod_by_0 iT_Div_0_card_if iT_Div_0_icard_if<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">I'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="improper">I'</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="improper">I'</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">d'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iT_Div_finite_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>enat <span class="main">(</span>card <span class="improper">I'</span><span class="main">)</span><span class="main">)</span> <span class="improper">d'</span> <span class="main">=</span> enat <span class="bound">n</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> enat_ile<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="improper">I'</span> <span class="main">⊘</span> <span class="improper">d'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> icard_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>enat <span class="main">(</span>card <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> enat <span class="bound">n</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> enat_ile<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Results about sets of intervals›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Set of intervals without and with empty interval›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iFROM_UN_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iFROM_UN_set</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">n</span><span class="main">…]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iTILL_UN_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iTILL_UN_set</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="main">[…</span><span class="bound">n</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iIN_UN_set</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iIN_UN_set</span>   <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span> <span class="bound">d</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">n</span><span class="main">…,</span><span class="bound">d</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMOD_UN_set</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMOD_UN_set</span>  <span class="main">≡</span> <span class="main">⋃</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMODb_UN_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMODb_UN_set</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iFROM_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iFROM_set</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">n</span><span class="main">…]</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iTILL_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iTILL_set</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[…</span><span class="bound">n</span><span class="main">]</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iIN_set</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iIN_set</span>   <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">n</span><span class="main">…,</span><span class="bound">d</span><span class="main">]</span> <span class="main">|</span><span class="bound">n</span> <span class="bound">d</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMOD_set</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMOD_set</span>  <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span> <span class="main">|</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMODb_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMODb_set</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span> <span class="main">|</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> True<span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMOD2_set</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMOD2_set</span>  <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span> <span class="main">|</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMODb2_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMODb2_set</span> <span class="main">≡</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span> <span class="main">|</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMOD2_UN_set</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMOD2_UN_set</span>  <span class="main">≡</span> <span class="main">⋃</span><span class="bound">r</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">..}</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iMODb2_UN_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iMODb2_UN_set</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">r</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">..}</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">c</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..}</span><span class="main">.</span> <span class="main">{</span><span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_defs <span class="main">=</span>
  iFROM_set_def iTILL_set_def iIN_set_def
  iMOD_set_def iMODb_set_def
  iMOD2_set_def iMODb2_set_def
<span class="keyword1"><span class="command">lemmas</span></span> i_UN_set_defs <span class="main">=</span>
  iFROM_UN_set_def iTILL_UN_set_def iIN_UN_set_def
  iMOD_UN_set_def iMODb_UN_set_def
  iMOD2_UN_set_def iMODb2_UN_set_def

<span class="keyword1"><span class="command">lemma</span></span> iFROM_set_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"iFROM_set <span class="main">=</span> iFROM_UN_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iFROM_set_def iFROM_UN_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iTILL_set_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"iTILL_set <span class="main">=</span> iTILL_UN_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iIN_set_UN_set_eq<span class="main">:</span>   <span class="quoted"><span class="quoted">"iIN_set <span class="main">=</span> iIN_UN_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMOD_set_UN_set_eq<span class="main">:</span>  <span class="quoted"><span class="quoted">"iMOD_set <span class="main">=</span> iMOD_UN_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iMODb_set_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"iMODb_set <span class="main">=</span> iMODb_UN_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_defs i_UN_set_defs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD2_set_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"iMOD2_set <span class="main">=</span> iMOD2_UN_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_defs i_UN_set_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb2_set_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"iMODb2_set <span class="main">=</span> iMODb2_UN_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_defs i_UN_set_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_i_UN_set_sets_eq <span class="main">=</span>
  iFROM_set_UN_set_eq
  iTILL_set_UN_set_eq
  iIN_set_UN_set_eq
  iMOD_set_UN_set_eq
  iMODb_set_UN_set_eq
  iMOD2_set_UN_set_eq
  iMODb2_set_UN_set_eq

<span class="keyword1"><span class="command">lemma</span></span> iMOD2_set_iMOD_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"iMOD2_set <span class="main">⊆</span> iMOD_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb2_set_iMODb_set_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"iMODb2_set <span class="main">⊆</span> iMODb_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_defs<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set</span> <span class="main">≡</span> iFROM_set <span class="main">∪</span> iTILL_set <span class="main">∪</span> iIN_set <span class="main">∪</span> iMOD_set <span class="main">∪</span> iMODb_set"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_UN_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_UN_set</span> <span class="main">≡</span> iFROM_UN_set <span class="main">∪</span> iTILL_UN_set <span class="main">∪</span> iIN_UN_set <span class="main">∪</span> iMOD_UN_set <span class="main">∪</span> iMODb_UN_set"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Minimal definitions for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">i_set</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">i_set</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set_min</span> <span class="main">≡</span> iFROM_set <span class="main">∪</span> iIN_set <span class="main">∪</span> iMOD2_set <span class="main">∪</span> iMODb2_set"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_UN_set_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_UN_set_min</span> <span class="main">≡</span> iFROM_UN_set <span class="main">∪</span> iIN_UN_set <span class="main">∪</span> iMOD2_UN_set <span class="main">∪</span> iMODb2_UN_set"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set0</span> <span class="main">≡</span> insert <span class="main">{}</span> i_set"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_set_i_UN_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set <span class="main">=</span> i_UN_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_def i_UN_set_def i_set_i_UN_set_sets_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_min_i_UN_set_min_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_min <span class="main">=</span> i_UN_set_min"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_min_def i_UN_set_min_def i_set_i_UN_set_sets_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_min_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set <span class="main">=</span> i_set_min"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_set_def i_set_min_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="improper">m</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_ge2_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMOD_0 iMOD_1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="improper">c</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="improper">m</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_ge2_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iMODb_mod_0 iMODb_mod_1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linorder_not_le less_Suc_eq_le iMODb_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Un_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD2_set_iMOD_set_subset iMODb2_set_iMODb_set_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_UN_set_i_UN_min_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_UN_set <span class="main">=</span> i_UN_set_min"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_min_eq i_set_i_UN_set_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_set_min_i_UN_set_min_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_min_is_minimal_let<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="keyword1">let</span> <span class="bound">s1</span> <span class="main">=</span> iFROM_set<span class="main">;</span> <span class="bound">s2</span><span class="main">=</span> iIN_set<span class="main">;</span> <span class="bound">s3</span><span class="main">=</span> iMOD2_set<span class="main">;</span> <span class="bound">s4</span><span class="main">=</span> iMODb2_set <span class="keyword1">in</span>
  <span class="bound">s1</span> <span class="main">∩</span> <span class="bound">s2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∩</span> <span class="bound">s3</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∩</span> <span class="bound">s4</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
  <span class="bound">s2</span> <span class="main">∩</span> <span class="bound">s3</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">∩</span> <span class="bound">s4</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">∩</span> <span class="bound">s4</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Let_def i_set_defs<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjoint_iff_in_not_in1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_neq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_min_is_minimal <span class="main">=</span> i_set_min_is_minimal_let<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>


<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">i_set_ind</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  i_set_ind_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…]</span> <span class="main">∈</span> <span class="free">i_set_ind</span>"</span></span>
<span class="main">|</span> i_set_ind_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_ind</span>"</span></span>
<span class="main">|</span> i_set_ind_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_ind</span>"</span></span>
<span class="main">|</span> i_set_ind_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_ind</span>"</span></span>
<span class="main">|</span> i_set_ind_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_ind</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">i_set0_ind</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  i_set0_ind_empty<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="free">i_set0_ind</span>"</span></span>
<span class="main">|</span> i_set0_ind_i_set<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∈</span> i_set_ind <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∈</span> <span class="free">i_set0_ind</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The introduction rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i_set0_ind_i_set›</span></span></span></span> is not declared a safe introduction rule,
  because it would disturb the correct usage of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>safe›</span></span></span></span> method.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_ind_subset_i_set0_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_ind <span class="main">⊆</span> i_set0_ind"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set0_ind_i_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  i_set0_ind_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∈</span> i_set0_ind"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_ind_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> i_set0_ind"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_ind_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∈</span> i_set0_ind"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_ind_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set0_ind"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_ind_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∈</span> i_set0_ind"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_ind_subset_i_set0_ind<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_ind.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set0_ind_intros2 <span class="main">=</span>
  i_set0_ind_empty
  i_set0_ind_FROM
  i_set0_ind_TILL
  i_set0_ind_IN
  i_set0_ind_MOD
  i_set0_ind_MODb

<span class="keyword1"><span class="command">lemma</span></span> i_set_i_set_ind_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set <span class="main">=</span> i_set_ind"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> i_set_def i_set_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_i_set0_ind_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0 <span class="main">=</span> i_set0_ind"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> i_set0_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set0_ind.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_imp_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_not_empty<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_i_set_mem_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∈</span> i_set0<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">∈</span> i_set <span class="main">∨</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set0_ind.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_i_set0_mem_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∈</span> i_set<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">∧</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> i_set_imp_not_empty<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set0_i_set_mem_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_i_set_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0 <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_i_set0_mem_conv<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_set_subset_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set <span class="main">⊆</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_set_def iIN_set_def iIN_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_subset_i_set0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iIN_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_set_i_set_ind_eq i_set_ind.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  i_set_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∈</span> i_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> i_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∈</span> i_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_i_set_ind_eq<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_ind.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_intros <span class="main">=</span>
  i_set_FROM
  i_set_TILL
  i_set_IN
  i_set_MOD
  i_set_MODb

<span class="keyword1"><span class="command">lemma</span></span>
  i_set0_empty<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set0_i_set0_ind_eq<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set0_ind_intros2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set0_intros <span class="main">=</span>
  i_set0_empty
  i_set0_FROM
  i_set0_TILL
  i_set0_IN
  i_set0_MOD
  i_set0_MODb


<span class="keyword1"><span class="command">lemma</span></span> i_set_infinite_as_iMOD<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> infinite <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="free">I</span> <span class="main">=</span> <span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_finite_as_iMODb<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> finite <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> <span class="free">I</span> <span class="main">=</span> <span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_infinite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1 iIN_0_iTILL_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMODb_mod_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_0 iIN_0 iMODb_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_infinite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_as_iMOD_iMODb<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">m</span><span class="main">.</span> <span class="free">I</span> <span class="main">=</span> <span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">.</span> <span class="free">I</span> <span class="main">=</span> <span class="main">[</span><span class="bound">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">c</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> i_set_finite_as_iMODb i_set_infinite_as_iMOD<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interval sets are closed under cutting›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cut_le_ge_closed_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓≤)</span> <span class="main">∨</span> <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓≥)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">cut_op</span> <span class="free">I</span> <span class="free">t</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_cut_le1 iT_cut_ge1 i_set_ind.intros iMODb_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  i_set_cut_le_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">∈</span> i_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set_cut_ge_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_cut_le_ge_closed_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_cut_le_ge_closed <span class="main">=</span> i_set_cut_le_closed i_set_cut_ge_closed

<span class="keyword1"><span class="command">lemma</span></span> i_set0_cut_closed_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set0<span class="main">;</span>
    <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓≤)</span> <span class="main">∨</span> <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓≥)</span> <span class="main">∨</span>
    <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓&lt;)</span> <span class="main">∨</span> <span class="free">cut_op</span> <span class="main">=</span> <span class="main">(↓&gt;)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">cut_op</span> <span class="free">I</span> <span class="free">t</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set0_ind.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ssubst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> set_restriction_empty<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∈</span></span> i_set0_ind"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_cut_set_restriction_disj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">cut_op</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">I</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_cut_le iT_cut_ge iT_cut_less iT_cut_greater i_set0_ind_intros2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span>
  i_set0_cut_le_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="free">t</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_cut_less_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_cut_ge_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="free">t</span> <span class="main">∈</span> i_set0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_cut_greater_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_cut_closed_disj<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set0_cut_closed <span class="main">=</span>
  i_set0_cut_le_closed
  i_set0_cut_less_closed
  i_set0_cut_ge_closed
  i_set0_cut_greater_closed


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interval sets are closed under addition and multiplication›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_Plus_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_add i_set_ind.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_Mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_imp_not_empty iT_Mult_0_if i_set_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_mult i_set_ind.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_set0_Plus_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set0_ind.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_empty i_set0_ind_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_ind_subset_i_set0_ind<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_set_Plus_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_Mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set0_ind.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty i_set0_ind_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_ind_subset_i_set0_ind<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_set_Mult_closed<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interval sets are closed with certain conditions under subtraction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_Plus_neg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_iff iT_add_neg<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_Minus_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> iMin <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Min iT_sub<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_set0_Plus_neg_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set0_ind.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">I</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_add_neg<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_Minus_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_i_set0_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set0_ind.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty i_set0_ind_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">I</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_sub<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set_IntOp_closed <span class="main">=</span>
  i_set_Plus_closed
  i_set_Mult_closed
  i_set_Plus_neg_closed
  i_set_Minus_closed
<span class="keyword1"><span class="command">lemmas</span></span> i_set0_IntOp_closed <span class="main">=</span>
  i_set0_Plus_closed
  i_set0_Mult_closed
  i_set0_Plus_neg_closed
  i_set0_Minus_closed


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Interval sets are not closed under division›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_div_mod_gr0_not_in_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∉</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_set_infinite_as_iMOD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff iMOD_infinite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> r' m'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_div_mod_gr0_not_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iMODb_div_mod_gr0_not_in_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∉</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_set_finite_as_iMODb<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff iMODb_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> r' m' c'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMODb_div_mod_gr0_not_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">⊘</span> <span class="numeral">2</span> <span class="main">∉</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iMOD_div_mod_gr0_not_in_i_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_Div_not_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">I</span><span class="main">∈</span>i_set<span class="main">.</span> <span class="bound">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∉</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iMOD_div_mod_gr0_not_in_i_set<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc i_set_MOD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> i_set0_Div_not_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">I</span><span class="main">∈</span>i_set0<span class="main">.</span> <span class="bound">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∉</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_set_Div_not_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> bexE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_def iT_Div_not_empty i_set_imp_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_subset_i_set0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sets of intervals closed under division›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">NatMultiples</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  NatMultiples_Factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> <span class="free">NatMultiples</span> <span class="free">F</span>"</span></span>
<span class="main">|</span> NatMultiples_Product<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> <span class="free">NatMultiples</span> <span class="free">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∈</span> <span class="free">NatMultiples</span> <span class="free">F</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> NatMultiples_ex_divisor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> NatMultiples <span class="free">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> NatMultiples.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">k</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> NatMultiples_product_factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> NatMultiples_Factor<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> NatMultiples_Product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> NatMultiples_product_factor_multiple<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> NatMultiples_Product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> NatMultiples_product_multiple_factor<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> NatMultiples <span class="free">F</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> NatMultiples_Product<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> NatMultiples_product_multiple<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> NatMultiples <span class="free">F</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">∈</span> NatMultiples <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> NatMultiples.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NatMultiples_Product<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span> NatMultiples_Product<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Subset of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">i_set</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> containing only continuous intervals, i. e., without <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">iMOD</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">iMODb</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">i_set_cont</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    i_set_cont_FROM<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…]</span> <span class="main">∈</span> <span class="free">i_set_cont</span>"</span></span>
  <span class="main">|</span> i_set_cont_TILL<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_cont</span>"</span></span>
  <span class="main">|</span> i_set_cont_IN<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_cont</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set0_cont</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set0_cont</span> <span class="main">≡</span> insert <span class="main">{}</span> i_set_cont"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_subset_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_cont <span class="main">⊆</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> subset_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_cont.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_cont_subset_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0_cont <span class="main">⊆</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> i_set0_cont_def i_set0_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insert_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont_subset_i_set<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Minimal definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">i_set_cont</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">i_set_cont_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  i_set_cont_FROM<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…]</span> <span class="main">∈</span> <span class="free">i_set_cont_min</span>"</span></span>
<span class="main">|</span> i_set_cont_IN<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_cont_min</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set0_cont_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set0_cont_min</span> <span class="main">≡</span> insert <span class="main">{}</span> i_set_cont_min"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_min_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_cont <span class="main">=</span> i_set_cont_min"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_cont.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iIN_0_iTILL_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_cont_min.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inext›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>iprev›</span></span></span></span> with continuous intervals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_inext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_cont<span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> finite <span class="free">I</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> Max <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_cont_min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont_min.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_finite iT_Max iT_inext_if iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_iprev<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_cont<span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> iMin <span class="free">I</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_cont_min_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont_min.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_iprev_if iT_Min iT_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_inext__less<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_cont<span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">n0</span><span class="main">;</span> <span class="free">n0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> inext <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont_inext<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Max_ge<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_finite iT_inext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_cont_iprev__greater<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_cont<span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">n0</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span> <span class="free">n0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> iprev <span class="free">n</span> <span class="free">I</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_cont_iprev<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMin_le<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sets of modulo intervals›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">i_set_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">k</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">where</span></span>
  i_set_mult_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…]</span> <span class="main">∈</span> <span class="free">i_set_mult</span> <span class="free">k</span>"</span></span>
<span class="main">|</span> i_set_mult_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_mult</span> <span class="free">k</span>"</span></span>
<span class="main">|</span> i_set_mult_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">…,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_mult</span> <span class="free">k</span>"</span></span>
<span class="main">|</span> i_set_mult_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="free">k</span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_mult</span> <span class="free">k</span>"</span></span>
<span class="main">|</span> i_set_mult_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">∈</span> <span class="free">i_set_mult</span> <span class="free">k</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">i_set0_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i_set0_mult</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> insert <span class="main">{}</span> <span class="main">(</span>i_set_mult <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  i_set0_mult_empty<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_mult_FROM<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…]</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_mult_TILL<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[…</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_mult_IN<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span><span class="main">…,</span><span class="free">d</span><span class="main">]</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_mult_MOD<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span>  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">]</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i_set0_mult_MODb<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span> <span class="main">*</span> <span class="free">k</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_def i_set_mult.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> i_set0_mult_intros <span class="main">=</span>
  i_set0_mult_empty
  i_set0_mult_FROM
  i_set0_mult_TILL
  i_set0_mult_IN
  i_set0_mult_MOD
  i_set0_mult_MODb

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_subset_i_set0_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_mult <span class="free">k</span> <span class="main">⊆</span> i_set0_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> i_set0_mult_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subset_insertI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_subset_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_mult <span class="free">k</span> <span class="main">⊆</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_mult.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mult_subset_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0_mult <span class="free">k</span> <span class="main">⊆</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_def i_set0_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ i_set_subset_i_set0<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> i_set_mult_subset_i_set<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_0_eq_i_set_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_mult <span class="main">0</span> <span class="main">=</span> i_set_cont"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_mult.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_cont.intros iMOD_0 iMODb_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_cont.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mult_0_eq_i_set0_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0_mult <span class="main">0</span> <span class="main">=</span> i_set0_cont"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_def i_set0_cont_def i_set_mult_0_eq_i_set_cont<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_1_eq_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set_mult <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_mult.induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_ind.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">m</span></span> <span class="main"><span class="main">*</span></span> Suc <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_mult.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mult_1_eq_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"i_set0_mult <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_def i_set0_def i_set_mult_1_eq_i_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_imp_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set_mult <span class="free">k</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_mult.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_in_i_set_mult_imp_divisor_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span><span class="main">;</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set_mult <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> i_set_mult.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span> <span class="keyword1"><span class="keyword1">mod</span></span> <span class="free"><span class="free">m</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iFROM_iMOD_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iTILL_iMOD_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iIN_iMOD_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_eq_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iMOD_iMODb_neq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  divisor_mod_0_imp_iMOD_in_i_set_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set_mult <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  divisor_mod_0_imp_iMODb_in_i_set_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">,</span> <span class="free">c</span><span class="main">]</span> <span class="main">∈</span> i_set_mult <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iMOD_in_i_set_mult__divisor_mod_0_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">m</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">r</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">]</span> <span class="main">∈</span> i_set_mult <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_in_i_set_mult_imp_divisor_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_mod_0_imp_iMOD_in_i_set_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_neq1_subset_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> i_set_mult <span class="free">k</span> <span class="main">⊂</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> psubsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_mult_subset_i_set<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> neq_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult_0_eq_i_set_cont<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_intros<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> i_set_cont.cases<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">False</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_neq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> Suc <span class="free">k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> iMOD_in_i_set_mult_imp_divisor_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_0_imp_i_set_mult_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> i_set_mult <span class="free">a</span> <span class="main">⊆</span> i_set_mult <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">k</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_mult.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult.intros mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_subset_imp_mod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">a</span> <span class="main">≠</span> Suc <span class="main">0</span><span class="main">;</span> <span class="main">(</span>i_set_mult <span class="free">a</span> <span class="main">⊆</span> i_set_mult <span class="free">b</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> <span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisor_mod_0_imp_iMOD_in_i_set_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_in_i_set_mult_imp_divisor_mod_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_subset_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">a</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>i_set_mult <span class="free">a</span> <span class="main">⊆</span> i_set_mult <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult_subset_imp_mod_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_0_imp_i_set_mult_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_mod_0_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_mult <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∈</span> i_set_mult <span class="main">(</span><span class="free">k</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_mult_imp_not_empty<span class="main"><span class="main">]</span></span> i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> i_set_mult.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_div i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMOD_div iMODb_div mod_0_imp_mod_mult_left_0 mod_0_imp_div_mult_left_eq i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intervals from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"i_set_mult <span class="free"><span class="free">k</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> remain in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">i_set</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> after division by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> a divisor of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> i_set_mult_mod_0_div_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set_mult <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_mult_subset_i_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">k</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">d</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_mult_mod_0_div<span class="main">)</span>
<span class="keyword1"><span class="command">corollary</span></span> i_set_mult_div_self_i_set<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">∈</span> i_set_mult <span class="free">k</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∈</span> i_set"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult_mod_0_div_i_set<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> i_set_mod_0_mult_in_i_set_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set<span class="main">;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">∈</span> i_set_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 i_set_imp_not_empty i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_i_set_ind_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> i_set_ind.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_mult mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> i_set_mult.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_self_mult_in_i_set_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">∈</span> i_set_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i_set_mod_0_mult_in_i_set_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mod_self<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set_mult_mod_gr0_div_not_in_i_set<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">I</span><span class="main">∈</span>i_set_mult <span class="free">k</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∉</span> i_set"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMOD_div_mod_gr0_not_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">d</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">k</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Suc_le_lessD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> gr0_imp_self_le_mult1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">mod</span> Suc <span class="free">d</span> <span class="main">*</span> <span class="free">k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_set_infinite_as_iMOD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_finite_iff iMOD_infinite<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult.intros <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mult_mod_0_div<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∈</span> i_set0_mult <span class="main">(</span><span class="free">k</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mult_mod_0_div<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> i_set0_mult_mod_0_div_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set0_mult_subset_i_set0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">k</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">d</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set0_mult_mod_0_div<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> i_set0_mult_div_self_i_set0<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span> <span class="main">∈</span> i_set0"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mult_mod_0_div_i_set0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mod_0_mult_in_i_set0_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">∈</span> i_set0<span class="main">;</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">m</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty i_set0_mult_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_mult_subset_i_set0_mult<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set_mod_0_mult_in_i_set_mult<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_self_mult_in_i_set0_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">∈</span> i_set0 <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span> <span class="main">∈</span> i_set0_mult <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_mod_0_mult_in_i_set0_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> i_set0_mult_mod_gr0_div_not_in_i_set0<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">I</span><span class="main">∈</span>i_set0_mult <span class="free">k</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊘</span> <span class="free">d</span> <span class="main">∉</span> i_set0"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> i_set_mult_mod_gr0_div_not_in_i_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> I<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_set0_def iT_Div_not_empty i_set_mult_imp_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_set_mult_subset_i_set0_mult<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IL_TemporalOperators">
<div class="head">
<h1>Theory IL_TemporalOperators</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      IL_Operator.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Temporal logic operators on natural intervals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IL_TemporalOperators
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IL_IntervalOperators.html">IL_IntervalOperators</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bool : some additional properties›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>ord<span class="main">,</span> zero<span class="main">,</span> one<span class="main">,</span> plus<span class="main">,</span> times<span class="main">,</span> order<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> Zero_bool_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> False"</span></span>
<span class="keyword1"><span class="command">definition</span></span> One_bool_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≡</span> True"</span></span>
<span class="keyword1"><span class="command">definition</span></span> add_bool_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> mult_bool_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"False <span class="main">&lt;</span> True"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"True <span class="main">&lt;</span> True"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"True <span class="main">≤</span> True"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> bool_op_rel_defs <span class="main">=</span>
  add_bool_def 
  mult_bool_def
  less_bool_def
  le_bool_def

<span class="keyword1"><span class="command">instance</span></span> bool <span class="main">::</span> <span class="quoted">wellorder</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_wellorderI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> wf_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instance</span></span> bool <span class="main">::</span> <span class="quoted">comm_semiring_1</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bool_op_rel_defs Zero_bool_def One_bool_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> UNIV_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">ℕ</span> <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nats_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Universal temporal operator: Always/Globally›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iAll</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Always›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iAll</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Existential temporal operator: Eventually/Finally›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iEx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Eventually›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iEx</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span>"</span></span>


<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">□</span> _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iEx"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">◇</span> _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">□</span> <span class="free">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iAll <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">◇</span> <span class="free">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iEx <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Future temporal operator: Next›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iNext</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Next›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iNext</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>inext <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Past temporal operator: Last/Previous›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iLast</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Last›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iLast</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>iprev <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iNext"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">○</span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iLast"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⊖</span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">○</span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iNext <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⊖</span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iLast <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">○</span> <span class="bound">t</span> <span class="numeral">10</span> <span class="main">[</span><span class="main">0</span><span class="main">…]</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="numeral">10</span> <span class="main">&gt;</span> <span class="numeral">10</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def iT_inext_if<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following versions of Next and Last operator differ in the cases
  where no next/previous element exists or specified time point is not in interval:
  the weak versions return <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">True</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the strong versions return <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">False</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iNextWeak</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Weak Next›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iNextWeak</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">{</span>inext <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iNextStrong</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Strong Next›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iNextStrong</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">{</span>inext <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iLastWeak</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Weak Last›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iLastWeak</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>   <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">{</span>iprev <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iLastStrong</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Strong Last›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iLastStrong</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">{</span>iprev <span class="free"><span class="bound"><span class="entity">t0</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free"><span class="bound"><span class="entity">t0</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iNextWeak"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iNextStrong"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iLastWeak"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iLastStrong"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> _ _ _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iNextWeak <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iNextStrong <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iLastWeak <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="free">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iLastStrong <span class="free">t0</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some examples for Next and Last operator›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">○</span> <span class="bound">t</span> <span class="numeral">5</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="numeral">10</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">20</span><span class="main">,</span><span class="numeral">30</span><span class="main">,</span><span class="numeral">40</span><span class="main">,</span><span class="numeral">50</span><span class="main">,</span><span class="numeral">60</span><span class="main">,</span><span class="numeral">70</span><span class="main">,</span><span class="numeral">80</span><span class="main">,</span><span class="numeral">90</span><span class="main">]</span> <span class="main">!</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="numeral">80</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def iIN_inext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="bound">t</span> <span class="numeral">5</span> <span class="main">[</span><span class="main">0</span><span class="main">…,</span><span class="numeral">10</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">10</span><span class="main">,</span><span class="numeral">20</span><span class="main">,</span><span class="numeral">30</span><span class="main">,</span><span class="numeral">40</span><span class="main">,</span><span class="numeral">50</span><span class="main">,</span><span class="numeral">60</span><span class="main">,</span><span class="numeral">70</span><span class="main">,</span><span class="numeral">80</span><span class="main">,</span><span class="numeral">90</span><span class="main">]</span> <span class="main">!</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="numeral">80</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iLast_def iIN_iprev<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Temporal Until operator›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iUntil</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Until›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iUntil</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Temporal Since operator (past operator corresponding to Until)›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iSince</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Since›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iSince</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓&gt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iUntil"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">𝒰</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iSince"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">𝒮</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">𝒰</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iUntil <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">𝒮</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iSince <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iWeakUntil</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Weak Until/Wating-for/Unless›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iWeakUntil</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iWeakSince</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Weak Since/Back-to›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iWeakSince</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓&gt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iWeakUntil"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">𝒲</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iWeakSince"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">ℬ</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">𝒲</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iWeakUntil <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">ℬ</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iWeakSince <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iRelease</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Release›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iRelease</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓≤</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iTrigger</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>      <span class="comment1">― ‹Trigger›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">iTrigger</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">↓≥</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_iRelease"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">ℛ</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_iTrigger"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"Time <span class="main">⇒</span> Time <span class="main">⇒</span> iT <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>Time <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword3">(3</span><span class="keyword1">𝒯</span> _ _<span class="keyword3">)</span><span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>10<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">ℛ</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iRelease <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="free">P</span><span class="main">.</span> <span class="free">t</span> <span class="keyword1">𝒯</span> <span class="free">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> iTrigger <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="free">t</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="free">t'</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">lemmas</span></span> iTL_Next_defs <span class="main">=</span>
  iNext_def iLast_def
  iNextWeak_def iLastWeak_def
  iNextStrong_def iLastStrong_def
<span class="keyword1"><span class="command">lemmas</span></span> iTL_defs <span class="main">=</span> 
  iAll_def iEx_def
  iUntil_def iSince_def
  iWeakUntil_def iWeakSince_def
  iRelease_def iTrigger_def
  iTL_Next_defs
<span class="comment1">(* Like in Set.thy *)</span>
<span class="comment1">(* To avoid eta-contraction of body: *)</span>
<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
 <span class="main">[</span>Syntax_Trans.preserve_binder_abs2_tr' <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> iAll<span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_iAll"<span class="antiquote">}</span></span><span class="main">,</span>
  Syntax_Trans.preserve_binder_abs2_tr' <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> iEx<span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_iEx"<span class="antiquote">}</span></span><span class="main">]</span>
›</span>

<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">btr'</span> <span class="entity">syn</span> <span class="main">[</span><span class="entity">i</span><span class="main">,</span>Abs <span class="entity">abs</span><span class="main">,</span>Abs <span class="entity">abs'</span><span class="main">]</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t</span><span class="main">,</span><span class="entity">P</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t'</span><span class="main">,</span><span class="entity">Q</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs'</span>
    <span class="keyword2"><span class="keyword">in</span></span> Syntax.const <span class="entity">syn</span> $ <span class="entity">P</span> $ <span class="entity">t</span> $ <span class="entity">t'</span> $ <span class="entity">i</span> $ <span class="entity">Q</span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">in</span></span>
 <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iUntil"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iUntil"</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iSince"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iSince"</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">btr'</span> <span class="entity">syn</span> <span class="main">[</span><span class="entity">i</span><span class="main">,</span>Abs <span class="entity">abs</span><span class="main">,</span>Abs <span class="entity">abs'</span><span class="main">]</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t</span><span class="main">,</span><span class="entity">P</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t'</span><span class="main">,</span><span class="entity">Q</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs'</span>
    <span class="keyword2"><span class="keyword">in</span></span> Syntax.const <span class="entity">syn</span> $ <span class="entity">P</span> $ <span class="entity">t</span> $ <span class="entity">t'</span> $ <span class="entity">i</span> $ <span class="entity">Q</span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">in</span></span>
 <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iWeakUntil"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iWeakUntil"</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iWeakSince"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iWeakSince"</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">print_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">btr'</span> <span class="entity">syn</span> <span class="main">[</span><span class="entity">i</span><span class="main">,</span>Abs <span class="entity">abs</span><span class="main">,</span>Abs <span class="entity">abs'</span><span class="main">]</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t</span><span class="main">,</span><span class="entity">P</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">t'</span><span class="main">,</span><span class="entity">Q</span><span class="main">)</span> <span class="main">=</span> Syntax_Trans.atomic_abs_tr' <span class="entity">abs'</span>
    <span class="keyword2"><span class="keyword">in</span></span> Syntax.const <span class="entity">syn</span> $ <span class="entity">P</span> $ <span class="entity">t</span> $ <span class="entity">t'</span> $ <span class="entity">i</span> $ <span class="entity">Q</span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">in</span></span>
 <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iRelease"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iRelease"</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_syntax</span> "iTrigger"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="main">(</span><span class="entity">btr'</span> <span class="inner_quoted">"_iTrigger"</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmata for temporal operators›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Intro/elim rules›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iexI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rev_iexI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">P</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iexE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iEx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iallI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ispec<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iallE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="free">P</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">;</span> <span class="free">t</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iuntilI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">Q</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rev_iuntilI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">Q</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t</span><span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iuntilE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">P'</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  isinceI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">Q</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rev_isinceI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">Q</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t</span><span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span>
  isinceE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"
    <span class="main">⟦</span> <span class="free">P'</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Rewrite rules for trivial simplification›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iall_triv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iAll_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_triv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iEx_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_conjL1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_conjR1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_conjL2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_conjR2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conjL1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I2</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conjR1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I2</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conjL2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="free">I2</span> <span class="bound">t1</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conjR2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="free">I2</span> <span class="bound">t1</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">□</span> <span class="bound">t2</span> <span class="free">I2</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_disj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_conj_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_disj_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I1</span><span class="main">.</span> <span class="main">◇</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I2</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_disj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q1</span> <span class="bound">t2</span> <span class="main">∨</span> <span class="free">Q2</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q2</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iUntil_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_disj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q1</span> <span class="bound">t2</span> <span class="main">∨</span> <span class="free">Q2</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q2</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iSince_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLast_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTL_Next_defs iT_add iIN_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_iEx_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLast_iEx_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">[…</span><span class="main">0</span><span class="main">]</span> <span class="main">⊕</span> <span class="main">(</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTL_Next_defs iT_add iIN_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> inext_singleton_cut_greater_not_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_inext_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_empty_iff inext_all_le_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_not_empty_iff inext_mono2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iprev_singleton_cut_less_not_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_in_iprev_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty_iff iprev_all_ge_fix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_not_empty_iff iprev_mono2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> inext_singleton_cut_greater_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Not_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_singleton_cut_greater_not_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iprev_singleton_cut_less_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Not_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_singleton_cut_less_not_empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iNextWeak_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∨</span> <span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_singleton_cut_greater_empty_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_greater_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iNextStrong_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inext_singleton_cut_greater_not_empty_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_greater_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iLastWeak_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∨</span> <span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_singleton_cut_less_empty_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_less_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iLastStrong_iff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprev_singleton_cut_less_not_empty_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> cut_less_singleton<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iTL_Next_iff <span class="main">=</span>
  iNext_iff iLast_iff
  iNextWeak_iff iNextStrong_iff
  iLastWeak_iff iLastStrong_iff


<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_iff_singleton       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLast_iff_singleton       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTL_Next_defs iT_add iIN_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> iNextLast_iff_singleton <span class="main">=</span> iNext_iff_singleton iLast_iff_singleton

<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_iEx_iff_singleton   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLast_iEx_iff_singleton   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTL_Next_defs iT_add iIN_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">lemma</span></span> 
  iNextWeak_iAll_conv<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextStrong_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="main">{</span>inext <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&gt;</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastWeak_iAll_conv<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastStrong_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="main">{</span>iprev <span class="free">t0</span> <span class="free">I</span><span class="main">}</span> <span class="main">↓&lt;</span> <span class="free">t0</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_Next_defs<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> 
  iAll_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iAll_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iEx_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iEx_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> empty_iff_iAll_False<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> not_empty_iff_iEx_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextWeak_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNext_False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextStrong_False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iNextStrong_True<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextWeak_False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs ex_in_conv inext_singleton_cut_greater_not_empty_iff<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> 
  iLast_True<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastWeak_True<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLast_False<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastStrong_False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  iLastStrong_True<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastWeak_False<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="free">t0</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs ex_in_conv iprev_singleton_cut_less_not_empty_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty iMinI_ex2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> iMin_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_empty_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_True_if<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> finite <span class="free">I</span> <span class="keyword1">then</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">◇</span> <span class="bound">t1</span> <span class="free">I</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> iSince_True_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_True_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>finite <span class="free">I</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_greater_infinite_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Max_equality<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_empty_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_empty_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMin_equality<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_True_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_True_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span>finite <span class="free">I</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_greater_infinite_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Max_equality<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_empty_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI2_ex2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_True_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t1</span> <span class="free">I</span><span class="main">.</span> <span class="main">□</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_False_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iUntil_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iSince_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iWeakUntil_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iWeakSince_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iRelease_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iTrigger_TrueTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> True"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs ex_in_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Empty sets and singletons›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="main">{}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iEx_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">{}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iSince_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒲</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">ℬ</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">ℛ</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> iTrigger_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒯</span> <span class="bound">t1</span> <span class="main">{}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iTL_empty <span class="main">=</span>
  iAll_empty iEx_empty
  iUntil_empty iSince_empty
  iWeakUntil_empty iWeakSince_empty
  iRelease_empty iTrigger_empty

<span class="keyword1"><span class="command">lemma</span></span> iAll_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iEx_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒰</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def cut_less_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒮</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def cut_greater_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒲</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t</span> <span class="main">∨</span> <span class="free">Q</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_def cut_less_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">ℬ</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t</span> <span class="main">∨</span> <span class="free">Q</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_def cut_greater_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">ℛ</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iRelease_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t0</span><span class="main">.</span> <span class="bound">t0</span> <span class="keyword1">𝒯</span> <span class="bound">t1</span> <span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTrigger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> iTL_singleton <span class="main">=</span>
  iAll_singleton iEx_singleton
  iUntil_singleton iSince_singleton
  iWeakUntil_singleton iWeakSince_singleton
  iRelease_singleton iTrigger_singleton


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversions between temporal operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iEx_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iAll<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> not_iEx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iSince_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iWeakUntil_def iUntil_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iWeakSince_def iSince_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iWeakUntil_iUntil_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> iWeakSince_iSince_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iRelease_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒲</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iRelease_def iWeakUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_less_conv_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iWeakUntil_iUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℬ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTrigger_def iWeakSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_greater_conv_if<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iWeakSince_iSince_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_not_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iUntil_def iRelease_def not_iAll not_iEx de_Morgan_conj not_not<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">≤</span> <span class="improper">t1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI_ex<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_le_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_less_le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> not_less_iMin<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iUntil_not_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_not_iUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Trigger operator \isasymT is a past operator,
  so that it is used for time intervals,
  that are bounded by a current time point, and thus are finite.
  For an infinite interval
  the stated relation to the Since operator \isasymS would not be fulfilled.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> iTrigger_not_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iTrigger_def iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> iexE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">≥</span> <span class="improper">t1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> iexE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_finite_imp_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ MaxI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> MaxI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_ge_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> z<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> not_greater_Max<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_not_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_not_iSince_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> not_iUntil<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iSince<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_conj_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_not_iUntil_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> iRelease_iWeakUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_disj_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>iMin <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Collect_not_less_iMin<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t2</span> <span class="main">&lt;</span> <span class="improper">t1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_less_le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_iMin_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_disj_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iUntil_disj_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_iUntil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="improper">t1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">}</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="improper">t2</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Collect_not_less_iMin<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_iUntil_conj_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iWeakUntil_disj_iWeakUntil_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> de_Morgan_disj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iWeakUntil_conj_iUntil_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_disj_distribR conj_disj_absorb<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Negation and temporal operators›</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> 
  not_iNext<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_iNextWeak<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_iNextStrong<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_iLast<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_iLastWeak<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_iLastStrong<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_Next_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iWeakUntil<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv not_iUntil<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> not_iWeakSince<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv not_iSince<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iRelease<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">↓≤</span> <span class="bound">t</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iRelease_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">ℛ</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_not_iRelease_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iTrigger<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="bound">t</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iTrigger_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒯</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_not_iTrigger_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Some implication results›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_imp_iall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> bex_imp_lex<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_imp_iEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> i_set_iAll_imp_iEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∈</span> i_set <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iAll_imp_iEx<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i_set_imp_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_iAll_imp_iEx <span class="main">=</span> iT_not_empty<span class="main">[</span><span class="operator">THEN</span> iAll_imp_iEx<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_imp_iEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_imp_iEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_subset_imp_iall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iex_subset_imp_iex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iall_mp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iex_mp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">;</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> iUntil_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iRelease_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iTrigger_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P1</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P2</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P2</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> iMin_imp_iUntil<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_Min_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Max_imp_iSince<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_Max_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Max_in<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Congruence rules for temporal operators' predicates›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> iEx_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_cong1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t1</span><span class="main">)</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t1</span><span class="main">)</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="improper">t</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iAll_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iall_subset_imp_iall<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cut_less_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_cong2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_cong1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t1</span><span class="main">)</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t1</span><span class="main">)</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="improper">t</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iAll_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iall_subset_imp_iall<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cut_greater_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_cong2<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> bex_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q'</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> iEx_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">Q'</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q'</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Temporal operators with set unions/intersections and subsets›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iall_subset_imp_iall<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iEx_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iex_subset_imp_iex<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_append<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> Max <span class="free">A</span> <span class="main">≤</span> iMin <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">A</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Un_upper1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">A</span> <span class="main">↓&lt;</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">↓&lt;</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iEx_cong<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_Un<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">B</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cut_less_Min_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> Max <span class="free">A</span> <span class="main">≤</span> iMin <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">B</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iEx_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Un_upper2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">B</span> <span class="main">↓&gt;</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">↓&gt;</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iEx_cong<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_greater_Un<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cut_greater_Max_empty<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_ge_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iAll_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iAll_union_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iEx_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iEx_union_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iAll_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> not_iEx_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">∃</span><span class="bound">A</span> <span class="bound">B</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iAll_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="free">t</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span>insert <span class="free">t</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iAll_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span>insert <span class="free">t</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iEx_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span>insert <span class="free">t</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iEx_insert_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="main">(</span>insert <span class="free">t</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t'</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Further results for temporal operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Collect_minI_iEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t'</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def iEx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Collect_minI_ex_cut<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_disj_conv1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> iMin <span class="free">I</span> <span class="main">&lt;</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_imp_iUntil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_disj_conv1<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> Max <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_imp_iSince<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_next<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒰</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&gt;</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_imp_iUntil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> iMinI_ex2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_prev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="keyword1">𝒮</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓&lt;</span> Max <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Max_imp_iSince<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Max_in<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iNext_induct_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inext_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iNext_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span>iMin <span class="free">I</span><span class="main">)</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t'</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iNext_induct_rule<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iLast_induct_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t'</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> finite <span class="free">I</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iprev_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iLast_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iLast_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span>Max <span class="free">I</span><span class="main">)</span><span class="main">;</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t'</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> finite <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iallI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iLast_induct_rule<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iUntil_conj_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iUntil_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iMinI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"iMin <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≤</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> order_less_le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iMin_le<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakUntil_conj_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iUntil_conj_not<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_conj_not<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> MaxI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">≤</span> Max <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> order_le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span>  not_greater_Max<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ MaxI<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iWeakSince_conj_not<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">t1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">Q</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iSince_conj_not<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iNextStrong_imp_iNextWeak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_Next_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> iLastStrong_imp_iLastWeak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> iTL_Next_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> infin_imp_iNextWeak_iNextStrong_eq_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> infinite <span class="free">I</span><span class="main">;</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_Next_iff nat_cut_greater_infinite_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> infin_imp_iNextWeak_eq_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> infinite <span class="free">I</span><span class="main">;</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infin_imp_iNextWeak_iNextStrong_eq_iNext<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> infin_imp_iNextStrong_eq_iNext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> infinite <span class="free">I</span><span class="main">;</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infin_imp_iNextWeak_iNextStrong_eq_iNext<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> infin_imp_iNextStrong_eq_iNextWeak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> infinite <span class="free">I</span><span class="main">;</span> <span class="free">t0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infin_imp_iNextWeak_eq_iNext infin_imp_iNextStrong_eq_iNext<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  not_in_iNext_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_in_iLast_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">t0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_defs not_in_inext_fix not_in_iprev_fix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  not_in_iNextWeak_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_in_iLastWeak_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNextWeak_iff iLastWeak_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  not_in_iNextStrong_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  not_in_iLastStrong_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t0</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNextStrong_iff iLastStrong_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iNext_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="free">t0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextWeak_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="free">t0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iNextStrong_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">○<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="free">t0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_Next_defs inext_UNIV cut_greater_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> 
  iLast_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">t0</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastWeak_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>W</sub></span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">t0</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="main">(</span><span class="free">t0</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> True<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iLastStrong_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊖<span class="hidden">⇩</span><sub>S</sub></span> <span class="bound">t</span> <span class="free">t0</span> UNIV<span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">t0</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="main">(</span><span class="free">t0</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTL_Next_defs iprev_UNIV cut_less_singleton<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iTL_Next_UNIV <span class="main">=</span> 
  iNext_UNIV iNextWeak_UNIV iNextStrong_UNIV
  iLast_UNIV iLastWeak_UNIV iLastStrong_UNIV

<span class="keyword1"><span class="command">lemma</span></span> inext_nth_iNext_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">○</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> <span class="free">n</span><span class="main">)</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">I</span> <span class="main">→</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iNext_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iprev_nth_iLast_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> <span class="free">n</span><span class="main">)</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">I</span> <span class="main">←</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iLast_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Temporal operators and arithmetic interval operators›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Shifting intervals through addition and subtraction of constants. 
  Mirroring intervals through subtraction of intervals from constants. 
  Expanding and compressing intervals through multiplication and division by constants.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Always operator›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_mem_iff2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_mem_iff2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_mem_iff mod_0_div_mult_cancel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff cut_ge_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_mem_iff cut_le_mem_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iAll_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iAll_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_imp_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> iT_arith_iAll_conv <span class="main">=</span> 
  iT_Plus_iAll_conv
  iT_Mult_iAll_conv
  iT_Plus_neg_iAll_conv
  iT_Minus_iAll_conv
  iT_Div_iAll_conv

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Eventually operator›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> 
  iT_Plus_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Mult_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Plus_neg_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Minus_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  iT_Div_iEx_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span> <span class="bound">t</span> <span class="free">I</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> iEx_iAll_conv iT_arith_iAll_conv<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Until and Since operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def iT_Plus_iAll_conv iT_Plus_iEx_conv iT_Plus_cut_less2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Mult_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def iT_Mult_iAll_conv iT_Mult_iEx_conv iT_Mult_cut_less2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def iT_Plus_neg_iAll_conv iT_Plus_neg_iEx_conv iT_Plus_neg_cut_less2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def iSince_def iT_Minus_iAll_conv iT_Minus_iEx_conv iT_Minus_cut_less2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_commute_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_0 iTILL_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iUntil_def iT_Div_iAll_conv iT_Div_iEx_conv iT_Div_cut_less2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_ge_not_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"
    <span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span> <span class="main">≤</span> iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cut_ge_Min_greater<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iMin_le cut_ge_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> div_le_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sub_mod_div_eq_div<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">↓&lt;</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span> <span class="main">∪</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_cut_ge_ident<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">↓≥</span> <span class="main">(</span><span class="improper">t</span> <span class="main">-</span> <span class="improper">t</span> <span class="keyword1">mod</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_less_iMin<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ iMinI_ex2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓&lt;</span> <span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iAll_subset<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_less_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Until and Since operators can be converted into each other through substraction of intervals from constants›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iUntil_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMin_le_Max<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Max<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"iMin <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> iMin_le_Max<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_finite iT_Minus_empty_iff <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Max_le_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Minus_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_iUntil_conv cut_le_Max_all iT_Minus_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iSince_iUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span> finite <span class="free">I</span><span class="main">;</span> Max <span class="free">I</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_iUntil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_Max_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iSince_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def iT_Plus_iAll_conv iT_Plus_iEx_conv iT_Plus_cut_greater2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def iT_Mult_iAll_conv iT_Mult_iEx_conv iT_Mult_cut_greater2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def iT_Plus_neg_iAll_conv iT_Plus_neg_iEx_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_cut_greater2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t'</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff2 cut_greater_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t'</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Plus_neg_mem_iff i_cut_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒰</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_empty cut_le_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_image_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Minus_cut_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iSince_iUntil_conv<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iT_Minus_finite<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> iT_Minus_Max<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cut_le_bound<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iMinI_ex2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Minus_Minus_cut_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒮</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iSince_def iT_Div_iAll_conv iT_Div_iEx_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_cut_greater<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_cancel add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_add_diff Suc_mod_le_divisor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_le_not_empty_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">≤</span> Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_finite cut_le_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_cut_le_finite cut_le_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">=</span> <span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> div_add1_eq1_mod_0_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_mult_self2_is_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> div_add1_eq1_mod_0_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mod_mult_self2_is_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_le_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="main">(</span><span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="keyword1">div</span> <span class="free">k</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="improper">t1</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> not_greater_Max<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nat_cut_le_finite<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_cut_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t1</span> <span class="keyword1">div</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iT_Div_imp_mem cut_greater_mem_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Max_in<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> nat_cut_le_finite<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> iexI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iT_Div_mem_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> t1 t2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ispec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_greater_mem_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Weak Until and Weak Since operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iT_Plus_iUntil_conv iT_Plus_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iT_Mult_iUntil_conv iT_Mult_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iT_Plus_neg_iUntil_conv iT_Plus_neg_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iWeakSince_iSince_conv iT_Minus_iUntil_conv iT_Minus_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iWeakUntil_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakUntil_iUntil_conv iT_Div_iUntil_conv iT_Div_iAll_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iT_Plus_iSince_conv iT_Plus_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iT_Mult_iSince_conv iT_Mult_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iT_Plus_neg_iSince_conv iT_Plus_neg_iAll_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒲</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iT_Minus_iSince_conv iT_Minus_iAll_conv iWeakUntil_iUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iWeakSince_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℬ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iWeakSince_iSince_conv iT_Div_iSince_conv iT_Div_iAll_conv<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Release and Trigger operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iT_Plus_iWeakUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iT_Mult_iWeakUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iT_Plus_neg_iWeakUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iT_Minus_iWeakUntil_conv 
  iTrigger_iSince_conv iWeakSince_iSince_conv disj_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iRelease_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iRelease_iWeakUntil_conv iT_Div_iWeakUntil_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iT_Plus_iWeakSince_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Mult_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊗</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iT_Mult_iWeakSince_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Plus_neg_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊕-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≥</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iT_Plus_neg_iWeakSince_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Minus_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊖</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">ℛ</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">↓≤</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iT_Minus_iWeakSince_conv iRelease_iUntil_conv iWeakUntil_iUntil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iT_Div_iTrigger_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="main">(</span><span class="free">I</span> <span class="main">⊘</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">t1</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">t1</span> <span class="keyword1">𝒯</span> <span class="bound">t2</span> <span class="free">I</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">t2</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iTrigger_iWeakSince_conv iT_Div_iWeakSince_conv<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>