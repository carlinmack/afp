<div id="Irrationality_J_Hancl">
<div class="head">
<h1>Theory Irrationality_J_Hancl</h1>
</div>
<pre class="source"><span class="comment1">(*
  File: Irrationality_J_Hancl.thy
  Authors:  Angeliki Koutsoukou-Argyraki and Wenda Li,
            Computer Laboratory, University of Cambridge, UK.
  Email: ak2110@cam.ac.uk, wl302@cam.ac.uk  
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Irrational Rapidly Convergent Series›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Irrationality_J_Hancl
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the formalisation of a proof by J. Hančl, in particular of the proof of his Theorem 3 in
the paper: Irrational Rapidly Convergent Series, Rend. Sem. Mat. Univ. Padova, Vol 107 (2002).

The statement asserts the irrationality of the sum of a series consisting of rational numbers
defined using sequences that fulfill certain properties. Even though the statement
is number-theoretic, the proof uses only arguments from introductory Analysis.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the central result (theorem Hancl3) by contradiction, by making use of some of 
 the auxiliary lemmas. To this end, assuming that the sum is a rational number, for a quantity 
 $\textrm{ALPHA}(n)$ we show that $\textrm{ALPHA}(n) \geq 1$ for all $n \in \mathbb{N}$. After that we show that we can find an 
  $n \in \mathbb{N}$ for which $\textrm{ALPHA}(n) &lt; 1$ which yields a contradiction and we thus conclude that the 
  sum of the series is rational. We finally give an immediate application of theorem Hancl3
 for a specific series (corollary Hancl3corollary, requiring lemma
 summable\_ln\_plus) which corresponds to Corollary 2 in the original
paper by J. Hančl. 
›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> floatarith.Max

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_sequentially_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> <span class="free">F1</span> sequentially <span class="main">⟷</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">F1</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_top_linorder eventually_sequentially_seg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_realpow_sequentially_at_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> filterlim <span class="main">(</span>power <span class="free">x</span><span class="main">)</span> at_top sequentially"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_divide_realpow_zero<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> filterlim_inverse_at_top<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_powr_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="free">g'</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">g'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_gt<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> ln <span class="skolem">Z</span> <span class="main">/</span> ln <span class="main">(</span><span class="main">(</span><span class="free">g'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> filterlim_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> ln <span class="skolem">Z</span> <span class="main">≤</span> ln <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">g'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g'</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ln_powr <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>        
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">Z</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">g'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">Z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g'</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">g'</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">g'</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g'</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> filterlim_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g'</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> powrfinitesum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc.prems add.commute linorder_not_le powr_add prod.nat_ivl_Suc' sum.cl_ivl_Suc that<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span>Suc <span class="skolem">n</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="free">s</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">=</span>Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> sum <span class="main">(</span>power <span class="numeral">2</span><span class="main">)</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="free">s</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> sum <span class="main">(</span>power <span class="numeral">2</span><span class="main">)</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span>Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span>Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_ratio_test_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> dist <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> tendsto_iff eventually_sequentially 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> diff_gt_0_iff_gt zero_less_divide_iff zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> N_dist<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> that<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> dist_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> that assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> summable_ratio_test<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">N</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> summable_ln_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"summable <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test_ev<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ln_gt_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ln_add_one_self_le_self2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> norm <span class="main">(</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventuallyI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_imp_le<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> suminf_real_offset_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"summable <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> suminf <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable_sums<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹summable <span class="free">f</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> summable_LIMSEQ summable_ignore_initial_segment<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> summable_sums<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹summable <span class="free">f</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def atLeast0LessThan f<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_ignore_initial_segment<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sum <span class="free">f</span> <span class="main">{..&lt;</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sum <span class="free">f</span> <span class="main">{..&lt;</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> factt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="free">n</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span>  <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span>  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span> <span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.cl_ivl_Suc <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≤</span> Suc <span class="skolem">n</span> ›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that  <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≤</span> Suc <span class="skolem">n</span> ›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span> <span class="main">)</span><span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas and the main proof›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> showpre7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q</span> <span class="free">p</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    assumerational<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span>  <span class="keyword1">sums</span> <span class="main">(</span><span class="free">p</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>suminf <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span><span class="free">q</span><span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>       "</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">=</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> sum <span class="skolem">ff</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> suminf_minus_initial_segment<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assumerational <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_summable<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="main">/</span><span class="free">q</span> <span class="main">-</span> sum <span class="skolem">ff</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assumerational <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="main">/</span><span class="free">q</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">ff</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum_bounds_lt_plus1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="free">q</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">aa</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> show7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q</span> <span class="free">p</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assumerational<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">p</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span> suminf <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> "</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≥</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">LL</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LL</span><span class="main">=</span><span class="var">?L</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">=</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_one_le_iff_zero_less prod_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> assumerational
        <span class="keyword1"><span class="command">using</span></span> summable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> summable_iff_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ff</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> a assms<span class="main">(</span>4<span class="main">)</span> int_one_le_iff_zero_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def ff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≥</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span><span class="free">q</span><span class="main">*</span> <span class="main">(</span> <span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> aa_def
      <span class="keyword1"><span class="command">using</span></span> a assms assumerational int_one_le_iff_zero_less showpre7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">*</span> <span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">aa</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> prod <span class="free">a</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">*</span> <span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">*</span> prod <span class="free">a</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="skolem">aa</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">*</span> prod <span class="free">a</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> of_int_sum
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_atLeastAtMost prod.remove<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> prod <span class="free">a</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">*</span> <span class="free">b</span> <span class="skolem">j</span> <span class="main">/</span> <span class="free">a</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">b</span> <span class="skolem">j</span> <span class="main">*</span> prod <span class="free">a</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute of_int_mult times_divide_eq_right<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">*</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">.</span>  <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>  <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ints_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> LL_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_cases int_one_le_iff_zero_less not_less of_int_0_less_iff of_int_less_1_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> show8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="free">s</span><span class="main">.</span> <span class="free">A</span> <span class="main">/</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">MAX</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">sp</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">ia</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">ia</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">ia</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">ia</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prodinf_split_initial_segment<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> convergent_prod_iff_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d not_one_less_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">sp</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="skolem">i</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="skolem">n</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sp_def <span class="keyword1"><span class="command">using</span></span> convergent_prod_iff_shift <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> d 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>less_1_prodinf<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> d less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prod_ge_1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="free">A</span> <span class="main">/</span> <span class="skolem">ff</span> <span class="bound">j</span> <span class="main">&gt;</span> <span class="skolem">sp</span> <span class="bound">j</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ff_def sp_def <span class="keyword1"><span class="command">using</span></span> assu2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="free">s</span><span class="main">≤</span><span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">/</span> <span class="skolem">ff</span> <span class="bound">j</span> <span class="main">&gt;</span> <span class="skolem">sp</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="skolem">n</span><span class="main">&lt;</span> <span class="free">A</span> <span class="main">/</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Max_in <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="free">s</span>›</span></span> atLeastAtMost_iff empty_iff 
        finite_atLeastAtMost finite_imageI imageE image_is_empty order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> auxiliary1_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="free">m</span><span class="main">::</span><span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">m</span> <span class="main">≥</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> auxifalse_assu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>
              <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>
    <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">j</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> of_int_0_less_iff powr_gt_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ff_asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> auxifalse_assu that <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">≥</span><span class="free">m</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Max<span class="main">(</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">≥</span><span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">=</span>Suc <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≠</span>Suc <span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> prod <span class="free">d</span> <span class="main">{</span><span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems assms<span class="main">(</span>5<span class="main">)</span> atLeastAtMostSuc_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> max <span class="main">(</span>Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems assms<span class="main">(</span>5<span class="main">)</span> max_def sup_assoc that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> max <span class="main">(</span>Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> ff_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> max <span class="main">1</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Max_in <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ff</span> <span class="bound">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
              atLeastAtMost_iff empty_iff finite_atLeastAtMost finite_imageI imageE 
              image_is_empty less_eq_real_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> max_mult_distrib_right 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_mult_distrib_right mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d max.commute max.strict_order_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  prod <span class="free">d</span> <span class="main">{</span><span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH d<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> prod <span class="free">d</span> <span class="main">{</span><span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>prod.nat_ivl_Suc' <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">≤</span><span class="free">n</span>›</span></span> d<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>prod.nat_ivl_Suc'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ff_asm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">≤</span><span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> show9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>   <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> assu1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> <span class="free">A</span><span class="main">)</span> sequentially "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> prodinf <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span><span class="main">(</span> <span class="bound">n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">&lt;</span> <span class="free">A</span><span class="main">/</span><span class="main">(</span>Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span>  <span class="main">(</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span>
          <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span> <span class="main">(</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assumptioncontra<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">ff</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">d</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span>  <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≥</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ttt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">t</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>               
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≡</span> <span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less_0_prodinf<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> convergent_prod_iff_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d le_less_trans zero_le_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> Max <span class="main">(</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">sequentially</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">∏</span></span><span class="bound"><span class="bound">j</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">d</span></span> <span class="bound"><span class="bound">j</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> Max <span class="main"><span class="main">(</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">s</span></span><span class="main"><span class="main">..</span></span><span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> 
        <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assu1<span class="main">[</span><span class="operator">folded</span> ff_def<span class="main">]</span> LIMSEQ_ignore_initial_segment <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prod <span class="free">d</span> <span class="main">{</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> convergent_prod_iff_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> B_def convergent_prod_LIMSEQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> atLeast0AtMost <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prod <span class="free">d</span> <span class="main">{</span><span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> prod.shift_bounds_cl_nat_ivl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> seq_offset_neg<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prod <span class="free">d</span> <span class="main">{</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> Lim_transform<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_I<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> prod <span class="free">d</span> <span class="main">{</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">B</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially ff_def
      <span class="keyword1"><span class="command">using</span></span> auxiliary1_9<span class="main">[</span><span class="operator">OF</span> d a <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≥</span><span class="free">s</span>›</span></span> ttt<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ff_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">(</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="free">d</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> Max <span class="main">(</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≥</span><span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Max_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="main">/</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">folded</span> ff_def B_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">*</span> Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> zero_less_mult_pos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="skolem">ff</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span>Suc <span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> show10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real "</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">a</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> a <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span>
          <span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
            <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> 9<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> asm_9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span>
          <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span> <span class="main">(</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">MAX</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">j</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> of_int<span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> real_of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">=</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">..</span><span class="free">s</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="free">s</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a f_def of_int_0_less_iff prod_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">i</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> powr_powr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a less_eq_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a less_imp_le of_int_0_le_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">d</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>  "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transcendental.log_one d le_powr_iff zero_le_numeral zero_le_power zero_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">i</span> <span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> powrfinitesum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">M</span> <span class="free">s</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>power <span class="numeral">2</span><span class="main">)</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> factt <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">M</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span> of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>real_of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="skolem">n</span>  <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≥</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ge_one_powr_ge_zero<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="free">s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a int_one_le_iff_zero_less<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int<span class="main">(</span> <span class="free">a</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>real_of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> S_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Max_ge_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> S_def M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono powr_mono M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">M</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">s</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def Max_ge_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">using</span></span> powr_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">s</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≤</span><span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def Max_ge_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> d<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">M</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">M</span> <span class="free">s</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M_def asm_9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>    
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a less_eq_real_def pos_add_strict powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">m</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≥</span><span class="free">s</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lasttoshow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span>
          <span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu3<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim<span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">/</span> <span class="free">b</span> <span class="bound">n</span><span class="main">)</span> at_top sequentially "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> real_of_int<span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> suminf <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">&lt;</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span><span class="main">=</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_def1<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span> 
      <span class="main">*</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">as</span><span class="main">)</span> 
          <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n_def3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_inverse_0_at_top<span class="main">[</span><span class="operator">OF</span> assu3<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">d</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d le_less_trans powr_realpow zero_le_one<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> tendsto_mult_right_zero<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> order_tendstoD<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">as</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">d</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span> 
            <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
                <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> show10<span class="main">[</span><span class="operator">OF</span> d a <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 9<span class="main">,</span><span class="operator">folded</span> as_def<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="free">s</span> <span class="skolem">N</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> N_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dn</span> <span class="main">≡</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">dn</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dn_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d not_le numeral_One powr_gt_zero zero_le_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> as_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a prod_pos<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">pa</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pa_def <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_pos<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> suminf <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">≤</span><span class="free">q</span><span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span><span class="numeral">2</span><span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">a</span><span class="main">(</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pa_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_mono<span class="main">[</span><span class="operator">OF</span> n_def3<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real_of_int <span class="free">q</span> <span class="main">*</span> <span class="skolem">pa</span>"</span></span><span class="main">]</span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pa</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> KK<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="free">q</span><span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>
      <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> real_of_int<span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="keyword1">powr</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> real_of_int <span class="main">(</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">dn</span> <span class="main">*</span> <span class="skolem">pa</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n_def2 <span class="keyword1"><span class="command">unfolding</span></span> dn_def pa_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pa_def dn_def as_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pa</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> b<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> KKK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="main">(</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> real_of_int<span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> as_def pa_def dn_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">pa</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> KKKK<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def1 <span class="keyword1"><span class="command">unfolding</span></span> as_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real "</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">a</span> <span class="free">b</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span><span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> assu1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> <span class="free">A</span><span class="main">)</span> sequentially "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu3<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">/</span> <span class="free">b</span> <span class="bound">n</span><span class="main">)</span> at_top sequentially"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> issummable<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> show5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> 
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c_ratio_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">d</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> nn_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ff_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> nn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff_def
        <span class="keyword1"><span class="command">using</span></span> d<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> ff_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">⇢</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">nn</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sqrt<span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">unfolding</span></span> nn_def <span class="keyword1"><span class="command">using</span></span> a
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_half_sqrt <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_powr <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> sqrt<span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> sqrt <span class="free">A</span><span class="main">)</span> sequentially "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assu1 tendsto_real_sqrt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span>of_int <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> sqrt <span class="free">A</span><span class="main">)</span> sequentially "</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> tendsto_divide<span class="main">[</span><span class="operator">OF</span> this assu1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> LIMSEQ_ignore_initial_segment<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> nn_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>powr_divide less_imp_le inverse_eq_divide sqrt_divide_self_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">⇢</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> convergent_prod_imp_LIMSEQ<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> convergent_prod_iff_shift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ff</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">=</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">/</span>sqrt <span class="free">A</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">n</span><span class="main">&lt;</span><span class="skolem">aa</span><span class="main">)</span> sequentially"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_tendstoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ff_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">aa</span> <span class="keyword1">powr</span> <span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">aa</span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">∘</span> <span class="skolem">nn</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_power_zero<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> nn_def comp_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_subseq<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>strict_monoI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> pos_add_strict<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="skolem">aa</span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">∘</span> <span class="skolem">nn</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="keyword1">powr</span> real_of_int <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_int order.strict_implies_order<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nn_pos<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> metric_tendsto_imp_tendsto<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>powr_mono2 <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> nn_pos ff_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_cases not_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="skolem">ff</span> <span class="bound">x</span> <span class="keyword1">powr</span>  <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> nat <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventuallyI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
          <span class="keyword1"><span class="command">unfolding</span></span> ff_def
          <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span> d<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span> nn_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> powr_divide powr_powr powr_mult <span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_int<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">d</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_inverse_0_at_top<span class="main">[</span><span class="operator">OF</span> assu3<span class="main">,</span><span class="operator">THEN</span> LIMSEQ_ignore_initial_segment<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> nn_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> nat_mult_distrib nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> asm
        <span class="keyword1"><span class="command">using</span></span> tendsto_mult<span class="main">[</span><span class="operator">OF</span> asm<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> always_eventually 
            not_one_less_zero<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> Lim_transform_bound<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventuallyI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span> 
          b<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> b<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> c_ratio_tendsto
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">b</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> c_def
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_of_pos <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> summable_ratio_test_tendsto<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">]</span> a b 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_def c_pos less_irrefl zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N_ratio<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">N</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> sequentially"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> c_ratio_tendsto<span class="main">[</span><span class="operator">unfolded</span> tendsto_iff<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n <span class="keyword1"><span class="command">using</span></span> c_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> c_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span>Suc <span class="bound">i</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sum.lessThan_Suc_shift <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">using</span></span> N_ratio<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="skolem">N</span>›</span></span> c_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="skolem">n</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sum_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sum_divide_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">using</span></span> c_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_le_eq_1_pos divide_pos_pos nonzero_mult_div_cancel_left zero_less_power<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹summable <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_iff_shift<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> suminf_le_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>  <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Hancl3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="free">s</span><span class="main">.</span> <span class="free">A</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">n</span> sequentially<span class="main">.</span> <span class="free">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="free">d</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℚ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ab_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="free">b</span> <span class="bound">j</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> issummable<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> d a b assu1 assu3 <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> suminf_minus_initial_segment<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ab_sum<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">/</span><span class="skolem">q'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Rats_eq_int_div_int
      <span class="keyword1"><span class="command">using</span></span> summable_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> ab_sum<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">THEN</span> summable_sums<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">q'</span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="skolem">p'</span> <span class="keyword1">else</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">q'</span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="skolem">q'</span> <span class="keyword1">else</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">/</span><span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> pq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ALPHA</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">ALPHA</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_int <span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> of_int<span class="main">(</span><span class="free">a</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">a</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ALPHA</span> <span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_pos<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> summable_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> ab_sum<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">/</span><span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pq_def sums_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">a</span> <span class="bound">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">b</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a b 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_one_le_iff_zero_less<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ALPHA_def
      <span class="keyword1"><span class="command">using</span></span> show7<span class="main">[</span><span class="operator">OF</span> _ _ _ _ pq_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ALPHA</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ALPHA_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lasttoshow<span class="main"><span class="main">[</span></span><span class="operator">OF</span> d a <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> b _ assu3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> show5<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> d a b assu1 assu3 <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">MAX</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="free">s</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">a</span> <span class="bound">j</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">≤</span> <span class="free">a</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> show9<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> d a <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> assu1 <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> show8<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> d a <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="free">d</span>›</span></span> assu2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Hancl3corollary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assu1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int<span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> asscor2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="numeral">6</span><span class="main">.</span> <span class="free">a</span> <span class="bound">n</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">A</span>
                        <span class="main">∧</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="free">b</span> <span class="bound">n</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℚ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> dgt1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="bound">n</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent_prod <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_convergent_prod_imp_convergent_prod summable_imp_abs_convergent_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="numeral">6</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="main">/</span> <span class="free">a</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">6</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> d_sum<span class="main">:</span><span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> summable_ln_plus<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> ln <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">1</span><span class="main">/</span><span class="numeral">8</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="numeral">6</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="numeral">6</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_add_diff_inverse power_add<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="numeral">6</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>power_le_one<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">8</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>c_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> d_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_pos_pos less_eq_real_def ln_add_one_self_le_self zero_less_numeral zero_less_power<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> summable_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> d_sum<span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">::</span>real<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> summable_geometric<span class="main">[</span><span class="operator">THEN</span> summable_ignore_initial_segment<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_add<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> summable_geometric suminf_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> c_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suminf_geometric<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span>  <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">1</span><span class="main">/</span><span class="numeral">8</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * R&lt;1) * (R&lt;1/16 * [1]^2))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ln_one_plus_pos_lower_bound<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">1</span><span class="main">/</span><span class="numeral">8</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> divide_pos_pos ln_exp ln_ge_iff zero_less_power<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">.</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> exp_suminf_prodinf_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> dgt1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">na</span><span class="main">.</span> exp <span class="main">(</span>ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> exp_ln<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dgt1 le_less_trans zero_le_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs_convergent_prod <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> abs_convergent_prod_def 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹convergent_prod <span class="skolem">d</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgt1 convergent_prod_iff_shift less_imp_le <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> exp <span class="main">(</span>ln <span class="main">(</span><span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dgt1 exp_ln not_less not_one_less_zero order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>  <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> asscor2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="numeral">6</span><span class="main">≤</span><span class="skolem">n</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">a</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">n</span> sequentially<span class="main">.</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">n</span> sequentially<span class="main">.</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>real<span class="main">)</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">n</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_powr_real<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"exp <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">8</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">9</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> exp <span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">approximation</span> 4<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">e1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> exp <span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_exp_limit_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> n1_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_tendsto_pos_mult_at_top 
                filterlim_realpow_sequentially_at_top
                <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_sequentially_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e1_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">n2</span> at_top sequentially"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> n2_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_sequentially_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">4</span></span> <span class="main"><span class="main">/</span></span> <span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">^</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>filterlim_realpow_sequentially_at_top<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n2</span> <span class="bound">n</span><span class="main">)</span>
        <span class="main">=</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_sequentiallyI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n1</span> <span class="skolem">k</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n2</span> <span class="skolem">k</span> 
            <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n2</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n1_def n2_def powr_divide<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">n1</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n2</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n2</span> <span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> n1_def n2_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span>power_mult_distrib power_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> n1_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> powr_realpow divide_pos_pos numeral_plus_numeral numeral_plus_one of_nat_numeral of_nat_power semiring_norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_power<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">d</span> <span class="skolem">k</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> n1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≥</span><span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat_diff_split<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">/</span> <span class="numeral">9</span> <span class="main">/</span> <span class="skolem">n1</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n1</span> <span class="skolem">k</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">n2</span> <span class="skolem">k</span> 
                    <span class="main">=</span> <span class="skolem">d</span> <span class="skolem">k</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">n</span> <span class="keyword1">in</span> sequentially<span class="main">.</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">≤</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="free">b</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_sequentiallyI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">6</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> asscor2 b dgt1 frac_le of_int_0_less_iff zero_le_power<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> filterlim_at_top_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Hancl3<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> _ a b _ assu1<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="numeral">6</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>