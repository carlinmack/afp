<div id="TermsAndLiterals">
<div class="head">
<h1>Theory TermsAndLiterals</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Terms and Literals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> TermsAndLiterals <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Countable_Set.html">HOL-Library.Countable_Set</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> var_sym  <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> fun_sym  <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> pred_sym <span class="main">=</span> <span class="quoted">string</span>

<span class="keyword1"><span class="command">datatype</span></span> fterm <span class="main">=</span> 
  Fun <span class="quoted">fun_sym</span> <span class="main">(</span><span class="free"><span class="entity">get_sub_terms</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"fterm list"</span></span><span class="main">)</span>
<span class="main">|</span> Var <span class="quoted">var_sym</span>

<span class="keyword1"><span class="command">datatype</span></span> hterm <span class="main">=</span> HFun <span class="quoted">fun_sym</span> <span class="quoted"><span class="quoted">"hterm list"</span></span> <span class="comment1">― ‹Herbrand terms defined as in Berghofer's FOL-Fitting›</span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'t</span> atom <span class="main">=</span> <span class="quoted"><span class="quoted">"pred_sym <span class="main">*</span> <span class="tfree">'t</span> list"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'t</span> literal <span class="main">=</span> 
  <span class="entity">sign</span><span class="main">:</span> Pos <span class="main">(</span><span class="free"><span class="entity">get_pred</span></span><span class="main">:</span> <span class="quoted">pred_sym</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">get_terms</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> list"</span></span><span class="main">)</span>
<span class="main">|</span> Neg <span class="main">(</span>get_pred<span class="main">:</span> <span class="quoted">pred_sym</span><span class="main">)</span> <span class="main">(</span>get_terms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> list"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_atom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> literal <span class="main">⇒</span> <span class="tfree">'t</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_atom</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_atom</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ground›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ground<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ground<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> <span class="free">ground<span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>get_terms <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ground_fatoms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm atom set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ground_fatoms</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="bound">a</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="TermsAndLiterals-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub>_ground_fatom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get_atom <span class="free">l</span> <span class="main">∈</span> ground_fatoms"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ground_fatoms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary›</span></span>

<span class="keyword1" id="TermsAndLiterals-infinity"><span class="command">lemma</span></span> infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">undiago</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> all_tree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> inj all_tree <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">undiago</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ds</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">undiago</span> <span class="bound">ds</span> <span class="main">∧</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">undiago</span> <span class="main">`</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageI infinite_UNIV_nat<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-inv_into_f_f"><span class="command">lemma</span></span> inv_into_f_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bij_betw_inv_into_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="TermsAndLiterals-f_inv_into_f"><span class="command">lemma</span></span> f_inv_into_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">(</span>inv_into <span class="free">A</span> <span class="free">f</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bij_betw_inv_into_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conversions›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversions - Terms and Herbrand Terms›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fterm_of_hterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm <span class="main">⇒</span> fterm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fterm_of_hterm</span> <span class="main">(</span>HFun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Fun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="free">fterm_of_hterm</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fterms_of_hterms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm list <span class="main">⇒</span> fterm list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fterms_of_hterms</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> map fterm_of_hterm <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hterm_of_fterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> hterm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hterm_of_fterm</span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> HFun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="free">hterm_of_fterm</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hterms_of_fterms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> hterm list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hterms_of_fterms</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> map hterm_of_fterm <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1" id="TermsAndLiterals-hterm_of_fterm_fterm_of_hterm"><span class="command">lemma</span></span> hterm_of_fterm_fterm_of_hterm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hterm_of_fterm <span class="main">(</span>fterm_of_hterm <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="TermsAndLiterals-hterms_of_fterms_fterms_of_hterms"><span class="command">lemma</span></span> hterms_of_fterms_fterms_of_hterms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hterms_of_fterms <span class="main">(</span>fterms_of_hterms <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> hterms_of_fterms_def fterms_of_hterms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="TermsAndLiterals-fterm_of_hterm_hterm_of_fterm"><span class="command">lemma</span></span> fterm_of_hterm_hterm_of_fterm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fterm_of_hterm <span class="main">(</span>hterm_of_fterm <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="TermsAndLiterals-fterms_of_hterms_hterms_of_fterms"><span class="command">lemma</span></span> fterms_of_hterms_hterms_of_fterms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fterms_of_hterms <span class="main">(</span>hterms_of_fterms <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fterms_of_hterms_def hterms_of_fterms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="TermsAndLiterals-ground_fterm_of_hterm"><span class="command">lemma</span></span> ground_fterm_of_hterm<span class="main">:</span>  <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>fterm_of_hterm <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="TermsAndLiterals-ground_fterms_of_hterms"><span class="command">lemma</span></span> ground_fterms_of_hterms<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>fterms_of_hterms <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fterms_of_hterms_def <span class="keyword1"><span class="command">using</span></span> ground_fterm_of_hterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversions -  Literals and Herbrand Literals›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">flit_of_hlit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm literal <span class="main">⇒</span> fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">flit_of_hlit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>fterms_of_hterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">flit_of_hlit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>fterms_of_hterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hlit_of_flit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> hterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hlit_of_flit</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>hterms_of_fterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hlit_of_flit</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>hterms_of_fterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="TermsAndLiterals-ground_flit_of_hlit"><span class="command">lemma</span></span> ground_flit_of_hlit<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>flit_of_hlit <span class="free">l</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ground_fterms_of_hterms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hlit_of_flit_flit_of_hlit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hlit_of_flit <span class="main">(</span>flit_of_hlit <span class="free">l</span><span class="main">)</span> <span class="main">=</span>  <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> flit_of_hlit_hlit_of_flit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"flit_of_hlit <span class="main">(</span>hlit_of_flit <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-sign_flit_of_hlit"><span class="command">lemma</span></span> sign_flit_of_hlit<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>flit_of_hlit <span class="free">l</span><span class="main">)</span> <span class="main">=</span> sign <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-hlit_of_flit_bij"><span class="command">lemma</span></span> hlit_of_flit_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw hlit_of_flit <span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span> UNIV"</span></span> 
 <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on hlit_of_flit <span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_on_inverseI flit_of_hlit_hlit_of_flit 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l'</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> hlit_of_flit <span class="bound">l'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_flit_of_hlit hlit_of_flit_flit_of_hlit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hlit_of_flit <span class="main">`</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-flit_of_hlit_bij"><span class="command">lemma</span></span> flit_of_hlit_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw flit_of_hlit UNIV <span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span>"</span></span> 
 <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>UNIV<span class="main">.</span> flit_of_hlit <span class="bound">x</span> <span class="main">=</span> flit_of_hlit <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_flit_of_hlit hlit_of_flit_flit_of_hlit <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">l</span> <span class="main">=</span> flit_of_hlit <span class="main">(</span>hlit_of_flit <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hlit_of_flit_flit_of_hlit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span>  <span class="main">⊆</span> flit_of_hlit <span class="main">`</span> UNIV "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>flit_of_hlit <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_flit_of_hlit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"flit_of_hlit <span class="main">`</span> UNIV <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hlit_of_flit_flit_of_hlit ground_flit_of_hlit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Conversions - Atoms and Herbrand Atoms›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fatom_of_hatom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm atom <span class="main">⇒</span> fterm atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fatom_of_hatom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> fterms_of_hterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hatom_of_fatom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm atom <span class="main">⇒</span> hterm atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hatom_of_fatom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> hterms_of_fterms <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="TermsAndLiterals-ground_fatom_of_hatom"><span class="command">lemma</span></span> ground_fatom_of_hatom<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="main">(</span>fatom_of_hatom <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ground_fterms_of_hterms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hatom_of_fatom_fatom_of_hatom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hatom_of_fatom <span class="main">(</span>fatom_of_hatom <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> fatom_of_hatom_hatom_of_fatom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fatom_of_hatom <span class="main">(</span>hatom_of_fatom <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-hatom_of_fatom_bij"><span class="command">lemma</span></span> hatom_of_fatom_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw hatom_of_fatom ground_fatoms UNIV"</span></span> 
 <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on hatom_of_fatom ground_fatoms"</span></span> <span class="keyword1"><span class="command">using</span></span> inj_on_inverseI fatom_of_hatom_hatom_of_fatom <span class="keyword1"><span class="command">unfolding</span></span> ground_fatoms_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a'</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="bound">a'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> hatom_of_fatom <span class="bound">a'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_fatom_of_hatom hatom_of_fatom_fatom_of_hatom <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hatom_of_fatom <span class="main">`</span> ground_fatoms <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_fatoms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-fatom_of_hatom_bij"><span class="command">lemma</span></span> fatom_of_hatom_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw fatom_of_hatom UNIV ground_fatoms"</span></span> 
 <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>UNIV<span class="main">.</span> fatom_of_hatom <span class="bound">x</span> <span class="main">=</span> fatom_of_hatom <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_fatom_of_hatom hatom_of_fatom_fatom_of_hatom <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="bound">a</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> fatom_of_hatom <span class="main">(</span>hatom_of_fatom <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hatom_of_fatom_fatom_of_hatom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground_fatoms  <span class="main">⊆</span> fatom_of_hatom <span class="main">`</span> UNIV "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ground_fatoms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="main">(</span>fatom_of_hatom <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_fatom_of_hatom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fatom_of_hatom <span class="main">`</span> UNIV <span class="main">=</span> ground_fatoms"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hatom_of_fatom_fatom_of_hatom ground_fatom_of_hatom <span class="keyword1"><span class="command">unfolding</span></span> ground_fatoms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Enumerations›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Enumerating Strings›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_string</span><span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_of_string</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> bij <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">string_of_nat</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">string_of_nat</span> <span class="main">≡</span> inv nat_of_string"</span></span>

<span class="keyword1" id="TermsAndLiterals-nat_of_string_bij"><span class="command">lemma</span></span> nat_of_string_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij nat_of_string"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>UNIV<span class="main">::</span>string set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span>string set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="skolem">x</span><span class="main">::</span> string <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countableE_infinite<span class="main">[</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nat_of_string_def <span class="keyword1"><span class="command">using</span></span> someI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-string_of_nat_bij"><span class="command">lemma</span></span> string_of_nat_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij string_of_nat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> string_of_nat_def <span class="keyword1"><span class="command">using</span></span> nat_of_string_bij bij_betw_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-nat_of_string_string_of_nat"><span class="command">lemma</span></span> nat_of_string_string_of_nat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_string <span class="main">(</span>string_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> string_of_nat_def 
  <span class="keyword1"><span class="command">using</span></span> nat_of_string_bij f_inv_into_f<span class="main">[</span><span class="operator">of</span> <span class="quoted">nat_of_string</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="TermsAndLiterals-string_of_nat_nat_of_string"><span class="command">lemma</span></span> string_of_nat_nat_of_string<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"string_of_nat <span class="main">(</span>nat_of_string <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> string_of_nat_def 
  <span class="keyword1"><span class="command">using</span></span> nat_of_string_bij inv_into_f_f<span class="main">[</span><span class="operator">of</span> <span class="quoted">nat_of_string</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Enumerating Herbrand Atoms›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_hatom</span><span class="main">::</span> <span class="quoted"><span class="quoted">"hterm atom <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_of_hatom</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> bij <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hatom_of_nat</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> hterm atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hatom_of_nat</span> <span class="main">≡</span> inv nat_of_hatom"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hterm <span class="main">::</span> <span class="quoted">countable</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">countable_datatype</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="TermsAndLiterals-infinite_hatoms"><span class="command">lemma</span></span> infinite_hatoms<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span> atom<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diago</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>string_of_nat <span class="bound">n</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?undiago</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> nat_of_string <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?undiago</span> <span class="main">(</span><span class="var">?diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_of_string_string_of_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?diago</span> <span class="bound">n</span> <span class="main">∈</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'t</span> atom<span class="main">)</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinity<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?undiago</span></span></span> <span class="var"><span class="quoted"><span class="var">?diago</span></span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-nat_of_hatom_bij"><span class="command">lemma</span></span> nat_of_hatom_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij nat_of_hatom"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span><span class="main">::</span>countable<span class="main">)</span> atom<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_hatoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="skolem">x</span> <span class="main">::</span> hterm atom <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countableE_infinite<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij nat_of_hatom"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nat_of_hatom_def <span class="keyword1"><span class="command">using</span></span> someI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">unfolding</span></span> nat_of_hatom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TermsAndLiterals-hatom_of_nat_bij"><span class="command">lemma</span></span> hatom_of_nat_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij hatom_of_nat"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hatom_of_nat_def <span class="keyword1"><span class="command">using</span></span> nat_of_hatom_bij bij_betw_inv_into <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-nat_of_hatom_hatom_of_nat"><span class="command">lemma</span></span> nat_of_hatom_hatom_of_nat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_hatom <span class="main">(</span>hatom_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> hatom_of_nat_def 
  <span class="keyword1"><span class="command">using</span></span> nat_of_hatom_bij f_inv_into_f<span class="main">[</span><span class="operator">of</span> <span class="quoted">nat_of_hatom</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="TermsAndLiterals-hatom_of_nat_nat_of_hatom"><span class="command">lemma</span></span> hatom_of_nat_nat_of_hatom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hatom_of_nat <span class="main">(</span>nat_of_hatom <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> hatom_of_nat_def 
  <span class="keyword1"><span class="command">using</span></span> nat_of_hatom_bij inv_into_f_f<span class="main">[</span><span class="operator">of</span> <span class="quoted">nat_of_hatom</span> <span class="main">_</span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Enumerating Ground Atoms›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fatom_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> fterm atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fatom_of_nat</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> fatom_of_hatom <span class="main">(</span>hatom_of_nat <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_fatom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm atom <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat_of_fatom</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> nat_of_hatom <span class="main">(</span>hatom_of_fatom <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> diag_undiag_fatom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fatom_of_nat <span class="main">(</span>nat_of_fatom <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> fatom_of_nat_def nat_of_fatom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> undiag_diag_fatom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>fatom_of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fatom_of_nat_def nat_of_fatom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-fatom_of_nat_bij"><span class="command">lemma</span></span> fatom_of_nat_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw fatom_of_nat UNIV ground_fatoms"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> hatom_of_nat_bij bij_betw_trans fatom_of_hatom_bij hatom_of_nat_bij <span class="keyword1"><span class="command">unfolding</span></span> fatom_of_nat_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TermsAndLiterals-ground_fatom_of_nat"><span class="command">lemma</span></span> ground_fatom_of_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>snd <span class="main">(</span>fatom_of_nat <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fatom_of_nat_def <span class="keyword1"><span class="command">using</span></span> ground_fatom_of_hatom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TermsAndLiterals-nat_of_fatom_bij"><span class="command">lemma</span></span> nat_of_fatom_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw nat_of_fatom ground_fatoms UNIV"</span></span>
   <span class="keyword1"><span class="command">using</span></span> nat_of_hatom_bij bij_betw_trans hatom_of_fatom_bij hatom_of_nat_bij <span class="keyword1"><span class="command">unfolding</span></span> nat_of_fatom_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tree">
<div class="head">
<h1>Theory Tree</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Trees›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tree <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sometimes it is nice to think of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">bool</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s as directions in a binary tree›</span></span>
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Left Right
<span class="keyword1"><span class="command">type_synonym</span></span> dir <span class="main">=</span> <span class="quoted">bool</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Left</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Left</span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Right</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Right</span> <span class="main">=</span> False"</span></span>
<span class="keyword1"><span class="command">declare</span></span> Left_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Right_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> tree <span class="main">=</span>
  Leaf
<span class="main">|</span> Branching <span class="main">(</span><span class="free"><span class="entity">ltree</span></span><span class="main">:</span> <span class="quoted">tree</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">rtree</span></span><span class="main">:</span> <span class="quoted">tree</span><span class="main">)</span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sizes›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">treesize</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">treesize</span> Leaf <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">treesize</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">treesize</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">+</span> <span class="free">treesize</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1" id="Tree-treesize_Leaf"><span class="command">lemma</span></span> treesize_Leaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"treesize <span class="free">T</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Leaf"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-treesize_Branching"><span class="command">lemma</span></span> treesize_Branching<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"treesize <span class="free">T</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="free">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Paths›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list <span class="main">⇒</span> tree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">then</span> <span class="free">path</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">T1</span></span></span> <span class="keyword1">else</span> <span class="free">path</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">T2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> False"</span></span>

<span class="keyword1" id="Tree-path_inv_Leaf"><span class="command">lemma</span></span> path_inv_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">p</span> Leaf <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>  <span class="operator">auto</span>

<span class="keyword1" id="Tree-path_inv_Cons"><span class="command">lemma</span></span> path_inv_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">ds</span><span class="main">)</span> <span class="free">T</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="free">T</span><span class="main">=</span>Branching <span class="bound">l</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_inv_Leaf<span class="main">)</span>


<span class="keyword1" id="Tree-path_inv_Branching_Left"><span class="command">lemma</span></span> path_inv_Branching_Left<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>Left<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Left_def Right_def path.cases <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-path_inv_Branching_Right"><span class="command">lemma</span></span> path_inv_Branching_Right<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>Right<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">p</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Left_def Right_def path.cases <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>  <span class="operator">auto</span>


<span class="keyword1" id="Tree-path_inv_Branching"><span class="command">lemma</span></span> path_inv_Branching<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"path <span class="free">p</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">p'</span><span class="main">.</span> <span class="free">p</span><span class="main">=</span><span class="bound">a</span><span class="main">#</span><span class="bound">p'</span><span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> path <span class="bound">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="bound">a</span> <span class="main">⟶</span> path <span class="bound">p'</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">p'</span><span class="main">.</span> <span class="free">p</span><span class="main">=</span><span class="bound">a</span><span class="main">#</span><span class="bound">p'</span><span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> path <span class="bound">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="bound">a</span> <span class="main">⟶</span> path <span class="bound">p'</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p'</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">p'</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-path_prefix"><span class="command">lemma</span></span> path_prefix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">ds1</span><span class="main">@</span><span class="free">ds2</span><span class="main">)</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ds1</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ds1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ds1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">l</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> atrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="main">(</span><span class="skolem">ds1</span><span class="main">)</span> <span class="main">@</span> <span class="free">ds2</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> path_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ds1</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr atrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> afalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="main">(</span><span class="skolem">ds1</span><span class="main">)</span> <span class="main">@</span> <span class="free">ds2</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> path_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ds1</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr afalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Branches›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">branch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list <span class="main">⇒</span> tree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">branch</span> <span class="main">[]</span> Leaf <span class="main">⟷</span> True"</span></span>    
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">branch</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">then</span> <span class="free">branch</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> <span class="free">branch</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">branch</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> False"</span></span>

<span class="keyword1" id="Tree-has_branch"><span class="command">lemma</span></span> has_branch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Leaf<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">[]</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span>Left<span class="main">#</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-branch_inv_Leaf"><span class="command">lemma</span></span> branch_inv_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">b</span> Leaf <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-branch_inv_Branching_Left"><span class="command">lemma</span></span> branch_inv_Branching_Left<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"branch <span class="main">(</span>Left<span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> branch <span class="free">b</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-branch_inv_Branching_Right"><span class="command">lemma</span></span> branch_inv_Branching_Right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"branch <span class="main">(</span>Right<span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> branch <span class="free">b</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-branch_inv_Branching"><span class="command">lemma</span></span> branch_inv_Branching<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"branch <span class="free">b</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> 
     <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b'</span><span class="main">.</span> <span class="free">b</span><span class="main">=</span><span class="bound">a</span><span class="main">#</span><span class="bound">b'</span><span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> branch <span class="bound">b'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="bound">a</span> <span class="main">⟶</span>  branch <span class="bound">b'</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-branch_inv_Leaf2"><span class="command">lemma</span></span> branch_inv_Leaf2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Leaf <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span>Leaf"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b'</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> branch <span class="bound">b</span> <span class="main">(</span>Branching <span class="bound">l</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> branch_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span>Leaf"</span></span> <span class="keyword1"><span class="command">using</span></span> has_branch<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> branch.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Leaf <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> branch <span class="bound">b</span> <span class="free">T</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-branch_is_path"><span class="command">lemma</span></span> branch_is_path<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"branch <span class="free">ds</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ds</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ds_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> branch <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">a</span> <span class="main">⟶</span> branch <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Branching<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ds_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-Branching_Leaf_Leaf_Tree"><span class="command">lemma</span></span> Branching_Leaf_Leaf_Tree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> Branching <span class="free">T1</span> <span class="free">T2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> branch <span class="main">(</span><span class="bound">B</span><span class="main">@</span><span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="free">T</span> <span class="main">∧</span> branch <span class="main">(</span><span class="bound">B</span><span class="main">@</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T1</span></span> <span class="quoted"><span class="free">T2</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T1'</span><span class="main">=</span>Leaf <span class="main">∧</span> <span class="skolem">T2'</span><span class="main">=</span>Leaf"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span> <span class="main">∧</span> branch <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T11</span> <span class="skolem">T12</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T1'</span> <span class="main">=</span> Branching <span class="skolem">T11</span> <span class="skolem">T12</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="skolem">T1'</span> 
                       <span class="main">∧</span> branch <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="skolem">T1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="main">(</span><span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span> 
             <span class="main">∧</span> branch <span class="main">(</span><span class="main">(</span><span class="main">[</span>True<span class="main">]</span> <span class="main">@</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T11</span> <span class="skolem">T12</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T2'</span> <span class="main">=</span> Branching <span class="skolem">T11</span> <span class="skolem">T12</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="skolem">T2'</span> 
                       <span class="main">∧</span> branch <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="skolem">T2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="main">(</span><span class="main">[</span>False<span class="main">]</span> <span class="main">@</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span> 
             <span class="main">∧</span> branch <span class="main">(</span><span class="main">(</span><span class="main">[</span>False<span class="main">]</span> <span class="main">@</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1'</span> <span class="skolem">T2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> tree.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Internal Paths›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">internal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list <span class="main">⇒</span> tree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internal</span> <span class="main">[]</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">internal</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">then</span> <span class="free">internal</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> <span class="free">internal</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">internal</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> False"</span></span>

<span class="keyword1" id="Tree-internal_inv_Leaf"><span class="command">lemma</span></span> internal_inv_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>internal <span class="free">b</span> Leaf"</span></span> <span class="keyword1"><span class="command">using</span></span> internal.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tree-internal_inv_Branching_Left"><span class="command">lemma</span></span> internal_inv_Branching_Left<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"internal <span class="main">(</span>Left<span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> internal <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-internal_inv_Branching_Right"><span class="command">lemma</span></span> internal_inv_Branching_Right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"internal <span class="main">(</span>Right<span class="main">#</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> internal <span class="free">b</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-internal_inv_Branching"><span class="command">lemma</span></span> internal_inv_Branching<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"internal <span class="free">p</span> <span class="main">(</span>Branching <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">p'</span><span class="main">.</span> <span class="free">p</span><span class="main">=</span><span class="bound">a</span><span class="main">#</span><span class="bound">p'</span><span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> internal <span class="bound">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="bound">a</span> <span class="main">⟶</span> internal <span class="bound">p'</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> internal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neq_Nil_conv<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">p'</span><span class="main">.</span> <span class="free">p</span><span class="main">=</span><span class="bound">a</span><span class="main">#</span><span class="bound">p'</span><span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟶</span> internal <span class="bound">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="bound">a</span> <span class="main">⟶</span> internal <span class="bound">p'</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p'</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">p'</span> <span class="free">l</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">p'</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-internal_is_path"><span class="command">lemma</span></span> internal_is_path<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"internal <span class="free">ds</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ds</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ds_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="skolem">a</span> <span class="main">⟶</span> path <span class="skolem">b</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ds_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-internal_prefix"><span class="command">lemma</span></span> internal_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="free">ds1</span><span class="main">@</span><span class="free">ds2</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"internal <span class="free">ds1</span> <span class="free">T</span>"</span></span> <span class="comment1">(* more or less copy paste of path_prefix *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ds1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ds1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">l</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> atrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="main">(</span><span class="skolem">ds1</span><span class="main">)</span> <span class="main">@</span> <span class="free">ds2</span> <span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> internal_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">ds1</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr atrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> afalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="main">(</span><span class="skolem">ds1</span><span class="main">)</span> <span class="main">@</span> <span class="free">ds2</span> <span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> internal_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">ds1</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr afalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Tree-internal_branch"><span class="command">lemma</span></span> internal_branch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="free">ds1</span><span class="main">@</span><span class="free">ds2</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"internal <span class="free">ds1</span> <span class="free">T</span>"</span></span> <span class="comment1">(* more or less copy paste of path_prefix *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ds1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ds1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">l</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> atrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">ds1</span> <span class="main">@</span> <span class="free">ds2</span> <span class="main">@</span> <span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> branch_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">ds1</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr atrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> afalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="main">(</span><span class="skolem">ds1</span><span class="main">)</span> <span class="main">@</span> <span class="free">ds2</span> <span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr Cons<span class="main">(</span>2<span class="main">)</span> branch_inv_Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">ds1</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"internal <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ds1</span><span class="main">)</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lr afalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">parent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list <span class="main">⇒</span> dir list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">parent</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="main">=</span> tl <span class="free"><span class="bound"><span class="entity">ds</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Deleting Nodes›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">delete</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list <span class="main">⇒</span> tree <span class="main">⇒</span> tree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delete</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> Leaf"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delete</span> <span class="main">(</span>True<span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span>  <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Branching <span class="main">(</span><span class="free">delete</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delete</span> <span class="main">(</span>False<span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Branching <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">delete</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delete</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> Leaf <span class="main">=</span> Leaf"</span></span>

<span class="keyword1" id="Tree-delete_Leaf"><span class="command">lemma</span></span> delete_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"delete <span class="free">T</span> Leaf <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-path_delete"><span class="command">lemma</span></span> path_delete<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">p</span> <span class="main">(</span>delete <span class="free">ds</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">p</span> <span class="free">T</span> "</span></span> <span class="comment1">(* What a huge proof... But the four cases can be proven shorter *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">ds'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bds'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span><span class="main">=</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">ds'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">dT1</span> <span class="bound">dT2</span><span class="main">.</span> delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">dT1</span> <span class="bound">dT2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons path_inv_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dT1</span></span> <span class="skolem"><span class="skolem">dT2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">dT1</span> <span class="skolem">dT2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span><span class="main">.</span> <span class="skolem">T</span><span class="main">=</span>Branching <span class="bound">T1</span> <span class="bound">T2</span>"</span></span> <span class="comment1">(* Is there a lemma hidden here that I could extract? *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> T1T2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span>Branching <span class="skolem">T1</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span><span class="skolem">T1</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-branch_delete"><span class="command">lemma</span></span> branch_delete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"branch <span class="free">p</span> <span class="main">(</span>delete <span class="free">ds</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"branch <span class="free">p</span> <span class="free">T</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="free">ds</span>"</span></span> <span class="comment1">(* Adapted from above *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"delete <span class="skolem">ds</span> <span class="skolem">T</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">T</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">using</span></span> delete.elims <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">ds'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bds'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span><span class="main">=</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">ds'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">dT1</span> <span class="bound">dT2</span><span class="main">.</span> delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">dT1</span> <span class="bound">dT2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons path_inv_Cons branch_is_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dT1</span></span> <span class="skolem"><span class="skolem">dT2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">dT1</span> <span class="skolem">dT2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span><span class="main">.</span> <span class="skolem">T</span><span class="main">=</span>Branching <span class="bound">T1</span> <span class="bound">T2</span>"</span></span> <span class="comment1">(* Is there a lemma hidden here that I could extract? *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> T1T2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span>Branching <span class="skolem">T1</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span><span class="skolem">T1</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="skolem">T1</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ds'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">using</span></span> bds'_p a_p b_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">p</span> <span class="skolem">T2</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ds'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p <span class="keyword1"><span class="command">using</span></span> bds'_p a_p b_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="Tree-branch_delete_postfix"><span class="command">lemma</span></span> branch_delete_postfix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">p</span> <span class="main">(</span>delete <span class="free">ds</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="free">ds</span> <span class="main">@</span> <span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span>"</span></span> <span class="comment1">(* Adapted from previous proof *)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">ds'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bds'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span><span class="main">=</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">ds'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">dT1</span> <span class="bound">dT2</span><span class="main">.</span> delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">dT1</span> <span class="bound">dT2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons path_inv_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dT1</span></span> <span class="skolem"><span class="skolem">dT2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"delete <span class="skolem">ds</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">dT1</span> <span class="skolem">dT2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span><span class="main">.</span> <span class="skolem">T</span><span class="main">=</span>Branching <span class="bound">T1</span> <span class="bound">T2</span>"</span></span> <span class="comment1">(* Is there a lemma hidden here that I could extract? *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">ds</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> T1T2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span>Branching <span class="skolem">T1</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p b_p bds'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p b_p bds'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ds'</span> <span class="main">@</span> <span class="bound">c</span> <span class="main">#</span> <span class="bound">cs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p b_p bds'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>delete <span class="skolem">ds</span> <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T1</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p bds'_p T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">p</span> <span class="main">(</span>delete <span class="skolem">ds'</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ds'</span> <span class="main">@</span> <span class="bound">c</span> <span class="main">#</span> <span class="bound">cs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p a_p b_p bds'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-treezise_delete"><span class="command">lemma</span></span> treezise_delete<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"internal <span class="free">p</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"treesize <span class="main">(</span>delete <span class="free">p</span> <span class="free">T</span><span class="main">)</span> <span class="main">&lt;</span> treesize <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">T1</span> <span class="bound">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> T1T2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">T1</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T1</span> <span class="bound">T2</span><span class="main">.</span> <span class="skolem">T</span> <span class="main">=</span> Branching <span class="bound">T1</span> <span class="bound">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_inv_Cons internal_is_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> T1T2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> Branching <span class="skolem">T1</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="skolem">a</span></span>
      <span class="keyword1"><span class="command">from</span></span> a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delete <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>Branching <span class="main">(</span>delete <span class="skolem">p</span> <span class="skolem">T1</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">p</span> <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"treesize <span class="main">(</span>delete <span class="skolem">p</span> <span class="skolem">T1</span><span class="main">)</span> <span class="main">&lt;</span> treesize <span class="skolem">T1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delete <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span>Branching <span class="skolem">T1</span> <span class="main">(</span>delete <span class="skolem">p</span> <span class="skolem">T2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"internal <span class="skolem">p</span> <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"treesize <span class="main">(</span>delete <span class="skolem">p</span> <span class="skolem">T2</span><span class="main">)</span> <span class="main">&lt;</span> treesize <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> T1T2_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cutoff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dir list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> dir list <span class="main">⇒</span> tree <span class="main">⇒</span> tree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cutoff</span> <span class="free"><span class="bound"><span class="entity">red</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="main">(</span>Branching <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">red</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="keyword1">then</span> Leaf <span class="keyword1">else</span> Branching <span class="main">(</span><span class="free">cutoff</span> <span class="free"><span class="bound"><span class="entity">red</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">@</span><span class="main">[</span>Left<span class="main">]</span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">cutoff</span> <span class="free"><span class="bound"><span class="entity">red</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">@</span><span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">T<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">cutoff</span> <span class="free"><span class="bound"><span class="entity">red</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span> Leaf <span class="main">=</span> Leaf"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Initially you should call <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cutoff<span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ds</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
 If all branches are red, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cutoff<span class="antiquote"><span class="antiquote">}</span></span></span></span> gives a subtree.
 If all branches are red, then so are the ones in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cutoff<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
 The internal paths of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> cutoff<span class="antiquote"><span class="antiquote">}</span></span></span></span> are not red.›</span></span>

<span class="keyword1" id="Tree-treesize_cutoff"><span class="command">lemma</span></span> treesize_cutoff<span class="main">:</span> <span class="quoted"><span class="quoted">"treesize <span class="main">(</span>cutoff <span class="free">red</span> <span class="free">ds</span> <span class="free">T</span><span class="main">)</span> <span class="main">≤</span> treesize <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T1</span> <span class="skolem">T2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"treesize <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="skolem">T1</span><span class="main">)</span> <span class="main">+</span> treesize <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T2</span><span class="main">)</span> <span class="main">≤</span> treesize <span class="skolem">T1</span> <span class="main">+</span> treesize <span class="skolem">T2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">anypath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> <span class="main">(</span>dir list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">anypath</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> path <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">anybranch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> <span class="main">(</span>dir list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">anybranch</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">anyinternal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> <span class="main">(</span>dir list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">anyinternal</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> internal <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1" id="Tree-cutoff_branch'"><span class="command">lemma</span></span> cutoff_branch'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">red</span><span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="main">(</span>cutoff <span class="free">red</span> <span class="free">ds</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">red</span><span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span> <span class="comment1">(* This proof seems a bit excessive for such a simple theorem *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Leaf<span class="main">)</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="skolem">ds</span> Leaf"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="skolem">ds</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Branching <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="bound">p</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"anybranch <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> 
         "</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> Branching <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="bound">p</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"anybranch <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> 
         "</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>           
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">red</span> <span class="skolem">ds</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">red</span> <span class="skolem">ds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ds_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">red</span> <span class="skolem">ds</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ds_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ds_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span> <span class="skolem">ds</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Left<span class="main">]</span><span class="main">)</span>  <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> ds_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">=</span> Branching <span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this b_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> branch <span class="skolem">b'</span> <span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="skolem">a</span> <span class="main">⟶</span> branch <span class="skolem">b'</span> <span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Branching<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa bb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-cutoff_branch"><span class="command">lemma</span></span> cutoff_branch<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">[]</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms cutoff_branch'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">red</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-cutoff_internal'"><span class="command">lemma</span></span> cutoff_internal'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">red</span><span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"anyinternal <span class="main">(</span>cutoff <span class="free">red</span> <span class="free">ds</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">¬</span><span class="free">red</span><span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ds</span></span><span class="main">)</span> <span class="comment1">(* This proof seems a bit excessive for such a simple theorem *)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Leaf<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>                                                     
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="skolem">ds</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Branching <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="bound">p</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Left<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"anyinternal <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> Branching <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span> <span class="main">(</span>Branching <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> branch <span class="bound">p</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟶</span> <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">(</span>Right<span class="main">#</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"anyinternal <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="free">red</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Branching <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"internal <span class="skolem">p</span> <span class="var">?T</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ds_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span> <span class="skolem">ds</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> internal_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="skolem">p</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span><span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ds_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Left<span class="main">]</span><span class="main">)</span>  <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span><span class="main">@</span><span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">=</span> Branching <span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ds_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p'</span> <span class="main">∧</span>
             <span class="main">(</span><span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">p'</span> <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">¬</span> <span class="skolem">a</span> <span class="main">⟶</span> internal <span class="skolem">p'</span> <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="skolem">T<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> b_p internal_inv_Branching<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="var"><span class="quoted"><span class="var">?T<span class="hidden">⇩</span><sub>2</sub>'</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa bb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">red</span><span class="main">(</span><span class="skolem">ds</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-cutoff_internal"><span class="command">lemma</span></span> cutoff_internal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="free">red</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"anyinternal <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">[]</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span><span class="free">red</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms cutoff_internal'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">red</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-cutoff_branch_internal'"><span class="command">lemma</span></span> cutoff_branch_internal'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="free">red</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"anyinternal <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">[]</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span><span class="free">red</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> anybranch <span class="main">(</span>cutoff <span class="free">red</span> <span class="main">[]</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms cutoff_internal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> cutoff_branch<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Tree-cutoff_branch_internal"><span class="command">lemma</span></span> cutoff_branch_internal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="free">T</span> <span class="free">red</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T'</span><span class="main">.</span> anyinternal <span class="bound">T'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span><span class="free">red</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> anybranch <span class="bound">T'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">red</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms cutoff_branch_internal' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Possibly Infinite Trees›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Possibly infinite trees are of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"dir list set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">wf_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_tree</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ds</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">ds</span> <span class="main">@</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟶</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The subtree in with root r›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subtree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dir list set <span class="main">⇒</span> dir list <span class="main">⇒</span> dir list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">subtree</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ds</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">ds'</span><span class="main">.</span> <span class="bound">ds</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">@</span> <span class="bound">ds'</span><span class="main">}</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A subtree of a tree is either in the left branch, the right branch, or is the tree itself›</span></span>
<span class="keyword1" id="Tree-subtree_pos"><span class="command">lemma</span></span> subtree_pos<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"subtree <span class="free">T</span> <span class="free">ds</span> <span class="main">⊆</span> subtree <span class="free">T</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">∪</span> subtree <span class="free">T</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">ds</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> Set.UnCI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?subtree</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subtree <span class="free">T</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?subtree</span> <span class="free">ds</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="free">ds</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">ds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">ds</span> <span class="main">@</span> <span class="main">[</span><span class="bound">d</span><span class="main">]</span> <span class="main">@</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm list.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span> <span class="main">@</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span> <span class="main">@</span> <span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bool.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Infinite Paths›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">wf_infpath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_infpath</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-infpath_length"><span class="command">lemma</span></span> infpath_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_infpath <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_append_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tree-chain_prefix"><span class="command">lemma</span></span> chain_prefix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_infpath <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">@</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∨</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">@</span> <span class="main">[</span><span class="bound">b</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If we make a lookup in a list, then looking up in an extension gives us the same value.›</span></span>
<span class="keyword1" id="Tree-ith_in_extension"><span class="command">lemma</span></span> ith_in_extension<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chain<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> smalli<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="hidden">⇩</span><sub>1</sub>n<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> chain n<span class="hidden">⇩</span><sub>1</sub>n<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chain_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smalli <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹König's Lemma›</span></span>

<span class="keyword1" id="Tree-inf_subs"><span class="command">lemma</span></span> inf_subs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite<span class="main">(</span>subtree <span class="free">T</span> <span class="free">ds</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite<span class="main">(</span>subtree <span class="free">T</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>finite<span class="main">(</span>subtree <span class="free">T</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?subtree</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subtree <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asms<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="var">?subtree</span><span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="var">?subtree</span><span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?subtree</span> <span class="free">ds</span> <span class="main">⊆</span> <span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span> <span class="main">)</span> <span class="main">∪</span> <span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">ds</span><span class="main">}</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> subtree_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite<span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>finite<span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">buildchain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dir list <span class="main">⇒</span> dir list<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> dir list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">buildchain</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">buildchain</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">(</span><span class="free">buildchain</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-konig"><span class="command">lemma</span></span> konig<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wellformed<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_tree <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> wf_infpath <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?subtree</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subtree <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextnode</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ds</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span>finite <span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="bound">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">ds</span> <span class="main">@</span> <span class="main">[</span>Left<span class="main">]</span> <span class="keyword1">else</span> <span class="bound">ds</span> <span class="main">@</span> <span class="main">[</span>Right<span class="main">]</span><span class="main">)</span>"</span></span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"buildchain <span class="var">?nextnode</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> is_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> wellformed <span class="keyword1"><span class="command">have</span></span> prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ds</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">ds</span> <span class="main">@</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟶</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="main">¬</span>finite <span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ds</span><span class="main">.</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_finite_existsD<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">@</span><span class="skolem">ds</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> next_in<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> next_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> next_inf <span class="keyword1"><span class="command">have</span></span> next_next_inf<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">(</span><span class="var">?subtree</span> <span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> inf_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ds</span><span class="main">.</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="var">?subtree</span> <span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_finite_existsD<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">where</span></span> dss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">∈</span> <span class="var">?subtree</span> <span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">suf</span><span class="main">.</span> <span class="skolem">ds</span> <span class="main">=</span> <span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="bound">suf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">suf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="skolem">ds</span> <span class="main">=</span> <span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">suf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?nextnode</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> next_next_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_infpath <span class="var">?c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="var">?c</span> <span class="bound">n</span><span class="main">)</span><span class="main">∈</span> <span class="free">T</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> is_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resolution">
<div class="head">
<h1>Theory Resolution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More Terms and Literals›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Resolution <span class="keyword2"><span class="keyword">imports</span></span> <a href="TermsAndLiterals.html">TermsAndLiterals</a> <a href="Tree.html">Tree</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">complement</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> literal <span class="main">⇒</span> <span class="tfree">'t</span> literal"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span> <span class="main">[</span>300<span class="main">]</span> 300<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>c</sup></span></span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>  
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>c</sup></span></span> <span class="main">=</span> Pos <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1" id="Resolution-cancel_comp1"><span class="command">lemma</span></span> cancel_comp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>   

<span class="keyword1" id="Resolution-cancel_comp2"><span class="command">lemma</span></span> cancel_comp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-comp_exi1"><span class="command">lemma</span></span> comp_exi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="bound">l'</span> <span class="main">=</span> <span class="free">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1" id="Resolution-comp_exi2"><span class="command">lemma</span></span> comp_exi2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">l'</span> <span class="main">=</span> <span class="bound">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-comp_swap"><span class="command">lemma</span></span> comp_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟶</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">⟶</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-sign_comp"><span class="command">lemma</span></span> sign_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> get_pred <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> get_pred <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> get_terms <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> get_terms <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-sign_comp_atom"><span class="command">lemma</span></span> sign_comp_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> get_atom <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> get_atom <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Clauses›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'t</span> clause <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> literal set"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">complementls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> literal set <span class="main">⇒</span> <span class="tfree">'t</span> literal set"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span> <span class="main">[</span>300<span class="main">]</span> 300<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>C</sup></span></span> <span class="main">≡</span> complement <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1" id="Resolution-cancel_compls1"><span class="command">lemma</span></span> cancel_compls1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span> <span class="main">=</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cancel_comp1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> imageI cancel_comp1<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-cancel_compls2"><span class="command">lemma</span></span> cancel_compls2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cancel_compls1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> cancel_compls1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vars<span class="hidden">⇩</span><sub>t</sub></span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> var_sym set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vars<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> <span class="free">vars<span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> var_sym set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vars<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> var_sym set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">vars<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>get_terms <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal set <span class="main">⇒</span> var_sym set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">l</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">.</span> vars<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span>"</span></span>

<span class="keyword1" id="Resolution-ground_vars"><span class="command">lemma</span></span> ground_vars<span class="hidden">⇩</span><sub>t</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ground_vars<span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub>_vars<span class="hidden">⇩</span><sub>l</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">using</span></span> assms ground_vars<span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">using</span></span> assms ground<span class="hidden">⇩</span><sub>l</sub>_vars<span class="hidden">⇩</span><sub>l</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground_comp"><span class="command">lemma</span></span> ground_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="main">⟷</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground_compls"><span class="command">lemma</span></span>  ground_compls<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span> <span class="main">⟷</span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Alternative - Collect variables with vars and see if empty set *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'u</span> fun_denot  <span class="main">=</span> <span class="quoted"><span class="quoted">"fun_sym  <span class="main">⇒</span> <span class="tfree">'u</span> list <span class="main">⇒</span> <span class="tfree">'u</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'u</span> pred_denot <span class="main">=</span> <span class="quoted"><span class="quoted">"pred_sym <span class="main">⇒</span> <span class="tfree">'u</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'u</span> var_denot  <span class="main">=</span> <span class="quoted"><span class="quoted">"var_sym  <span class="main">⇒</span> <span class="tfree">'u</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval<span class="hidden">⇩</span><sub>t</sub></span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> var_denot <span class="main">⇒</span> <span class="tfree">'u</span> fun_denot <span class="main">⇒</span> fterm <span class="main">⇒</span> <span class="tfree">'u</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="main">(</span><span class="free">eval<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> var_denot <span class="main">⇒</span> <span class="tfree">'u</span> fun_denot <span class="main">⇒</span> fterm list <span class="main">⇒</span> <span class="tfree">'u</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> map <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> var_denot <span class="main">⇒</span> <span class="tfree">'u</span> fun_denot <span class="main">⇒</span> <span class="tfree">'u</span> pred_denot <span class="main">⇒</span> fterm literal <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">⟷</span>  <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> fun_denot <span class="main">⇒</span> <span class="tfree">'u</span> pred_denot <span class="main">⇒</span> fterm clause <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> fun_denot <span class="main">⇒</span> <span class="tfree">'u</span> pred_denot <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">C</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics of Ground Terms›</span></span>

<span class="keyword1" id="Resolution-ground_var_denott"><span class="command">lemma</span></span> ground_var_denott<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">t</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E'</span> <span class="free">F</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fun <span class="skolem">f</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="skolem">ts</span><span class="main">.</span> ground<span class="hidden">⇩</span><sub>t</sub> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set <span class="skolem">ts</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> <span class="free">F</span> <span class="bound">t</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E'</span> <span class="free">F</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="skolem">ts</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E'</span> <span class="free">F</span> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E'</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-ground_var_denotts"><span class="command">lemma</span></span> ground_var_denotts<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">ts</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E'</span> <span class="free">F</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ground_var_denott <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_eq_conv<span class="main">)</span>


<span class="keyword1" id="Resolution-ground_var_denot"><span class="command">lemma</span></span> ground_var_denot<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E'</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Pos <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ground_var_denotts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval<span class="hidden">⇩</span><sub>l</sub>.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> literal.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Neg <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ground_var_denotts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eval<span class="hidden">⇩</span><sub>l</sub>.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> literal.sel<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Substitutions›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> substitution <span class="main">=</span> <span class="quoted"><span class="quoted">"var_sym <span class="main">⇒</span> fterm"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sub</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm list"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm literal"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>l</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>l</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal set <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm literal set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="keyword1"><span class="free">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1" id="Resolution-subls_def2"><span class="command">lemma</span></span> subls_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">|</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instance_of<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> fterm <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">instance_of<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> fterm list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ts<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ts<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ts<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ts<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instance_of<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> fterm literal <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">instance_of<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="bound">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause <span class="main">⇒</span> fterm clause <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">σ</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resolution-comp_sub"><span class="command">lemma</span></span> comp_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">=</span><span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-compls_subls"><span class="command">lemma</span></span> compls_subls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">=</span><span class="main">(</span><span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> comp_sub <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-subls_union"><span class="command">lemma</span></span> subls_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* 
  Alternative: apply a substitution that is a bijection between the set of variables in C1 and some other set.
 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">var_renaming_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause <span class="main">⇒</span> fterm clause <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">var_renaming_of</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⟷</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">∧</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Empty Substitution›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ε</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ε</span> <span class="main">≡</span> Var"</span></span>

<span class="keyword1" id="Resolution-empty_subt"><span class="command">lemma</span></span> empty_subt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">::</span> fterm<span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> ε <span class="main">=</span> <span class="free">t</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="Resolution-empty_subts"><span class="command">lemma</span></span> empty_subts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> ε <span class="main">=</span> <span class="free">ts</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> empty_subt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-empty_subl"><span class="command">lemma</span></span> empty_subl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> ε <span class="main">=</span> <span class="free">l</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> empty_subts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-empty_subls"><span class="command">lemma</span></span> empty_subls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> ε <span class="main">=</span> <span class="free">L</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> empty_subl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_self<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_def
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_self<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_self<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_def
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_self<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Substitutions and Ground Terms›</span></span>

<span class="keyword1" id="Resolution-ground_sub"><span class="command">lemma</span></span> ground_sub<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="Resolution-ground_subs"><span class="command">lemma</span></span> ground_subs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="free">ts</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms ground_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub>_subs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="free">l</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms ground_subs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_subls<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ground<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> l_L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground<span class="hidden">⇩</span><sub>l</sub>_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">∈</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_L <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> l_L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="free">L</span> <span class="main">∧</span> <span class="skolem">l'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground ground<span class="hidden">⇩</span><sub>l</sub>_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> l_L l'_p this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">composition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> substitution <span class="main">⇒</span> substitution"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">σ<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="keyword1" id="Resolution-composition_conseq2t"><span class="command">lemma</span></span> composition_conseq2t<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fun <span class="skolem">t</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-composition_conseq2ts"><span class="command">lemma</span></span> composition_conseq2ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> composition_conseq2t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-composition_conseq2l"><span class="command">lemma</span></span> composition_conseq2l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> composition_conseq2t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1" id="Resolution-composition_conseq2ls"><span class="command">lemma</span></span> composition_conseq2ls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> composition_conseq2l <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> imageI<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1" id="Resolution-composition_assoc"><span class="command">lemma</span></span> composition_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">σ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> composition_def composition_conseq2t<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-empty_comp1"><span class="command">lemma</span></span> empty_comp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⋅</span> ε<span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ</span> <span class="main">⋅</span> ε<span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">σ</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">using</span></span> empty_subt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-empty_comp2"><span class="command">lemma</span></span> empty_comp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ε <span class="main">⋅</span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ε <span class="main">⋅</span> <span class="free">σ</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">σ</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_trans <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub> <span class="free">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">t<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub> <span class="free">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">t<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub> <span class="free">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">t<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> t<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> t<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">t<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">t<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">t<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⋅</span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> ts<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ts<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ts<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">ts<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ts<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ts<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ts<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> ts<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">ts<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">ts<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ts<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⋅</span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2ts <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_trans <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⋅</span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-instance_of"><span class="command">lemma</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> L<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> L<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> L<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> L<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">σ<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>3</sub></span> <span class="main">⋅</span> <span class="skolem">σ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Merging substitutions›</span></span>

<span class="keyword1" id="Resolution-project_sub"><span class="command">lemma</span></span> project_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inst_C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">C'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> L'sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">⊆</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">L</span></span> <span class="main">⊆</span> <span class="free">C</span><span class="main">.</span> <span class="bound">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">L'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">C</span><span class="main">-</span><span class="bound">L</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">C'</span> <span class="main">-</span> <span class="free">L'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span> <span class="main">∈</span> <span class="free">L'</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="bound">l'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">L'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Orderings.order_antisym<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> Set.subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l'</span>
      <span class="keyword3"><span class="command">assume</span></span> l'L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> <span class="free">L'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> inst_C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span><span class="main">|</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">}</span> <span class="main">=</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subls_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span> <span class="main">∈</span> <span class="free">L'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L'sub l'L <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">l'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span> <span class="main">∈</span> <span class="free">L'</span><span class="main">}</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">l'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">l</span></span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">∈</span><span class="free">L'</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="bound">l'</span><span class="main">}</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">-</span><span class="var">?L</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">C'</span> <span class="main">-</span> <span class="free">L'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inst_C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-relevant_vars_subt"><span class="command">lemma</span></span> relevant_vars_subt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fun <span class="skolem">f</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="skolem">ts</span> <span class="main">⟶</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="bound">t</span> <span class="main">⊆</span> vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="skolem">ts</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> tints<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="skolem">ts</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="skolem">t</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f Fun<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fun tints <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-relevant_vars_subts"><span class="command">lemma</span></span> relevant_vars_subts<span class="main">:</span> <span class="comment1">(* similar to above proof *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟶</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="bound">t</span> <span class="main">⊆</span> vars<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="free">ts</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> tints<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>t</sub> <span class="skolem">t</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subt tints <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-relevant_vars_subl"><span class="command">lemma</span></span> relevant_vars_subl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subts <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subts <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-relevant_vars_subls"><span class="command">lemma</span></span> relevant_vars_subls<span class="main">:</span> <span class="comment1">(* in many ways a mirror of relevant_vars_subts  *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span> <span class="main">⟶</span> vars<span class="hidden">⇩</span><sub>l</sub> <span class="bound">l</span> <span class="main">⊆</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span> linls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span><span class="free">L</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>vars<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">l</span><span class="main">.</span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x</span> <span class="main">=</span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subl linls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> image_cong<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-merge_sub"><span class="command">lemma</span></span> merge_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">D</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> CC'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span> <span class="main">=</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> DD'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">μ</span> <span class="main">=</span> <span class="free">D'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">η</span><span class="main">.</span> <span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">η</span> <span class="main">=</span> <span class="free">C'</span> <span class="main">∧</span> <span class="free">D</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">η</span> <span class="main">=</span> <span class="free">D'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span> <span class="keyword1">then</span> <span class="free">lmbd</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">μ</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span><span class="main">.</span> <span class="var">?η</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">lmbd</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?η</span> <span class="main">=</span> <span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">lmbd</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subls<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="quoted"><span class="free">lmbd</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?η</span> <span class="main">=</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CC' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">D</span><span class="main">.</span> <span class="var">?η</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">μ</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?η</span> <span class="main">=</span> <span class="free">D</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> relevant_vars_subls<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span> <span class="var"><span class="quoted"><span class="var">?η</span></span></span> <span class="quoted"><span class="free">μ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?η</span> <span class="main">=</span> <span class="free">D'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DD' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Standardizing apart›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">std<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause <span class="main">⇒</span> fterm clause"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">std<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''1''</span> <span class="main">@</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">std<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause <span class="main">⇒</span> fterm clause"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">std<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''2''</span> <span class="main">@</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resolution-std_apart_apart''"><span class="command">lemma</span></span> std_apart_apart''<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>t</sub>  <span class="main">(</span><span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>char list<span class="main">.</span> Var <span class="main">(</span><span class="free">y</span> <span class="main">@</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">@</span><span class="bound">x'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-std_apart_apart'"><span class="command">lemma</span></span> std_apart_apart'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var  <span class="main">(</span><span class="free">y</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">@</span><span class="bound">x'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">using</span></span> std_apart_apart'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-std_apart_apart"><span class="command">lemma</span></span> std_apart_apart<span class="main">:</span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="skolem">x</span><span class="main">=</span><span class="inner_quoted">''1''</span> <span class="main">@</span> <span class="bound">x'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> std_apart_apart'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''1''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> xin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="skolem">x</span><span class="main">=</span> <span class="inner_quoted">''2''</span> <span class="main">@</span><span class="bound">x'</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> std_apart_apart'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''2''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-std_apart_instance_of"><span class="command">lemma</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>1<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''1''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> ε <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''1''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''1''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-std_apart_instance_of"><span class="command">lemma</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>2<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C2</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C2</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''2''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ε"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> ε <span class="main">=</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_subls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''2''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span><span class="inner_quoted">''2''</span><span class="main">@</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> composition_conseq2ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C2</span> <span class="main">=</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Var <span class="main">(</span>tl <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C2</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Unifiers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> fterm set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> fterm literal set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="bound">l'</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resolution-unif_sub"><span class="command">lemma</span></span> unif_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unif<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> subls <span class="free">L</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span>subl <span class="bound">l</span> <span class="free">σ</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> unif this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-unifiert_def2"><span class="command">lemma</span></span> unifiert_def2<span class="main">:</span> <span class="comment1">(*  (λt. sub t σ) ` ts could have some nice notation maybe *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> L_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">ts</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sub <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">`</span> <span class="free">ts</span> <span class="main">=</span><span class="main">{</span><span class="bound">l</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> unif<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> L_elem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sub <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">`</span> <span class="free">ts</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unif <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sub <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">`</span> <span class="free">ts</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sub <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">`</span> <span class="free">ts</span> <span class="main">=</span><span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> sub <span class="bound">t</span> <span class="free">σ</span><span class="main">)</span> <span class="main">`</span> <span class="free">ts</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l'</span> <span class="main">∈</span> <span class="free">ts</span><span class="main">.</span> <span class="bound">l'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-unifier"><span class="command">lemma</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> L_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> unif<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> L_elem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unif <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span><span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l'</span> <span class="main">∈</span> <span class="free">L</span><span class="main">.</span> <span class="bound">l'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-ground"><span class="command">lemma</span></span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_unif_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">L</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> unif<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ'</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> empt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">L</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> unif empt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">L</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ'</span> <span class="main">=</span> <span class="main">{</span><span class="bound">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unif_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_subls ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unifiablets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unifiablets</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">σ</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unifiablels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unifiablels</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">σ</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">σ</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resolution-unifier_comp"><span class="command">lemma</span></span> unifier_comp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span> <span class="main">⟷</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l''</span></span> <span class="keyword2"><span class="keyword">where</span></span> l''_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l''</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="skolem">l''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_exi2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this l''_p <span class="keyword1"><span class="command">have</span></span> l'_p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span><span class="free">L</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">∈</span> <span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cancel_comp1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l'_p comp_sub cancel_comp1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-unifier_sub1"><span class="command">lemma</span></span> unifier_sub1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">L'</span> <span class="main">⊆</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L'</span> "</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-unifier_sub2"><span class="command">lemma</span></span> unifier_sub2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this asm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unifier_sub1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Most General Unifiers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> fterm set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">⟷</span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⋅</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> fterm literal set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">⟷</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⋅</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Resolution›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">applicable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"   fterm clause <span class="main">⇒</span> fterm clause 
                          <span class="main">⇒</span> fterm literal set <span class="main">⇒</span> fterm literal set 
                          <span class="main">⇒</span> substitution <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">applicable</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> 
       <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≠</span> <span class="main">{}</span>
     <span class="main">∧</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">{}</span> 
     <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> 
     <span class="main">∧</span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mresolution</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"   fterm clause <span class="main">⇒</span> fterm clause 
                          <span class="main">⇒</span> fterm literal set <span class="main">⇒</span> fterm literal set 
                          <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm clause"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mresolution</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resolution</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"   fterm clause <span class="main">⇒</span> fterm clause 
                          <span class="main">⇒</span> fterm literal set <span class="main">⇒</span> fterm literal set 
                          <span class="main">⇒</span> substitution <span class="main">⇒</span> fterm clause"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">resolution</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">mresolution_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause set <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  mresolution_rule<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> applicable <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> 
       <span class="free">mresolution_step</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">∪</span> <span class="main">{</span>mresolution <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> standardize_apart<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> var_renaming_of <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">⟹</span> <span class="free">mresolution_step</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">resolution_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause set <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  resolution_rule<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> applicable <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟹</span> 
       <span class="free">resolution_step</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">∪</span> <span class="main">{</span>resolution <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">L<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> standardize_apart<span class="main">:</span> <span class="comment1">(* renaming *)</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟹</span> var_renaming_of <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">⟹</span> <span class="free">resolution_step</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mresolution_deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause set <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mresolution_deriv</span> <span class="main">=</span> rtranclp mresolution_step"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resolution_deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause set <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">resolution_deriv</span> <span class="main">=</span> rtranclp resolution_step"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">evalsub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'u</span> var_denot <span class="main">⇒</span> <span class="tfree">'u</span> fun_denot <span class="main">⇒</span> substitution <span class="main">⇒</span> <span class="tfree">'u</span> var_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalsub</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>

<span class="keyword1" id="Resolution-substitutiont"><span class="command">lemma</span></span> substitutiont<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> <span class="free">F</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>evalsub <span class="free">E</span> <span class="free">F</span> <span class="free">σ</span><span class="main">)</span> <span class="free">F</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">unfolding</span></span> evalsub_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> comp_apply map_cong<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-substitutionts"><span class="command">lemma</span></span> substitutionts<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="main">(</span><span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>evalsub <span class="free">E</span> <span class="free">F</span> <span class="free">σ</span><span class="main">)</span> <span class="free">F</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> substitutiont <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-substitution"><span class="command">lemma</span></span> substitution<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">⟷</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>evalsub <span class="free">E</span> <span class="free">F</span> <span class="free">σ</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> 
 <span class="keyword1"><span class="command">using</span></span> substitutionts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> eval<span class="hidden">⇩</span><sub>l</sub>.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subl.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">using</span></span> substitutionts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> eval<span class="hidden">⇩</span><sub>l</sub>.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subl.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Resolution-subst_sound"><span class="command">lemma</span></span> subst_sound<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E'</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>evalsub <span class="skolem">E</span> <span class="free">F</span> <span class="free">σ</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> substitution <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-simple_resolution_sound"><span class="command">lemma</span></span> simple_resolution_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="hidden">⇩</span><sub>1</sub>sat<span class="main">:</span>  <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="hidden">⇩</span><sub>2</sub>sat<span class="main">:</span>  <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>1</sub>inc<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>2</sub>inc<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="bound">l<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>2</sub>inc<span class="hidden">⇩</span><sub>2</sub> C<span class="hidden">⇩</span><sub>2</sub>sat <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="comment1">(* Symmetric *)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="bound">l<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>1</sub>inc<span class="hidden">⇩</span><sub>1</sub> C<span class="hidden">⇩</span><sub>1</sub>sat <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="main">{</span><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-mresolution_sound"><span class="command">lemma</span></span> mresolution_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sat<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sat<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> appl<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span>mresolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sat<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">have</span></span> sat<span class="hidden">⇩</span><sub>1</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> sat<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> sat<span class="hidden">⇩</span><sub>2</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> appl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inc<span class="hidden">⇩</span><sub>1</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p <span class="keyword1"><span class="command">have</span></span> unified<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p appl <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>1</sub>σisl<span class="hidden">⇩</span><sub>1</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> appl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inc<span class="hidden">⇩</span><sub>2</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">have</span></span> unified<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">∈</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> unified<span class="hidden">⇩</span><sub>1</sub> unified<span class="hidden">⇩</span><sub>2</sub> appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_sub comp_swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> unifier_sub2 <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>2</sub>σisl<span class="hidden">⇩</span><sub>2</sub>σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> sat<span class="hidden">⇩</span><sub>1</sub>σ sat<span class="hidden">⇩</span><sub>2</sub>σ inc<span class="hidden">⇩</span><sub>1</sub>σ inc<span class="hidden">⇩</span><sub>2</sub>σ comp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> simple_resolution_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this l<span class="hidden">⇩</span><sub>1</sub>σisl<span class="hidden">⇩</span><sub>1</sub>σ l<span class="hidden">⇩</span><sub>2</sub>σisl<span class="hidden">⇩</span><sub>2</sub>σ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mresolution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-resolution_superset"><span class="command">lemma</span></span> resolution_superset<span class="main">:</span> <span class="quoted"><span class="quoted">"mresolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span> <span class="main">⊆</span> resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> mresolution_def resolution_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-superset_sound"><span class="command">lemma</span></span> superset_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sat<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C'</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
      <span class="keyword1"><span class="command">from</span></span> sat <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C'</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">theorem</span></span> resolution_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sat<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sat<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> appl<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sat<span class="hidden">⇩</span><sub>1</sub> sat<span class="hidden">⇩</span><sub>2</sub> appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span>mresolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mresolution_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> superset_sound resolution_superset <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-mstep_sound"><span class="command">lemma</span></span> mstep_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mresolution_step <span class="free">Cs</span> <span class="free">Cs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mresolution_step.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mresolution_rule <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Cs</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">σ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span>mresolution <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mresolution_sound mresolution_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mresolution_rule <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>standardize_apart <span class="skolem">C</span> <span class="skolem">Cs</span> <span class="skolem">C'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_sound standardize_apart <span class="keyword1"><span class="command">unfolding</span></span> var_renaming_of_def instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> standardize_apart <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> step_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="free">Cs</span> <span class="free">Cs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> resolution_step.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>resolution_rule <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Cs</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">σ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">(</span>resolution <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> resolution_sound resolution_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> resolution_rule <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>standardize_apart <span class="skolem">C</span> <span class="skolem">Cs</span> <span class="skolem">C'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subst_sound standardize_apart <span class="keyword1"><span class="command">unfolding</span></span> var_renaming_of_def instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> standardize_apart <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-mderivation_sound"><span class="command">lemma</span></span> mderivation_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mresolution_deriv <span class="free">Cs</span> <span class="free">Cs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mresolution_deriv_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> rtrancl_refl <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rtrancl_into_rtrancl <span class="skolem">Cs<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Cs<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Cs<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mstep_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> derivation_sound<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="free">Cs</span> <span class="free">Cs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> rtrancl_refl <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rtrancl_into_rtrancl <span class="skolem">Cs<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Cs<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Cs<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> derivation_sound_refute<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="free">Cs</span> <span class="free">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="free">Cs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deriv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span> <span class="main">⟶</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> derivation_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> deriv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs'</span> <span class="main">⟶</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">{}</span> <span class="main">⟶</span> False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Herbrand Interpretations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> HFun<span class="antiquote"><span class="antiquote">}</span></span></span></span> is the Herbrand function denotation in which terms are mapped to themselves.›</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted">HFun</span>

<span class="keyword1" id="Resolution-eval_ground"><span class="command">lemma</span></span> eval_ground<span class="hidden">⇩</span><sub>t</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> HFun <span class="free">t</span><span class="main">)</span> <span class="main">=</span> hterm_of_fterm <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1" id="Resolution-eval_ground"><span class="command">lemma</span></span> eval_ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> hterms_of_fterms <span class="free">ts</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> hterms_of_fterms_def <span class="keyword1"><span class="command">using</span></span> assms eval_ground<span class="hidden">⇩</span><sub>t</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>l</sub>_ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span>Pos <span class="free">P</span> <span class="free">ts</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">G</span> <span class="free">P</span> <span class="main">(</span>hterms_of_fterms <span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span>Pos <span class="free">P</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span> <span class="free">P</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">G</span> <span class="free">P</span> <span class="main">(</span>hterms_of_fterms <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm eval_ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Partial Interpretations›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> partial_pred_denot <span class="main">=</span> <span class="quoted"><span class="quoted">"bool list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">falsifies<span class="hidden">⇩</span><sub>l</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> fterm literal <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">falsifies<span class="hidden">⇩</span><sub>l</sub></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟷</span>
        ground<span class="hidden">⇩</span><sub>l</sub> <span class="free"><span class="bound"><span class="entity">l</span></span></span>
     <span class="main">∧</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span> <span class="main">=</span> nat_of_fatom <span class="main">(</span>get_atom <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>
        <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A ground clause is falsified if it is actually ground and all its literals are falsified.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">falsifies<span class="hidden">⇩</span><sub>g</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> fterm clause <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">falsifies<span class="hidden">⇩</span><sub>g</sub></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">falsifies<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> fterm clause <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">falsifies<span class="hidden">⇩</span><sub>c</sub></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C'</span><span class="main">.</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">C'</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">C'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">C</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">extend</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> partial_pred_denot<span class="main">)</span> <span class="main">⇒</span> hterm pred_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">extend</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> <span class="main">(</span>
     <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> nat_of_hatom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
       <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span>
     <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sub_of_denot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm var_denot <span class="main">⇒</span> substitution"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sub_of_denot</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> fterm_of_hterm <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span>

<span class="keyword1" id="Resolution-ground_sub_of_denott"><span class="command">lemma</span></span> ground_sub_of_denott<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span><span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ground_fterm_of_hterm<span class="main">)</span>


<span class="keyword1" id="Resolution-ground_sub_of_denotts"><span class="command">lemma</span></span> ground_sub_of_denotts<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ground_sub_of_denott <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 


<span class="keyword1" id="Resolution-ground_sub_of_denotl"><span class="command">lemma</span></span> ground_sub_of_denotl<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>subs <span class="main">(</span>get_terms <span class="free">l</span><span class="main">)</span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ground_sub_of_denotts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>  <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-sub_of_denot_equivx"><span class="command">lemma</span></span> sub_of_denot_equivx<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> HFun <span class="main">(</span>sub_of_denot <span class="free">E</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>sub_of_denot <span class="free">E</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_fterm_of_hterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> HFun <span class="main">(</span>sub_of_denot <span class="free">E</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> hterm_of_fterm <span class="main">(</span>sub_of_denot <span class="free">E</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_ground<span class="hidden">⇩</span><sub>t</sub><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> hterm_of_fterm <span class="main">(</span>fterm_of_hterm <span class="main">(</span><span class="free">E</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">E</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-sub_of_denot_equivt"><span class="command">lemma</span></span> sub_of_denot_equivt<span class="main">:</span>
    <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> HFun <span class="main">(</span><span class="free">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> HFun <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sub_of_denot_equivx  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-sub_of_denot_equivts"><span class="command">lemma</span></span> sub_of_denot_equivts<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="main">(</span><span class="free">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sub_of_denot_equivt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Resolution-sub_of_denot_equivl"><span class="command">lemma</span></span> sub_of_denot_equivl<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span> <span class="main">⟷</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span><span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">G</span> <span class="skolem">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="main">(</span><span class="skolem">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">⟷</span> <span class="free">G</span> <span class="skolem">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equivts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">⟷</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span><span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span><span class="free">G</span> <span class="skolem">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="main">(</span><span class="skolem">ts</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>sub_of_denot <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">⟷</span> <span class="main">¬</span><span class="free">G</span> <span class="skolem">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> HFun <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equivts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Under an Herbrand interpretation, an environment is equivalent to a substitution.›</span></span>
<span class="keyword1" id="Resolution-sub_of_denot_equiv_ground'"><span class="command">lemma</span></span> sub_of_denot_equiv_ground'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="free">l</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span> <span class="main">∧</span> ground<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equivl ground_sub_of_denotl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Under an Herbrand interpretation, an environment is similar to a substitution - also for partial interpretations.›</span></span>
<span class="keyword1" id="Resolution-partial_equiv_subst"><span class="command">lemma</span></span> partial_equiv_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">τ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C'</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">τ</span><span class="main">)</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">τ</span><span class="main">)</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C'</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C'_p instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> C'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Under an Herbrand interpretation, an environment is equivalent to a substitution.›</span></span>
<span class="keyword1" id="Resolution-sub_of_denot_equiv_ground"><span class="command">lemma</span></span> sub_of_denot_equiv_ground<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="bound">l</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> sub_of_denot <span class="free">E</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> HFun <span class="free">G</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∧</span> ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> sub_of_denot <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equiv_ground' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resolution-std"><span class="command">lemma</span></span> std<span class="hidden">⇩</span><sub>1</sub>_falsifies<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟷</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="skolem">Cg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>1 instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inst<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="skolem">Cg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inst instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-std"><span class="command">lemma</span></span> std<span class="hidden">⇩</span><sub>2</sub>_falsifies<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟷</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>  <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="skolem">Cg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>2 instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inst<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>  <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="skolem">Cg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">Cg</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inst instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-std"><span class="command">lemma</span></span> std<span class="hidden">⇩</span><sub>1</sub>_renames<span class="main">:</span> <span class="quoted"><span class="quoted">"var_renaming_of <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"var_renaming_of <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>1</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_renaming_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-std"><span class="command">lemma</span></span> std<span class="hidden">⇩</span><sub>2</sub>_renames<span class="main">:</span> <span class="quoted"><span class="quoted">"var_renaming_of <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std_apart_instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"var_renaming_of <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>std<span class="hidden">⇩</span><sub>2</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_renaming_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantic Trees›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">closed_branch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> tree <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed_branch</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">≡</span> branch <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">open_branch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partial_pred_denot <span class="main">⇒</span> tree <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">open_branch</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">≡</span> branch <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closed_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"tree <span class="main">⇒</span> fterm clause set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed_tree</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="main">⟷</span> anybranch <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> closed_branch <span class="bound">b</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span><span class="main">)</span> 
                  <span class="main">∧</span> anyinternal <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Herbrand's Theorem›</span></span>

<span class="keyword1" id="Resolution-maximum"><span class="command">lemma</span></span> maximum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">l</span> <span class="main">≤</span> <span class="main">(</span>Max <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-extend_preserves_model"><span class="command">lemma</span></span> extend_preserves_model<span class="main">:</span> <span class="comment1">(* only for ground *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_infpath<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> partial_pred_denot<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> C_ground<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> nat_of_fatom <span class="main">(</span>get_atom <span class="bound">l</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"HFun"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
    <span class="keyword1"><span class="command">from</span></span> C_sat <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C'</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span>instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">C'</span> <span class="free">C</span> <span class="main">∨</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">C'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span><span class="free">C</span> <span class="main">∧</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="skolem">l</span><span class="main">)</span>"</span></span>
     
    <span class="keyword1"><span class="command">from</span></span> l_p <span class="keyword1"><span class="command">have</span></span> i_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> j_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_infpath infpath_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">P</span> <span class="skolem">ts</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Pos l_p C_ground <span class="keyword1"><span class="command">have</span></span> ts_ground<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> True"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> j_n Pos ts_ground empty_subts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> f_infpath i_n j_n infpath_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> ith_in_extension<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> Pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="skolem">P</span> <span class="main">(</span>hterms_of_fterms <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_of_fatom_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>l</sub>_ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts</span></span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> ts_ground Pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">P</span> <span class="skolem">ts</span><span class="main">)</span> <span class="comment1">(* Symmetric *)</span>
        <span class="keyword1"><span class="command">from</span></span> Neg l_p C_ground <span class="keyword1"><span class="command">have</span></span> ts_ground<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> False"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> j_n Neg ts_ground empty_subts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> f_infpath i_n j_n infpath_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> ith_in_extension<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?G</span> <span class="skolem">P</span> <span class="main">(</span>hterms_of_fterms <span class="skolem">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_of_fatom_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Neg eval<span class="hidden">⇩</span><sub>l</sub>_ground<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ts</span></span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> ts_ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-extend_preserves_model2"><span class="command">lemma</span></span> extend_preserves_model2<span class="main">:</span> <span class="comment1">(* only for ground *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_infpath<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> partial_pred_denot<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> C_ground<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_c<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> model_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> C_false<span class="main">:</span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹Since C is finite, C has a largest index of a literal.›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> largest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> nat_of_fatom <span class="main">(</span>get_atom <span class="bound">l</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_c maximum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l</span><span class="main">.</span> nat_of_fatom <span class="main">(</span>get_atom <span class="bound">l</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> model_C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> model_C f_infpath C_ground extend_preserves_model<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-extend_infpath"><span class="command">lemma</span></span> extend_infpath<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> f_infpath<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> partial_pred_denot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> model_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_c<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sub_of_denot <span class="skolem">E</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> fin_c <span class="keyword1"><span class="command">have</span></span> fin_cσ<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> sub_of_denot <span class="skolem">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> groundcσ<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> sub_of_denot <span class="skolem">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equiv_ground <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹Here starts the proof›</span>
  <span class="comment1">― ‹We go from syntactic FO world to syntactic ground world:›</span>
  <span class="keyword1"><span class="command">from</span></span> model_c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> partial_equiv_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹Then from syntactic ground world to semantic ground world:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> HFun <span class="var">?G</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> groundcσ f_infpath fin_cσ extend_preserves_model2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?σ</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹Then from semantic ground world to semantic FO world:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?σ</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> HFun <span class="var">?G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?σ</span><span class="main">)</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> HFun <span class="var">?G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> HFun <span class="var">?G</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub_of_denot_equiv_ground<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="skolem">E</span></span> <span class="quoted"><span class="quoted">"extend <span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If we have a infpath of partial models, then we have a model.›</span></span>
<span class="keyword1" id="Resolution-infpath_model"><span class="command">lemma</span></span> infpath_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_infpath<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_infpath <span class="main">(</span><span class="free">f</span> <span class="main">::</span> nat <span class="main">⇒</span> partial_pred_denot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> model_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">Cs</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"HFun"</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">Cs</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="var">?F</span> <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="bound">C</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Cs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> model_cs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="var">?F</span> <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_c asm f_infpath extend_infpath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>                                                                      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="var">?F</span> <span class="main">(</span>extend <span class="free">f</span><span class="main">)</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deeptree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> tree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deeptree</span> <span class="main">0</span> <span class="main">=</span> Leaf"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">deeptree</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Branching <span class="main">(</span><span class="free">deeptree</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">deeptree</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resolution-branch_length"><span class="command">lemma</span></span> branch_length<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"branch <span class="free">b</span> <span class="main">(</span>deeptree <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">b</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="main">(</span>Branching <span class="main">(</span>deeptree <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>deeptree <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">b'</span><span class="main">∧</span> branch <span class="skolem">b'</span> <span class="main">(</span>deeptree <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Branching<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-infinity"><span class="command">lemma</span></span> infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="free">undiago</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> all_tree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">tree</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">tree</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> inj all_tree <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">undiago</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">tree</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ds</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">undiago</span> <span class="bound">ds</span> <span class="main">∧</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="free">tree</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">undiago</span> <span class="main">`</span> <span class="free">tree</span> <span class="main">=</span> <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="free">tree</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageI infinite_UNIV_nat<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-longer_falsifies"><span class="command">lemma</span></span> longer_falsifies<span class="hidden">⇩</span><sub>l</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">ds</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> i_p<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span> <span class="main">∧</span>  <span class="var">?i</span> <span class="main">&lt;</span> length <span class="free">ds</span> <span class="main">∧</span> <span class="free">ds</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> i_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> i_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-longer_falsifies"><span class="command">lemma</span></span> longer_falsifies<span class="hidden">⇩</span><sub>g</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">ds</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span><span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms longer_falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-longer_falsifies"><span class="command">lemma</span></span> longer_falsifies<span class="hidden">⇩</span><sub>c</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">ds</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C'</span> <span class="free">C</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">ds</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> longer_falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use this so that we can apply König's lemma.›</span></span>
<span class="keyword1" id="Resolution-longer_falsifies"><span class="command">lemma</span></span> longer_falsifies<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">ds</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">Cs</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="free">ds</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span><span class="free">ds</span> <span class="main">@</span> <span class="free">d</span><span class="main">)</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> longer_falsifies<span class="hidden">⇩</span><sub>c</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="free">ds</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If all finite semantic trees have an open branch, then the set of clauses has a model.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> herbrand'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> openb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">T</span><span class="main">.</span> <span class="main">∃</span><span class="bound">G</span><span class="main">.</span> open_branch <span class="bound">G</span> <span class="bound">T</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹Show T infinite:›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tree</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">G</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">G</span> <span class="free">Cs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?undiag</span></span></span> <span class="main">=</span> <span class="quoted">length</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diag</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> open_branch <span class="bound">b</span> <span class="main">(</span>deeptree <span class="bound">l</span><span class="main">)</span> <span class="free">Cs</span><span class="main">)</span> <span class="main">::</span> nat <span class="main">⇒</span> partial_pred_denot"</span></span>

  <span class="keyword1"><span class="command">from</span></span> openb <span class="keyword1"><span class="command">have</span></span> diag_open<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> open_branch <span class="main">(</span><span class="var">?diag</span> <span class="bound">l</span><span class="main">)</span> <span class="main">(</span>deeptree <span class="bound">l</span><span class="main">)</span> <span class="free">Cs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> open_branch <span class="bound">b</span> <span class="main">(</span>deeptree <span class="main">_</span><span class="main">)</span> <span class="free">Cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?undiag</span> <span class="main">(</span><span class="var">?diag</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="var">?diag</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?tree</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diag_open <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="var">?tree</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinity<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">b</span><span class="main">.</span> open_branch <span class="bound">b</span> <span class="main">(</span><span class="main">_</span> <span class="bound">n</span><span class="main">)</span> <span class="free">Cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">― ‹Get infinite path:›</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ds</span> <span class="bound">d</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="bound">ds</span> <span class="main">@</span> <span class="bound">d</span><span class="main">)</span> <span class="free">Cs</span> <span class="main">⟶</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">ds</span> <span class="free">Cs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> longer_falsifies<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Cs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ds</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">ds</span> <span class="main">@</span> <span class="bound">d</span> <span class="main">∈</span> <span class="var">?tree</span> <span class="main">⟶</span> <span class="bound">ds</span> <span class="main">∈</span> <span class="var">?tree</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> wf_infpath <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">c</span> <span class="bound">n</span> <span class="main">∈</span> <span class="var">?tree</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> konig<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?tree</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> wf_infpath <span class="bound">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="bound">G</span> <span class="bound">n</span><span class="main">)</span> <span class="free">Cs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹Apply above infpath lemma:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infpath_model finite_cs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Resolution-shorter_falsifies"><span class="command">lemma</span></span> shorter_falsifies<span class="hidden">⇩</span><sub>l</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">ds</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">ds</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> i_p<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span> <span class="main">∧</span>  <span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ds</span><span class="main">@</span><span class="free">d</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="free">ds</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ds</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_p nth_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ds</span></span> <span class="quoted"><span class="free">d</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> herbrand'_contra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> branch <span class="bound">G</span> <span class="bound">T</span> <span class="main">⟶</span> closed_branch <span class="bound">G</span> <span class="bound">T</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_cs unsat <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">T</span><span class="main">.</span> <span class="main">∃</span><span class="bound">G</span><span class="main">.</span> open_branch <span class="bound">G</span> <span class="bound">T</span> <span class="free">Cs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">G</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> herbrand' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unsat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> herbrand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> closed_tree <span class="bound">T</span> <span class="free">Cs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> unsat finite_cs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> closed_branch <span class="bound">b</span> <span class="skolem">T</span> <span class="free">Cs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> herbrand'_contra<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Cs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> anybranch <span class="bound">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">p</span> <span class="free">Cs</span><span class="main">)</span> <span class="main">∧</span> anyinternal <span class="bound">T</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">p</span> <span class="free">Cs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cutoff_branch_internal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">p</span> <span class="free">Cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Completeness">
<div class="head">
<h1>Theory Completeness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lifting Lemma›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Completeness <span class="keyword2"><span class="keyword">imports</span></span> <a href="Resolution.html">Resolution</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> unification <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unification<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">σ</span> <span class="bound">L</span><span class="main">.</span> finite <span class="bound">L</span> <span class="main">⟹</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">σ</span> <span class="bound">L</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">θ</span><span class="main">.</span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">θ</span> <span class="bound">L</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A proof of this assumption is available in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹Unification_Theorem.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> and used in
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹Completeness_Instance.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Completeness-lifting"><span class="command">lemma</span></span> lifting<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> finite <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> apart<span class="main">:</span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inst<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> appl<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">τ</span><span class="main">.</span> applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">τ</span> <span class="main">∧</span>
                instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">τ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹Obtaining the subsets we resolve upon:›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R<span class="hidden">⇩</span><sub>1</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?R<span class="hidden">⇩</span><sub>2</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> inst <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="skolem"><span class="skolem">μ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">γ</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">μ</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="keyword2"><span class="keyword">where</span></span> η_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apart merge_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> η_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="hidden">⇩</span><sub>1</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="var">?R<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> appl project_sub <span class="keyword1"><span class="command">using</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> η_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="hidden">⇩</span><sub>2</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span> <span class="main">=</span> <span class="var">?R<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> appl project_sub <span class="keyword1"><span class="command">using</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>

  <span class="comment1">― ‹Obtaining substitutions:›</span>
  <span class="keyword1"><span class="command">from</span></span> appl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∪</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L<span class="hidden">⇩</span><sub>1</sub>_p L<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">∪</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> compls_subls subls_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">∪</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ησuni<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="skolem">η</span> <span class="main">⋅</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">∪</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def composition_conseq2l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">τ</span></span> <span class="keyword2"><span class="keyword">where</span></span> τ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">τ</span> <span class="main">(</span><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">∪</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>C</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unification fin L<span class="hidden">⇩</span><sub>1</sub>_p L<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_UnI finite_imageI rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> <span class="main">⋅</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">η</span> <span class="main">⋅</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ησuni mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹Showing that we have the desired resolvent:›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">τ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">φ</span>  <span class="main">=</span> <span class="main">(</span><span class="var">?R<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="var">?R<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">τ</span> <span class="main">⋅</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subls_union composition_conseq2ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?R<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="var">?R<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">η</span> <span class="main">⋅</span> <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> φ_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?R<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?R<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">η</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subls_union composition_conseq2ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?R<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∪</span> <span class="var">?R<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> η_p L<span class="hidden">⇩</span><sub>1</sub>_p L<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> resolution_def instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="comment1">― ‹Showing that the resolution rule is applicable:›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> appl applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> η_p L<span class="hidden">⇩</span><sub>1</sub>_p L<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> appli<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apart L<span class="hidden">⇩</span><sub>1</sub>_p L<span class="hidden">⇩</span><sub>2</sub>_p τ_p applicable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ins appli <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1" id="Completeness-falsifies"><span class="command">lemma</span></span> falsifies<span class="hidden">⇩</span><sub>g</sub>_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">[]</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">C</span><span class="main">.</span> False"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span><span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">[]</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Completeness-falsifies"><span class="command">lemma</span></span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="main">[]</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C'</span> <span class="free">C</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">[]</span> <span class="skolem">C'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span><span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> falsifies<span class="hidden">⇩</span><sub>g</sub>_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C'_p <span class="keyword1"><span class="command">unfolding</span></span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Completeness-complements_do_not_falsify'"><span class="command">lemma</span></span> complements_do_not_falsify'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l1C1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>2</sub>C1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> falsif<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">ts</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Neg <span class="skolem">p</span> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp Pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> falsif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l1C1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> l1C1' Pos <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"Pos <span class="skolem">p</span> <span class="skolem">ts</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> falsif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>2</sub>C1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i2</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pos Neg comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> Neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">ts</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Pos <span class="skolem">p</span> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp Neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> falsif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l1C1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> l1C1' Neg <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_atom.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> literal.disc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> falsif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">G</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>2</sub>C1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i2</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pos Neg comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">!</span> <span class="var">?i1</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> Pos <span class="keyword1"><span class="command">using</span></span> literal.disc<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Completeness-complements_do_not_falsify"><span class="command">lemma</span></span> complements_do_not_falsify<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l1C1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="hidden">⇩</span><sub>2</sub>C1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fals<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="free">G</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms complements_do_not_falsify' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Completeness-other_falsified"><span class="command">lemma</span></span> other_falsified<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C1'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> l_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">l</span><span class="main">)</span> <span class="main">=</span> length <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lo</span> <span class="main">∈</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lo</span> <span class="main">≠</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">B</span> <span class="free">lo</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">lo</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ground_l<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_p C1'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹They are, of course, also ground:›</span>
  <span class="keyword1"><span class="command">have</span></span> ground_lo<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="free">lo</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C1'_p other <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> C1'_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="main">(</span><span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="main">{</span><span class="free">l</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹And indeed, falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> loB<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span> <span class="free">lo</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> other <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">B</span> <span class="main">@</span> <span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="comment1">― ‹And they have numbers in the range of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>, i.e. less than <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"length <span class="free">B</span> <span class="main">+</span> <span class="main">1</span>"</span><span class="antiquote">}</span></span>:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">lo</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">B</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> undiag_diag_fatom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">lo</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> l_lo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">≠</span><span class="free">lo</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> other <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹The are not the complement of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">l</span></span> <span class="antiquote">}</span></span>, since then the clause could not be falsified:›</span>
  <span class="keyword1"><span class="command">have</span></span> lc_lo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lo</span> <span class="main">≠</span> <span class="free">l</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C1'_p l_p other complements_do_not_falsify<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">lo</span></span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> l_lo lc_lo <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_atom <span class="free">l</span> <span class="main">≠</span> get_atom <span class="free">lo</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sign_comp_atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">lo</span><span class="main">)</span> <span class="main">≠</span> nat_of_fatom <span class="main">(</span>get_atom <span class="free">l</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_of_fatom_bij ground_lo ground_l<span class="hidden">⇩</span><sub>2</sub> ground<span class="hidden">⇩</span><sub>l</sub>_ground_fatom 
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="comment1">― ‹Therefore they have different numbers:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">lo</span><span class="main">)</span> <span class="main">≠</span> length <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> 
  <span class="comment1">― ‹So their numbers are in the range of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span>:›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="free">lo</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹So we did not need the last index of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">B</span><span class="main">@</span><span class="main">[</span><span class="free">d</span><span class="main">]</span>"</span><span class="antiquote">}</span></span> to falsify them, i.e. <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> suffices:›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="free">B</span> <span class="free">lo</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loB<span class="hidden">⇩</span><sub>2</sub> shorter_falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> completeness'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed_tree <span class="free">T</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Cs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> measure_induct_rule<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">treesize</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="main">::</span> <span class="quoted">tree</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Cs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm clause set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">T'</span> <span class="bound">Cs</span><span class="main">.</span> treesize <span class="bound">T'</span> <span class="main">&lt;</span> treesize <span class="skolem">T</span> <span class="main">⟹</span> closed_tree <span class="bound">T'</span> <span class="bound">Cs</span> <span class="main">⟹</span> 
                            <span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="bound">Cs</span><span class="main">.</span> finite <span class="bound">C</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="bound">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> clo<span class="main">:</span> <span class="quoted"><span class="quoted">"closed_tree <span class="skolem">T</span> <span class="skolem">Cs</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> finite_Cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="skolem">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="comment1">― ‹Base case:›</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"treesize <span class="skolem">T</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span>Leaf"</span></span> <span class="keyword1"><span class="command">using</span></span> treesize_Leaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed_branch <span class="main">[]</span> Leaf <span class="skolem">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_inv_Leaf clo <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">[]</span> <span class="skolem">Cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="skolem">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="skolem">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="comment1">― ‹Induction case:›</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"treesize <span class="skolem">T</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">T</span><span class="main">=</span>Branching <span class="bound">l</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">)</span> <span class="operator">auto</span>
    
    <span class="comment1">― ‹Finding sibling branches and their corresponding clauses:›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_p<span class="main">:</span> <span class="quoted"><span class="quoted">"internal <span class="skolem">B</span> <span class="skolem">T</span> <span class="main">∧</span> branch <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="skolem">T</span> <span class="main">∧</span> branch <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> internal_branch<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">T</span></span><span class="main">]</span> Branching_Leaf_Leaf_Tree <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">@</span><span class="main">[</span>True<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">@</span><span class="main">[</span>False<span class="main">]</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>o</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="hidden">⇩</span><sub>1</sub>o_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>o</span> <span class="main">∈</span> <span class="skolem">Cs</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>o</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p clo <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="hidden">⇩</span><sub>2</sub>o_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span> <span class="main">∈</span> <span class="skolem">Cs</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_p clo <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="comment1">― ‹Standardizing the clauses apart:›</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"std<span class="hidden">⇩</span><sub>1</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>o</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"std<span class="hidden">⇩</span><sub>2</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="hidden">⇩</span><sub>1</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span> <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>1</sub>_falsifies C<span class="hidden">⇩</span><sub>1</sub>o_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="hidden">⇩</span><sub>2</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>2</sub>_falsifies C<span class="hidden">⇩</span><sub>2</sub>o_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> finite <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>1</sub>o_p C<span class="hidden">⇩</span><sub>2</sub>o_p finite_Cs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹We go down to the ground world.›</span>
    <span class="comment1">― ‹Finding the falsifying ground instance <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span>, and proving properties about it:›</span>
    
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> is falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>1</sub>_p  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="hidden">⇩</span><sub>1</sub>'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="skolem">B</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>o</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>1</sub>o_p b_p clo <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="skolem">B</span> <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>1</sub>_falsifies <span class="keyword1"><span class="command">using</span></span> prod.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> is not falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>1</sub>'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> contains a literal <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> that is falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span>, but not <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>1</sub>'_p l_B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">B</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> is of course ground:›</span>
    <span class="keyword1"><span class="command">have</span></span> ground_l<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>1</sub>'_p l<span class="hidden">⇩</span><sub>1</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?i</span> <span class="main">&lt;</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_l<span class="hidden">⇩</span><sub>1</sub> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?i</span> <span class="main">&lt;</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_append<span class="main">)</span> <span class="comment1">― ‹Not falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>1</sub>_sign_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">=</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>True<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> is negative:›</span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_sign_no <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>1</sub>_sign<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_sign_no <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>1</sub>_no<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹All the other literals in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> must be falsified by B, since they are falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span>, but not <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>1</sub>'_p l<span class="hidden">⇩</span><sub>1</sub>_no l<span class="hidden">⇩</span><sub>1</sub>_p <span class="keyword1"><span class="command">have</span></span> B_C<span class="hidden">⇩</span><sub>1</sub>'l<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="comment1">(* This should be a lemma *)</span>
      <span class="keyword1"><span class="command">using</span></span> other_falsified <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">― ‹We do the same exercise for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">C<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="antiquote">}</span></span>, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="hidden">⇩</span><sub>2</sub>'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">∧</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="skolem">B</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>2</sub>o_p b_p clo <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="skolem">B</span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>2</sub>_falsifies <span class="keyword1"><span class="command">using</span></span> prod.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>2</sub>'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(* I already had something called l_B... I could give it a new name *)</span>
    
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="antiquote">}</span></span> contains a literal <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span> that is falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>, but not B:›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>2</sub>'_p l_B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">∧</span> falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">B</span> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> ground_l<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"ground<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="hidden">⇩</span><sub>2</sub>'_p l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?i</span> <span class="main">&lt;</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ground_l<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?i</span> <span class="main">&lt;</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span><span class="main">@</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_append<span class="main">)</span> <span class="comment1">― ‹Not falsified by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> falsifies<span class="hidden">⇩</span><sub>l</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>2</sub>_sign_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">=</span> length <span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">@</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>sign <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span> is negative:›</span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_sign_no <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>2</sub>_sign<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>2</sub>_sign_no <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>2</sub>_no<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_fatom <span class="main">(</span>get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹All the other literals in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="antiquote">}</span></span> must be falsified by B, since they are falsified by 
          <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>, but not <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">from</span></span> C<span class="hidden">⇩</span><sub>2</sub>'_p l<span class="hidden">⇩</span><sub>2</sub>_no l<span class="hidden">⇩</span><sub>2</sub>_p <span class="keyword1"><span class="command">have</span></span> B_C<span class="hidden">⇩</span><sub>2</sub>'l<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> other_falsified <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">― ‹Proving some properties about <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="antiquote">}</span></span>, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>, as well as 
          the resolvent of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="hidden">⇩</span><sub>2</sub>cisl<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="comment1">(* Could perhaps be a lemma *)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> l<span class="hidden">⇩</span><sub>1</sub>_no l<span class="hidden">⇩</span><sub>2</sub>_no ground_l<span class="hidden">⇩</span><sub>1</sub> ground_l<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> get_atom <span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> nat_of_fatom_bij ground<span class="hidden">⇩</span><sub>l</sub>_ground_fatom 
              <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>1</sub>_sign l<span class="hidden">⇩</span><sub>2</sub>_sign <span class="keyword1"><span class="command">using</span></span> sign_comp_atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"applicable <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> Resolution.ε"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> applicable_def
      <span class="keyword1"><span class="command">using</span></span> l<span class="hidden">⇩</span><sub>1</sub>_p l<span class="hidden">⇩</span><sub>2</sub>_p C<span class="hidden">⇩</span><sub>1</sub>'_p ground<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> l<span class="hidden">⇩</span><sub>2</sub>cisl<span class="hidden">⇩</span><sub>1</sub> empty_comp2 <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">― ‹Lifting to get a resolvent of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">τ</span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="hidden">⇩</span><sub>1</sub>L<span class="hidden">⇩</span><sub>2</sub>τ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span>  <span class="main">∧</span> instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>resolution <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> Resolution.ε<span class="main">)</span> <span class="main">(</span>resolution <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> std_apart_apart C<span class="hidden">⇩</span><sub>1</sub>'_p C<span class="hidden">⇩</span><sub>2</sub>'_p lifting<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span> <span class="quoted">Resolution.ε</span><span class="main">]</span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


    <span class="comment1">― ‹Defining the clause to be derived, the new clausal form and the new tree:›</span>
    <span class="comment1">― ‹We name the resolvent <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">C</span></span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> resolution <span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">τ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CsNext</span></span> <span class="keyword2"><span class="keyword">where</span></span> CsNext_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CsNext</span> <span class="main">=</span> <span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">C</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T''</span></span> <span class="keyword2"><span class="keyword">where</span></span> T''_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T''</span> <span class="main">=</span> delete <span class="skolem">B</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="comment1">― ‹Here we delete the two branch children <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?B<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span> of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span>.›</span>
    
    <span class="comment1">― ‹Our new clause is falsified by the branch <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">B</span></span><span class="antiquote">}</span></span> of our new tree:›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="main">(</span><span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_C<span class="hidden">⇩</span><sub>1</sub>'l<span class="hidden">⇩</span><sub>1</sub> B_C<span class="hidden">⇩</span><sub>2</sub>'l<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>g</sub> <span class="skolem">B</span> <span class="main">(</span>resolution <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">{</span><span class="skolem">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> Resolution.ε<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> resolution_def empty_subls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> falsifies_C<span class="main">:</span> <span class="quoted"><span class="quoted">"falsifies<span class="hidden">⇩</span><sub>c</sub> <span class="skolem">B</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_p L<span class="hidden">⇩</span><sub>1</sub>L<span class="hidden">⇩</span><sub>2</sub>τ_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> T''_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"treesize <span class="skolem">T''</span> <span class="main">&lt;</span> treesize <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> treezise_delete T''_p b_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> T''_bran<span class="main">:</span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T''</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> closed_branch <span class="bound">b</span> <span class="skolem">T''</span> <span class="skolem">CsNext</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> br<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="skolem">T''</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> br <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">∨</span> branch <span class="skolem">b</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> branch_delete T''_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_branch <span class="skolem">b</span> <span class="skolem">T''</span> <span class="skolem">CsNext</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">B</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_branch <span class="skolem">b</span> <span class="skolem">T''</span> <span class="skolem">CsNext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> falsifies_C br CsNext_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"branch <span class="skolem">b</span> <span class="skolem">T</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_branch <span class="skolem">b</span> <span class="skolem">T''</span> <span class="skolem">CsNext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> clo br T''_p CsNext_p <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> T''_bran2<span class="main">:</span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T''</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">b</span> <span class="skolem">CsNext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="comment1">(* replace T''_bran with this maybe? *)</span>

    <span class="comment1">― ‹We cut the tree even smaller to ensure only the branches are falsified, i.e. it is a closed tree:›</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> T'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> cutoff <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">G</span> <span class="skolem">CsNext</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">T''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> T'_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"treesize <span class="skolem">T'</span> <span class="main">&lt;</span> treesize <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> treesize_cutoff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">G</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">G</span> <span class="skolem">CsNext</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">T''</span></span><span class="main">]</span> T''_smaller <span class="keyword1"><span class="command">unfolding</span></span> T'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> T''_bran2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">b</span> <span class="skolem">CsNext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cutoff_branch<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T''</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">b</span> <span class="skolem">CsNext</span>"</span></span><span class="main">]</span> T'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> T'_bran<span class="main">:</span> <span class="quoted"><span class="quoted">"anybranch <span class="skolem">T'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> closed_branch <span class="bound">b</span> <span class="skolem">T'</span> <span class="skolem">CsNext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> T'_intr<span class="main">:</span> <span class="quoted"><span class="quoted">"anyinternal <span class="skolem">T'</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span>falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">p</span> <span class="skolem">CsNext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T'_p cutoff_internal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T''</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> falsifies<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">b</span> <span class="skolem">CsNext</span>"</span></span><span class="main">]</span> T''_bran2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> T'_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"closed_tree <span class="skolem">T'</span> <span class="skolem">CsNext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T'_bran T'_intr <span class="keyword1"><span class="command">unfolding</span></span> closed_tree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> finite_CsNext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="skolem">CsNext</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> CsNext_p C_p resolution_def <span class="keyword1"><span class="command">using</span></span> finite_Cs fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="comment1">― ‹By induction hypothesis we get a resolution derivation of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{}</span>"</span><span class="antiquote">}</span></span> from our new clausal form:›</span>
    <span class="keyword1"><span class="command">from</span></span> T'_smaller T'_closed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs''</span><span class="main">.</span> resolution_deriv <span class="skolem">CsNext</span> <span class="bound">Cs''</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ih<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T'</span></span> <span class="quoted"><span class="skolem">CsNext</span></span><span class="main">]</span> finite_CsNext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cs''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cs''_p<span class="main">:</span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="skolem">CsNext</span> <span class="skolem">Cs''</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="skolem">Cs''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="comment1">― ‹Proving that we can actually derive the new clausal form:›</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="skolem">Cs</span> <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>1</sub>_renames standardize_apart C<span class="hidden">⇩</span><sub>1</sub>o_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_right<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> std<span class="hidden">⇩</span><sub>2</sub>_renames<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span></span><span class="main">]</span> standardize_apart<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub>o</span></span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span> C<span class="hidden">⇩</span><sub>2</sub>o_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">C</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> L<span class="hidden">⇩</span><sub>1</sub>L<span class="hidden">⇩</span><sub>2</sub>τ_p resolution_rule<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="quoted"><span class="skolem">L<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="skolem">L<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="skolem">τ</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> C_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="main">(</span><span class="skolem">Cs</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="var">?C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span> <span class="skolem">CsNext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CsNext_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Un_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="skolem">Cs</span> <span class="skolem">CsNext</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="comment1">― ‹Combining the two derivations, we get the desired derivation from <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Cs</span></span><span class="antiquote">}</span></span> of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{}</span>"</span><span class="antiquote">}</span></span>:›</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="skolem">Cs</span> <span class="skolem">Cs''</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="skolem">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cs''_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="skolem">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span>hterm fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span>hterm pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> unsat <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">G</span><span class="main">::</span>hterm pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> HFun <span class="bound">G</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"closed_tree <span class="skolem">T</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> herbrand assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> completeness' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">E_conv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> var_denot <span class="main">⇒</span> <span class="tfree">'b</span> var_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">E_conv</span> <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F_conv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fun_denot <span class="main">⇒</span> <span class="tfree">'b</span> fun_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">F_conv</span> <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="bound">bs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">f</span> <span class="main">(</span>map <span class="main">(</span>inv <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span><span class="main">)</span> <span class="bound">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">G_conv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> pred_denot <span class="main">⇒</span> <span class="tfree">'b</span> pred_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G_conv</span> <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span> <span class="bound">bs</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">p</span> <span class="main">(</span>map <span class="main">(</span>inv <span class="free"><span class="bound"><span class="entity">b_of_a</span></span></span><span class="main">)</span> <span class="bound">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Completeness-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>t</sub>_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">b_of_a</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="free">b_of_a</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Fun <span class="skolem">f</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>inv <span class="free">b_of_a</span> <span class="main">∘</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ts</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="skolem">ts</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> E_conv_def F_conv_def
    <span class="keyword1"><span class="command">using</span></span> assms bij_is_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b_of_a</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span>inv <span class="free">b_of_a</span> <span class="main">∘</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b_of_a</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">f</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> E_conv_def F_conv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> E_conv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Completeness-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">b_of_a</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"G_conv <span class="free">b_of_a</span> <span class="free">G</span> <span class="free">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span> <span class="free">p</span> <span class="main">(</span>eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">ts</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>t</sub>_bij
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>inv <span class="free">b_of_a</span> <span class="main">∘</span> eval<span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ts</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>t</sub>_bij assms bij_is_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> G_conv_def map_map<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
   
  
<span class="keyword1" id="Completeness-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>l</sub>_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">b_of_a</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="free">E</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>G_conv <span class="free">b_of_a</span> <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="free">E</span> <span class="free">F</span> <span class="free">G</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_bij 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pos <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_bij assms<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_bij assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 
            
<span class="keyword1" id="Completeness-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>c</sub>_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">b_of_a</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>G_conv <span class="free">b_of_a</span> <span class="free">G</span><span class="main">)</span> <span class="free">C</span> <span class="main">=</span> eval<span class="hidden">⇩</span><sub>c</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"char list <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> bij_b_of_a<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">b_of_a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> C_sat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">::</span> char list <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="bound">E</span> <span class="free">F</span> <span class="free">G</span> <span class="bound">l</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> E_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> E_conv <span class="free">b_of_a</span> <span class="main">(</span>E_conv <span class="main">(</span>inv <span class="free">b_of_a</span><span class="main">)</span> <span class="skolem">E</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> E_conv_def <span class="keyword1"><span class="command">using</span></span> bij_b_of_a
      <span class="keyword1"><span class="command">using</span></span> bij_betw_inv_into_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="main">(</span>E_conv <span class="free">b_of_a</span> <span class="main">(</span>E_conv <span class="main">(</span>inv <span class="free">b_of_a</span><span class="main">)</span> <span class="skolem">E</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>G_conv <span class="free">b_of_a</span> <span class="free">G</span><span class="main">)</span> <span class="bound">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>l</sub>_bij bij_b_of_a C_sat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> eval<span class="hidden">⇩</span><sub>l</sub> <span class="skolem">E</span> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>G_conv <span class="free">b_of_a</span> <span class="free">G</span><span class="main">)</span> <span class="bound">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> E_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eval<span class="hidden">⇩</span><sub>l</sub>_bij assms eval<span class="hidden">⇩</span><sub>c</sub>_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Completeness-eval"><span class="command">lemma</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="free">b_of_a</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>F_conv <span class="free">b_of_a</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>G_conv <span class="free">b_of_a</span> <span class="free">G</span><span class="main">)</span> <span class="free">Cs</span> <span class="main">⟷</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="free">Cs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eval<span class="hidden">⇩</span><sub>c</sub>_bij assms eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_def<span class="main">)</span>
    
<span class="keyword1" id="Completeness-countably_inf_bij"><span class="command">lemma</span></span> countably_inf_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_a_uni<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>countable<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_b_uni<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span>countable<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b_of_a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">.</span> bij <span class="bound">b_of_a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>countable<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_a_uni <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat_of_a</span></span> <span class="keyword2"><span class="keyword">where</span></span> QWER<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="skolem">nat_of_a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countableE_infinite<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>countable<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"countable <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_b_uni <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nat_of_b</span></span> <span class="keyword2"><span class="keyword">where</span></span> TYUI<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="skolem">nat_of_b</span> <span class="main">::</span> <span class="tfree">'b</span> <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> countableE_infinite<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b_of_a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>inv <span class="skolem">nat_of_b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nat_of_a</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> bij_nat_of_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">nat_of_b</span> <span class="main">(</span>inv <span class="skolem">nat_of_b</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TYUI bij_betw_inv_into_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> inv <span class="skolem">nat_of_a</span> <span class="main">(</span><span class="skolem">nat_of_a</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> QWER UNIV_I bij_betw_inv_into_left<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> inv <span class="skolem">nat_of_b</span> <span class="main">(</span><span class="skolem">nat_of_a</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_nat_of_b injI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> inv <span class="skolem">nat_of_b</span> <span class="main">(</span><span class="skolem">nat_of_a</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> QWER TYUI bij_def image_image inj_imp_surj_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij <span class="var">?b_of_a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Completeness-infinite_hterms"><span class="command">lemma</span></span> infinite_hterms<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> hterm set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diago</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> HFun <span class="main">(</span>string_of_nat <span class="bound">n</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?undiago</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> nat_of_string <span class="main">(</span><span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> HFun <span class="bound">f</span> <span class="bound">ts</span> <span class="main">⇒</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?undiago</span> <span class="main">(</span><span class="var">?diago</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_of_string_string_of_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?diago</span> <span class="bound">n</span> <span class="main">∈</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> hterm set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinity<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?undiago</span></span></span> <span class="var"><span class="quoted"><span class="var">?diago</span></span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> completeness_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_uni<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'u</span> <span class="main">::</span> countable<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span><span class="tfree">'u</span> fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="tfree">'u</span> pred_denot<span class="main">)</span><span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span>hterm fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span>hterm pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm fun_denot"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm pred_denot"</span></span>
      
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u_of_hterm</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hterm <span class="main">⇒</span> <span class="tfree">'u</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_u_of_hterm<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">u_of_hterm</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> countably_inf_bij inf_uni infinite_hterms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"F_conv <span class="skolem">u_of_hterm</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"G_conv <span class="skolem">u_of_hterm</span> <span class="skolem">G</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="var">?F</span> <span class="var">?G</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unsat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">F</span> <span class="skolem">G</span> <span class="free">Cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub>_bij <span class="keyword1"><span class="command">using</span></span> p_u_of_hterm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_cs completeness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">theorem</span></span> completeness_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span>nat fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span>nat pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms completeness_countable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹unification locale›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples">
<div class="head">
<h1>Theory Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Examples <span class="keyword2"><span class="keyword">imports</span></span> <a href="Resolution.html">Resolution</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Var <span class="inner_quoted">''x''</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Fun <span class="inner_quoted">''one''</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Fun <span class="inner_quoted">''mul''</span> <span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Fun <span class="inner_quoted">''add''</span> <span class="main">[</span>Fun <span class="inner_quoted">''mul''</span> <span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">,</span> Fun <span class="inner_quoted">''one''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Pos <span class="inner_quoted">''greater''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Neg <span class="inner_quoted">''less''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Pos <span class="inner_quoted">''less''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Pos <span class="inner_quoted">''equals''</span>
        <span class="main">[</span>Fun <span class="inner_quoted">''add''</span><span class="main">[</span>Fun <span class="inner_quoted">''mul''</span><span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">,</span> Fun <span class="inner_quoted">''one''</span><span class="main">[]</span><span class="main">]</span><span class="main">,</span>Var <span class="inner_quoted">''x''</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat fun_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="inner_quoted">''add''</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> 
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="inner_quoted">''mul''</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="inner_quoted">''one''</span>  <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="inner_quoted">''zero''</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat pred_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="inner_quoted">''less''</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> True <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="inner_quoted">''greater''</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> True <span class="keyword1">else</span> 
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="inner_quoted">''equals''</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> True <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">us</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat var_denot"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="inner_quoted">''x''</span> <span class="keyword1">then</span> <span class="numeral">26</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="inner_quoted">''y''</span> <span class="keyword1">then</span> <span class="numeral">5</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Var <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">26</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Fun <span class="inner_quoted">''one''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Fun <span class="inner_quoted">''mul''</span> <span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">25</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>t</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Fun <span class="inner_quoted">''add''</span> <span class="main">[</span>Fun <span class="inner_quoted">''mul''</span> <span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">,</span> Fun <span class="inner_quoted">''one''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">26</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Pos <span class="inner_quoted">''greater''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Neg <span class="inner_quoted">''less''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> <span class="main">(</span>Pos <span class="inner_quoted">''less''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">,</span> Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> False"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"eval<span class="hidden">⇩</span><sub>l</sub> E<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> F<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> G<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub> 
       <span class="main">(</span>Pos <span class="inner_quoted">''equals''</span> 
         <span class="main">[</span>Fun <span class="inner_quoted">''add''</span> <span class="main">[</span>Fun <span class="inner_quoted">''mul''</span> <span class="main">[</span>Var <span class="inner_quoted">''y''</span><span class="main">,</span>Var <span class="inner_quoted">''y''</span><span class="main">]</span><span class="main">,</span>Fun <span class="inner_quoted">''one''</span> <span class="main">[]</span><span class="main">]</span>
         <span class="main">,</span>Var <span class="inner_quoted">''x''</span><span class="main">]</span>
       <span class="main">)</span> <span class="main">=</span> True"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PP</span> <span class="main">=</span> Pos <span class="inner_quoted">''P''</span> <span class="main">[</span>Fun <span class="inner_quoted">''c''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PQ</span> <span class="main">=</span> Pos <span class="inner_quoted">''Q''</span> <span class="main">[</span>Fun <span class="inner_quoted">''d''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NP</span> <span class="main">=</span> Neg <span class="inner_quoted">''P''</span> <span class="main">[</span>Fun <span class="inner_quoted">''c''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NQ</span> <span class="main">=</span> Neg <span class="inner_quoted">''Q''</span> <span class="main">[</span>Fun <span class="inner_quoted">''d''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> empty_mgu<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> ε <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> ε <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> empty_comp1 empty_comp2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> unifier_single<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">{</span><span class="free">l</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> resolution_rule'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">{</span>resolution <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">L<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">σ</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resolution_step <span class="free">Cs</span> <span class="main">(</span><span class="free">Cs</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms resolution_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Examples-resolution_example1"><span class="command">lemma</span></span> resolution_example1<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"resolution_deriv <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">}</span> 
                              <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{</span>NP<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NP<span class="main"><span class="main">,</span></span>PQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>PQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">ε</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
              NQ_def NP_def PQ_def PP_def resolution_def
       <span class="keyword1"><span class="command">using</span></span> unifier_single empty_mgu <span class="keyword1"><span class="command">using</span></span> empty_subls
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step
         <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{</span>PP<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>PP<span class="main"><span class="main">,</span></span>PQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>PQ<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">ε</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
              NQ_def NP_def PQ_def PP_def resolution_def
       <span class="keyword1"><span class="command">using</span></span> unifier_single empty_mgu empty_subls <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step
         <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step
         <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NP<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>PP<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>NP<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>PP<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">ε</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
              NQ_def NP_def PQ_def PP_def resolution_def
       <span class="keyword1"><span class="command">using</span></span> unifier_single empty_mgu <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step
         <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">}</span>
        <span class="main">(</span><span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">}</span> 
                         <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">,</span>PQ<span class="main">}</span><span class="main">,</span><span class="main">{</span>NP<span class="main">}</span><span class="main">,</span><span class="main">{</span>PP<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Pa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Pa</span> <span class="main">=</span> Pos <span class="inner_quoted">''a''</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Na</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Na</span> <span class="main">=</span> Neg <span class="inner_quoted">''a''</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Pb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Pb</span> <span class="main">=</span> Pos <span class="inner_quoted">''b''</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Nb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Nb</span> <span class="main">=</span> Neg <span class="inner_quoted">''b''</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Paa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Paa</span> <span class="main">=</span> Pos <span class="inner_quoted">''a''</span> <span class="main">[</span>Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Naa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Naa</span> <span class="main">=</span> Neg <span class="inner_quoted">''a''</span> <span class="main">[</span>Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Pax</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Pax</span> <span class="main">=</span> Pos <span class="inner_quoted">''a''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Nax</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Nax</span> <span class="main">=</span> Neg <span class="inner_quoted">''a''</span> <span class="main">[</span>Var <span class="inner_quoted">''x''</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mguPaaPax</span> <span class="main">::</span> <span class="quoted">substitution</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mguPaaPax</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="inner_quoted">''x''</span> <span class="keyword1">then</span> Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span> <span class="keyword1">else</span> Var <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Examples-mguPaaPax_mgu"><span class="command">lemma</span></span> mguPaaPax_mgu<span class="main">:</span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> mguPaaPax <span class="main">{</span>Paa<span class="main">,</span>Pax<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?σ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="inner_quoted">''x''</span> <span class="keyword1">then</span> Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span> <span class="keyword1">else</span> Var <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="inner_quoted">''x''</span> <span class="keyword1">then</span> Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span> <span class="keyword1">else</span> Var <span class="bound">x</span><span class="main">)</span> <span class="main">{</span>Paa<span class="main">,</span>Pax<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Paa_def Pax_def unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">u</span> <span class="main">{</span>Paa<span class="main">,</span>Pax<span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="var">?σ</span> <span class="main">⋅</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">;</span></span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">u</span> <span class="main">{</span>Paa<span class="main">,</span>Pax<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> uuu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def Paa_def Pax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="inner_quoted">''x''</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span><span class="main">)</span> <span class="inner_quoted">''x''</span> <span class="main">=</span>  Fun <span class="inner_quoted">''a''</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uuu <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="inner_quoted">''x''</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>ε <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> composition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?σ</span> <span class="main">⋅</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="var">?σ</span> <span class="main">⋅</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="var">?σ</span> <span class="main">⋅</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">unfolding</span></span> mguPaaPax_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Examples-resolution_example2"><span class="command">lemma</span></span> resolution_example2<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"resolution_deriv <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span>
                              <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Pax<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Na<span class="main"><span class="main">,</span></span>Pb<span class="main"><span class="main">,</span></span>Naa<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Pax<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Naa<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">mguPaaPax</span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> mguPaaPax_mgu <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
          Nb_def Na_def Pax_def Pa_def Pb_def Naa_def Paa_def mguPaaPax_def resolution_def
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">Na</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> image_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> Na_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">Pb</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> image_eqI<span class="main">)</span>
     <span class="keyword1"><span class="command">unfolding</span></span> Pb_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{</span>Na<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Nb<span class="main"><span class="main">,</span></span>Na<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Na<span class="main"><span class="main">,</span></span>Pb<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Nb<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Pb<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">ε</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
                 Pb_def Nb_def Na_def PP_def resolution_def
       <span class="keyword1"><span class="command">using</span></span> unifier_single empty_mgu <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> resolution_rule'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Na<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Pa<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Na<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>Pa<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted">ε</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> applicable_def vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def  vars<span class="hidden">⇩</span><sub>l</sub>_def 
                  Pa_def Nb_def Na_def PP_def resolution_def
       <span class="keyword1"><span class="command">using</span></span> unifier_single empty_mgu <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_step 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">}</span>
         <span class="main">(</span><span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resolution_deriv <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span> 
          <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resolution_deriv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Examples-resolution_example1_sem"><span class="command">lemma</span></span> resolution_example1_sem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">{</span><span class="main">{</span>NP<span class="main">,</span> PQ<span class="main">}</span><span class="main">,</span> <span class="main">{</span>NQ<span class="main">}</span><span class="main">,</span> <span class="main">{</span>PP<span class="main">,</span> PQ<span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> resolution_example1 derivation_sound_refute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Examples-resolution_example2_sem"><span class="command">lemma</span></span> resolution_example2_sem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">F</span> <span class="free">G</span> <span class="main">{</span><span class="main">{</span>Nb<span class="main">,</span>Na<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pax<span class="main">}</span><span class="main">,</span><span class="main">{</span>Pa<span class="main">}</span><span class="main">,</span><span class="main">{</span>Na<span class="main">,</span>Pb<span class="main">,</span>Naa<span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> resolution_example2 derivation_sound_refute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Unification_Theorem">
<div class="head">
<h1>Theory Unification_Theorem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Unification Theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Unification_Theorem <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../First_Order_Terms/Unification.html">First_Order_Terms.Unification</a> <a href="Resolution.html">Resolution</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_to_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set_to_list</span> <span class="main">≡</span> inv set"</span></span>

<span class="keyword1" id="Unification_Theorem-set_set_to_list"><span class="command">lemma</span></span> set_set_to_list<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">xs</span> <span class="main">⟹</span> set <span class="main">(</span>set_to_list <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_to_list_def inv_into_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI <span class="skolem">A</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span>set_to_list <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_to_list_def inv_into_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UNIV_I someI<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">iterm_to_fterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fun_sym<span class="main">,</span> var_sym<span class="main">)</span> term <span class="main">⇒</span> fterm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iterm_to_fterm</span> <span class="main">(</span>Term.Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iterm_to_fterm</span> <span class="main">(</span>Term.Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="free">iterm_to_fterm</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fterm_to_iterm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> <span class="main">(</span>fun_sym<span class="main">,</span> var_sym<span class="main">)</span> term"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fterm_to_iterm</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Term.Var <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fterm_to_iterm</span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Term.Fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map <span class="free">fterm_to_iterm</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Unification_Theorem-iterm_to_fterm_cancel"><span class="command">lemma</span></span> iterm_to_fterm_cancel<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"iterm_to_fterm <span class="main">(</span>fterm_to_iterm <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1" id="Unification_Theorem-fterm_to_iterm_cancel"><span class="command">lemma</span></span> fterm_to_iterm_cancel<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="main">(</span>iterm_to_fterm <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">fsub_to_isub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"substitution <span class="main">⇒</span> <span class="main">(</span>fun_sym<span class="main">,</span> var_sym<span class="main">)</span> subst"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fsub_to_isub</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fterm_to_iterm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">isub_to_fsub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fun_sym<span class="main">,</span> var_sym<span class="main">)</span> subst <span class="main">⇒</span> substitution"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isub_to_fsub</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> iterm_to_fterm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Unification_Theorem-iterm_to_fterm_subt"><span class="command">lemma</span></span> iterm_to_fterm_subt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterm_to_fterm <span class="free">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> iterm_to_fterm <span class="main">(</span><span class="free">t1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fterm_to_iterm <span class="main">(</span><span class="free">σ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Unification_Theorem-unifiert_unifiers"><span class="command">lemma</span></span> unifiert_unifiers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="free">σ</span> <span class="main">∈</span> unifiers <span class="main">(</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t2</span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">⋅</span> <span class="main">(</span>fsub_to_isub <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="bound">t2</span> <span class="main">⋅</span> <span class="main">(</span>fsub_to_isub <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">;</span></span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span> 
      <span class="keyword3"><span class="command">assume</span></span> t1_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> t2_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> t1_p t2_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iterm_to_fterm <span class="skolem">t1</span> <span class="main">∈</span> <span class="free">ts</span> <span class="main">∧</span> iterm_to_fterm <span class="skolem">t2</span> <span class="main">∈</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iterm_to_fterm <span class="skolem">t1</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>iterm_to_fterm <span class="skolem">t2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iterm_to_fterm <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> iterm_to_fterm <span class="main">(</span><span class="skolem">t2</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iterm_to_fterm_subt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="main">(</span>iterm_to_fterm <span class="main">(</span><span class="skolem">t1</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fterm_to_iterm <span class="main">(</span>iterm_to_fterm <span class="main">(</span><span class="skolem">t2</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span> <span class="main">=</span> <span class="skolem">t2</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fterm_to_iterm_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">.</span> fst <span class="bound">p</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span> <span class="main">=</span> snd <span class="bound">p</span> <span class="main">⋅</span> fsub_to_isub <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Times_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifiers_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">get_mgut</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm list <span class="main">⇒</span> substitution option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_mgut</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> map_option <span class="main">(</span>isub_to_fsub <span class="main">∘</span> subst_of<span class="main">)</span> <span class="main">(</span>unify <span class="main">(</span>List.product <span class="main">(</span>map fterm_to_iterm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">(</span>map fterm_to_iterm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Unification_Theorem-unify_unification"><span class="command">lemma</span></span> unify_unification<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> unifiers <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">θ</span><span class="main">.</span> is_imgu <span class="bound">θ</span> <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> unify <span class="free">E</span> <span class="main">[]</span> <span class="main">=</span> Some <span class="bound">cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unify_complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unify_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Unification_Theorem-fterm_to_iterm_subst"><span class="command">lemma</span></span> fterm_to_iterm_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fterm_to_iterm <span class="free">t1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">σ</span> <span class="main">=</span>fterm_to_iterm <span class="main">(</span><span class="free">t1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Unification_Theorem-unifiers_unifiert"><span class="command">lemma</span></span> unifiers_unifiert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> unifiers <span class="main">(</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="free">σ</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="free">σ</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∈</span><span class="free">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">∈</span><span class="free">ts</span><span class="main">.</span> <span class="bound">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span> <span class="main">=</span> <span class="bound">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI <span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">ts</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">(</span>fterm_to_iterm <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> unifiers_def
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms fst_conv in_unifiersE snd_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="main">(</span><span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> fterm_to_iterm <span class="main">(</span><span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fterm_to_iterm_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iterm_to_fterm <span class="main">(</span>fterm_to_iterm <span class="main">(</span><span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>isub_to_fsub <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> iterm_to_fterm <span class="main">(</span>fterm_to_iterm <span class="main">(</span><span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span> <span class="main">=</span> <span class="skolem">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t<span class="hidden">⇩</span><sub>2</sub></span><span class="main">∈</span><span class="free">ts</span><span class="main">.</span> <span class="skolem">t'</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span> <span class="main">=</span> <span class="bound">t<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> isub_to_fsub <span class="free">σ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t'_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>            
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="free">σ</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Unification_Theorem-icomp_fcomp"><span class="command">lemma</span></span> icomp_fcomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">θ</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">i</span> <span class="main">=</span> fsub_to_isub <span class="main">(</span>isub_to_fsub <span class="free">θ</span> <span class="main">⋅</span> isub_to_fsub <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> composition_def subst_compose_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">θ</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="free">i</span> <span class="main">=</span> fterm_to_iterm <span class="main">(</span>iterm_to_fterm <span class="main">(</span><span class="free">θ</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> iterm_to_fterm <span class="main">(</span><span class="free">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iterm_to_fterm_subt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Unification_Theorem-is_mgu_mgu"><span class="command">lemma</span></span> is_mgu_mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_imgu <span class="free">θ</span> <span class="main">(</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="free">θ</span><span class="main">)</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="free">θ</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_imgu_def <span class="keyword1"><span class="command">using</span></span> unifiers_unifiert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">u</span> <span class="free">ts</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">(</span>isub_to_fsub <span class="free">θ</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">u</span> <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="skolem">u</span> <span class="main">∈</span> unifiers <span class="main">(</span>fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unifiert_unifiers <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> fsub_to_isub <span class="skolem">u</span> <span class="main">=</span> <span class="free">θ</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_imgu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="skolem">u</span> <span class="main">=</span> <span class="free">θ</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="skolem">u</span> <span class="main">=</span>  fsub_to_isub <span class="main">(</span>isub_to_fsub <span class="free">θ</span> <span class="main">⋅</span> isub_to_fsub <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> icomp_fcomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isub_to_fsub <span class="main">(</span>fsub_to_isub <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> isub_to_fsub <span class="main">(</span>fsub_to_isub <span class="main">(</span>isub_to_fsub <span class="free">θ</span> <span class="main">⋅</span> isub_to_fsub <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> isub_to_fsub <span class="free">θ</span> <span class="main">⋅</span> isub_to_fsub <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> isub_to_fsub <span class="free">θ</span> <span class="main">⋅</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Unification_Theorem-unification'"><span class="command">lemma</span></span> unification'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">θ</span><span class="main">.</span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">θ</span> <span class="free">ts</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fterm_to_iterm <span class="main">`</span> <span class="free">ts</span> <span class="main">×</span> fterm_to_iterm <span class="main">`</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set_to_list <span class="var">?E</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="free">σ</span> <span class="main">∈</span> unifiers <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unifiert_unifiers <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">θ</span><span class="main">.</span> is_imgu <span class="bound">θ</span> <span class="var">?E</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unify_unification<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fsub_to_isub <span class="free">σ</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?lE</span></span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_set_to_list<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_imgu <span class="skolem">θ</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_to_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>isub_to_fsub <span class="skolem">θ</span><span class="main">)</span> <span class="free">ts</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms is_mgu_mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">literal_to_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm literal <span class="main">⇒</span> fterm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">literal_to_term</span> <span class="main">(</span>Pos <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Fun <span class="inner_quoted">''Pos''</span> <span class="main">[</span>Fun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">literal_to_term</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> Fun <span class="inner_quoted">''Neg''</span> <span class="main">[</span>Fun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">term_to_literal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fterm <span class="main">⇒</span> fterm literal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">term_to_literal</span> <span class="main">(</span>Fun <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[</span>Fun <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">=</span><span class="inner_quoted">''Pos''</span> <span class="keyword1">then</span> Pos <span class="keyword1">else</span> Neg<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1" id="Unification_Theorem-term_to_literal_cancel"><span class="command">lemma</span></span> term_to_literal_cancel<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"term_to_literal <span class="main">(</span>literal_to_term <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Unification_Theorem-literal_to_term_sub"><span class="command">lemma</span></span> literal_to_term_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"literal_to_term <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>literal_to_term <span class="free">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1" id="Unification_Theorem-unifier"><span class="command">lemma</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> literal_to_term <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> literal_to_term <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="main">(</span>literal_to_term <span class="bound">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> literal_to_term <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal_to_term_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>literal_to_term <span class="main">`</span> <span class="free">L</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> literal_to_term <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Unification_Theorem-unifiert_unifier"><span class="command">lemma</span></span> unifiert_unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>literal_to_term <span class="main">`</span> <span class="free">L</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>literal_to_term <span class="main">`</span> <span class="free">L</span><span class="main">.</span> term_to_literal <span class="main">(</span><span class="bound">t</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> term_to_literal <span class="skolem">t'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span> <span class="free">L</span><span class="main">.</span> term_to_literal <span class="main">(</span><span class="main">(</span>literal_to_term <span class="bound">l</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">σ</span><span class="main">)</span> <span class="main">=</span> term_to_literal <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span> <span class="free">L</span><span class="main">.</span> term_to_literal <span class="main">(</span><span class="main">(</span>literal_to_term <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> term_to_literal <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> literal_to_term_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">∈</span> <span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>l</sub></span> <span class="free">σ</span> <span class="main">=</span> term_to_literal <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Unification_Theorem-mgu"><span class="command">lemma</span></span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">θ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">θ</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">θ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">θ</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unifiert_unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">u</span> <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">u</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">θ</span> <span class="main">⋅</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> unification<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uni<span class="main">:</span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">θ</span><span class="main">.</span> mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">θ</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> uni <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">σ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unifier<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub>_unifier<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">θ</span> <span class="main">(</span>literal_to_term <span class="main">`</span>  <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin unification' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="skolem">θ</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mgu<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub>_mgu<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Completeness_Instance">
<div class="head">
<h1>Theory Completeness_Instance</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Instance of completeness theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Completeness_Instance <span class="keyword2"><span class="keyword">imports</span></span> <a href="Unification_Theorem.html">Unification_Theorem</a> <a href="Completeness.html">Completeness</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> unification <span class="keyword1"><span class="command">using</span></span> unification <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">thm</span></span> lifting

<span class="keyword1" id="Completeness_Instance-lift"><span class="command">lemma</span></span> lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span> <span class="main">∧</span> finite <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> apart<span class="main">:</span> <span class="quoted"><span class="quoted">"vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C</span> <span class="main">∩</span> vars<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">D</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inst<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">C'</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inst<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="free">D'</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> appl<span class="main">:</span> <span class="quoted"><span class="quoted">"applicable <span class="free">C'</span> <span class="free">D'</span> <span class="free">L'</span> <span class="free">M'</span> <span class="free">σ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span> <span class="bound">M</span> <span class="bound">τ</span><span class="main">.</span> applicable <span class="free">C</span> <span class="free">D</span> <span class="bound">L</span> <span class="bound">M</span> <span class="bound">τ</span> <span class="main">∧</span>
                   instance_of<span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>s</sub> <span class="main">(</span>resolution <span class="free">C'</span> <span class="free">D'</span> <span class="free">L'</span> <span class="free">M'</span> <span class="free">σ</span><span class="main">)</span> <span class="main">(</span>resolution <span class="free">C</span> <span class="free">D</span> <span class="bound">L</span> <span class="bound">M</span> <span class="bound">τ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms lifting <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">thm</span></span> completeness

<span class="keyword1"><span class="command">theorem</span></span> complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span>hterm fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span>hterm pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms completeness <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>

<span class="keyword1"><span class="command">thm</span></span> completeness_countable

<span class="keyword1"><span class="command">theorem</span></span> complete_countable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_uni<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'u</span> <span class="main">::</span> countable<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span><span class="tfree">'u</span> fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="tfree">'u</span> pred_denot<span class="main">)</span><span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms completeness_countable <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>

<span class="keyword1"><span class="command">thm</span></span> completeness_nat

<span class="keyword1"><span class="command">theorem</span></span> complete_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_cs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Cs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">∈</span><span class="free">Cs</span><span class="main">.</span> finite <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">F</span><span class="main">::</span>nat fun_denot<span class="main">)</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span>nat pred_denot<span class="main">)</span> <span class="main">.</span> <span class="main">¬</span>eval<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub> <span class="bound">F</span> <span class="bound">G</span> <span class="free">Cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs'</span><span class="main">.</span> resolution_deriv <span class="free">Cs</span> <span class="bound">Cs'</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∈</span> <span class="bound">Cs'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms completeness_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>