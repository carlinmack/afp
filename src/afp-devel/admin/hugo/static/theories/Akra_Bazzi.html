<div id="Akra_Bazzi_Library">
<div class="head">
<h1>Theory Akra_Bazzi_Library</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Akra_Bazzi_Library.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Lemma bucket for the Akra-Bazzi theorem.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi_Library
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="../Landau_Symbols/Landau_More.html">Landau_Symbols.Landau_More</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: Move? *)</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> ln <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> ln <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_mono_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> ln <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> ln <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">declare</span></span> DERIV_powr<span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_pos'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> linordered_ab_group_add<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">I</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> bexE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert_remove<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_pos_nonneg sum_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> min_mult_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> min <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> min <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_mult_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> max <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> max <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> DERIV_nonneg_imp_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="free">f'</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f'</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">y</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f'</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MVT2<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> z <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> z<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f'</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> z<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_conjE<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span>eventually <span class="free">P</span> <span class="free">F</span> <span class="main">⟹</span> eventually <span class="free">Q</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> eventually_rev_mp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> eventually_rev_mp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_natfloor_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℕ</span> <span class="main">⟹</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Nats_cases<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_natfloor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="main">(</span>at_top <span class="main">::</span> nat filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_top <span class="main">::</span> real filter<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span>real <span class="skolem">N</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">n</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI N le_nat_floor<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_0_smallo_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> smalloD_tendsto<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_1_tendsto_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smalloI_tendsto<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_smallomega_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallomegaD_filterlim_at_top_norm<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_imp_abs_less_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_imp_less_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> smallo_imp_abs_less_real<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_imp_le_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="comment1">(* TODO MOVE *)</span>
<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟷</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span><span class="main">)</span> <span class="free">F</span> <span class="main">∧</span> filterlim <span class="free">f</span> <span class="main">(</span>nhds <span class="free">a</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
<span class="comment1">(* END TODO *)</span>

<span class="keyword1"><span class="command">lemma</span></span> one_plus_x_powr_approx_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> 
    <span class="main">1</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(!)</span> <span class="main">[</span><span class="var">?f</span><span class="main">,</span> <span class="var">?f'</span><span class="main">,</span> <span class="var">?f''</span><span class="main">]</span>"</span></span>
 
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">0.5</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="numeral">0.5</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?fs</span> <span class="bound">m</span> <span class="keyword1">has_real_derivative</span> <span class="var">?fs</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">0.5</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="numeral">0.5</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?fs</span> <span class="skolem">m</span> <span class="keyword1">has_real_derivative</span> <span class="var">?fs</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span> <span class="var">?fs</span> <span class="bound">m</span> <span class="main">0</span> <span class="main">/</span> <span class="main">(</span>fact <span class="bound">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span><span class="main">^</span><span class="bound">m</span><span class="main">)</span> <span class="main">+</span> 
              <span class="var">?fs</span> <span class="numeral">2</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span>fact <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms x' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Taylor<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ A<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> t <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> t<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> powr_lower_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">l</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">u</span><span class="main">⟧</span> <span class="main">⟹</span> min <span class="main">(</span><span class="free">l</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> min.cobounded1 powr_mono2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> min.cobounded2 powr_mono2'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> powr_upper_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">l</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">u</span><span class="main">⟧</span> <span class="main">⟹</span> max <span class="main">(</span><span class="free">l</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">powr</span> <span class="free">z</span><span class="main">)</span> <span class="main">≥</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> powr_mono2 max.cobounded2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> powr_mono2' max.cobounded1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_plus_x_powr_Taylor2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">k</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> abs <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> max <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> one_plus_x_powr_approx_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> t <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> t <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> t<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono mult_right_mono k_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_plus_x_powr_Taylor2_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span>real<span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> one_plus_x_powr_Taylor2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> k <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> tendstoD<span class="main">[</span><span class="operator">OF</span> lim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_plus_x_powr_Taylor1_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span>real<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> one_plus_x_powr_Taylor2_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI_tendsto<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.big.mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">OF</span> _ this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">p</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sum_in_bigo<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A B<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_times_x_minus_1_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>linordered_idom<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> x_times_x_minus_1_nonpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>linordered_idom<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonpos<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> powr_mono'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">≤</span> inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> powr_less_mono'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">&lt;</span> inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_less_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_powr_at_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> at_bot at_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_tendsto_pos_mult_at_bot<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const _ filterlim_ident<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_bot<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_powr_at_bot_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> at_top at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> ln <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> filterlim_uminus_at_top_at_bot<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="free">a</span> <span class="main">:&gt;</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ln_inverse<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="free">a</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_powr_at_top_neg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> ln <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_ident <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> ln <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_uminus_at_bot<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_bot<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nat_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="main">(</span>at_top <span class="main">::</span> real filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_top <span class="main">::</span> nat filter<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms filterlim_real_sequentially
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_def le_filter_def eventually_filtermap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Akra_Bazzi_Asymptotics">
<div class="head">
<h1>Theory Akra_Bazzi_Asymptotics</h1>
</div>
<pre class="source"><span class="comment1">(* File:   Akra_Bazzi_Asymptotics.thy
   Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

   Proofs for the four(ish) asymptotic inequalities required for proving the
   Akra Bazzi theorem with variation functions in the recursive calls.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Asymptotic bounds›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi_Asymptotics
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Akra_Bazzi_Library.html">Akra_Bazzi_Library</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_asymptotics_bep <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="free">e</span> <span class="free">p</span> <span class="free">hb</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Functions that are negligible w.r.t. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ln <span class="main"><span class="main">(</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">e</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">negl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">negl</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> neglD<span class="main">:</span> <span class="quoted"><span class="quoted">"negl <span class="free">f</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> landau_o.smallD<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> negl_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"negl <span class="free">f</span> <span class="main">⟹</span> negl <span class="free">g</span> <span class="main">⟹</span> negl <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> landau_o.small_1_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> landau_o.small_imp_big<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> landau_o.small_trans<span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"negl <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smallo_imp_le_real<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">b</span><span class="main">/</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">b</span><span class="main">/</span>ln <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="skolem">x</span> <span class="main">=</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">b</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="free">b</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_0_smallo_1<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> one_plus_x_powr_Taylor2_bigo<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">b</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">b</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big_small_trans<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">b</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">b</span><span class="main">/</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">b</span><span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_theta.mult<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smallomega_iff_smallo<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="skolem">h2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smallomega_iff_smallo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h2</span> <span class="bound">x</span> <span class="main">=</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">b</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  h2_def
                                      ln_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ln_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">b</span>"</span></span><span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_mono2' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ln_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"negl <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_0_smallo_1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
           <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bep <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> one_plus_x_powr_Taylor1_bigo<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_0_smallo_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negl <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev2_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eq_rhs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_ln<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> tendsto_add<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="operator">of</span> <span class="main"><span class="main"><span class="main"><span class="main">_</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_0_smallo_1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lim'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_zero<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_0_smallo_1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> one_plus_x_powr_Taylor2_bigo<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> lim' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big_small_mult smalloI_tendsto<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o(</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small_imp_big<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_in_bigo<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">e</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> bep lim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> smallo_1_tendsto_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"negl <span class="free">h</span>"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> ev2_aux <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f'_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">x</span> <span class="main">=</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bep g <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"negl <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> landau_o.small_big_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small_big_trans<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo_imp_abs_less_real<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> h_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">*</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_add powr_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> elim<span class="main">(</span>1<span class="main">)</span> bep
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_nonneg <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> elim<span class="main">(</span>1<span class="main">)</span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f'</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> f'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≥</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def h_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev21<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"negl <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span>
         <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ev2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> g <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> g<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ev22<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"negl <span class="free">g</span>"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
         <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ev2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> g <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
                                      <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> asymptotics1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span>
             <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> ev1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negl <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.small.uminus_in_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> this zero_less_one<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≤</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ev21 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> g <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> f
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?t</span> <span class="main">-</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ elim<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="quoted"><span class="quoted">‹negl <span class="skolem">f</span>›</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negl <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_in_smallo landau_o.small.mult <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_o.small_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> ev4<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
             <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> ev1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negl <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.small.uminus_in_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> this zero_less_one<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≤</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> ev22 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> g <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> tendsto_neg_powr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_smallomega_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_pos_nonneg <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> ev_g<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="var">?g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallo_imp_abs_less_real smalloI_tendsto<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> ev_g f
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?t</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> h_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="quoted"><span class="quoted">‹negl <span class="skolem">f</span>›</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negl <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_in_smallo landau_o.small.mult <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_o.small_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> ev4<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics3<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> tendsto_neg_powr ln_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">0.5</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">0.5</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">0.5</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">0.5</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">0.5</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">0.5</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics4<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">⤏</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> tendsto_neg_powr ln_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="var">?f</span> <span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics5<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">b</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_mult_right_zero tendsto_neg_powr ln_at_top<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ filterlim_ident<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> bep<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">...</span> at_top at_top"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_neg_powr filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">*</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics6<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> asymptotics7<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> asymptotics8<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">/</span><span class="numeral">3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> A B<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> A C<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> bep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> landau_omega.smallD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> A eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic1</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">/</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
  <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic1'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">/</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
  <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic2</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">/</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic2'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">/</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic3</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic4</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic5</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span>ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic6</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">/</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic7</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">/</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotic8</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="main">/</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_asymptotics</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span>
  akra_bazzi_asymptotic1 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> akra_bazzi_asymptotic1' <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>
  akra_bazzi_asymptotic2 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> akra_bazzi_asymptotic2' <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>
  akra_bazzi_asymptotic3 <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> akra_bazzi_asymptotic4 <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> akra_bazzi_asymptotic5 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>
  akra_bazzi_asymptotic6 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> akra_bazzi_asymptotic7 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>
  akra_bazzi_asymptotic8 <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">hb</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> akra_bazzi_asymptotic_defs <span class="main">=</span>
  akra_bazzi_asymptotic1_def akra_bazzi_asymptotic1'_def
  akra_bazzi_asymptotic2_def akra_bazzi_asymptotic2'_def akra_bazzi_asymptotic3_def
  akra_bazzi_asymptotic4_def akra_bazzi_asymptotic5_def akra_bazzi_asymptotic6_def
  akra_bazzi_asymptotic7_def akra_bazzi_asymptotic8_def akra_bazzi_asymptotics_def

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_asymptotics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="free">hb</span> <span class="free">e</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_asymptotics_bep <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">hb</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> akra_bazzi_asymptotics <span class="skolem">b</span> <span class="free">hb</span> <span class="free">e</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_asymptotic_defs
    <span class="keyword1"><span class="command">using</span></span> asymptotics1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">c</span><span class="main">]</span> asymptotics2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">c</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj asymptotics1 asymptotics2 asymptotics3
              asymptotics4 asymptotics5 asymptotics6 asymptotics7 asymptotics8<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Akra_Bazzi_Real">
<div class="head">
<h1>Theory Akra_Bazzi_Real</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Akra_Bazzi_Real.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  The continuous version of the Akra-Bazzi theorem for functions on the reals.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The continuous Akra-Bazzi theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi_Real
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Akra_Bazzi_Asymptotics.html">Akra_Bazzi_Asymptotics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We want to be generic over the integral definition used; we fix some arbitrary
  notions of integrability and integral and assume just the properties we need.
  The user can then instantiate the theorems with any desired integral definition.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_integral <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">integrable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">integral</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> integrable_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> integral_const<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> integrable_subinterval<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="free">integrable</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a'</span> <span class="main">⟹</span> <span class="free">b'</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="free">f</span> <span class="free">a'</span> <span class="free">b'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> integral_le<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="free">integrable</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="free">g</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
                 <span class="free">integral</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">integral</span> <span class="free">g</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> integral_combine<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
                 <span class="free">integral</span> <span class="free">f</span> <span class="free">a</span> <span class="free">c</span> <span class="main">+</span> <span class="free">integral</span> <span class="free">f</span> <span class="free">c</span> <span class="free">b</span> <span class="main">=</span> <span class="free">integral</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> integral_nonneg<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">integral</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> integral_le<span class="main">[</span><span class="operator">OF</span> integrable_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_const<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">declare</span></span> sum.cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_mono_imp_ex1_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim_neg_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lim_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">z</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">b</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> isCont <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> y_greater_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> lim_neg_inf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> at_bot"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> filterlim_at_top<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_at_bot_linorder<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> order_tendstoD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> lim_inf y_greater_z<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">u</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_at_top_linorder<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> min <span class="skolem">l</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> max <span class="skolem">l</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">≥</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> l<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">b</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> u<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> a_le_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_def b_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IVT2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The parameter <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the Akra-Bazzi theorem always exists and is unique.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">akra_bazzi_exponent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> real list <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_exponent</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_params <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">as</span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> length_as<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     k_not_0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     a_ge_0<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     b_bounds<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">p</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> akra_bazzi_exponent <span class="free">as</span> <span class="free">bs</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"p <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> akra_bazzi_exponent_def length_as<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> b_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b_less_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> as_nonempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bs_nonempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_as length_bs k_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> a_in_as<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">as</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_as<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> b_in_bs<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_bs<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_params_nonzero <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">as</span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> length_as<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     a_ge_0<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ex_a_pos<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     b_bounds<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_params <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">insert</span> length_as length_bs a_ge_0 ex_a_pos b_bounds<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_p_strict_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_strict_mono_ex1 ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ex_a_pos <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth length_as<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> b_bounds <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono powr_less_mono'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> a_ge_0 b_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono powr_mono'<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_p_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> akra_bazzi_p_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_p_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strict_mono_imp_ex1_real<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> as_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_as<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a_ge_0<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ex_a_pos <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth length_as<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">p</span> at_bot<span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="bound">p</span> <span class="main">:&gt;</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> b_bounds i
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> real_powr_at_bot_neg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="bound">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">from</span></span> a_ge_0 b_bounds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">i</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.insert_remove<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">i</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">p</span> at_bot<span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">p</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_at_top_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ always_eventually<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_sum tendsto_mult_right_zero real_powr_at_top_neg<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_bounds<span class="main">[</span><span class="operator">OF</span> nth_mem<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> akra_bazzi_p_strict_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_props<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">=</span> <span class="free">p'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> theI'<span class="main">[</span><span class="operator">OF</span> akra_bazzi_p_unique<span class="main">]</span> the1_equality<span class="main">[</span><span class="operator">OF</span> akra_bazzi_p_unique<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">=</span> <span class="free">p'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_greaterI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">&lt;</span> p"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_less_linear<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">p</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> akra_bazzi_p_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> p_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_lessI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">&gt;</span> p"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_less_linear<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">p</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> akra_bazzi_p_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> p_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_geI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">≤</span> p"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_less_linear<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">p</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> akra_bazzi_p_strict_mono<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> p_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_leI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">≥</span> p"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_less_linear<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">p</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> akra_bazzi_p_strict_mono<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> p_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_boundsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> p_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> p_geI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_boundsI'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> p_lessI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> p_greaterI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="free">as</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> p_geI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="free">as</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_list_sum_nth length_as atLeast0LessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> b_bounds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">=</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_real_recursion <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">as</span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">hs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">hb</span> <span class="free">e</span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> length_as<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_hs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">hs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     k_not_0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     a_ge_0<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     b_bounds<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>

  <span class="comment1">(* The recursively-defined function *)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     x0_ge_1<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     x0_le_x1<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     x1_ge<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> inverse <span class="free">b</span>"</span></span>
  <span class="comment1">(* Bounds on the variation functions *)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     e_pos<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     h_bounds<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∈</span> set <span class="free">hs</span> <span class="main">⟹</span> <span class="main">¦</span><span class="free">h</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* Asymptotic inequalities *)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> akra_bazzi_asymptotics <span class="free">b</span> <span class="free">hb</span> <span class="free">e</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_params <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_as length_bs k_not_0 a_ge_0 b_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> h_in_hs<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">hs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">hs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_hs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x1_gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bs_nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> b_less_1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> x0_ge_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> inverse <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x1_ge <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x1_ge_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> x1_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bx_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span>  <span class="free">b</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> b_less_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_le_one_le<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x0_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x0_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> x0_hb_bound0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   x0_hb_bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   x0_hb_bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> asymptotics<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_asymptotic_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_bounds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x0_hb_bound2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step_diff<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x0_hb_bound0<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> less_le_trans<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_pos<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> step_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x0_hb_bound0'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms x0_pos x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_bounds<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> step_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step_pos<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> step_nonneg'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> x0_pos x0_le_x1<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hb_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> k_not_0 <span class="keyword2"><span class="keyword">and</span></span> length_hs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set <span class="free">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">hs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">h</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">h</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">¦</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">/</span> ln <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> h_bounds<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">/</span> ln <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">...</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">/</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">intro</span> divide_nonneg_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> x1_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">hb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1_gt_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_bounds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_pos x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono x0_hb_bound0'<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound0<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms x0_pos x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">-</span><span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms x1_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound4'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x0_hb_bound4<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_bounds<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_pos x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono x0_hb_bound0<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms x1_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x0_hb_bound1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h_bounds assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_hs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x1_ge assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms b_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms step_nonneg' x' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x1_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound7'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ x0_hb_bound7<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> x0_le_x1 x0_ge_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x1_ge<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> b_pos assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms b_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound0<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">...</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms x1_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound8'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> x0_hb_bound8<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms hb_nonneg x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   asymptotics1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">+</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">-</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">+</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">-</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     asymptotics5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">using</span></span> assms asymptotics<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_asymptotic_defs
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">using</span></span> assms asymptotics<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_asymptotic_defs
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">using</span></span> assms asymptotics<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_asymptotic_defs
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> x0_hb_bound9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound4<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">...</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x1_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x0_hb_bound8<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> x0_ge_1 <span class="keyword1"><span class="command">have</span></span> pos'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_imp_neg_le h_bounds<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms b_pos x0_pos pos' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_mono mult_pos_pos pos<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms e_pos asymptotics5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> pos' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono2' ln_gt_zero<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asymptotics5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> assms x0_le_x1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">akra_bazzi_measure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_measure</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> nat <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⌉</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_measure_decreases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_measure <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> akra_bazzi_measure <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> step_diff assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">⌉</span> <span class="main">≤</span> <span class="main">⌈</span><span class="free">x</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ceiling_mono<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">⌉</span> <span class="main">&lt;</span> <span class="main">⌈</span><span class="free">x</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">⌉</span> <span class="main">&lt;</span> nat <span class="main">⌈</span><span class="free">x</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_mono_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_measure_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base rec<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="quoted">"akra_bazzi_measure <span class="free">x</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> base <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rec<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> x0_hb_bound7<span class="main">[</span><span class="operator">OF</span> _ i<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> i x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less akra_bazzi_measure_decreases<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_real <span class="main">=</span> akra_bazzi_real_recursion <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">integrable</span> <span class="free">integral</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> integral<span class="main">:</span> <span class="quoted"><span class="quoted">"akra_bazzi_integral <span class="free">integrable</span> <span class="free">integral</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">C</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     f_base<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     f_rec<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_nonneg<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     C_bound<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">C</span><span class="main">*</span><span class="free">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> akra_bazzi_integral <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_integrable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_subinterval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_integrable<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">g_approx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g_approx</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> akra_bazzi_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> f_base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> rec.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_ge_0<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rec.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_rec<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">f_approx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f_approx</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_approx_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_nonneg ballI g_nonneg divide_nonneg_nonneg g_integrable<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_approx_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> f_approx <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> f_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_pos_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> x0_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> f_approx_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f_approx_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> f_approx <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_approx_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> f_approx_bounded_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> f_approx <span class="bound">x</span> <span class="main">≥</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≥</span> min <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_lower_bound<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f_approx <span class="skolem">x</span> <span class="main">≥</span> min <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono f_approx_aux<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this x0_pos x1_pos <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"min <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> asymptotics_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x1_gt_1 <span class="keyword1"><span class="command">have</span></span> ln_x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms x1_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound0<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> hb_nonneg ln_x_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_pos
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> mult_pos_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> neg_le_iff_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> h_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≥</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> A B C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_mono2 powr_mono2' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A B C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_mono2 powr_mono2' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
           <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> b_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> b_less_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> b_less_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x1_gt_1 assms <span class="keyword1"><span class="command">have</span></span> ln_x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
          <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span>inverse<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
          <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms x <span class="keyword1"><span class="command">unfolding</span></span> s_def <span class="keyword1"><span class="command">using</span></span> asymptotics1<span class="main">[</span><span class="operator">OF</span> x assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> asymptotics1'<span class="main">[</span><span class="operator">OF</span> x assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x0_hb_bound0'<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> hb_nonneg x ln_x_pos assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">*</span><span class="free">hb</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span>inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_pos assms x x0_pos b_less_1 ln_x_pos
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span>inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_pos assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> x assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asymptotics_aux<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> s_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> h_bounds<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x hb_nonneg x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span>
                       <span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x e_pos b_pos x0_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_left_mono powr_mono2' ln_mono ln_gt_zero step_pos x0_hb_bound7'
                add_pos_nonneg mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span>
                         <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymptotics2'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
           <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms x1_gt_1 <span class="keyword1"><span class="command">have</span></span> ln_x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> b_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos hb_nonneg <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">*</span> <span class="free">hb</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x0_hb_bound0'<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span>"</span></span><span class="main">]</span> b_pos assms ln_x_pos
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span>inverse<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymptotics_aux<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x0_hb_bound9<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?B</span> <span class="main">≤</span>
                   <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms e_pos pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≤</span> <span class="var">?B'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> x0_hb_bound8'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> x0_hb_bound8<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> x0_ge_1
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x0_hb_bound7<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> x0_ge_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> h_bounds<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≤</span> <span class="var">?B'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms e_pos x step_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_left_mono powr_mono2' ln_mono ln_gt_zero<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?B</span> <span class="main">≤</span>
             <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?B'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="free">hb</span><span class="main">*</span>inverse <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">*</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b_pos x x0_pos pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mult<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?B'</span> <span class="main">=</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="var">?A</span> <span class="main">*</span> <span class="var">?B'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">*</span> <span class="var">?B'</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x
    <span class="keyword1"><span class="command">using</span></span> asymptotics2<span class="main">[</span><span class="operator">OF</span> x assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> asymptotics2'<span class="main">[</span><span class="operator">OF</span> x assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Cx_le_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">*</span><span class="free">x</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">*</span><span class="free">x</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> C_bound<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> neg_le_iff_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> h_bounds<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="free">x</span><span class="main">/</span>ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">¦</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_nat_to_real <span class="main">=</span> akra_bazzi_real_recursion <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_base<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> real <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     f_rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"real <span class="free">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span>
                          <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     x0_int<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⌋</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f'</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure akra_bazzi_measure"</span></span><span class="main">)</span>
               <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> akra_bazzi_measure_decreases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f'_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> f' <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> f'.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_base<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"real <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">⌊</span></span><span class="free"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main"><span class="main">⌋</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x0_int<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_le_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> nat_mono floor_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> x0_pos <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> f'_rec <span class="main">=</span> f'.simps<span class="main">(</span>2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_real_lower <span class="main">=</span> akra_bazzi_real <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fb2</span> <span class="free">gb2</span> <span class="free">c2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_base2<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">fb2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     fb2_pos<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">fb2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="free">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">g</span> <span class="bound">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     c2_pos<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">gb2</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> akra_bazzi_integral <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gb2_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gb2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">]</span> x0_le_x1 x0_pos g_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> g_growth2'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">g</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">*</span><span class="free">x</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cx_le_step<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">C</span><span class="main">*</span><span class="free">x</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms g_growth2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> g_bounds2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c4</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> g_approx <span class="bound">i</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c4</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c4</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c4</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c4</span> <span class="main">=</span> Max <span class="main">{</span><span class="free">c2</span> <span class="main">/</span> min <span class="main">1</span> <span class="main">(</span>min <span class="main">(</span><span class="main">(</span><span class="bound">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="bound">b</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> bs_nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min <span class="main">1</span> <span class="main">(</span>min <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> b b_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b b_pos c2_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">/</span> <span class="var">?m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c4</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Max_gr_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> powr_negD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">powr</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword1"><span class="command">unfolding</span></span> powr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min <span class="main">1</span> <span class="main">(</span>min <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> min <span class="main">1</span> <span class="main">(</span>min <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> x i x0_le_x1 x1_pos step_pos b_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b_in_bs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
             <span class="operator">rule</span> min.mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> min.cobounded1 powr_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x0_hb_bound4'<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> min.cobounded2 powr_mono2'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x0_hb_bound5<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> i b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">/</span> min <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c2</span> <span class="main">/</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2_pos
      <span class="keyword1"><span class="command">unfolding</span></span> min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_pos_pos <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_negD<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">c4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max.coboundedI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">/</span> min <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c4</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> c4 <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x x1_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x x1_ge_1 i g_growth2' x0_le_x1 c2_pos
      <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="var">?x'</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> x0_le_x1 x i <span class="keyword1"><span class="command">have</span></span> x'_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> step_le_x<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="var">?x'</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> min <span class="main">1</span> <span class="main">(</span><span class="var">?x''</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> b_pos nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i length_bs<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x0_le_x1 x i <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> step_pos<span class="main">)</span> <span class="operator">simp_all</span>


    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="var">?x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_lower_bound mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c2 <span class="keyword2"><span class="keyword">and</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?m</span> <span class="main">≤</span> <span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 x x1_pos x0_le_x1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono mult_nonneg_nonneg g_nonneg<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?x'</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span> <span class="var">?x'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_pos step_pos<span class="main">[</span><span class="operator">OF</span> i x<span class="main">]</span> x0_hb_bound7<span class="main">[</span><span class="operator">OF</span> x i<span class="main">]</span> c2 x x0_le_x1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_le x'_le_x akra_bazzi_integrable ballI integrable_const<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_nonneg_nonneg g_nonneg<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x0_pos x x0_le_x1 x'_le_x c2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_const<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> c2 x_pos x x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg g_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> x i x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound3 mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x x1_pos step_pos<span class="main">[</span><span class="operator">OF</span> i x<span class="main">]</span> x_pos i x0_le_x1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="main">...</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m'_def <span class="keyword1"><span class="command">using</span></span> x_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> min.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> min_mult_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">c2</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c2</span><span class="main">/</span><span class="skolem">m'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x i g_nonneg x0_le_x1 x1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">c4</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono c4<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"g_approx <span class="skolem">i</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c4</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_approx_def <span class="keyword1"><span class="command">using</span></span> x_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">c4</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_approx_bounded_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> f_approx <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">gb2</span> <span class="main">*</span> <span class="var">?m2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> <span class="var">?m3</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="var">?m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">/</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> u x x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?m2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?m2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> u g_nonneg x0_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x u x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="free">gb2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_bounded<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?m2</span> <span class="main">≤</span> <span class="free">gb2</span> <span class="main">*</span> <span class="var">?m2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">u</span> <span class="main">/</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?m3</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">from</span></span> A x gb2_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?int</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="var">?m3</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_le akra_bazzi_integrable integrable_const mult_nonneg_nonneg<span class="main">)</span>
           <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x gb2_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> <span class="var">?m3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_const<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x gb2_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> <span class="var">?m3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?m4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x g_nonneg x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?int</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_nonneg akra_bazzi_integrable<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?m1</span> <span class="main">*</span> <span class="var">?m4</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"f_approx <span class="skolem">x</span> <span class="main">≤</span> max <span class="main">1</span> <span class="main">(</span><span class="var">?m1</span> <span class="main">*</span> <span class="var">?m4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> that<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f_bounded_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> f_approx <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> f_approx <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_approx_bounded_above<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x f_base2 x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">fb2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">*</span> <span class="free">fb2</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fb2_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">c'</span> <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_approx_nonneg x c
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono f_approx_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>min <span class="free">c'</span> <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">c'</span> <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="free">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="free">c'</span> <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">*</span> <span class="free">fb2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c fb2_pos c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c5</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">c5</span> <span class="main">*</span> f_approx <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c5</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c4</span></span> <span class="keyword2"><span class="keyword">where</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> g_approx <span class="bound">i</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c4</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c4</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> g_bounds2<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c4</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c5</span></span> <span class="keyword2"><span class="keyword">where</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> f_approx <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">≤</span> inverse <span class="skolem">c4</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_bounded_below<span class="main">)</span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> c5 x <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">" <span class="skolem">c5</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c5</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_left_mono f_approx_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> akra_bazzi_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asymptotics3 base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c5 f_approx_nonneg base x0_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> c5<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">hs</span><span class="main">!</span><span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">+</span><span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">+</span><span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ln <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> rec <span class="keyword2"><span class="keyword">and</span></span> x0_le_x1 x0_ge_1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_gt_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> x0_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> c5 c4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> <span class="skolem">c4</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> asymptotics3 x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c5</span><span class="main">*</span><span class="skolem">c4</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">c5</span><span class="main">*</span><span class="skolem">c4</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> g_nonneg<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c5</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">c5</span><span class="main">*</span><span class="skolem">c4</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x_gt_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c5</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> f_approx_def powr_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="var">?a</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?b</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_props<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> <span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f_approx_aux x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> int_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="var">?b</span> <span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c5</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="var">?f</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?expr</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> x_pos b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"g_approx <span class="skolem">i</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c4</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> c4<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c4</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≥</span> <span class="var">?int2</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_approx_def <span class="keyword1"><span class="command">using</span></span> x_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">*</span> <span class="var">?B</span> <span class="main">≤</span> <span class="var">?A</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="var">?int</span> <span class="main">-</span> <span class="var">?int2</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i c5 a_ge_0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?int</span> <span class="main">-</span> <span class="var">?int2</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?int1</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_eq_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> eq_commute<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> integral_combine akra_bazzi_integrable<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> rec.hyps step_le_x<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c5</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c5</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l'</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rec.hyps i c5 a_ge_0 int_nonneg
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono asymptotics1' mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="skolem">c5</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?l'</span> <span class="skolem">i</span><span class="main">)</span><span class="main">*</span>f_approx <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> f_approx_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono a_ge_0 rec.IH<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?expr</span> <span class="main">≤</span> <span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_rec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> rec.hyps x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c5</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> c5<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_bigomega<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_approx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> akra_bazzi_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> landau_omega.bigI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_nonneg f_approx_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_real_upper <span class="main">=</span> akra_bazzi_real <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fb1</span> <span class="free">c1</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_base1<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">fb1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="free">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     c1_pos<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> akra_bazzi_integral <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> g_growth1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">*</span><span class="free">x</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="main">(</span><span class="free">hs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cx_le_step<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">C</span><span class="main">*</span><span class="free">x</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms g_growth1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> g_bounds1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c3</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">c3</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> g_approx <span class="bound">i</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">=</span>
    Min <span class="main">{</span><span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> max <span class="main">1</span> <span class="main">(</span>max <span class="main">(</span><span class="main">(</span><span class="bound">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="bound">b</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span>max <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_less_one<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b b_less_1 c1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_pos_pos mult_pos_pos<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Min_gr_iff<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> b_less_1 <span class="keyword1"><span class="command">have</span></span> b_less_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span>max <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">≤</span> <span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Min.coboundedI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">1</span> <span class="main">(</span>max <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> x i x0_le_x1 x1_pos step_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i x<span class="main"><span class="main">]</span></span> b_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b_in_bs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
             <span class="operator">rule</span> max.mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> powr_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x0_hb_bound5<span class="main"><span class="main">]</span></span> max.cobounded2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> powr_mono2'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ x0_hb_bound4'<span class="main"><span class="main">]</span></span> max.cobounded1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> b_less_1' c1_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?m</span> <span class="main">≤</span>
          <span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> max <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">≤</span> <span class="free">c1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> max <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> c3 <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x x1_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x x1_ge_1 x0_le_x1 i c1_pos g_growth1'
      <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="var">?x'</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">≥</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> x x0_le_x1 i <span class="keyword1"><span class="command">have</span></span> x'_le_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> step_le_x<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="var">?x'</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> max <span class="main">1</span> <span class="main">(</span><span class="var">?x''</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> b_pos nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i length_bs<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x x0_le_x1 i <span class="keyword1"><span class="command">have</span></span> x'_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> step_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">have</span></span> m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_def <span class="keyword1"><span class="command">using</span></span> x_pos step_pos<span class="main">[</span><span class="operator">OF</span> i x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x x0_le_x1 c1 <span class="keyword1"><span class="command">have</span></span> c1_g_m_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg divide_nonneg_pos g_nonneg<span class="main">)</span> <span class="operator">simp_all</span>

    <span class="keyword1"><span class="command">from</span></span> x i g_nonneg x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">c1</span><span class="main">*</span><span class="skolem">b'</span><span class="main">/</span><span class="skolem">m'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono c3<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x i c1_pos x1_pos x0_le_x1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> b'_def m'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound6 mult_right_mono mult_nonneg_nonneg
                                        divide_nonneg_nonneg g_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m'</span> <span class="main">=</span>
                 max <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m'_def <span class="keyword1"><span class="command">using</span></span> x_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> max.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> max_mult_left<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x x1_pos step_pos<span class="main">[</span><span class="operator">OF</span> i x<span class="main">]</span> x_pos i x0_le_x1 x_pos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span> <span class="main">=</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span> <span class="var">?x'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x'_le_x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_const<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c1_g_m_nonneg<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="var">?x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x u x'_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x'_pos u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c1 <span class="keyword2"><span class="keyword">and</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">u</span> <span class="main">*</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 x u x0_hb_bound7<span class="main">[</span><span class="operator">OF</span> x i<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono g_nonneg<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> m_pos u step_pos<span class="main">[</span><span class="operator">OF</span> i x<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">u</span> <span class="main">/</span> <span class="skolem">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">/</span> <span class="var">?m</span><span class="main">)</span> <span class="var">?x'</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?x'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x0_hb_bound7<span class="main">[</span><span class="operator">OF</span> x i<span class="main">]</span> x'_le_x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_le ballI akra_bazzi_integrable integrable_const c1_g_m_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> g_approx <span class="skolem">i</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_pos
      <span class="keyword1"><span class="command">unfolding</span></span> g_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> f_bounded_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> f_approx <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="free">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> f_approx <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_approx_bounded_below<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fb1_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fb1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_base1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span><span class="main">]</span> f_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">]</span> x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> f_base1 x0_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">fb1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f_approx <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="free">fb1</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c fb1_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> f_approx_nonneg x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">fb1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> c<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_approx_nonneg x<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≥</span> max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_le_cancel_left1<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> c'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="free">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> max.cobounded2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> fb1_nonneg <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="main">(</span><span class="free">fb1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">c'</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c6</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c6</span> <span class="main">*</span> f_approx <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c6</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="skolem">c3</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> g_approx <span class="bound">i</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> g_bounds1<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">/</span> <span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c6</span></span> <span class="keyword2"><span class="keyword">where</span></span> c6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span> <span class="main">*</span> f_approx <span class="bound">x</span><span class="main">)</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="skolem">c6</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">/</span> <span class="skolem">c3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c6</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_bounded_above<span class="main">)</span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> akra_bazzi_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> c6<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asymptotics4 base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span> <span class="main">*</span> f_approx <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c6 f_approx_nonneg base x0_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">hs</span><span class="main">!</span><span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">+</span><span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">+</span><span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ln <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> rec <span class="keyword2"><span class="keyword">and</span></span> x0_le_x1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x0_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> c6 c3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c6</span> <span class="main">*</span> <span class="skolem">c3</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="bound">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?sum</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> f_rec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> rec.hyps x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="var">?a</span> <span class="bound">i</span><span class="main">*</span><span class="var">?b</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c3</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?sum'</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f_approx_aux x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> int_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> l_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="free">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asymptotics3<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rec.IH<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_ge_0 i
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l'</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i rec.hyps c6 a_ge_0
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono asymptotics2' mult_nonneg_nonneg int_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int1</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">hs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x0_hb_bound7<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?int1</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?int</span> <span class="main">-</span> <span class="var">?int2</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eq_diff_eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> integral_combine akra_bazzi_integrable<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> rec.hyps step_le_x<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rec.hyps i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> g_approx <span class="skolem">i</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> c3<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?int2</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">c3</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_approx_def <span class="keyword1"><span class="command">using</span></span> x_pos
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="var">?int</span> <span class="main">-</span> <span class="var">?int2</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
             <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c3</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> i c6 a_ge_0 l_le_1
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono mult_nonneg_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="skolem">i</span><span class="main">*</span><span class="var">?b</span> <span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c3</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span> x x0_pos i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="var">?b</span> <span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="var">?h</span> <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?sum'</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?int</span> <span class="main">-</span> <span class="skolem">c3</span><span class="main">*</span><span class="free">g</span> <span class="skolem">x</span><span class="main">/</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> p_props<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="skolem">c3</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_approx_def <span class="keyword1"><span class="command">using</span></span> x_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
       <span class="keyword1"><span class="command">from</span></span> c6 c3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c6</span><span class="main">*</span><span class="skolem">c3</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asymptotics4<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c6</span><span class="main">*</span><span class="skolem">c3</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command">with</span></span> x x_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="skolem">c3</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg g_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c6</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">c6</span><span class="main">*</span><span class="skolem">c3</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">≤</span>
                  <span class="skolem">c6</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x c6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono mult_right_mono f_approx_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c6</span> <span class="main">*</span> f_approx <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> c6<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_bigo<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_approx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> akra_bazzi_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> landau_o.bigI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_nonneg f_approx_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Akra_Bazzi">
<div class="head">
<h1>Theory Akra_Bazzi</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Akra_Bazzi.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  The Akra-Bazzi theorem for functions on the naturals.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The discrete Akra-Bazzi theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <a href="Akra_Bazzi_Real.html">Akra_Bazzi_Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> x_over_ln_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> exp <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">/</span> ln <span class="free">y</span> <span class="keyword1">powr</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_nonneg_imp_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">/</span></span> ln <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">e</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> exp <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> t <span class="keyword1"><span class="command">have</span></span> t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&gt;</span> exp <span class="free">e</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> exp <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> t' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">t</span> <span class="main">&gt;</span> ln <span class="main">(</span>exp <span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_less_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> t''<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="skolem">t</span> <span class="main">&gt;</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> 
            <span class="main">(</span>ln <span class="skolem">t</span> <span class="main">-</span> <span class="free">e</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">e</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms t t' t''
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_add<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> t'' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ln <span class="skolem">t</span> <span class="main">-</span> <span class="free">e</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_nonneg_nonneg<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">akra_bazzi_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_term</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">e</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">x</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">h</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_termI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">t</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="free">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_imp_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_imp_less'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Suc <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">b</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_recursion <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">as</span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> k_not_0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_as<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_bs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     length_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     a_ge_0<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     b_bounds<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ts<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span> <span class="main">⟹</span> akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_params <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_as length_bs k_not_0 a_ge_0 b_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_ts k_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">e_hs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">×</span> <span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">e_hs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">hs</span><span class="main">)</span><span class="main">.</span> 
     <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> length <span class="bound">hs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set <span class="bound">hs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="free">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
     <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="bound">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
   <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> e_hs <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> e_hs <span class="keyword1">of</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="bound">hs</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">hs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_powr_zero_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> at_top <span class="main">=</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span> at_top"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>
  

<span class="keyword1"><span class="command">lemma</span></span> e_hs_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> e <span class="main">∧</span> length hs <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs<span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="free">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ex <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">hs</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> length <span class="bound">hs</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set <span class="bound">hs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="free">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="bound">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ts <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_bs<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="bound">e</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">e</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> <span class="bound">h</span> <span class="bound">i</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_term_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> bchoice_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> bchoice_iff<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> ee <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hh <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> eh <span class="main">=</span> this
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Min <span class="main">{</span><span class="skolem">ee</span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">=</span> map <span class="skolem">hh</span> <span class="main">(</span>upt <span class="main">0</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> e_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">using</span></span> eh k_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Min_gr_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">hs</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> hs_growth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set <span class="skolem">hs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set <span class="skolem">hs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="skolem">hh</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">ee</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eh <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> t k_not_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≤</span> <span class="skolem">ee</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Min_le_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">ee</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigo_real_nat_transfer<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>set <span class="free">ts</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="free">ts</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_ts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> in_set_conv_nth<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> eh <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">hs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> eh <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">hs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> length_ts <span class="keyword1"><span class="command">unfolding</span></span> hs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> e_hs_def<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> e_def hs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  e_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"e <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> length_hs<span class="main">:</span> <span class="quoted"><span class="quoted">"length hs <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  hs_growth<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> set hs <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  step_ge_x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">t</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  step_less<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  decomp<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> e_hs_aux<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> h_in_hs <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> hs <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set hs"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_hs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> t_in_ts <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">ts</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x0_less_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0_le_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ts_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> hd <span class="free">ts</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step_ge_x0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="free">ts</span>"</span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ts_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> step_less<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base rec<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">t</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms step_less step_ge_x0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_function <span class="main">=</span> akra_bazzi_recursion <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">integrable</span> <span class="free">integral</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> integral<span class="main">:</span> <span class="quoted"><span class="quoted">"akra_bazzi_integral <span class="free">integrable</span> <span class="free">integral</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_nonneg_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     f_rec<span class="main">:</span>         <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_nonneg<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ex_pos_a<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex_pos_a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_pos_a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth length_as<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_params_nonzero
  <span class="keyword1"><span class="command">using</span></span> length_as length_bs ex_pos_a a_ge_0 b_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">g_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g_real</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⌋</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> g_real_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"g_real <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> akra_bazzi_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> f_nonneg_base <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rec <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rec.hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_nonneg<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rec.hyps length_ts length_as
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_nonneg ballI mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_ge_0 rec.IH<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rec.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_rec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">hs'</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">h</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">::</span>real<span class="main">⌋</span><span class="main">)</span><span class="main">)</span> hs"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_hs'<span class="main">:</span> <span class="quoted"><span class="quoted">"length hs' <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_hs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hs'_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span>hs'<span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>hs<span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_hs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> h_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">hb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">hb</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs<span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set hs"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hs_growth<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">c</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> bigo_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> bchoice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hb</span></span> <span class="keyword2"><span class="keyword">where</span></span> hb<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs<span class="main">.</span> <span class="skolem">hb</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="bound">h</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hb'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb'</span> <span class="main">=</span> max <span class="main">1</span> <span class="main">(</span>Max <span class="main">{</span><span class="skolem">hb</span> <span class="bound">h</span> <span class="main">|</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> set hs<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hb'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs<span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb'</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eventually_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> always_eventually eventually_conj<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> set hs"</span></span>
    <span class="keyword1"><span class="command">with</span></span> hb <span class="keyword1"><span class="command">have</span></span> hb_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_gt_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h hb <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span> <span class="main">::</span> real<span class="main">⌋</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> 
        <span class="skolem">hb</span> <span class="skolem">h</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_natfloor<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span> <span class="main">::</span> real<span class="main">⌋</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb'</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e eventually_gt_at_top
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>      
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
 
      <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ x<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="skolem">h</span><span class="main">*</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">/</span>ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span> <span class="main">&lt;</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ x<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">/</span>ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">/</span>ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> x_over_ln_mono<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> hb_pos mult_left_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="skolem">h</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="skolem">h</span> <span class="main">*</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">/</span>ln <span class="main">(</span>real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">hb'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> hb'_def f_rec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Max.coboundedI max.cobounded2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="skolem">h</span><span class="main">*</span><span class="skolem">x</span><span class="main">/</span>ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">≤</span> <span class="skolem">hb'</span><span class="main">*</span><span class="skolem">x</span><span class="main">/</span>ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono divide_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">h</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb'</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb'</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hs'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb'</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> C_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">&lt;</span> <span class="bound">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="free">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> e_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr ln_at_top<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tendsto_iff dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="main">¦</span><span class="free">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> eventually_conj<span class="main">[</span><span class="operator">OF</span> this eventually_gt_at_top<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="main">¦</span><span class="free">hb</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">-</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> b A assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hb</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">-</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">hb</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">*</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">*</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">hb</span><span class="main">*</span><span class="skolem">x</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_lower <span class="main">=</span> akra_bazzi_function <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">g'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_pos<span class="main">:</span>      <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span> 
                           eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≤</span> <span class="bound">c2</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g'_integrable<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="bound">a</span><span class="main">.</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g'_bounded<span class="main">:</span>  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_bigomega<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g'_nonneg<span class="main">:</span>  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gc2</span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">gc2</span><span class="main">.</span> <span class="bound">gc2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">gc2</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gc2<span class="main">:</span> <span class="quoted"><span class="quoted">"gc2 <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g_bigomega <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_omega.bigE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> g'_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_nat_real<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> g_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gc2</span><span class="main">.</span> <span class="bound">gc2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">gc2</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gc2 <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gc2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gx0</span> <span class="main">≡</span> max <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">gx0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx0</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gx1</span> <span class="main">≡</span> max gx0 <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">gx1</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx1</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> gx0<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gx0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> gx0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> gc2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eventually_conj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f_pos eventually_nat_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g'_nonneg<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gx0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx0</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">gx0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx0</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span><span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> gx0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gx1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> gx1"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> gx0"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mb</span> <span class="main">=</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> mb_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h_bound <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> hb <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> hb <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> e_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr ln_at_top<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> mb_pos
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">hb</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">mb</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> hb<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> eventually_nat_real<span class="main">[</span><span class="operator">OF</span> hb<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> eventually_nat_real<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
       eventually_ge_at_top eventually_ge_at_top
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> gx0<span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">mb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> B'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>hs'<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_hs'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> nat <span class="main">⌈</span>gx0<span class="main">/</span><span class="skolem">mb</span><span class="main">⌉</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"real gx0<span class="main">/</span><span class="skolem">mb</span> <span class="main">≤</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      
    <span class="keyword1"><span class="command">from</span></span> mb_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real gx0 <span class="main">=</span> <span class="skolem">mb</span> <span class="main">*</span> <span class="main">(</span>real gx0<span class="main">/</span><span class="skolem">mb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i bs_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mb</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mb</span> <span class="main">*</span> <span class="main">(</span>real gx0<span class="main">/</span><span class="skolem">mb</span><span class="main">)</span> <span class="main">≤</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C' i b_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span>"</span></span><span class="main">]</span> mb_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i B' length_hs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hs'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">≤</span> <span class="skolem">mb</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> powr_minus<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">mb</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hb</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span> <span class="main">≤</span> <span class="skolem">mb</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i D decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≥</span> gx0"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gx1</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx1</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> gx0 <span class="main">≤</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Ex <span class="var">?P</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> gx1 <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> gx1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gx0_ge_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"gx0 <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> gx0_le_gx1<span class="main">:</span> <span class="quoted"><span class="quoted">"gx0 <span class="main">≤</span> gx1"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">f2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> gx1 <span class="main">⟹</span> <span class="free">f2'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> max <span class="main">0</span> <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> gc2<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> gx1 <span class="main">⟹</span> <span class="free">f2'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="free">f2'</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> le_less_linear <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span> 
               <span class="main">(</span><span class="operator">insert</span> gx0_le_gx1 gx0_ge_x1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_less<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f2'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> gx0 <span class="main">⟹</span> f2' <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> f2'.induct<span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_nonneg_nonneg sum_nonneg gx0 gx1  mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_ge_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
               
<span class="keyword1"><span class="command">lemma</span></span> f2'_le_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> gc2 <span class="main">*</span> f2' <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> f2'.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gc2 f_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gx0 gx0_le_gx1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gc2 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step_ge_x0 prems<span class="main">(</span>1<span class="main">)</span> gx0_ge_x1 gx0_le_gx1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>gc2 <span class="main">*</span> f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono a_ge_0 prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gc2 <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>1<span class="main">)</span> gx0_ge_x1 gx0_le_gx1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> f_rec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f2'_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> f2' <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> gx0"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"f2' <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> f2'.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> gc2 gx0<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_pos'<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ex_pos_a' <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> i <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>1<span class="main">)</span> gx0 gx1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_pos_pos prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> gx1<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_ge_0<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>1<span class="main">)</span> gx0_le_gx1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_nonneg_pos gx0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> bigomega_f_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a'</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="main">ℕ</span> <span class="main">⟶</span> 
    <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">a'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g'_integrable <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> a0 <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> h_bound <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> hb <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> hb <span class="main">=</span> this
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g_growth2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C c2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hb<span class="main">(</span>1<span class="main">)</span> bs_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> C_bound<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> b_bounds hb<span class="main">(</span>1<span class="main">)</span> e_pos 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> g'_bounded C<span class="main">(</span>3<span class="main">)</span> g'_nonneg eventually_natfloor<span class="main">[</span><span class="operator">OF</span> f2'_pos<span class="main">]</span> eventually_natfloor<span class="main">[</span><span class="operator">OF</span> gc2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> f2' <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                        f2' <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_at_top_linorder<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> ex_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> X <span class="main">=</span> this

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span> <span class="main">=</span> max <span class="free">A</span> <span class="main">(</span>max <span class="skolem">X</span> <span class="main">(</span>max <span class="skolem">a0</span> <span class="main">(</span>max gx1 <span class="main">(</span>max <span class="main">1</span> <span class="main">(</span>real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x0'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x0'_ge_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> real <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">X</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x0'_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  x0'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> x0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> f2' <span class="main">(</span>nat <span class="main">⌊</span><span class="bound">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X x0'_ge_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_props<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x0'_int<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_natfloor_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_props <span class="keyword1"><span class="command">have</span></span> x0'_ge_gx1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> gx1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">a0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> gx0_le_gx1 <span class="keyword1"><span class="command">have</span></span> f2'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">⟹</span> f2' <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> f2'_nonneg<span class="main">)</span>
           
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">=</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="skolem">bm</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fb2</span> <span class="main">=</span> Min <span class="main">{</span>f2' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gb2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gb2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> inverse <span class="skolem">bm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mult_strict_left_mono<span class="main">[</span><span class="operator">OF</span> this x0'_pos<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> x0'_lt_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">&lt;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_le_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> 
    
  <span class="keyword1"><span class="command">from</span></span> x0_le_x1 x0'_ge_x1 <span class="keyword1"><span class="command">have</span></span> ge_x0'D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> real <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_ge_x1 x0'_le_x1' <span class="keyword1"><span class="command">have</span></span> gt_x1'D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">&lt;</span> real <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">have</span></span> x0'_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="bound">b</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bm_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> b bs_nonempty b_bounds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">b</span> <span class="main">≤</span> inverse <span class="skolem">bm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x0'_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">note</span></span> f_nonneg' <span class="main">=</span> f_nonneg
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">..</span>nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⌉</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>f2' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">note</span></span> facts <span class="main">=</span> hs'_real e_pos length_hs' length_as length_bs k_not_0 a_ge_0 p_props x0'_ge_1
               f2'_nonneg f_rec<span class="main">[</span><span class="operator">OF</span> gt_x1'D<span class="main">]</span> x0' x0'_int x0'_x1' gc2<span class="main">(</span>1<span class="main">)</span> decomp
  <span class="keyword1"><span class="command">from</span></span> b_bounds x0'_le_x1' x0'_ge_gx1 gx0_le_gx1 x0'_ge_x1
    <span class="keyword1"><span class="command">interpret</span></span> abr<span class="main">:</span> akra_bazzi_nat_to_real <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted">hs'</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="skolem">hb</span></span> <span class="quoted">e</span> <span class="quoted">p</span> <span class="quoted">f2'</span> <span class="quoted"><span class="free">g'</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> facts <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f2'.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> f2'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> f'_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> abr.f' <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> f2' <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">(</span>real <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> f2' <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> abr.f'.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> IH <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g'</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gt_x1'D hs'_real g_real_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> i x x0'_le_x1' x0'_ge_x1 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> decomp<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">...</span> <span class="main">=</span> f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hs'_real<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>real <span class="skolem">x</span><span class="main">+</span><span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>f2' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">...</span> <span class="main">=</span> f2' <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x x0'_ge_gx1 x0'_le_x1' 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f2'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> gt_x1'D<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_integral <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral<span class="main">)</span> 
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_real_lower <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted">hs'</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="skolem">hb</span></span> <span class="quoted">e</span> <span class="quoted">p</span> 
      <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="quoted">abr.f'</span> <span class="quoted"><span class="free">g'</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">fb2</span></span> <span class="quoted"><span class="skolem">gb2</span></span> <span class="quoted"><span class="skolem">c2</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abr.f'_base<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_subinterval<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a0</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> a0 x0'_ge_a0 x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x0'_int<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nat_mono floor_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x x0'_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f2' <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>f2' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f2' <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">fb2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fb2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Min_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">fb2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> x0'_int x0'_le_x1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">∧</span> real <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"nat <span class="main"><span class="main"><span class="main">⌊</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span></span></span><span class="main"><span class="main"><span class="main">⌋</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">∧</span> real <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> x0'<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f2' <span class="main">(</span>nat <span class="main">⌊</span>real <span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"f2' <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fb2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fb2_def <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Min_gr_iff<span class="main">)</span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x0'<span class="main">(</span>4<span class="main">)</span> x0'_lt_x1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">gb2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gb2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> g_nonneg integral x0'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> C x0'_le_x1' x0'_ge_x1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> facts<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> akra_bazzi_lower <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c5 <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> c5 <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≥</span> gc2 <span class="main">*</span> <span class="skolem">c5</span> <span class="main">*</span> <span class="main">¦</span>f_approx <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌉</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">note</span></span> c5<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> f2' <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f'_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gc2 <span class="main">*</span> <span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x x0'_ge_x1 x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f2'_le_f<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x f_nonneg' x0'_ge_x1 x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gc2 <span class="main">*</span> <span class="skolem">c5</span> <span class="main">*</span> <span class="main">¦</span>f_approx <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> gc2 f_approx_nonneg<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> f_approx <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gc2<span class="main">(</span>1<span class="main">)</span> f_nonneg' f_approx_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_omega.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"gc2 <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">c5</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> eventually_conj 
        mult_pos_pos c5 eventually_nat_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">unfolded</span> f_approx_def<span class="main">]</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def gx0_ge_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigomega_f<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p<span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bigomega_f_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> real <span class="main">(</span>max <span class="main">(</span>nat <span class="main">⌈</span><span class="skolem">a</span><span class="main">⌉</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> a
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def a'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≥</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">locale</span></span> akra_bazzi_upper <span class="main">=</span> akra_bazzi_function <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">g'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g'_integrable<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="bound">a</span><span class="main">.</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c1</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span> 
                          eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≥</span> <span class="bound">c1</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_bigo<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gc1</span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">gc1</span><span class="main">.</span> <span class="bound">gc1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">gc1</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gc1<span class="main">:</span> <span class="quoted"><span class="quoted">"gc1 <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g_bigo <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> g'_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_nat_real<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> g_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gc1</span><span class="main">.</span> <span class="bound">gc1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">gc1</span> <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gc1 <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gc1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gx3</span> <span class="main">≡</span> max <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">gx0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx0</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gx3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> gx3"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> gc1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gx3</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx3</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">gx0</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">gx0</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> gx3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gx3_ge_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"gx3 <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gx3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> gx3 <span class="main">⟹</span> <span class="free">f'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> max <span class="main">0</span> <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> gc1<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> gx3 <span class="main">⟹</span> <span class="free">f'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">g'</span> <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="free">f'</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> le_less_linear <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span> 
               <span class="main">(</span><span class="operator">insert</span> gx3_ge_x1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_less<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f'_ge_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> gc1 <span class="main">*</span> f' <span class="free">x</span> <span class="main">≥</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> f'.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gc1 f_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> gx3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gc1 <span class="main">*</span> <span class="free">g'</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> step_ge_x0 prems<span class="main">(</span>1<span class="main">)</span> gx3_ge_x1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> nat <span class="main">⌊</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> le_nat_floor<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>gc1 <span class="main">*</span> f' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono a_ge_0 prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gc1 <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>f' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_distrib_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>1<span class="main">)</span> gx3_ge_x1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> f_rec<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_f_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">a'</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="main">ℕ</span> <span class="main">⟶</span> 
    <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">a'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> g'_integrable <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> a0 <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> h_bound <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> hb <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> hb <span class="main">=</span> this
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g_growth1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C c1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> e<span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hb<span class="main">(</span>1<span class="main">)</span> bs_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> C_bound<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> b_bounds hb<span class="main">(</span>1<span class="main">)</span> e_pos 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_asymptotics<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> gc1<span class="main">(</span>2<span class="main">)</span> C<span class="main">(</span>3<span class="main">)</span> g'_nonneg
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≥</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≥</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_at_top_linorder<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> X <span class="main">=</span> this
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span> <span class="main">=</span> max <span class="free">A</span> <span class="main">(</span>max <span class="skolem">X</span> <span class="main">(</span>max <span class="main">1</span> <span class="main">(</span>max <span class="skolem">a0</span> <span class="main">(</span>max gx3 <span class="main">(</span>real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x0'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x0'_ge_x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> real <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">X</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x0'_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  x0'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> x0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">h</span><span class="main">∈</span>set hs'<span class="main">.</span> <span class="main">¦</span><span class="bound">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">hb</span><span class="main">*</span><span class="bound">x</span><span class="main">/</span>ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>e<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> akra_bazzi_asymptotics <span class="bound">b</span> <span class="skolem">hb</span> e p <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≥</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> X x0'_ge_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_props<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x0'_int<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_natfloor_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_props <span class="keyword1"><span class="command">have</span></span> x0'_ge_gx0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> gx3"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_ge_a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≥</span> <span class="skolem">a0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> f'_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">⟹</span> f' <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.trans<span class="main">[</span><span class="operator">OF</span> f_nonneg f'_ge_f<span class="main">]</span> gc1<span class="main">(</span>1<span class="main">)</span> x0'_ge_x1 x0_le_x1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f'.simps<span class="main">)</span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">=</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="skolem">bm</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fb1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fb1</span> <span class="main">=</span> Max <span class="main">{</span>f' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> inverse <span class="skolem">bm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mult_strict_left_mono<span class="main">[</span><span class="operator">OF</span> this x0'_pos<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> x0'_lt_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">&lt;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0'_le_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> 
    
  <span class="keyword1"><span class="command">from</span></span> x0_le_x1 x0'_ge_x1 <span class="keyword1"><span class="command">have</span></span> ge_x0'D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> real <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x0'_ge_x1 x0'_le_x1' <span class="keyword1"><span class="command">have</span></span> gt_x1'D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">&lt;</span> real <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">have</span></span> x0'_x1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="bound">b</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bm_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> b b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bm</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">b</span> <span class="main">≤</span> inverse <span class="skolem">bm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x0'_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">*</span> inverse <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">note</span></span> f_nonneg' <span class="main">=</span> f_nonneg
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≥</span> nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">..</span>nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⌉</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>f' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">note</span></span> facts <span class="main">=</span> hs'_real e_pos length_hs' length_as length_bs k_not_0 a_ge_0 p_props x0'_ge_1
               f'_nonneg f_rec<span class="main">[</span><span class="operator">OF</span> gt_x1'D<span class="main">]</span> x0' x0'_int x0'_x1' gc1<span class="main">(</span>1<span class="main">)</span> decomp
  <span class="keyword1"><span class="command">from</span></span> b_bounds x0'_le_x1' x0'_ge_gx0 x0'_ge_x1 
  <span class="keyword1"><span class="command">interpret</span></span> abr<span class="main">:</span> akra_bazzi_nat_to_real <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted">hs'</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="skolem">hb</span></span> <span class="quoted">e</span> <span class="quoted">p</span> <span class="quoted">f'</span> <span class="quoted"><span class="free">g'</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> facts <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> f'.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> f'.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> f'_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> abr.f' <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> f' <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">(</span>real <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> f' <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> abr.f'.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> IH <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g'</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gt_x1'D hs'_real <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span><span class="main">*</span>f' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> i x x0'_le_x1' x0'_ge_x1 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> real <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> decomp<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="main">...</span> <span class="main">=</span> f' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hs'_real<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>abr.f' <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>real <span class="skolem">x</span><span class="main">+</span><span class="main">(</span>hs<span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span><span class="main">*</span>f' <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">...</span> <span class="main">=</span> f' <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x0'_le_x1' x0'_ge_gx0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_integral <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_real_upper <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted">hs'</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quoted"><span class="skolem">hb</span></span> <span class="quoted">e</span> <span class="quoted">p</span> <span class="quoted"><span class="free">integrable</span></span> <span class="quoted"><span class="free">integral</span></span> <span class="quoted">abr.f'</span> <span class="quoted"><span class="free">g'</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">fb1</span></span> <span class="quoted"><span class="skolem">c1</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abr.f'_base<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_subinterval<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a0</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> a0 x0'_ge_a0 x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x0'_int<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nat_mono floor_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x x0'_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f' <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span>f' <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">..</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f' <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">fb1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fb1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abr.f' <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">fb1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> x0'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x0'_le_x1' x0'_ge_x1 C<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> facts<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> akra_bazzi_upper <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c6 <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> c6 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌉</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> gc1 <span class="main">*</span> f' <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x x0'_ge_x1 x0_le_x1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> f'_ge_f<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f' <span class="skolem">x</span> <span class="main">=</span> abr.f' <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f'_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> c6<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> f_nonneg' x x0'_ge_x1 x0_le_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> f_approx_nonneg x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"f_approx <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span>f_approx <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gc1 <span class="main">*</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">¦</span>f_approx <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gc1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> gc1 <span class="main">*</span> <span class="skolem">c6</span> <span class="main">*</span> <span class="main">¦</span>f_approx <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">⌉</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> f_approx <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gc1<span class="main">(</span>1<span class="main">)</span> f_nonneg' f_approx_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.bigI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"gc1 <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">c6</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> eventually_conj 
        mult_pos_pos c6 eventually_nat_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">unfolded</span> f_approx_def<span class="main">]</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>0</sub>'_min</span> <span class="main">≥</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>0</sub>'_min_def gx3_ge_x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_f<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bigo_f_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> real <span class="main">(</span>max <span class="main">(</span>nat <span class="main">⌈</span><span class="skolem">a</span><span class="main">⌉</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> a
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def a'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≥</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> akra_bazzi <span class="main">=</span> akra_bazzi_function <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>   <span class="free">g'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_pos<span class="main">:</span>         <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g'_nonneg<span class="main">:</span>     <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g'_integrable<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="bound">a</span><span class="main">.</span> <span class="free">integrable</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c1</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span> 
                           eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≥</span> <span class="bound">c1</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_growth2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span> 
                           eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">≤</span> <span class="bound">c2</span> <span class="main">*</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_bounded<span class="main">:</span>  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="free">g'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_lower <span class="keyword1"><span class="command">using</span></span> f_pos g_growth2 g_bounded 
  bigthetaD2<span class="main">[</span><span class="operator">OF</span> g_bigtheta<span class="main">]</span> g'_nonneg g'_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> 
<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_upper <span class="keyword1"><span class="command">using</span></span> g_growth1 bigthetaD1<span class="main">[</span><span class="operator">OF</span> g_bigtheta<span class="main">]</span> 
  g'_nonneg g'_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_f<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bigo_f_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> bigomega_f_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> b <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> b <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>max <span class="main">(</span>max <span class="main">(</span>nat <span class="main">⌈</span><span class="skolem">a</span><span class="main">⌉</span><span class="main">)</span> <span class="main">(</span>nat <span class="main">⌈</span><span class="skolem">b</span><span class="main">⌉</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> <span class="main">ℕ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≥</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≥</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">integral</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">u</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="var">?a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&gt;</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?a</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">named_theorems</span></span> akra_bazzi_term_intros <span class="quoted">"introduction rules for Akra-Bazzi terms"</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_floor_add <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_termI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_less_one<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> step_ge_x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≥</span> real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> le_nat_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_floor_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms step_ge_x0 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_less_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floor_less_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> step_ge_x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">⌊</span><span class="free">c</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">=</span> real_of_int <span class="main">(</span>nat <span class="main">⌊</span><span class="free">c</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          real <span class="main">(</span>nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real_of_int <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big_mono always_eventually allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> real_norm_def<span class="main">)</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>nat<span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real_of_int <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> 
                    <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_floor_add' <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> real <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_term_floor_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">...</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_add_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌋</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_floor_subtract <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> diff_conv_add_uminus<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> akra_bazzi_term_floor_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_floor_subtract' <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> real <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> real <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌋</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> akra_bazzi_term_floor_subtract<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">-</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">...</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌋</span> <span class="main">=</span> nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌋</span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_floor <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌊</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms akra_bazzi_term_floor_add<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_ceiling_add <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_termI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_less_one<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">≤</span> real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bx_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bx_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_less_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ceiling_less_iff<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> real_of_int <span class="main">⌈</span><span class="main">...</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ceiling_mono<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bx_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big_mono always_eventually allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> real_norm_def<span class="main">)</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>nat<span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> 
                    <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_ceiling_add' <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> real <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">c</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌉</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_term_ceiling_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌉</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> 
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">≤</span> real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bx_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">+</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms bx_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">...</span> <span class="main">=</span> nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nat_add_distrib<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">+</span> real <span class="free">c</span><span class="main">⌉</span> <span class="main">=</span> nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_ceiling_subtract <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> diff_conv_add_uminus<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> akra_bazzi_term_ceiling_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_ceiling_subtract' <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> real <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real <span class="free">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌉</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> akra_bazzi_term_ceiling_subtract<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌉</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> 
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">≤</span> real_of_int <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> bx_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌉</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">-</span> int <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms bx_nonneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">...</span> <span class="main">=</span> nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span> <span class="main">-</span> real <span class="free">c</span><span class="main">⌉</span> <span class="main">=</span> nat <span class="main">⌈</span><span class="free">b</span> <span class="main">*</span> real <span class="skolem">x</span><span class="main">⌉</span> <span class="main">-</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_ceiling <span class="main">[</span><span class="operator">akra_bazzi_term_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> real <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> nat <span class="main">⌈</span><span class="free">b</span><span class="main">*</span>real <span class="bound">x</span><span class="main">⌉</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms akra_bazzi_term_ceiling_add<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Master_Theorem">
<div class="head">
<h1>Theory Master_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Master_Theorem.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  The Master theorem in a generalised form as derived from the Akra-Bazzi theorem.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Master theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Master_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Equivalence_Lebesgue_Henstock_Integration.html">HOL-Analysis.Equivalence_Lebesgue_Henstock_Integration</a>"</span>
  <a href="Akra_Bazzi_Library.html">Akra_Bazzi_Library</a>
  <a href="Akra_Bazzi.html">Akra_Bazzi</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fundamental_theorem_of_calculus_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_real_derivative</span> <span class="free">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus ballI<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_powr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span>
     inverse <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> right_diff_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> integral_unique fundamental_theorem_of_calculus_real<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_ln_powr_over_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span>
     inverse <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> right_diff_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> integral_unique fundamental_theorem_of_calculus_real<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> integral_one_over_x_ln_x<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>ln <span class="free">b</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_unique fundamental_theorem_of_calculus_real<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_integral_kurzweil_henstock<span class="main">:</span>
  <span class="quoted"><span class="quoted">"akra_bazzi_integral <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_const_ivl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> integrable_subinterval_real<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integral_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_combine<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">locale</span></span> master_theorem_function <span class="main">=</span> akra_bazzi_recursion <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_nonneg_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     f_rec<span class="main">:</span>         <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     g_nonneg<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ex_pos_a<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> akra_bazzi_integral <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> akra_bazzi_integral_kurzweil_henstock<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> akra_bazzi_function <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_nonneg_base f_rec g_nonneg ex_pos_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_nonneg'<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> g_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> landau_omega.bigE_nonneg_real<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> g_nonneg'<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> c<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_pos_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> f_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> g_pos<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> f_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> step_ge_x0<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_pos_nonneg sum_nonneg mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a_ge_0<span class="main"><span class="main">]</span></span> f_nonneg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bs_lower_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">C</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> b_pos <span class="keyword3"><span class="command">show</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_growth2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c2</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">c2</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span>
      eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">c2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≥</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI allI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span>
    max <span class="main">(</span><span class="main">(</span>Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≥</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span>  <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> max <span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_pos x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> u x C_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">*</span> max <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> max_mult_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> max <span class="main">(</span><span class="main">(</span>Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_growth1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">c1</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span>
      eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI allI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> C_pos <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span>
          min <span class="main">(</span><span class="main">(</span>Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span>  <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> u x C_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">*</span> min <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> min <span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> min_mult_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≥</span> min <span class="main">(</span><span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_pos x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_lower_bound mult_pos_pos<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≥</span> min <span class="main">(</span><span class="main">(</span>Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_ln_powr_lower_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span>
     min <span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">*</span> min <span class="main">(</span>ln <span class="free">a</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span>ln <span class="free">b</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono powr_lower_bound<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> min.coboundedI1<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_ln_powr_upper_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span>
     max <span class="main">(</span><span class="free">a</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">powr</span> p<span class="main">)</span> <span class="main">*</span> max <span class="main">(</span>ln <span class="free">a</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">(</span>ln <span class="free">b</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">≥</span> <span class="free">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono powr_upper_bound<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> max.coboundedI1<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_ln_powr_upper_bound'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_dense<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_ln_powr_upper_bound<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_upper_bound'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">&gt;</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_dense<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_upper_bound<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> bounds <span class="main">=</span>
  powr_ln_powr_lower_bound powr_ln_powr_upper_bound powr_ln_powr_upper_bound' powr_upper_bound'


<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> eventually_ln_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">C</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tendstoD<span class="main">[</span><span class="operator">OF</span> tendsto_ln_over_ln<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span><span class="free">C</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_ln_powr_growth1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">c1</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span>
  eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="var">?C</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> min <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> C_pos <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bs_nonempty b_bounds <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?T</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="var">?f</span> <span class="bound">u</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span>inverse <span class="skolem">C</span><span class="main">)</span>"</span></span><span class="main">]</span> eventually_ln_const<span class="main">[</span><span class="operator">OF</span> C_pos<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> max <span class="main">1</span> <span class="main">(</span>inverse <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> C_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x u C_pos <span class="keyword1"><span class="command">have</span></span> u'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">u</span><span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x u u' C_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_lower_bound<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">note</span></span> A
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> C_pos x' u u' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> x' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">≤</span> ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x u u' C_pos A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_lower_bound<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">u</span><span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x u u' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">u</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?f</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_ln_powr_growth2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">c1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">c1</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span>
  eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="bound">C</span> <span class="main">*</span> <span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">≥</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r'</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="var">?C</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> max <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> b_bounds bs_nonempty <span class="keyword1"><span class="command">have</span></span> C_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> Min <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?T</span> <span class="main">*</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="var">?f</span> <span class="bound">u</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">1</span> <span class="main">(</span>inverse <span class="skolem">C</span><span class="main">)</span>"</span></span><span class="main">]</span> eventually_ln_const<span class="main">[</span><span class="operator">OF</span> C_pos<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> max <span class="main">1</span> <span class="main">(</span>inverse <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> C_pos <span class="keyword1"><span class="command">have</span></span> x_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x u C_pos <span class="keyword1"><span class="command">have</span></span> u'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> x u u' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">u</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">u</span><span class="main">/</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">≤</span> max <span class="main">(</span><span class="skolem">C</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x u u' C_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">note</span></span> A
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> C_pos x' u u' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ln <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> x' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">C</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="skolem">x</span> <span class="main">≤</span> ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span> <span class="main">≤</span> max <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">powr</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x u u' C_pos A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_upper_bound<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">u</span> <span class="main">/</span> ln <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">r'</span> <span class="main">≤</span> <span class="var">?T</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?T</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="var">?f</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> growths <span class="main">=</span> powr_growth1 powr_growth2 powr_ln_powr_growth1 powr_ln_powr_growth2


<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> master_integrable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">s</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">r</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> master_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">p</span> <span class="free">p'</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="free">p'</span> <span class="main">⟶</span> <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
             <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">d</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> inverse <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="free">p'</span> <span class="main">⟶</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e p a <span class="keyword1"><span class="command">unfolding</span></span> c_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bigtheta_real_nat_transfer<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Henstock_Kurzweil_Integration.integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p x0_less_x1 a x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">...</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">unfolding</span></span> c_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_diff e_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> master_integral'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">p</span> <span class="free">p'</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
       <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="free">d</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> ln <span class="free">a</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> inverse <span class="free">p'</span> <span class="main">*</span> <span class="skolem">e</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> inverse <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> landau_real_nat_transfer<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x a x0_less_x1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Henstock_Kurzweil_Integration.integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> inverse <span class="free">p'</span> <span class="main">*</span> <span class="main">(</span>ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">-</span> ln <span class="free">a</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p' x0_less_x1 a<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_ln_powr_over_x<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">...</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> c_def d_def e_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span>integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> master_integral''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">p</span> <span class="free">p'</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
           <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_real_nat_transfer<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
          <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> inverse <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> ln <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x a x0_less_x1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Henstock_Kurzweil_Integration.integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ln <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x0_less_x1 a<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_one_over_x_ln_x<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">...</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> ln <span class="main">(</span>ln <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
                <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> master1_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_upper <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms growths g_bigo master_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> less_p' <span class="keyword1"><span class="command">have</span></span> less_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&lt;</span> p"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> p_greaterI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bigo_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> a<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>1<span class="main">)</span> less_p x0_less_x1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"p <span class="main">≠</span> <span class="free">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> master_integral<span class="main">[</span><span class="operator">OF</span> this a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c d <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> cd <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> cd<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cd<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> less_p
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">d</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> master1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_pos<span class="main">:</span>  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi_lower <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> bs_lower_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> always_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bigomega_f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> master1_bigo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_bigo less_p'<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> master2_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bigthetaD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_bigtheta<span class="main"><span class="main">]</span></span> eventually_nat_real<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms growths bounds master_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> bigtheta_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> a<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>1<span class="main">)</span> p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> master_integral'<span class="main">[</span><span class="operator">OF</span> this a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">p</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c d <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> cd <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> cd<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">∈</span>
                 <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cd<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master2_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bigthetaD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_bigtheta<span class="main"><span class="main">]</span></span> eventually_nat_real<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms growths bounds master_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> bigtheta_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> a<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>1<span class="main">)</span> p' <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> integral <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">u</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">/</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span>p<span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
       <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> master_integral'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">p</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> p'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
                 <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cd<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master2_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">/</span> ln <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bigthetaD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_bigtheta<span class="main"><span class="main">]</span></span> eventually_nat_real<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g_bigtheta <span class="keyword1"><span class="command">have</span></span> g_bigtheta'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_theta.trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> landau_real_nat_transfer<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms growths bounds master_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> bigtheta_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> a<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> master_integral''<span class="main">[</span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p'_greater'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bigthetaD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g_bigtheta<span class="main"><span class="main">]</span></span> eventually_nat_real<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> akra_bazzi <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">f</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="bound">f</span>"</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms growths bounds master_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> p'_greater' <span class="keyword1"><span class="command">have</span></span> p'_greater<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&gt;</span> p"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> p_lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bigtheta_f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> a <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> a<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p'_greater <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"p <span class="main">≠</span> <span class="free">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> master_integral<span class="main">[</span><span class="operator">OF</span> this a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c d <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> cd <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> cd<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">d</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p'_greater cd<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eval_Numeral">
<div class="head">
<h1>Theory Eval_Numeral</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Eval_Numeral.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Evaluation of terms involving rational numerals with the simplifier.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Evaluating expressions with rational numerals›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Eval_Numeral
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_numeral_to_Ratreal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>numeral <span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span>numeral <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> numeral Num.One"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat_number_collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> real_equals_code<span class="main">:</span> <span class="quoted"><span class="quoted">"Ratreal <span class="free">x</span> <span class="main">=</span> Ratreal <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Rat_normalize_idempotent<span class="main">:</span> <span class="quoted"><span class="quoted">"Rat.normalize <span class="main">(</span>Rat.normalize <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Rat.normalize <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Rat.normalize <span class="free">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Rat.normalize_stable<span class="main">[</span><span class="operator">OF</span> normalize_denom_pos normalize_coprime<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_pow_Numeral1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>monoid_mult<span class="main">)</span><span class="main">)</span> <span class="main">^</span> Numeral1 <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> power_numeral_simps <span class="main">=</span> power_0 uminus_pow_Numeral1 power_minus_Bit0 power_minus_Bit1

<span class="keyword1"><span class="command">lemma</span></span> Fract_normalize<span class="main">:</span> <span class="quoted"><span class="quoted">"Fract <span class="main">(</span>fst <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Fract <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotient_of_inject<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_of_Fract Rat_normalize_idempotent<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_add<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">+</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
                   Frct <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">a</span> <span class="main">*</span> numeral <span class="free">d</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> numeral <span class="free">b</span><span class="main">,</span> numeral <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rat_number_collapse Fract_normalize<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Frct_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Frct <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">-</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
                    Frct <span class="main">(</span>Rat.normalize <span class="main">(</span><span class="free">a</span> <span class="main">*</span> numeral <span class="free">d</span> <span class="main">-</span> <span class="free">c</span> <span class="main">*</span> numeral <span class="free">b</span><span class="main">,</span> numeral <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rat_number_collapse Fract_normalize<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">*</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Frct <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">,</span> numeral <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Frct <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_divide<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">/</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">=</span> Frct <span class="main">(</span><span class="free">a</span><span class="main">*</span>numeral <span class="free">d</span><span class="main">,</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">^</span> <span class="free">c</span> <span class="main">=</span> Frct <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">c</span><span class="main">,</span> numeral <span class="free">b</span> <span class="main">^</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat_number_collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_less<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> numeral <span class="free">d</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">*</span> numeral <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_le<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> numeral <span class="free">d</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> numeral <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Frct_equals<span class="main">:</span> <span class="quoted"><span class="quoted">"Frct <span class="main">(</span><span class="free">a</span><span class="main">,</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Frct <span class="main">(</span><span class="free">c</span><span class="main">,</span> numeral <span class="free">d</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> numeral <span class="free">d</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> numeral <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> iffI antisym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Frct_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Frct_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_power_code<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ratreal <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">y</span> <span class="main">=</span> Ratreal <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_power<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> real_arith_code <span class="main">=</span>
  real_plus_code real_minus_code real_times_code real_uminus_code real_inverse_code
  real_divide_code real_power_code real_less_code real_less_eq_code real_equals_code

<span class="keyword1"><span class="command">lemmas</span></span> rat_arith_code <span class="main">=</span>
  Frct_add Frct_uminus Frct_diff Frct_mult Frct_inverse Frct_divide Frct_pow
  Frct_less Frct_le Frct_equals

<span class="keyword1"><span class="command">lemma</span></span> gcd_numeral_red<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>numeral <span class="free">x</span><span class="main">::</span>int<span class="main">)</span> <span class="main">(</span>numeral <span class="free">y</span><span class="main">)</span> <span class="main">=</span> gcd <span class="main">(</span>numeral <span class="free">y</span><span class="main">)</span> <span class="main">(</span>numeral <span class="free">x</span> <span class="keyword1">mod</span> numeral <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gcd_red_int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divmod_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"divmod <span class="main">(</span>Num.One<span class="main">)</span> <span class="main">(</span>Num.One<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Numeral1<span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"divmod <span class="main">(</span>Num.One<span class="main">)</span> <span class="main">(</span>Num.Bit0 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> Numeral1<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"divmod <span class="main">(</span>Num.One<span class="main">)</span> <span class="main">(</span>Num.Bit1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> Numeral1<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"divmod <span class="free">x</span> <span class="main">(</span>Num.One<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>numeral <span class="free">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> divmod_numeral_simps <span class="main">=</span>
  div_0 div_by_0 mod_0 mod_by_0
  fst_divmod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  snd_divmod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  divmod_cancel
  divmod_steps <span class="main">[</span><span class="operator">simplified</span> rel_simps if_True<span class="main">]</span> divmod_trivial
  rel_simps

<span class="keyword1"><span class="command">lemma</span></span> Suc_0_to_numeral<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">=</span> Numeral1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemmas</span></span> Suc_to_numeral <span class="main">=</span> Suc_0_to_numeral Num.Suc_1 Num.Suc_numeral

<span class="keyword1"><span class="command">lemma</span></span> rat_powr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">powr</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span><span class="main">0</span><span class="main">,</span> Numeral1<span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span>Numeral1<span class="main">,</span> Numeral1<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">powr</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span>numeral <span class="free">a</span><span class="main">,</span> Numeral1<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> numeral <span class="free">a</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">powr</span> Ratreal <span class="main">(</span>Frct <span class="main">(</span><span class="main">-</span>numeral <span class="free">a</span><span class="main">,</span> Numeral1<span class="main">)</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">x</span> <span class="main">^</span> numeral <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rat_number_collapse powr_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> eval_numeral_simps <span class="main">=</span>
  real_numeral_to_Ratreal real_arith_code rat_arith_code Num.arith_simps
  Rat.normalize_def fst_conv snd_conv gcd_0_int gcd_0_left_int gcd.bottom_right_bottom gcd.bottom_left_bottom
  gcd_neg1_int gcd_neg2_int gcd_numeral_red zmod_numeral_Bit0 zmod_numeral_Bit1 power_numeral_simps
  divmod_numeral_simps numeral_One <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Groups.Let_0 Num.Let_numeral Suc_to_numeral power_numeral
  greaterThanLessThan_iff atLeastAtMost_iff atLeastLessThan_iff greaterThanAtMost_iff rat_powr
  Num.pow.simps Num.sqr.simps Product_Type.split of_int_numeral of_int_neg_numeral of_nat_numeral

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">EVAL_NUMERAL</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> eval_numeral_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Eval_Numeral</span> <span class="main">:</span> <span class="entity">EVAL_NUMERAL</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> put_simpset <span class="entity">HOL_ss</span> <span class="entity">ctxt</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> eval_numeral_simps<span class="antiquote">}</span></span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    SELECT_GOAL <span class="main">(</span>SOLVE <span class="main">(</span><span class="entity">Simplifier.simp_tac</span> <span class="entity">ctxt'</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">21254387548659589512</span><span class="main">*</span><span class="numeral">314213523632464357453884361</span><span class="main">*</span><span class="numeral">2342523623324234</span><span class="main">*</span><span class="numeral">564327438587241734743</span><span class="main">*</span>
          <span class="numeral">12561712738645824362329316482973164398214286</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">/</span>
         <span class="main">(</span><span class="numeral">1130246312978423123</span><span class="main">+</span><span class="numeral">231212374631082764842731842</span><span class="main">*</span><span class="numeral">122474378389424362347451251263</span><span class="main">)</span> <span class="main">&gt;</span>
        <span class="main">(</span><span class="numeral">12313244512931247243543279768645745929475829310651205623844</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">Eval_Numeral.eval_numeral_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span>›</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Akra_Bazzi_Method">
<div class="head">
<h1>Theory Akra_Bazzi_Method</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Akra_Bazzi_Method.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Provides the "master_theorem" and "akra_bazzi_termination" proof methods.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The proof methods›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Master theorem and termination›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi_Method
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Akra_Bazzi.html">Akra_Bazzi</a>
  <a href="Master_Theorem.html">Master_Theorem</a>
  <a href="Eval_Numeral.html">Eval_Numeral</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> landau_symbol_ge_3_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_semidom<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">L</span> at_top <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> landau_symbol.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exp_1_lt_3<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Taylor_up<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> exp"</span></span> <span class="quoted">exp</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">=</span> <span class="numeral">5</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> exp <span class="skolem">t</span> <span class="main">/</span> <span class="numeral">6</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">t</span> <span class="main">&lt;</span> exp <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_ln_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ln_gt_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms exp_1_lt_3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ln_mono_strict<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">akra_bazzi_terms</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">akra_bazzi_terms</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> akra_bazzi_term <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_termsI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">bs</span> <span class="main">⟹</span> akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> akra_bazzi_terms <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">bs</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_terms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> master_theorem_functionI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">..&lt;</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_ex <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">as</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_terms <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">bs</span> <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"master_theorem_function <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">k</span> <span class="free">as</span> <span class="free">bs</span> <span class="free">ts</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_terms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_ex_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_measure<span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> akra_bazzi_term <span class="main">0</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> akra_bazzi_term <span class="main">0</span> <span class="main">(</span>Suc <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">b</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_term_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> measure_prod_conv<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">t</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="free">t</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">e</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">t</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">h</span><span class="main">)</span> <span class="main">∈</span> Wellfounded.measure <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> measure_prod_conv' <span class="main">=</span> measure_prod_conv<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_termination_simps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> real <span class="free">x</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">/</span><span class="free">b</span> <span class="main">*</span> real <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">x</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">b</span> <span class="main">*</span> real <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_params_nonzeroI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">as</span> <span class="main">=</span> length <span class="free">bs</span> <span class="main">⟹</span>  
   <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span>
   akra_bazzi_params_nonzero <span class="main">(</span>length <span class="free">as</span><span class="main">)</span> <span class="free">as</span> <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> akra_bazzi_p_rel_intros <span class="main">=</span> 
  akra_bazzi_params_nonzero.p_lessI<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>
  akra_bazzi_params_nonzero.p_greaterI<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>
  akra_bazzi_params_nonzero.p_leI<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>
  akra_bazzi_params_nonzero.p_geI<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>
  akra_bazzi_params_nonzero.p_boundsI<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>
  akra_bazzi_params_nonzero.p_boundsI'<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_akra_bazzi_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_akra_bazzi_sum'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">#</span><span class="free">ts</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">#</span><span class="free">ts</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">ts</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_termsI'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"akra_bazzi_terms <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">[]</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"akra_bazzi_term <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">t</span> <span class="main">⟹</span> akra_bazzi_terms <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">bs</span> <span class="free">ts</span> <span class="main">⟹</span> akra_bazzi_terms <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">#</span><span class="free">ts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> akra_bazzi_terms_def <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_0_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ball_set_intros<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">[]</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ball_set_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">[]</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bex_set_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">[]</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_akra_bazzi_le_list_ex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_ex <span class="free">P</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">x</span> <span class="main">∨</span> list_ex <span class="free">P</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_ex <span class="free">P</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"list_ex <span class="free">P</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_ex_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_akra_bazzi_le_sum_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> sum_list <span class="main">[]</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> sum_list <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> sum_list <span class="free">ys</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> sum_list <span class="main">[]</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> sum_list <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> sum_list <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> atLeastLessThanE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> master_theorem_preprocess<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">1</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">1</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">0</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">1</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> landau_symbols<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> landau_symbol_ge_3_cong<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_term_imp_size_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> akra_bazzi_term <span class="main">0</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">t</span> <span class="main">⟹</span> size <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="free">x</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> akra_bazzi_term <span class="main">0</span> <span class="main">(</span>Suc <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">b</span> <span class="free">t</span> <span class="main">⟹</span> size <span class="main">(</span><span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> akra_bazzi_term_imp_less<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">CLAMP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">::</span> nat <span class="main">⇒</span> real<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">CLAMP'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">::</span> nat <span class="main">⇒</span> real<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">MASTER_BOUND</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> ln <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">MASTER_BOUND'</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> ln <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">MASTER_BOUND''</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_1_imp_less_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="free">x</span> <span class="main">≤</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> exp <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ln_exp <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exp_1_lt_3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_1_imp_less_3'<span class="main">:</span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> ln_1_imp_less_3<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ln_ln_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> ln <span class="main">(</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ln_ln_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> ln_ln_nonneg'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ln_ln_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> MASTER_BOUND_postproc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> numeral <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> numeral <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND' <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> 
       CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="main">0</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="main">1</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> numeral <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="main">(</span><span class="main">-</span>numeral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> numeral <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>MASTER_BOUND'' <span class="free">a</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">and</span></span> MASTER_BOUND_UNCLAMP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> CLAMP <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> CLAMP <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span>CLAMP <span class="free">f</span><span class="main">)</span> <span class="main">=</span> CLAMP <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CLAMP_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> MASTER_BOUND'_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> MASTER_BOUND''_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus divide_inverse fun_eq_iff<span class="main">)</span>

  
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> CLAMP_<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">f</span><span class="main">::</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">≡</span> <span class="free">L</span> at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CLAMP_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_symbol.cong eq_reflection<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> UNCLAMP'_<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="free">L</span> at_top <span class="main">(</span>CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">≡</span> <span class="free">L</span> at_top <span class="main">(</span>MASTER_BOUND <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CLAMP'_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CLAMP_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_symbol.cong eq_reflection<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> UNCLAMP_<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="free">L</span> at_top <span class="main">(</span>CLAMP <span class="free">f</span><span class="main">)</span> <span class="main">≡</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>nat"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> CLAMP'_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> CLAMP_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_symbol.cong eq_reflection<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> CLAMP <span class="main">=</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> CLAMP_<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> UNCLAMP' <span class="main">=</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> UNCLAMP'_<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> UNCLAMP <span class="main">=</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> UNCLAMP_<span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> propagate_CLAMP<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> CLAMP <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> CLAMP <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>CLAMP <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">1</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">^</span> <span class="free">a'</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">(</span>real <span class="free">a'</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="main">1</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="free">b</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">b'</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="main">(</span>real <span class="free">b'</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="main">0</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">0</span> <span class="main">0</span> <span class="main">(</span>real <span class="free">c'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP' <span class="main">(</span>CLAMP <span class="free">f</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a1</span> <span class="free">b1</span> <span class="free">c1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a2</span> <span class="free">b2</span> <span class="free">c2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">(</span><span class="free">a1</span><span class="main">+</span><span class="free">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">b1</span><span class="main">+</span><span class="free">b2</span><span class="main">)</span> <span class="main">(</span><span class="free">c1</span><span class="main">+</span><span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a1</span> <span class="free">b1</span> <span class="free">c1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="free">a2</span> <span class="free">b2</span> <span class="free">c2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">(</span><span class="free">a1</span><span class="main">-</span><span class="free">a2</span><span class="main">)</span> <span class="main">(</span><span class="free">b1</span><span class="main">-</span><span class="free">b2</span><span class="main">)</span> <span class="main">(</span><span class="free">c1</span><span class="main">-</span><span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"CLAMP' <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>MASTER_BOUND <span class="free">a1</span> <span class="free">b1</span> <span class="free">c1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CLAMP' <span class="main">(</span>MASTER_BOUND <span class="main">(</span><span class="main">-</span><span class="free">a1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">b1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">c1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> ln_1_imp_less_3'<span class="main">)</span>
   <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CLAMP_def CLAMP'_def MASTER_BOUND_def 
      powr_realpow powr_one<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_ln_nonneg'<span class="main"><span class="main">]</span></span> powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_ln_pos<span class="main"><span class="main">]</span></span> powr_add
      powr_diff powr_minus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> numeral_assoc_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">+</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">+</span> numeral <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> numeral <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">-</span> numeral <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> neg_numeral_class.sub <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">+</span> numeral <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> neg_numeral_class.sub <span class="free">c</span> <span class="free">b</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> numeral <span class="free">b</span><span class="main">)</span> <span class="main">-</span> numeral <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> numeral <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> CLAMP_aux <span class="main">=</span>
  arith_simps numeral_assoc_simps of_nat_power of_nat_mult of_nat_numeral
  one_add_one numeral_One <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> CLAMP_postproc <span class="main">=</span> numeral_One

<span class="keyword1"><span class="command">context</span></span> master_theorem_function
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master1_bigo_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span>MASTER_BOUND p <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"MASTER_BOUND p <span class="main">0</span> <span class="main">0</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer bigthetaI_cong 
          eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ln_1_imp_less_3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.big.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> master1_bigo<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master1_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O(</span>MASTER_BOUND'' <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND p <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"MASTER_BOUND p <span class="main">0</span> <span class="main">0</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer bigthetaI_cong 
      eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ln_1_imp_less_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span>MASTER_BOUND'' <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MASTER_BOUND''_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> B assms<span class="main">(</span>1<span class="main">)</span> master1<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master2_1_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND p <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"MASTER_BOUND p <span class="main">0</span> <span class="main">0</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer bigthetaI_cong 
          eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_ge_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>real"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ln_1_imp_less_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CLAMP<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> MASTER_BOUND_postproc MASTER_BOUND_UNCLAMP<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UNCLAMP<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> B assms<span class="main">(</span>1<span class="main">)</span> master2_1<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master2_2_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND p <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"MASTER_BOUND p <span class="main">0</span> <span class="main">1</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_one<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_ln_nonneg<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">/</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CLAMP<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> MASTER_BOUND_postproc MASTER_BOUND_UNCLAMP<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UNCLAMP<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> B assms<span class="main">(</span>1<span class="main">)</span> master2_2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master2_3_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND p <span class="free">p'</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"MASTER_BOUND p <span class="free">p'</span> <span class="main">0</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ln_1_imp_less_3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>MASTER_BOUND' p <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> p <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CLAMP<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> MASTER_BOUND_postproc MASTER_BOUND_UNCLAMP<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UNCLAMP<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> B assms<span class="main">(</span>1<span class="main">)</span> master2_3<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> master3_automation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND'' <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>MASTER_BOUND <span class="free">p'</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"MASTER_BOUND <span class="free">p'</span> <span class="main">0</span> <span class="main">0</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> MASTER_BOUND_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> landau_real_nat_transfer<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ln_1_imp_less_3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>MASTER_BOUND'' <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> real <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> CLAMP<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> MASTER_BOUND_postproc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> UNCLAMP<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> B assms<span class="main">(</span>1<span class="main">)</span> master3<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> master_automation <span class="main">=</span> 
  master1_automation master2_1_automation master2_2_automation 
  master2_2_automation master3_automation


<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generalize_master_thm</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">[</span><span class="entity">p'</span><span class="main">]</span><span class="main">,</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="main">=</span> Variable.variant_fixes <span class="main">[</span><span class="inner_quoted">"p''"</span><span class="main">]</span> <span class="entity">ctxt</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">p'</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">p'</span><span class="main">,</span> <span class="entity">HOLogic.realT</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">a</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"nth <span class="free">as</span>"</span><span class="antiquote">}</span></span> $ Bound <span class="inner_numeral">0</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">b</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Transcendental.powr <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ 
              <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"nth <span class="free">bs</span>"</span><span class="antiquote">}</span></span> $ Bound <span class="inner_numeral">0</span><span class="main">)</span> $ <span class="entity">p'</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">f</span> <span class="main">=</span> Abs <span class="main">(</span><span class="inner_quoted">"i"</span><span class="main">,</span> <span class="entity">HOLogic.natT</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">a</span> $ <span class="entity">b</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sum</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"sum <span class="main">::</span> <span class="main">(</span>nat <span class="main">=&gt;</span> real<span class="main">)</span> <span class="main">=&gt;</span> nat set <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">f</span> $ <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span><span class="antiquote">}</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="entity">HOLogic.mk_eq</span> <span class="main">(</span><span class="entity">sum</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cprop</span> <span class="main">=</span> Thm.cterm_of <span class="entity">ctxt'</span> <span class="entity">prop</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">thm</span>
    |&gt; Local_Defs.unfold <span class="entity">ctxt'</span> <span class="main">[</span>Thm.assume <span class="entity">cprop</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> p_unique<span class="antiquote">}</span></span></span><span class="main">]</span>
    |&gt; Thm.implies_intr <span class="entity">cprop</span>
    |&gt; rotate_prems <span class="inner_numeral">1</span>
    |&gt; singleton <span class="main">(</span>Variable.export <span class="entity">ctxt'</span> <span class="entity">ctxt</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generalize_master_thm'</span> <span class="main">(</span><span class="entity">binding</span><span class="main">,</span> <span class="entity">thm</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="main">=</span>
  Local_Theory.note <span class="main">(</span><span class="main">(</span><span class="entity">binding</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="entity">generalize_master_thm</span> <span class="entity">ctxt</span> <span class="entity">thm</span><span class="main">]</span><span class="main">)</span> <span class="entity">ctxt</span> |&gt; snd

›</span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  fold <span class="entity">generalize_master_thm'</span> 
    <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master1_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master1_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> 
     <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master1_bigo_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master1_bigo_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> 
     <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master2_1_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master2_1_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span>
     <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master2_2_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master2_2_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span>
     <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master2_3_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master2_3_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">,</span> 
     <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> master3_automation'<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> master3_automation<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">]</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">arith_consts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="numeral">5</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> True <span class="main">∨</span> True <span class="main">⟶</span> True <span class="keyword1">then</span> 
  <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> inverse <span class="numeral">3</span> <span class="keyword1">powr</span> <span class="numeral">21</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real <span class="main">(</span>Suc <span class="main">0</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="numeral">42</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">1</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> Numeral1 <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> Numeral1<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">‹akra_bazzi.ML›</span>

<span class="keyword1"><span class="command">hide_const</span></span> arith_consts

<span class="keyword1"><span class="command">method_setup</span></span> master_theorem <span class="main">=</span> <span class="quoted">‹
  <span class="entity">Akra_Bazzi.setup_master_theorem</span>
›</span> <span class="quoted">"automatically apply the Master theorem for recursive functions"</span>

<span class="keyword1"><span class="command">method_setup</span></span> akra_bazzi_termination <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">Akra_Bazzi.akra_bazzi_termination_tac</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"prove termination of Akra-Bazzi functions"</span>

<span class="keyword1"><span class="command">hide_const</span></span> CLAMP CLAMP' MASTER_BOUND MASTER_BOUND' MASTER_BOUND''

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="files/akra_bazzi.ML">
<div class="head">
<h1>File ‹akra_bazzi.ML›</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      akra_bazzi.ML
    Author:     Manuel Eberl, TU Muenchen
*)</span>

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">AKRA_BAZZI</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> master_theorem_tac <span class="main">:</span> string option <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> thm option <span class="main">-&gt;</span> term option <span class="main">-&gt;</span> term option <span class="main">-&gt;</span> 
    term option <span class="main">-&gt;</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic

  <span class="keyword1"><span class="keyword">val</span></span> master_theorem_function_tac <span class="main">:</span> bool <span class="main">-&gt;</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_term_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_sum_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic

  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_relation_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_measure_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_termination_tac <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic

  <span class="keyword1"><span class="keyword">val</span></span> setup_master_theorem <span class="main">:</span> Context.generic * Token.T list <span class="main">-&gt;</span> 
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="entity">Method.method</span><span class="main">)</span> * <span class="main">(</span>Context.generic * Token.T list<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Akra_Bazzi</span><span class="main">:</span> <span class="entity">AKRA_BAZZI</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">changed_conv</span> <span class="entity">conv</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">conv</span> <span class="entity">ct</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> Thm.is_reflexive <span class="entity">thm</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"changed_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">thm</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="entity">thms</span> <span class="main">=</span>
  CONVERSION <span class="main">(</span>Conv.repeat_conv <span class="main">(</span><span class="entity">changed_conv</span> <span class="main">(</span>Conv.bottom_conv 
    <span class="main">(</span>K <span class="main">(</span>Conv.try_conv <span class="main">(</span>Conv.rewrs_conv <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> eq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="entity">thms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">term_preps</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> akra_bazzi_termination_simps<span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_term_intros</span> <span class="entity">ctxt</span> <span class="main">=</span> <span class="entity">Named_Theorems.get</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> "akra_bazzi_term_intros"<span class="antiquote">}</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">master_intros</span> <span class="main">=</span> 
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master1_automation 
      master_theorem_function.master1_bigo_automation master_theorem_function.master1_automation'
      master_theorem_function.master1_bigo_automation' master_theorem_function.master2_1_automation 
      master_theorem_function.master2_1_automation' master_theorem_function.master2_2_automation
      master_theorem_function.master2_2_automation' master_theorem_function.master2_3_automation
      master_theorem_function.master2_3_automation' master_theorem_function.master3_automation 
      master_theorem_function.master3_automation'<span class="antiquote">}</span></span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_intros</span> NONE <span class="entity">b</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> not <span class="entity">b</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">master_intros</span> <span class="keyword2"><span class="keyword">else</span></span> 
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master1_automation master_theorem_function.master1_bigo_automation
         master_theorem_function.master1_automation' master_theorem_function.master2_1_automation 
      master_theorem_function.master2_1_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">(</span>SOME <span class="inner_quoted">"1"</span><span class="main">)</span> <span class="main">_</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master1_automation 
      master_theorem_function.master1_bigo_automation master_theorem_function.master1_automation'
      master_theorem_function.master1_bigo_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">(</span>SOME <span class="inner_quoted">"2.1"</span><span class="main">)</span> <span class="main">_</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master2_1_automation 
      master_theorem_function.master2_1_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">(</span>SOME <span class="inner_quoted">"2.2"</span><span class="main">)</span> <span class="main">_</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master2_2_automation
      master_theorem_function.master2_2_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">(</span>SOME <span class="inner_quoted">"2.3"</span><span class="main">)</span> <span class="main">_</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master2_3_automation
      master_theorem_function.master2_3_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">(</span>SOME <span class="inner_quoted">"3"</span><span class="main">)</span> <span class="main">_</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_function.master3_automation 
      master_theorem_function.master3_automation'<span class="antiquote">}</span></span></span>
<span class="main">|</span>   <span class="entity">get_intros</span> <span class="main">_</span> <span class="main">_</span> <span class="main">=</span> error <span class="inner_quoted">"invalid Master theorem case"</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">allowed_consts</span> <span class="main">=</span>
  <span class="main">[</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nat"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Suc <span class="main">::</span> nat <span class="main">=&gt;</span> nat"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> 
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"inverse <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="keyword1">(powr)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"real_of_nat"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"real <span class="main">::</span> nat <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.numeral <span class="main">::</span> num <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.Bit0"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.Bit1"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">1</span> <span class="main">::</span> real"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.One"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.BitM"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Num.numeral <span class="main">::</span> num <span class="main">=&gt;</span> nat"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span> <span class="main">::</span> nat"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">1</span> <span class="main">::</span> nat"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"atLeastAtMost <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real set"</span><span class="antiquote">}</span></span><span class="main">,</span> 
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"greaterThanAtMost <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real set"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"atLeastLessThan <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real set"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"greaterThanLessThan <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real set"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(=)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(≤)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(∈)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real set <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(=)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(≤)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Trueprop"</span><span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"HOL.Not"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"HOL.conj"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"HOL.disj"</span><span class="antiquote">}</span></span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"HOL.implies"</span><span class="antiquote">}</span></span><span class="main">]</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">contains_only_numerals</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">(</span><span class="entity">s</span> $ <span class="entity">t</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">go</span> <span class="entity">s</span> <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">go</span> <span class="entity">t</span> <span class="keyword2"><span class="keyword">end</span></span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span>Const <span class="entity">c</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="entity">allowed_consts</span> <span class="main">(</span>Const <span class="entity">c</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span>
            <span class="main">(</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">else</span></span>
            <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"contains_only_numerals"</span><span class="main">,</span> <span class="main">[</span>Const <span class="entity">c</span><span class="main">]</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"contains_only_numerals"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">go</span> <span class="entity">t</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    true
  <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> false

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_nat_number</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">HOLogic.dest_number</span> <span class="entity">t</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span><span class="entity">ty</span><span class="main">,</span> <span class="entity">n</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">ty</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"Nat.nat"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">n</span>  <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"dest_nat_number"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">num_to_Suc</span> <span class="entity">n</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">let</span></span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">acc</span> <span class="inner_numeral">0</span> <span class="main">=</span> <span class="entity">acc</span>
    <span class="main">|</span> <span class="entity">go</span> <span class="entity">acc</span> <span class="entity">n</span> <span class="main">=</span> <span class="entity">go</span> <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Suc <span class="main">::</span> Nat.nat <span class="main">=&gt;</span> Nat.nat"</span><span class="antiquote">}</span></span> $ <span class="entity">acc</span><span class="main">)</span> <span class="main">(</span><span class="entity">n</span> - <span class="inner_numeral">1</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">in</span></span>  
  <span class="entity">go</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span> <span class="main">::</span> Nat.nat"</span><span class="antiquote">}</span></span> <span class="entity">n</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(* Termination *)</span>

<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">breadcrumb</span> <span class="main">=</span> <span class="entity">Fst</span> <span class="main">|</span> <span class="entity">Snd</span>

<span class="comment1">(* extract all natural number types from a product type *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">pick_natT_leaf</span> <span class="entity">T</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">crumbs</span> <span class="entity">T</span> <span class="entity">acc</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">case</span></span> try <span class="entity">HOLogic.dest_prodT</span> <span class="entity">T</span> <span class="keyword2"><span class="keyword">of</span></span> 
        SOME <span class="main">(</span><span class="entity">T1</span><span class="main">,</span> <span class="entity">T2</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">acc</span> |&gt; <span class="entity">go</span> <span class="main">(</span><span class="entity">Snd</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="entity">T2</span> |&gt; <span class="entity">go</span> <span class="main">(</span><span class="entity">Fst</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="entity">T1</span>
      <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">T</span> <span class="main">=</span> <span class="entity">HOLogic.natT</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">crumbs</span> :: <span class="entity">acc</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">acc</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> <span class="main">[</span><span class="main">]</span> <span class="entity">T</span> <span class="main">[</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">breadcrumb</span> <span class="entity">Fst</span> <span class="main">=</span> fst
  <span class="main">|</span> <span class="entity">breadcrumb</span> <span class="entity">Snd</span> <span class="main">=</span> snd

<span class="comment1">(* construct an extractor function using fst/snd from a path in a product type *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_extractor</span> <span class="entity">T</span> <span class="entity">crumbs</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">aux</span> <span class="entity">c</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">T'</span><span class="main">,</span> <span class="entity">acc</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T''</span> <span class="main">=</span> <span class="entity">HOLogic.dest_prodT</span> <span class="entity">T'</span> |&gt; <span class="entity">f</span>
      <span class="keyword2"><span class="keyword">in</span></span>
         <span class="main">(</span><span class="entity">T''</span><span class="main">,</span> Const <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">T'</span> --&gt; <span class="entity">T''</span><span class="main">)</span> $ <span class="entity">acc</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">acc</span><span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="inner_quoted">"n"</span><span class="main">,</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">acc</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">Fst</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">acc</span> |&gt; <span class="entity">aux</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> fst<span class="antiquote">}</span></span> fst |&gt; <span class="entity">go</span> <span class="entity">crumbs</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">Snd</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">acc</span> |&gt; <span class="entity">aux</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> snd<span class="antiquote">}</span></span> snd |&gt; <span class="entity">go</span> <span class="entity">crumbs</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> <span class="main">(</span>rev <span class="entity">crumbs</span><span class="main">)</span> <span class="main">(</span><span class="entity">T</span><span class="main">,</span> Bound <span class="inner_numeral">0</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_from_prod</span> <span class="main">[</span><span class="main">]</span> <span class="entity">t</span> <span class="main">=</span> <span class="entity">t</span>
  <span class="main">|</span> <span class="entity">extract_from_prod</span> <span class="main">(</span><span class="entity">c</span> :: <span class="entity">cs</span><span class="main">)</span> <span class="entity">t</span> <span class="main">=</span> <span class="entity">extract_from_prod</span> <span class="entity">cs</span> <span class="entity">t</span> |&gt; <span class="entity">HOLogic.dest_prod</span> |&gt; <span class="entity">breadcrumb</span> <span class="entity">c</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ANY'</span> <span class="entity">tacs</span> <span class="entity">n</span> <span class="main">=</span> fold <span class="main">(</span>curry <span class="keyword1"><span class="keyword">op</span></span> APPEND<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="entity">t</span> <span class="entity">n</span><span class="main">)</span> <span class="entity">tacs</span><span class="main">)</span> no_tac

<span class="comment1">(* find recursion variable, set up a measure function for it and apply it to prove termination *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_relation_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> Proof_Context.lookup_fact <span class="entity">ctxt</span> <span class="inner_quoted">"local.termination"</span> <span class="keyword2"><span class="keyword">of</span></span>
    SOME <span class="main">{</span>thms <span class="main">=</span> <span class="main">[</span><span class="entity">thm</span><span class="main">]</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> Thm.prems_of <span class="entity">thm</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">relT</span> <span class="main">=</span> <span class="entity">prems</span> |&gt; hd |&gt; dest_comb |&gt; snd |&gt; dest_comb |&gt; snd |&gt; dest_Var |&gt; snd 
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> <span class="entity">relT</span> |&gt; <span class="entity">HOLogic.dest_setT</span> |&gt; <span class="entity">HOLogic.dest_prodT</span> |&gt; fst
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prems</span> <span class="main">=</span> <span class="entity">prems</span> |&gt; tl |&gt; map Term.strip_all_body
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">calls</span> <span class="main">=</span> <span class="entity">prems</span> |&gt; map <span class="main">(</span>Logic.strip_imp_concl #&gt; <span class="entity">HOLogic.dest_Trueprop</span> #&gt; 
                      dest_comb #&gt; fst #&gt; dest_comb #&gt; snd #&gt; <span class="entity">HOLogic.dest_prod</span> #&gt; fst<span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">leaves</span> <span class="main">=</span> <span class="entity">pick_natT_leaf</span> <span class="entity">T</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">calls</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">path</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">path</span><span class="main">,</span> map <span class="main">(</span><span class="entity">extract_from_prod</span> <span class="entity">path</span><span class="main">)</span> <span class="entity">calls</span><span class="main">)</span><span class="main">)</span> <span class="entity">leaves</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">calls</span> <span class="main">=</span> <span class="entity">calls</span> |&gt; filter <span class="main">(</span>snd #&gt; filter is_Bound #&gt; null<span class="main">)</span> |&gt; map fst
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">measureC</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Wellfounded.measure<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">(</span><span class="entity">T</span> --&gt; <span class="entity">HOLogic.natT</span><span class="main">)</span> --&gt; <span class="entity">relT</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_relation</span> <span class="entity">f</span> <span class="main">=</span> <span class="entity">measureC</span> $ <span class="entity">f</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">relations</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">mk_relation</span> o <span class="entity">mk_extractor</span> <span class="entity">T</span><span class="main">)</span> <span class="entity">calls</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">ANY'</span> <span class="main">(</span>map <span class="main">(</span><span class="entity">Function_Relation.relation_tac</span> <span class="entity">ctxt</span> o K<span class="main">)</span> <span class="entity">relations</span><span class="main">)</span>
         THEN' resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> wf_measure<span class="antiquote">}</span></span></span><span class="main">)</span>
        THEN_ALL_NEW <span class="main">(</span><span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> measure_prod_conv measure_prod_conv'<span class="antiquote">}</span></span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>
  <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> K no_tac

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">measure_postproc_simps</span> <span class="main">=</span> 
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> arith_simps of_nat_0 of_nat_1 of_nat_numeral
         Suc_numeral of_nat_Suc<span class="antiquote">}</span></span></span>

<span class="comment1">(* prove that the measure decreases in a recursive call by showing that the recursive call is
   an Akra-Bazzi term. Apply simple post-processing to make the numbers less ugly *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_measure_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="entity">term_preps</span>
  THEN' eresolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> akra_bazzi_term_measure<span class="antiquote">}</span></span></span>
  THEN' resolve_tac <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">get_term_intros</span> <span class="entity">ctxt</span><span class="main">)</span>
  THEN_ALL_NEW <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="entity">measure_postproc_simps</span>
  
<span class="comment1">(* prove termination of an Akra-Bazzi function *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_termination_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="entity">akra_bazzi_relation_tac</span> <span class="entity">ctxt</span>
  THEN_ALL_NEW <span class="entity">akra_bazzi_measure_tac</span> <span class="entity">ctxt</span>



<span class="comment1">(* General preprocessing *)</span>
    
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">nat_numeral_conv</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">let</span></span> 
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Thm.term_of <span class="entity">ct</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> Logic.mk_equals <span class="main">(</span><span class="entity">t</span><span class="main">,</span> <span class="entity">num_to_Suc</span> <span class="main">(</span><span class="entity">dest_nat_number</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tac</span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> prems <span class="main">=</span> <span class="main">_</span> <span class="main">}</span> <span class="main">=</span> 
    SOLVE <span class="main">(</span>Local_Defs.unfold_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> eval_nat_numeral BitM.simps One_nat_def<span class="antiquote">}</span></span></span> 
    THEN resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> Pure.reflexive<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>  
  <span class="keyword2"><span class="keyword">case</span></span> try <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> Goal.prove <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">prop</span> <span class="entity">tac</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
    NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"nat_numeral_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
  <span class="main">|</span> SOME <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_sum_conv</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> Thm.term_of <span class="entity">ct</span> <span class="keyword2"><span class="keyword">of</span></span> 
    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> sum<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span> $ 
      <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Set_Interval.ord_class.lessThan<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> 
        Conv.arg_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span><span class="entity">nat_numeral_conv</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span> <span class="entity">ct</span>
    <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"akra_bazzi_sum_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_sum_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">let</span></span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">conv</span> <span class="entity">ctxt</span> <span class="main">=</span> Conv.try_conv <span class="main">(</span><span class="entity">akra_bazzi_sum_conv</span> <span class="entity">ctxt</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> eval_akra_bazzi_sum eval_akra_bazzi_sum' 
                    mult_1_left mult_1_right add_0_left add_0_right<span class="antiquote">}</span></span></span>
<span class="keyword2"><span class="keyword">in</span></span>
  CHANGED <span class="main">(</span>CONVERSION <span class="main">(</span>Conv.top_conv <span class="entity">conv</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">i</span> THEN 
           REPEAT <span class="main">(</span><span class="entity">EqSubst.eqsubst_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="inner_numeral">0</span><span class="main">]</span> <span class="entity">thms</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_term_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="entity">term_preps</span>
  THEN' <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">get_term_intros</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_terms_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  REPEAT_ALL_NEW <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> DETERM <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> akra_bazzi_termsI'<span class="antiquote">}</span></span></span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span>
  THEN_ALL_NEW <span class="entity">akra_bazzi_term_tac</span> <span class="entity">ctxt</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_terminal</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">inv</span> <span class="entity">t_orig</span> <span class="entity">t</span> <span class="entity">acc</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">let</span></span> 
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> Proof_Context.theory_of <span class="entity">ctxt</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">patvar</span> <span class="main">=</span> <span class="main">(</span><span class="inner_quoted">"x"</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pat</span> <span class="main">=</span> Term.betapply <span class="main">(</span><span class="entity">f</span><span class="main">,</span> Var <span class="main">(</span><span class="entity">patvar</span><span class="main">,</span> <span class="entity">HOLogic.natT</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">match</span> <span class="entity">t</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">matcher</span> <span class="main">=</span> Pattern.first_order_match <span class="entity">thy</span> <span class="main">(</span><span class="entity">pat</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span> <span class="main">(</span>Vartab.empty<span class="main">,</span> Vartab.empty<span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x'</span> <span class="main">=</span> Vartab.lookup <span class="main">(</span>snd <span class="entity">matcher</span><span class="main">)</span> <span class="entity">patvar</span> |&gt; the |&gt; snd
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> Term.exists_subterm <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x'</span> <span class="main">=&gt;</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">x'</span><span class="main">)</span> <span class="entity">x'</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">x'</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> Pattern.MATCH
    <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">add_term</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">acc</span><span class="main">,</span> <span class="entity">acc_inv</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">inv</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="entity">acc</span><span class="main">,</span> <span class="entity">t</span> :: <span class="entity">acc_inv</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">t</span> :: <span class="entity">acc</span><span class="main">,</span> <span class="entity">acc_inv</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">acc</span><span class="main">,</span> <span class="entity">acc_inv</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">call'</span> <span class="main">=</span> <span class="entity">match</span> <span class="entity">t</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">call</span> <span class="keyword2"><span class="keyword">of</span></span>
        NONE <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">acc</span><span class="main">,</span> <span class="entity">acc_inv</span><span class="main">,</span> SOME <span class="entity">call'</span><span class="main">)</span>
      <span class="main">|</span> SOME <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"Non-linear occurrence of recursive call"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t_orig</span><span class="main">]</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword3"><span class="keyword">handle</span></span> Pattern.MATCH <span class="main">=&gt;</span> <span class="entity">add_term</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">acc</span><span class="main">,</span> <span class="entity">acc_inv</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="entity">go</span> <span class="entity">t</span> <span class="entity">acc</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_prod</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">1</span> <span class="main">::</span> real"</span><span class="antiquote">}</span></span>
<span class="main">|</span>   <span class="entity">mk_prod</span> <span class="main">(</span><span class="entity">x</span>::<span class="entity">xs</span><span class="main">)</span> <span class="main">=</span> 
      fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">acc</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">x</span> $ <span class="entity">acc</span><span class="main">)</span> <span class="entity">xs</span> <span class="entity">x</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_quot</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="entity">mk_prod</span> <span class="entity">xs</span>
  <span class="main">|</span> <span class="entity">mk_quot</span> <span class="main">(</span><span class="main">[</span><span class="main">]</span><span class="main">,</span> <span class="entity">ys</span><span class="main">)</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"inverse <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">mk_prod</span> <span class="entity">ys</span>
  <span class="main">|</span> <span class="entity">mk_quot</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="entity">ys</span><span class="main">)</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">mk_prod</span> <span class="entity">xs</span> $ <span class="entity">mk_prod</span> <span class="entity">ys</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_prod</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">minus</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">acc1</span><span class="main">,</span> <span class="entity">acc2</span><span class="main">)</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">let</span></span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">inv</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t1</span> $ <span class="entity">t2</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
          <span class="entity">go</span> <span class="entity">inv</span> <span class="entity">t1</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">inv</span> <span class="entity">t2</span> <span class="entity">acc</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
          <span class="entity">go</span> <span class="entity">inv</span> <span class="entity">t1</span> <span class="main">(</span><span class="entity">go</span> <span class="main">(</span>not <span class="entity">inv</span><span class="main">)</span> <span class="entity">t2</span> <span class="entity">acc</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span>
          <span class="entity">analyze_terminal</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">inv</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t1</span> $ <span class="entity">t2</span><span class="main">)</span> <span class="entity">acc</span>
  <span class="main">|</span>   <span class="entity">go</span> <span class="entity">inv</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t'</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"inverse <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
          <span class="entity">go</span> <span class="main">(</span>not <span class="entity">inv</span><span class="main">)</span> <span class="entity">t'</span> <span class="entity">acc</span>
        <span class="keyword2"><span class="keyword">else</span></span>
          <span class="entity">analyze_terminal</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">inv</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t'</span><span class="main">)</span> <span class="entity">acc</span>
  <span class="main">|</span>   <span class="entity">go</span> <span class="entity">inv</span> <span class="entity">t'</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">analyze_terminal</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">inv</span> <span class="entity">t</span> <span class="entity">t'</span> <span class="entity">acc</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">go</span> false <span class="entity">t</span> <span class="main">(</span><span class="main">[</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">,</span> NONE<span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> NONE<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">acc1</span><span class="main">,</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">minus</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">t</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">t</span><span class="main">)</span> :: <span class="entity">acc2</span><span class="main">)</span>
  <span class="main">|</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="entity">ys</span><span class="main">,</span> SOME <span class="entity">call</span><span class="main">)</span> <span class="main">=&gt;</span> 
      <span class="keyword2"><span class="keyword">let</span></span> 
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">r</span> <span class="main">=</span> <span class="entity">mk_quot</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="entity">ys</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">r'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">minus</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">r</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">r</span><span class="main">,</span> <span class="entity">call</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="main">(</span><span class="entity">r'</span> :: <span class="entity">acc1</span><span class="main">,</span> <span class="entity">acc2</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_sum</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span><span class="antiquote">}</span></span>
  <span class="main">|</span> <span class="entity">mk_sum</span> <span class="main">(</span><span class="entity">x</span>::<span class="entity">xs</span><span class="main">)</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">let</span></span> 
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">(</span><span class="entity">f</span> $ <span class="entity">x</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">f</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
                <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">acc</span> $ <span class="entity">x</span>
              <span class="keyword2"><span class="keyword">else</span></span>
                <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">acc</span> $ <span class="main">(</span><span class="entity">f</span> $ <span class="entity">x</span><span class="main">)</span>
          <span class="main">|</span> <span class="entity">go</span> <span class="entity">x</span> <span class="entity">acc</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> $ <span class="entity">acc</span> $ <span class="entity">x</span>
      <span class="keyword2"><span class="keyword">in</span></span>  
        fold <span class="entity">go</span> <span class="entity">xs</span> <span class="entity">x</span>
      <span class="keyword2"><span class="keyword">end</span></span>
  

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_sum</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">minus</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t1</span> $ <span class="entity">t2</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
            <span class="entity">go</span> <span class="entity">minus</span> <span class="entity">t1</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">minus</span> <span class="entity">t2</span> <span class="entity">acc</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> real <span class="main">=&gt;</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
            <span class="entity">go</span> <span class="entity">minus</span> <span class="entity">t1</span> <span class="main">(</span><span class="entity">go</span> <span class="main">(</span>not <span class="entity">minus</span><span class="main">)</span> <span class="entity">t2</span> <span class="entity">acc</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">analyze_prod</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">minus</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t1</span> $ <span class="entity">t2</span><span class="main">)</span> <span class="entity">acc</span>
    <span class="main">|</span>   <span class="entity">go</span> <span class="entity">minus</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">oper</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"uminus <span class="main">::</span> real <span class="main">=&gt;</span> real"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
            <span class="entity">go</span> <span class="main">(</span>not <span class="entity">minus</span><span class="main">)</span> <span class="entity">t</span> <span class="entity">acc</span>
          <span class="keyword2"><span class="keyword">else</span></span>
            <span class="entity">analyze_prod</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">minus</span> <span class="main">(</span><span class="entity">oper</span> $ <span class="entity">t</span><span class="main">)</span> <span class="entity">acc</span>
    <span class="main">|</span>   <span class="entity">go</span> <span class="entity">minus</span> <span class="entity">t</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">analyze_prod</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">minus</span> <span class="entity">t</span> <span class="entity">acc</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">go</span> false <span class="entity">t</span> <span class="main">(</span><span class="main">[</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
      <span class="main">(</span><span class="entity">xs</span><span class="main">,</span><span class="entity">ys</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">xs</span><span class="main">,</span> <span class="entity">mk_sum</span> <span class="entity">ys</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_coeff</span> <span class="entity">ctxt</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> Proof_Context.theory_of <span class="entity">ctxt</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t'</span> <span class="main">=</span> Raw_Simplifier.rewrite_term <span class="entity">thy</span> 
                 <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> akra_bazzi_termination_simps<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span> <span class="main">[</span><span class="main">]</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">aux</span> <span class="entity">thm</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span> 
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">tmp</span><span class="main">,</span> <span class="entity">pat</span><span class="main">)</span> <span class="main">=</span> <span class="entity">thm</span> |&gt; Thm.concl_of |&gt; <span class="entity">HOLogic.dest_Trueprop</span> |&gt; Term.dest_comb
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">var</span> <span class="main">=</span> <span class="entity">tmp</span> |&gt; Term.dest_comb |&gt; snd |&gt; Term.dest_Var |&gt; fst
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">insts</span><span class="main">)</span> <span class="main">=</span> Pattern.first_order_match <span class="entity">thy</span> <span class="main">(</span><span class="entity">pat</span><span class="main">,</span> <span class="entity">t'</span><span class="main">)</span> <span class="main">(</span>Vartab.empty<span class="main">,</span> Vartab.empty<span class="main">)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">coeff</span> <span class="main">=</span> Option.map snd <span class="main">(</span>Vartab.lookup <span class="entity">insts</span> <span class="entity">var</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">in</span></span> 
        <span class="entity">coeff</span>
      <span class="keyword2"><span class="keyword">end</span></span>
        <span class="keyword3"><span class="keyword">handle</span></span> Pattern.MATCH <span class="main">=&gt;</span> NONE
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">case</span></span> get_first <span class="entity">aux</span> <span class="main">(</span><span class="entity">get_term_intros</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
      NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"extract_coeff"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t'</span><span class="main">]</span><span class="main">)</span>
    <span class="main">|</span> SOME <span class="entity">coeff</span> <span class="main">=&gt;</span> <span class="entity">coeff</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_var_name</span> <span class="main">(</span>Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">x</span>
  <span class="main">|</span> <span class="entity">get_var_name</span> <span class="main">(</span>Var <span class="main">(</span><span class="main">(</span><span class="entity">x</span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">,</span><span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">x</span>
  <span class="main">|</span> <span class="entity">get_var_name</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"get_var_name"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_call</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">ts</span><span class="main">,</span> <span class="entity">g</span><span class="main">)</span> <span class="main">=</span> <span class="entity">analyze_sum</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">x</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">k</span> <span class="main">=</span> length <span class="entity">ts</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">a_coeffs</span> <span class="main">=</span> <span class="entity">HOLogic.mk_list</span> <span class="entity">HOLogic.realT</span> <span class="main">(</span>map fst <span class="entity">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">abstract</span> <span class="entity">t</span> <span class="main">=</span> Abs <span class="main">(</span><span class="entity">get_var_name</span> <span class="entity">x</span><span class="main">,</span> <span class="entity">HOLogic.natT</span><span class="main">,</span> abstract_over <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ts</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">abstract</span> o snd<span class="main">)</span> <span class="entity">ts</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">b_coeffs</span> <span class="main">=</span> <span class="entity">HOLogic.mk_list</span> <span class="entity">HOLogic.realT</span> <span class="main">(</span>map <span class="main">(</span><span class="entity">extract_coeff</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">ts</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ts</span> <span class="main">=</span> <span class="entity">HOLogic.mk_list</span> <span class="main">(</span><span class="entity">HOLogic.natT</span> --&gt; <span class="entity">HOLogic.natT</span><span class="main">)</span> <span class="entity">ts</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">{</span>k <span class="main">=</span> <span class="entity">HOLogic.mk_nat</span> <span class="entity">k</span><span class="main">,</span> a_coeffs <span class="main">=</span> <span class="entity">a_coeffs</span><span class="main">,</span> b_coeffs <span class="main">=</span> <span class="entity">b_coeffs</span><span class="main">,</span> ts <span class="main">=</span> <span class="entity">ts</span><span class="main">,</span> g <span class="main">=</span> <span class="entity">abstract</span> <span class="entity">g</span><span class="main">}</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">instantiate_akra_bazzi</span> <span class="entity">ctxt</span> <span class="entity">ts</span> <span class="main">=</span> 
    map <span class="main">(</span>Thm.instantiate' <span class="main">[</span><span class="main">]</span> <span class="main">(</span>map <span class="main">(</span>Option.map <span class="main">(</span>Thm.cterm_of <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span> <span class="entity">ts</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_equation</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">funvar</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rhs</span> <span class="main">=</span> <span class="entity">eq</span> |&gt; Thm.concl_of |&gt; <span class="entity">HOLogic.dest_Trueprop</span> |&gt; <span class="entity">HOLogic.dest_eq</span> |&gt; snd
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span><span class="entity">k</span><span class="main">,</span> <span class="entity">a_coeffs</span><span class="main">,</span> <span class="entity">b_coeffs</span><span class="main">,</span> <span class="entity">ts</span><span class="main">,</span> <span class="entity">g</span><span class="main">}</span> <span class="main">=</span> <span class="entity">analyze_call</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">funvar</span> <span class="entity">rhs</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">{</span>k <span class="main">=</span> <span class="entity">k</span><span class="main">,</span> a_coeffs <span class="main">=</span> <span class="entity">a_coeffs</span><span class="main">,</span> b_coeffs <span class="main">=</span> <span class="entity">b_coeffs</span><span class="main">,</span> ts <span class="main">=</span> <span class="entity">ts</span><span class="main">,</span> f <span class="main">=</span> <span class="entity">f</span><span class="main">,</span> g <span class="main">=</span> <span class="entity">g</span><span class="main">}</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_instantiate_tac</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">funvar</span> <span class="entity">p'</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span><span class="entity">k</span><span class="main">,</span> <span class="entity">a_coeffs</span><span class="main">,</span> <span class="entity">b_coeffs</span><span class="main">,</span> <span class="entity">ts</span><span class="main">,</span> <span class="entity">g</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span> <span class="entity">analyze_equation</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">funvar</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">insts</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">[</span>SOME <span class="entity">x0</span><span class="main">,</span> SOME <span class="entity">x1</span><span class="main">,</span> SOME <span class="entity">k</span><span class="main">,</span> SOME <span class="entity">a_coeffs</span><span class="main">,</span> SOME <span class="entity">b_coeffs</span><span class="main">,</span> SOME <span class="entity">ts</span><span class="main">,</span> SOME <span class="entity">f</span><span class="main">,</span> SOME <span class="entity">g</span><span class="main">]</span> @
        <span class="main">(</span>filter Option.isSome <span class="main">[</span><span class="entity">p'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    resolve_tac <span class="entity">ctxt</span> o <span class="entity">instantiate_akra_bazzi</span> <span class="entity">ctxt</span> <span class="entity">insts</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*
val code_simp_tac = 
  Code_Simp.static_tac {consts = [@{const_name arith_consts}], ctxt = @{context}, simpset = NONE}


fun eval_real_numeral_conv ctxt ct =
  case Thm.term_of ct of
    @{term "Pure.imp"} $ _ $ _ =&gt; Conv.implies_concl_conv (eval_real_numeral_conv ctxt) ct
  | _ =&gt;
      let
        val t = Thm.term_of ct
        val prop = Logic.mk_equals (t, @{term "Trueprop True"})
        val ctxt' = put_simpset (simpset_of @{context}) ctxt
        fun tac ({context = ctxt, ...}) =
          Local_Defs.unfold_tac ctxt @{thms greaterThanLessThan_iff}
          THEN (SOLVE (Simplifier.full_simp_tac ctxt' 1) ORELSE code_simp_tac ctxt 1)
      in
        if contains_only_numerals t then
          case try (fn () =&gt; Goal.prove ctxt [] [] prop tac) () of
            SOME thm =&gt; thm
          | NONE =&gt; raise CTERM ("eval_real_numeral_conv", [ct]) 
        else
          raise CTERM ("eval_real_numeral_conv", [ct])
      end *)</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
  SUBGOAL <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">goal</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=&gt;</span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">contains_only_numerals</span> <span class="main">(</span>Logic.strip_imp_concl <span class="entity">goal</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="entity">Eval_Numeral.eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span>
    <span class="keyword2"><span class="keyword">else</span></span>
      all_tac<span class="main">)</span>
  
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">unfold_simps</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> eval_akra_bazzi_le_list_ex eval_length of_nat_numeral 
           of_nat_0 of_nat_1 numeral_One<span class="antiquote">}</span></span></span>


<span class="comment1">(* Applying the locale intro rule *)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">master_theorem_function_tac</span> <span class="entity">simp</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> master_theorem_functionI<span class="antiquote">}</span></span></span>
  THEN_ALL_NEW <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> TRY <span class="main">(</span>REPEAT_ALL_NEW <span class="main">(</span>match_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> ball_set_intros<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span>
    THEN_ALL_NEW <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> TRY <span class="main">(</span><span class="entity">akra_bazzi_terms_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span>
      THEN_ALL_NEW <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span>
        <span class="entity">unfold_simps</span> <span class="entity">ctxt</span> <span class="entity">i</span>
        THEN TRY <span class="main">(</span><span class="entity">akra_bazzi_sum_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span>
        THEN <span class="entity">unfold_simps</span> <span class="entity">ctxt</span> <span class="entity">i</span>
        THEN <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">simp</span> <span class="keyword2"><span class="keyword">then</span></span> TRY <span class="main">(</span><span class="entity">eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> all_tac<span class="main">)</span>
      <span class="main">)</span>
    <span class="main">)</span>
  <span class="main">)</span>


<span class="comment1">(* Pre-processing of Landau bound in goal and post-processing of Landau bounds in premises *)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">goal_conv</span> <span class="entity">conv</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">case</span></span> Thm.term_of <span class="entity">ct</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Pure.imp"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span> $ <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> Conv.arg_conv <span class="main">(</span><span class="entity">goal_conv</span> <span class="entity">conv</span><span class="main">)</span> <span class="entity">ct</span>
  <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">conv</span> <span class="entity">ct</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">rewrs_conv'</span> <span class="entity">thms</span> <span class="main">=</span> 
  <span class="entity">goal_conv</span> <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.rewrs_conv <span class="entity">thms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">preprocess_tac</span> <span class="entity">ctxt</span> <span class="main">=</span>
  CONVERSION <span class="main">(</span><span class="entity">rewrs_conv'</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> CLAMP<span class="antiquote">}</span></span></span><span class="main">)</span>
  THEN' <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> propagate_CLAMP CLAMP_aux<span class="antiquote">}</span></span></span>
  THEN' <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> CLAMP_postproc<span class="antiquote">}</span></span></span>
  THEN' CONVERSION <span class="main">(</span><span class="entity">rewrs_conv'</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> UNCLAMP'<span class="antiquote">}</span></span></span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">rewrs_goal_conv</span> <span class="entity">thms</span> <span class="main">=</span> 
  <span class="entity">goal_conv</span> <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.rewrs_conv <span class="entity">thms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">rewrs_conv</span> <span class="entity">thms</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  Conv.repeat_conv <span class="main">(</span><span class="entity">changed_conv</span> <span class="main">(</span>Conv.bottom_conv <span class="main">(</span>K <span class="main">(</span>Conv.try_conv <span class="main">(</span>Conv.rewrs_conv <span class="entity">thms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">postprocess_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> TRY o <span class="main">(</span>
    CONVERSION <span class="main">(</span><span class="entity">rewrs_goal_conv</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> CLAMP<span class="antiquote">}</span></span></span><span class="main">)</span>
    THEN' <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> CLAMP_aux<span class="antiquote">}</span></span></span>
    THEN' <span class="entity">rewrite_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> CLAMP_postproc<span class="antiquote">}</span></span></span>
    THEN' CONVERSION <span class="main">(</span><span class="entity">rewrs_conv</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> MASTER_BOUND_postproc<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span> <span class="entity">ctxt</span><span class="main">)</span>
    THEN' CONVERSION <span class="main">(</span><span class="entity">rewrs_conv</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> MASTER_BOUND_UNCLAMP<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span> <span class="entity">ctxt</span><span class="main">)</span>
    THEN' CONVERSION <span class="main">(</span><span class="entity">rewrs_goal_conv</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> UNCLAMP<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span>


<span class="comment1">(* The main tactic *)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">intros_tac</span> <span class="entity">ctxt</span> <span class="entity">thms</span> <span class="main">=</span> DETERM o TRY o REPEAT_ALL_NEW <span class="main">(</span>DETERM o match_tac <span class="entity">ctxt</span> <span class="entity">thms</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">master_theorem_tac'</span> <span class="entity">caseno</span> <span class="entity">simp</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">funvar</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">p'</span> <span class="entity">ctxt</span> <span class="main">=</span>
    <span class="main">(</span>
      <span class="entity">preprocess_tac</span> <span class="entity">ctxt</span>
      THEN' <span class="entity">akra_bazzi_instantiate_tac</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">funvar</span> <span class="entity">p'</span> <span class="main">(</span><span class="entity">get_intros</span> <span class="entity">caseno</span> <span class="main">(</span><span class="entity">p'</span> &lt;&gt; NONE<span class="main">)</span><span class="main">)</span>
      THEN' DETERM o <span class="entity">master_theorem_function_tac</span> <span class="entity">simp</span> <span class="entity">ctxt</span><span class="main">)</span>
    THEN_ALL_NEW <span class="entity">intros_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> ball_set_intros akra_bazzi_p_rel_intros<span class="antiquote">}</span></span></span>
  THEN_ALL_NEW <span class="main">(</span>DETERM o <span class="main">(</span>
        <span class="entity">unfold_simps</span> <span class="entity">ctxt</span>
        THEN' TRY o <span class="entity">akra_bazzi_sum_tac</span> <span class="entity">ctxt</span>
        THEN' <span class="entity">unfold_simps</span> <span class="entity">ctxt</span>
        THEN' <span class="entity">postprocess_tac</span> <span class="entity">ctxt</span>
        THEN' <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">simp</span> <span class="keyword2"><span class="keyword">then</span></span> TRY o <span class="entity">eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="keyword2"><span class="keyword">else</span></span> K all_tac<span class="main">)</span>
        THEN' <span class="entity">intros_tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> allI ballI conjI impI<span class="antiquote">}</span></span></span>
        THEN_ALL_NEW <span class="main">(</span>TRY o eresolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> atLeastLessThanE<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">find_function</span> <span class="entity">goal</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">goal</span> |&gt; Logic.strip_imp_concl |&gt; <span class="entity">HOLogic.dest_Trueprop</span> <span class="keyword2"><span class="keyword">of</span></span>
      <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Set.member <span class="main">::</span> <span class="main">(</span>nat <span class="main">=&gt;</span> real<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">_</span> set <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span> $ <span class="entity">f</span> $ <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">f</span>
    <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"find_function"</span><span class="main">,</span> <span class="main">[</span><span class="entity">goal</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">leq_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(&lt;=)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">less_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> nat <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> bool"</span><span class="antiquote">}</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">find_x1</span> <span class="entity">var</span> <span class="entity">eq</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_x1</span> <span class="entity">prem</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prem</span> |&gt; <span class="entity">HOLogic.dest_Trueprop</span> <span class="keyword2"><span class="keyword">of</span></span>
        <span class="entity">rel</span> $ <span class="entity">x1</span> $ <span class="entity">x</span> <span class="main">=&gt;</span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">var</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">rel</span> <span class="main">=</span> <span class="entity">leq_nat</span> <span class="keyword2"><span class="keyword">then</span></span>
            SOME <span class="entity">x1</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">var</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">rel</span> <span class="main">=</span> <span class="entity">less_nat</span> <span class="keyword2"><span class="keyword">then</span></span>
            SOME <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Suc"</span><span class="antiquote">}</span></span> $ <span class="entity">x1</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">else</span></span>
            NONE
      <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> NONE
  <span class="keyword2"><span class="keyword">in</span></span>
    get_first <span class="entity">get_x1</span> <span class="main">(</span>Thm.prems_of <span class="entity">eq</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> NONE

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">analyze_funeq</span> <span class="entity">pat</span> <span class="entity">var</span> <span class="entity">ctxt</span> <span class="entity">eq</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">lhs</span> <span class="main">=</span> <span class="entity">eq</span> |&gt; Thm.concl_of |&gt; <span class="entity">HOLogic.dest_Trueprop</span> |&gt; <span class="entity">HOLogic.dest_eq</span> |&gt; fst
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">matcher</span> <span class="main">=</span> Thm.first_order_match <span class="main">(</span>Thm.cterm_of <span class="entity">ctxt</span> <span class="entity">lhs</span><span class="main">,</span> <span class="entity">pat</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eq</span> <span class="main">=</span> Thm.instantiate <span class="entity">matcher</span> <span class="entity">eq</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">find_x1</span> <span class="entity">var</span> <span class="entity">eq</span> <span class="keyword2"><span class="keyword">of</span></span>
      NONE <span class="main">=&gt;</span> NONE
    <span class="main">|</span> SOME <span class="main">_</span> <span class="main">=&gt;</span> SOME <span class="entity">eq</span>
  <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword3"><span class="keyword">handle</span></span> Pattern.MATCH <span class="main">=&gt;</span> NONE

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">find_funeq</span> <span class="entity">ctxt</span> <span class="entity">f</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n</span> <span class="main">=</span> <span class="main">(</span><span class="inner_quoted">"n"</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n'</span> <span class="main">=</span> Var <span class="main">(</span><span class="entity">n</span><span class="main">,</span> <span class="entity">HOLogic.natT</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pat</span> <span class="main">=</span> Thm.cterm_of <span class="entity">ctxt</span> <span class="main">(</span>Term.betapply <span class="main">(</span><span class="entity">f</span><span class="main">,</span> <span class="entity">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_function_info</span> <span class="main">(</span>Abs <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="entity">body</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">get_function_info</span> <span class="entity">body</span>
      <span class="main">|</span> <span class="entity">get_function_info</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="entity">f</span> $ <span class="main">_</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="entity">Function.get_info</span> <span class="entity">ctxt</span> <span class="entity">t</span> <span class="keyword3"><span class="keyword">handle</span></span> Empty <span class="main">=&gt;</span> <span class="entity">get_function_info</span> <span class="entity">f</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">get_function_info</span> <span class="entity">t</span> <span class="main">=</span> <span class="entity">Function.get_info</span> <span class="entity">ctxt</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span>simps <span class="main">=</span> <span class="entity">simps</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span> <span class="entity">get_function_info</span> <span class="entity">f</span>
      <span class="keyword3"><span class="keyword">handle</span></span> List.Empty <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"Could not obtain function info record."</span><span class="main">,</span> <span class="main">[</span><span class="entity">f</span><span class="main">]</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simps</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">simps</span> <span class="keyword2"><span class="keyword">of</span></span>
        SOME <span class="entity">simps</span> <span class="main">=&gt;</span> <span class="entity">simps</span>
      <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"Function has no simp rules."</span><span class="main">,</span> <span class="main">[</span><span class="entity">f</span><span class="main">]</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">case</span></span> get_first <span class="main">(</span><span class="entity">analyze_funeq</span> <span class="entity">pat</span> <span class="entity">n'</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">simps</span> <span class="keyword2"><span class="keyword">of</span></span>
      SOME <span class="entity">s</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">n'</span><span class="main">)</span>
    <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"Could not determine recurrence from simp rules."</span><span class="main">,</span> <span class="main">[</span><span class="entity">f</span><span class="main">]</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">master_theorem_tac</span> <span class="entity">caseno</span> <span class="entity">simp</span> <span class="entity">eq</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">p'</span> <span class="entity">ctxt</span> <span class="main">=</span>
  SUBGOAL <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">goal</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">Subgoal.FOCUS</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">f</span> <span class="main">=</span> <span class="entity">find_function</span> <span class="entity">goal</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">eq</span><span class="main">,</span> <span class="entity">funvar</span><span class="main">)</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">eq</span> <span class="keyword2"><span class="keyword">of</span></span>
          SOME <span class="entity">eq</span> <span class="main">=&gt;</span> <span class="main">(</span>
            <span class="keyword2"><span class="keyword">let</span></span>
              <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n</span> <span class="main">=</span> Var <span class="main">(</span><span class="main">(</span><span class="inner_quoted">"n"</span><span class="main">,</span> <span class="inner_numeral">0</span><span class="main">)</span><span class="main">,</span> <span class="entity">HOLogic.natT</span><span class="main">)</span>
            <span class="keyword2"><span class="keyword">in</span></span>
              <span class="keyword2"><span class="keyword">case</span></span> <span class="main">(</span><span class="entity">analyze_funeq</span> <span class="main">(</span>Thm.cterm_of <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">f</span> $ <span class="entity">n</span><span class="main">)</span><span class="main">)</span> <span class="entity">n</span> <span class="entity">ctxt</span> <span class="entity">eq</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
                SOME <span class="entity">eq</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">eq</span><span class="main">,</span> <span class="entity">n</span><span class="main">)</span>
              <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">""</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span>
            <span class="keyword2"><span class="keyword">end</span></span>
              <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span>
                <span class="inner_quoted">"Could not determine recursion variable from recurrence theorem."</span><span class="main">,</span>
                <span class="main">[</span>Thm.prop_of <span class="entity">eq</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">find_funeq</span> <span class="entity">ctxt</span> <span class="entity">f</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x0</span> <span class="main">=</span> Option.getOpt <span class="main">(</span><span class="entity">x0</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span><span class="antiquote">}</span></span><span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x1</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> Option.isSome <span class="entity">x1</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">x1</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">find_x1</span> <span class="entity">funvar</span> <span class="entity">eq</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">x1</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">x1</span> <span class="keyword2"><span class="keyword">of</span></span>
          SOME <span class="entity">x1</span> <span class="main">=&gt;</span> <span class="entity">x1</span>
        <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"Could not determine x1 from recurrence theorem"</span><span class="main">,</span> 
                              <span class="main">[</span><span class="entity">goal</span><span class="main">,</span> Thm.prop_of <span class="entity">eq</span><span class="main">,</span> <span class="entity">funvar</span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">p'</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">caseno</span> <span class="main">=</span> NONE <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">caseno</span> <span class="main">=</span> SOME <span class="inner_quoted">"1"</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">caseno</span> <span class="main">=</span> SOME <span class="inner_quoted">"2.1"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">p'</span> <span class="keyword2"><span class="keyword">else</span></span> NONE
    <span class="keyword2"><span class="keyword">in</span></span>
      HEADGOAL <span class="main">(</span><span class="entity">master_theorem_tac'</span> <span class="entity">caseno</span> <span class="entity">simp</span> <span class="entity">f</span> <span class="entity">eq</span> <span class="entity">funvar</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">p'</span> <span class="entity">ctxt</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>
  <span class="main">)</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span> 
    <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> K no_tac


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">read_term_with_type</span> <span class="entity">ctxt</span> <span class="entity">T</span> <span class="main">=</span> Syntax.check_term <span class="entity">ctxt</span> o Type.constraint <span class="entity">T</span> o Syntax.parse_term <span class="entity">ctxt</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">parse_assoc</span> <span class="entity">key</span> <span class="entity">scan</span> <span class="main">=</span> Scan.lift <span class="main">(</span>Args.$$$ <span class="entity">key</span> -- Args.colon<span class="main">)</span> -- <span class="entity">scan</span> &gt;&gt; snd

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">parse_param</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">term_with_type</span> <span class="entity">T</span> <span class="main">=</span> 
      Scan.peek <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">context</span> <span class="main">=&gt;</span> Args.embedded_inner_syntax &gt;&gt; 
        <span class="entity">read_term_with_type</span> <span class="main">(</span>Context.proof_of <span class="entity">context</span><span class="main">)</span> <span class="entity">T</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    <span class="entity">parse_assoc</span> <span class="inner_quoted">"recursion"</span> <span class="entity">Attrib.thm</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>SOME <span class="entity">x</span><span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">)</span><span class="main">)</span> ||
    <span class="entity">parse_assoc</span> <span class="inner_quoted">"x0"</span> <span class="main">(</span><span class="entity">term_with_type</span> <span class="entity">HOLogic.natT</span><span class="main">)</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>NONE<span class="main">,</span> SOME <span class="entity">x</span><span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">)</span><span class="main">)</span> ||
    <span class="entity">parse_assoc</span> <span class="inner_quoted">"x1"</span> <span class="main">(</span><span class="entity">term_with_type</span> <span class="entity">HOLogic.natT</span><span class="main">)</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>NONE<span class="main">,</span> NONE<span class="main">,</span> SOME <span class="entity">x</span><span class="main">,</span> NONE<span class="main">)</span><span class="main">)</span> ||
    <span class="entity">parse_assoc</span> <span class="inner_quoted">"p'"</span> <span class="main">(</span><span class="entity">term_with_type</span> <span class="entity">HOLogic.realT</span><span class="main">)</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>NONE<span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">,</span> SOME <span class="entity">x</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">parse_params</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">add_option</span> NONE <span class="entity">y</span> <span class="main">=</span> <span class="entity">y</span>
      <span class="main">|</span> <span class="entity">add_option</span> <span class="entity">x</span> <span class="main">_</span> <span class="main">=</span> <span class="entity">x</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">b</span><span class="main">,</span><span class="entity">c</span><span class="main">,</span><span class="entity">d</span><span class="main">)</span> <span class="main">(</span><span class="entity">a'</span><span class="main">,</span><span class="entity">b'</span><span class="main">,</span><span class="entity">c'</span><span class="main">,</span><span class="entity">d'</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="entity">add_option</span> <span class="entity">a</span> <span class="entity">a'</span><span class="main">,</span> <span class="entity">add_option</span> <span class="entity">b</span> <span class="entity">b'</span><span class="main">,</span> <span class="entity">add_option</span> <span class="entity">c</span> <span class="entity">c'</span><span class="main">,</span> <span class="entity">add_option</span> <span class="entity">d</span> <span class="entity">d'</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    Scan.repeat <span class="entity">parse_param</span> &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">xs</span> <span class="main">=&gt;</span> fold <span class="entity">go</span> <span class="entity">xs</span> <span class="main">(</span>NONE<span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">,</span> NONE<span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">setup_master_theorem</span> <span class="main">=</span> 
  Scan.option <span class="main">(</span>Scan.lift <span class="main">(</span>Parse.number || Parse.float_number<span class="main">)</span><span class="main">)</span>
  -- Scan.lift <span class="main">(</span>Args.parens <span class="main">(</span>Args.$$$ <span class="inner_quoted">"nosimp"</span><span class="main">)</span> &gt;&gt; K false || Scan.succeed true<span class="main">)</span>
  -- <span class="entity">parse_params</span>
  &gt;&gt;
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">caseno</span><span class="main">,</span> <span class="entity">simp</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">thm</span><span class="main">,</span> <span class="entity">x0</span><span class="main">,</span> <span class="entity">x1</span><span class="main">,</span> <span class="entity">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> 
      <span class="keyword2"><span class="keyword">let</span></span> 
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">caseno</span> <span class="keyword2"><span class="keyword">of</span></span>
            SOME <span class="entity">caseno</span> <span class="main">=&gt;</span>
              <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">[</span><span class="inner_quoted">"1"</span><span class="main">,</span><span class="inner_quoted">"2.1"</span><span class="main">,</span><span class="inner_quoted">"2.2"</span><span class="main">,</span><span class="inner_quoted">"2.3"</span><span class="main">,</span><span class="inner_quoted">"3"</span><span class="main">]</span> <span class="entity">caseno</span> <span class="keyword2"><span class="keyword">then</span></span>
                <span class="main">(</span><span class="main">)</span>
              <span class="keyword2"><span class="keyword">else</span></span>
                cat_error <span class="inner_quoted">"illegal Master theorem case: "</span> <span class="entity">caseno</span>
          <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> 
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">master_theorem_tac</span> <span class="entity">caseno</span> <span class="entity">simp</span> <span class="entity">thm</span> <span class="entity">x0</span> <span class="entity">x1</span> <span class="entity">p'</span> <span class="entity">ctxt</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
   
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
</pre>
</div><div id="Akra_Bazzi_Approximation">
<div class="head">
<h1>Theory Akra_Bazzi_Approximation</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Akra_Bazzi_Approximation
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Akra_Bazzi_Method.html">Akra_Bazzi_Method</a>
  <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* 
  This is a temporary workaround since recent changes broke approximation of the "powr" function. 
  Once it works again, this entire section can be removed.
*)</span>

<span class="keyword1"><span class="command">context</span></span> akra_bazzi_params_nonzero
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="bound">i</span> <span class="keyword1">powr</span> <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="free">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> b_bounds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">bs</span><span class="main">!</span><span class="skolem">i</span> <span class="keyword1">powr</span> <span class="free">p'</span> <span class="main">=</span> <span class="free">as</span><span class="main">!</span><span class="skolem">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> akra_bazzi_p_rel_intros_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">&lt;</span> p"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">&gt;</span> p"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">≤</span> p"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p'</span> <span class="main">≥</span> p"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> p <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_lessI p_greaterI p_leI p_geI p_boundsI p_boundsI' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_alt<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> akra_bazzi_p_rel_intros_exp <span class="main">=</span> 
  akra_bazzi_params_nonzero.akra_bazzi_p_rel_intros_aux<span class="main">[</span><span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> _ akra_bazzi_params_nonzeroI<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_akra_bazzi_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">bs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="free">b</span><span class="main">)</span> <span class="main">+</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">as</span><span class="main">!</span><span class="bound">i</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">bs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* end workaround *)</span>


<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">AKRA_BAZZI_APPROXIMATION</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> akra_bazzi_approximate_tac <span class="main">:</span> int <span class="main">-&gt;</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Akra_Bazzi_Approximation</span><span class="main">:</span> <span class="entity">AKRA_BAZZI_APPROXIMATION</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">akra_bazzi_approximate_tac</span> <span class="entity">prec</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simps</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> eval_length eval_akra_bazzi_sum add_0_left add_0_right 
                       mult_1_left mult_1_right<span class="antiquote">}</span></span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    SELECT_GOAL <span class="main">(</span>
      resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> akra_bazzi_p_rel_intros_exp<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span>
      THEN ALLGOALS <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> &gt; <span class="inner_numeral">1</span> <span class="keyword2"><span class="keyword">then</span></span> 
          SELECT_GOAL <span class="main">(</span>
            Local_Defs.unfold_tac <span class="entity">ctxt</span> 
              <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> bex_set_simps ball_set_simps greaterThanLessThan_iff eval_length<span class="antiquote">}</span></span></span>
            THEN TRY <span class="main">(</span>SOLVE <span class="main">(</span><span class="entity">Eval_Numeral.eval_numeral_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">)</span> <span class="entity">i</span>
        <span class="keyword2"><span class="keyword">else</span></span> 
          SELECT_GOAL <span class="main">(</span>Local_Defs.unfold_tac <span class="entity">ctxt</span> <span class="entity">simps</span><span class="main">)</span> <span class="entity">i</span>
          THEN <span class="entity">Approximation.approximation_tac</span> <span class="entity">prec</span> <span class="main">[</span><span class="main">]</span> NONE <span class="entity">ctxt</span> <span class="entity">i</span>
      <span class="main">)</span> 
    <span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
   
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> akra_bazzi_approximate <span class="main">=</span> <span class="quoted">‹
  Scan.lift Parse.nat &gt;&gt; 
    <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">prec</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> 
      <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">Akra_Bazzi_Approximation.akra_bazzi_approximate_tac</span> <span class="entity">prec</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"approximate transcendental Akra-Bazzi parameters"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Master_Theorem_Examples">
<div class="head">
<h1>Theory Master_Theorem_Examples</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Master_Theorem_Examples.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Examples for the application of the Master theorem and related proof methods.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Master_Theorem_Examples
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Akra_Bazzi_Method.html">Akra_Bazzi_Method</a>
  <a href="Akra_Bazzi_Approximation.html">Akra_Bazzi_Approximation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Merge sort›</span></span>

<span class="comment1">(* A merge sort cost function that is parametrised with the recombination costs *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">merge_sort_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">merge_sort_cost</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merge_sort_cost</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">merge_sort_cost</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="free">merge_sort_cost</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">merge_sort_cost</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>nat <span class="main">⌈</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌉</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> merge_sort_nonneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">t</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> merge_sort_cost <span class="free">t</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_sort_cost.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">t</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> merge_sort_cost <span class="free">t</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 2.3<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Karatsuba multiplication›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">karatsuba_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">karatsuba_cost</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">karatsuba_cost</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">karatsuba_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="numeral">3</span> <span class="main">*</span> <span class="free">karatsuba_cost</span> <span class="main">(</span>nat <span class="main">⌈</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌉</span><span class="main">)</span> <span class="main">+</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> karatsuba_cost_nonneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"karatsuba_cost <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> karatsuba_cost.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"karatsuba_cost <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> karatsuba_cost_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> karatsuba_cost <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> karatsuba_cost.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_nonneg_pos <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"karatsuba_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> karatsuba_cost_pos
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide eventually_at_top_linorder<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Strassen matrix multiplication›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">strassen_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strassen_cost</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">strassen_cost</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">strassen_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">7</span> <span class="main">*</span> <span class="free">strassen_cost</span> <span class="main">(</span>nat <span class="main">⌈</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌉</span><span class="main">)</span> <span class="main">+</span> real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> strassen_cost_nonneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strassen_cost <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> strassen_cost.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"strassen_cost <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> <span class="numeral">7</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_divide eventually_at_top_linorder<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strassen_cost_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> strassen_cost <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> strassen_cost.cases<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_nonneg_pos <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"strassen_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> <span class="numeral">7</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strassen_cost_pos
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_divide eventually_at_top_linorder<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Deterministic select›</span></span>

<span class="comment1">(* This is not possible with the standard Master theorem from literature *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">select_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">select_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">select_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="free">select_cost</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">5</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">select_cost</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="numeral">7</span> <span class="main">*</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">10</span><span class="main">⌋</span> <span class="main">+</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">12</span> <span class="main">*</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">5</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"select_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 3<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Decreasing function›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">dec_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">dec_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">dec_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">0.5</span><span class="main">*</span><span class="free">dec_cost</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dec_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">.</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 2.3<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example taken from Drmota and Szpakowski›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">drmota1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">drmota1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">drmota1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">drmota1</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">8</span><span class="main">/</span><span class="numeral">9</span> <span class="main">*</span> <span class="free">drmota1</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="numeral">3</span><span class="main">*</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">4</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> ln <span class="main">(</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"drmota1 <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">n</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 2.2<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>


<span class="keyword1"><span class="command">function</span></span> <span class="entity">drmota2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">drmota2</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">drmota2</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">drmota2</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">3</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">/</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">drmota2</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="numeral">2</span><span class="main">*</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"drmota2 <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">master_theorem</span> <span class="operator">simp_all</span>

<span class="comment1">(* Average phrase length of Boncelet arithmetic coding. See Drmota and Szpankowski. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> boncelet_phrase_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≡</span> <span class="main">1</span> <span class="main">-</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">d</span> <span class="bound">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">d</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">d</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">p</span> <span class="main">*</span> real <span class="bound">n</span> <span class="main">+</span> <span class="free">δ</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">d</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">q</span> <span class="main">*</span> real <span class="bound">n</span> <span class="main">-</span> <span class="free">δ</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> <span class="quasi_keyword">recursion</span><span class="main"><span class="main">:</span></span> d_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transcendental exponents›</span></span>

<span class="comment1">(* Certain number-theoretic conjectures would imply that if all the parameters are rational,
   the Akra-Bazzi parameter is either rational or transcendental. That makes this case 
   probably transcendental *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">foo_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">200</span> <span class="main">⟹</span> <span class="free">foo_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">200</span> <span class="main">⟹</span> <span class="free">foo_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="free">foo_cost</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">3</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">foo_cost</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="numeral">3</span> <span class="main">*</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">4</span><span class="main">⌋</span> <span class="main">+</span> <span class="numeral">42</span><span class="main">)</span> <span class="main">+</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> foo_cost_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"foo_cost <span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> foo_cost.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"foo_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="keyword1">powr</span> akra_bazzi_exponent <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="numeral">200</span><span class="main">.</span> foo_cost <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_nonneg_pos<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> foo_cost <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"akra_bazzi_exponent <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">]</span> <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">]</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">1.1519623</span><span class="main">..</span><span class="numeral">1.1519624</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">akra_bazzi_approximate</span> 29<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions in locale contexts›</span></span>

<span class="keyword1"><span class="command">locale</span></span> det_select <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">7</span><span class="main">/</span><span class="numeral">10</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">select_cost'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">select_cost'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="numeral">20</span> <span class="main">⟹</span> <span class="free">select_cost'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="free">select_cost'</span> <span class="main">(</span>nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">5</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">select_cost'</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free">b</span> <span class="main">*</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⌋</span> <span class="main">+</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">6</span> <span class="main">*</span> real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="numeral">5</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> select_cost' <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-curried functions›</span></span>

<span class="comment1">(* Note: either a or b could be seen as recursion variables. *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">baz_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">baz_cost</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">baz_cost</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="free">baz_cost</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> real <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> baz_cost_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> baz_cost <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> baz_cost.induct<span class="main"><span class="main">[</span></span><span class="operator">split_format</span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="quasi_keyword"><span class="quasi_keyword">complete</span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> baz_cost <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="numeral">3</span><span class="main">.</span> baz_cost <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_nonneg_pos<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> baz_cost <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide<span class="main">)</span>

<span class="comment1">(* Non-"Akra-Bazzi" variables may even be modified without impacting the termination proof.
   However, the Akra-Bazzi theorem and the Master theorem itself do not apply anymore, 
   because bar_cost cannot be seen as a recursive function with one parameter *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">bar_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">bar_cost</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="free">bar_cost</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="free">bar_cost</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> nat <span class="main">⌊</span>real <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">/</span> <span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> real <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ham-sandwich trees›</span></span>
<span class="comment1">(* f(n) = f(n/4) + f(n/2) + 1 *)</span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">ham_sandwich_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">⟹</span> <span class="free">ham_sandwich_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="numeral">4</span> <span class="main">⟹</span> <span class="free">ham_sandwich_cost</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
      <span class="free">ham_sandwich_cost</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">4</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="free">ham_sandwich_cost</span> <span class="main">(</span>nat <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">/</span><span class="numeral">2</span><span class="main">⌋</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">akra_bazzi_termination</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> ham_sandwich_cost_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ham_sandwich_cost <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ham_sandwich_cost.induct<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The golden ratio›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> sqrt <span class="numeral">5</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> φ_pos <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"φ <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"φ <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"φ <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_nonneg<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ham_sandwich_cost <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span>log <span class="numeral">2</span> φ<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">master_theorem</span> 1 <span class="quasi_keyword">p'</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ <span class="main">=</span>
            inverse <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> inverse <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_powr power2_eq_square powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> powr_log_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> inverse <span class="main">(</span>φ<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> inverse φ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"φ <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> φ<span class="main">*</span>φ"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>φ<span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> inverse φ <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> log <span class="numeral">2</span> φ <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>