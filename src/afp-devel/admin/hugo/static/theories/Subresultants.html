<div id="Resultant_Prelim">
<div class="head">
<h1>Theory Resultant_Prelim</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Resultants›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory defines the Sylvester matrix and the resultant and contains 
  basic facts about these notions. After the connection between resultants
  and subresultants has been established, we then use properties of subresultants
  to transfer them to resultants. Remark: these properties have previously been proven
  separately for both resultants and subresultants; and this is the reason for
  splitting the theory of resultants in two parts, namely ``Resultant-Prelim'' and
  ``Resultant'' which is located in the Algebraic-Number AFP-entry. 
›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Resultant_Prelim
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Jordan_Normal_Form/Determinant.html">Jordan_Normal_Form.Determinant</a> 
  <a href="../Polynomial_Interpolation/Ring_Hom_Poly.html">Polynomial_Interpolation.Ring_Hom_Poly</a> 
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sylvester matrix›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sylvester_mat_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sylvester_mat_sub</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span>
   mat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span>
     <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="bound">i</span> <span class="keyword1">then</span> coeff <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sylvester_mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sylvester_mat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> sylvester_mat_sub <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_sub_dim"><span class="command">lemma</span></span> sylvester_mat_sub_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">S</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">S</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> S_def sylvester_mat_sub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_sub_carrier"><span class="command">lemma</span></span> sylvester_mat_sub_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_dim"><span class="command">lemma</span></span> sylvester_mat_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_carrier_mat"><span class="command">lemma</span></span> sylvester_carrier_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> carrier_mat <span class="free">d</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_sub_index"><span class="command">lemma</span></span> sylvester_mat_sub_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> coeff <span class="free">p</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">then</span> coeff <span class="free">q</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_sub_def
  <span class="keyword1"><span class="command">unfolding</span></span> index_mat<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i j<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_index_mat"><span class="command">lemma</span></span> sylvester_index_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="free">q</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="keyword1">then</span> coeff <span class="free">p</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">i</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">then</span> coeff <span class="free">q</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_def
  <span class="keyword1"><span class="command">using</span></span> sylvester_mat_sub_index<span class="main">[</span><span class="operator">OF</span> i j<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Resultant_Prelim-sylvester_index_mat2"><span class="command">lemma</span></span> sylvester_index_mat2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="free">q</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>
     <span class="keyword1">else</span> coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sylvester_index_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> m_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_monom_mult
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">m</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> j m_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i j coeff_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_sub_0"><span class="command">lemma</span></span> sylvester_mat_sub_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sylvester_mat_sub <span class="main">0</span> <span class="free">n</span> <span class="main">0</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_sub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_0"><span class="command">lemma</span></span> sylvester_mat_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="main">0</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_const"><span class="command">lemma</span></span> sylvester_mat_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="free">q</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sylvester_index_mat<span class="main">)</span>

<span class="keyword1" id="Resultant_Prelim-sylvester_mat_sub_map"><span class="command">lemma</span></span> sylvester_mat_sub_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_mat <span class="free">f</span> <span class="main">(</span>sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> coeff_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">OF</span> f0<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="var">?l</span> <span class="main">=</span> dim_row <span class="var">?r</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?l</span> <span class="main">=</span> dim_col <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="var">?r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> ij' <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> sylvester_mat_sub_dim<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> ij'' <span class="main">=</span> ij<span class="main">[</span><span class="operator">unfolded</span> dim<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">symmetric</span></span><span class="main"><span class="main"><span class="main">]</span></span></span> index_map_mat<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> index_map_mat<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ij''<span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_sub_index<span class="main">[</span><span class="operator">OF</span> ij'<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def
    <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resultant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> det <span class="main">(</span>sylvester_mat <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Resultant, but the size of the base Sylvester matrix is given.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">resultant_sub</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> det <span class="main">(</span>sylvester_mat_sub <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Resultant_Prelim-resultant_sub"><span class="command">lemma</span></span> resultant_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> resultant_sub <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_def sylvester_mat_def resultant_sub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Resultant_Prelim-resultant_const"><span class="command">lemma</span></span> resultant_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="free">q</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_def <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Resultant_Prelim-resultant_1"><span class="command">lemma</span></span> resultant_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="main">1</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> resultant_const<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> resultant_const<span class="main">(</span>2<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons_one<span class="main">)</span>

<span class="keyword1" id="Resultant_Prelim-resultant_0"><span class="command">lemma</span></span> resultant_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> resultant_const<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> resultant_const<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> zero_power assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> resultant_map_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">⟹</span>
  degree <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">q</span> <span class="main">⟹</span> resultant <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>resultant <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_def sylvester_mat_def sylvester_mat_sub_def hom_det<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">det</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_comm_ring_hom<span class="main">)</span> resultant_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>resultant <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> resultant_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dichotomous_Lazard">
<div class="head">
<h1>Theory Dichotomous_Lazard</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Dichotomous Lazard›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains Lazard's optimization in the computation of
  the subresultant PRS as described by Ducos \cite[Section 2]{Ducos}.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Dichotomous_Lazard
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span> <span class="comment1">(* to_fract *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="Dichotomous_Lazard-power_fract"><span class="command">lemma</span></span> power_fract<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> Fract <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fract_collapse<span class="main">)</span> 
  
<span class="keyword1" id="Dichotomous_Lazard-range_to_fract_dvd_iff"><span class="command">lemma</span></span> range_to_fract_dvd_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> range to_fract <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Fract <span class="skolem">c</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fract<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> range to_fract"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_fract_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> range to_fract"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Fract <span class="skolem">c</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_fract_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fract<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Dichotomous_Lazard-Fract_cases_coprime"><span class="command">lemma</span></span> Fract_cases_coprime <span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> fract<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_ring_gcd fract"</span></span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>Fract<span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Fract <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Fract <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcd <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">g</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">g</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> b0 b <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Fract <span class="skolem">A</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q a b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq_fract<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b0 0 g<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">A</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A B g <span class="keyword1"><span class="command">using</span></span> b0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_gcd_coprime<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> Fract <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> coprime <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> q 0 cop<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Dichotomous_Lazard-to_fract_power_le"><span class="command">lemma</span></span> to_fract_power_le<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_ring_gcd fract"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_fract<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">e</span> <span class="main">∈</span> range to_fract"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> range to_fract"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="free">e</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">f</span> <span class="main">∈</span> range to_fract"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bn</span></span> <span class="skolem"><span class="skolem">bd</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> Fract <span class="skolem">bn</span> <span class="skolem">bd</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> copb<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">bn</span> <span class="skolem">bd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">an</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Fract <span class="skolem">an</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">unfolding</span></span> to_fract_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">e</span> <span class="main">=</span> Fract <span class="main">(</span><span class="skolem">an</span> <span class="main">*</span> <span class="skolem">bn</span><span class="main">^</span><span class="free">e</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bd</span><span class="main">^</span><span class="free">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a b power_fract mult_fract <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span><span class="main">^</span><span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span> <span class="keyword1"><span class="command">using</span></span> bd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> no_fract<span class="main">[</span><span class="operator">unfolded</span> id range_to_fract_dvd_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span> <span class="main">^</span> <span class="free">e</span> <span class="keyword1">dvd</span> <span class="skolem">an</span> <span class="main">*</span> <span class="skolem">bn</span> <span class="main">^</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> copb <span class="keyword1"><span class="command">have</span></span> copb<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">bd</span> <span class="main">^</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bn</span> <span class="main">^</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dvd copb <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span> bd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span> <span class="main">^</span> <span class="free">e</span> <span class="keyword1">dvd</span> <span class="skolem">an</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span> <span class="main">^</span> <span class="free">f</span> <span class="keyword1">dvd</span> <span class="skolem">an</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_le_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bd</span> <span class="main">^</span> <span class="free">f</span> <span class="keyword1">dvd</span> <span class="skolem">an</span> <span class="main">*</span> <span class="skolem">bn</span> <span class="main">^</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> le <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">f</span> <span class="main">+</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="free">f</span> <span class="main">=</span> Fract <span class="main">(</span><span class="skolem">an</span> <span class="main">*</span> <span class="skolem">bn</span><span class="main">^</span><span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">bd</span><span class="main">^</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a b power_fract mult_fract <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id' range_to_fract_dvd_iff<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Dichotomous_Lazard-div_divide_to_fract"><span class="command">lemma</span></span> div_divide_to_fract<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> range to_fract"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide fract<span class="main">)</span> <span class="main">/</span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">=</span> <span class="free">y'</span> <span class="keyword1">div</span> <span class="free">z'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> to_fract <span class="free">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> to_fract <span class="free">z'</span>"</span></span>   
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> to_fract <span class="free">x'</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False    
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"to_fract <span class="free">y'</span> <span class="main">/</span> to_fract <span class="free">z'</span> <span class="main">=</span> to_fract <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fract<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> to_fract_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">declare</span></span> divmod_nat_def<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dichotomous_Lazard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dichotomous_Lazard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="main">1</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">=</span> Divides.divmod_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="numeral">2</span><span class="main">;</span> 
       <span class="bound">rec</span> <span class="main">=</span> <span class="free">dichotomous_Lazard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">d</span><span class="main">;</span>
       <span class="bound">recsq</span> <span class="main">=</span> <span class="bound">rec</span> <span class="main">*</span> <span class="bound">rec</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">recsq</span> <span class="keyword1">else</span> <span class="bound">recsq</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Dichotomous_Lazard-dichotomous_Lazard_main"><span class="command">lemma</span></span> dichotomous_Lazard_main<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_fract <span class="main">(</span>dichotomous_Lazard <span class="free">x</span> <span class="free">y</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dichotomous_Lazard.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted">to_fract</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>n<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>   
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> n
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"Divides.divmod_nat <span class="skolem">n</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> divmod_nat_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> n2 <span class="keyword1"><span class="command">have</span></span> dr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rec</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rec</span> <span class="main">=</span> dichotomous_Lazard <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">d</span>"</span></span>      
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">rec</span> <span class="main">*</span> <span class="skolem">rec</span> <span class="keyword1">div</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"dichotomous_Lazard <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="var">?sq</span> <span class="keyword1">else</span> <span class="var">?sq</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dichotomous_Lazard.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n2 Let_def rec_def <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ndr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">from</span></span> ndr r n <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">rec</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">d</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> n refl n2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> rec_def<span class="main">]</span> ndr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">rec</span> <span class="main">*</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">d</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">d</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">rec</span> <span class="main">*</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?dd</span> <span class="main">=</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">d</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="var">?sq</span> <span class="main">=</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> div_divide_to_fract<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl refl id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dd<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">∈</span> range <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ndr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> res sq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ndr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sq'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> False res <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"dichotomous_Lazard <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">n</span> <span class="main">=</span> <span class="var">?sq'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> sq <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="var">?sq</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?dd</span> <span class="main">=</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d0 <span class="keyword1"><span class="command">unfolding</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">d</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> sq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="var">?sq'</span> <span class="main">=</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> div_divide_to_fract<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl refl id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dd<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">∈</span> range <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> ndr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> res sq' <span class="keyword1"><span class="command">unfolding</span></span> ndr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Dichotomous_Lazard-dichotomous_Lazard"><span class="command">lemma</span></span> dichotomous_Lazard<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_ring_gcd"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_fract <span class="main">(</span>dichotomous_Lazard <span class="free">x</span> <span class="free">y</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dichotomous_Lazard_main<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_fract <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">/</span> to_fract <span class="free">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"to_fract <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">/</span> to_fract <span class="free">y</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> to_fract <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>to_fract <span class="free">x</span> <span class="main">/</span> to_fract <span class="free">y</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"to_fract <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>to_fract <span class="free">x</span> <span class="main">/</span> to_fract <span class="free">y</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> to_fract_power_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ j<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> idd<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> to_fract <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> range to_fract"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">declare</span></span> dichotomous_Lazard.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Binary_Exponentiation">
<div class="head">
<h1>Theory Binary_Exponentiation</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Binary Exponentiation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory defines the standard algorithm for binary exponentiation, or 
  exponentiation by squaring.›</span></span> 
<span class="keyword1"><span class="command">theory</span></span> Binary_Exponentiation
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> divmod_nat_def<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">context</span></span> monoid_mult
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">binary_power</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">binary_power</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">=</span> Divides.divmod_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="numeral">2</span><span class="main">;</span> 
       <span class="bound">rec</span> <span class="main">=</span> <span class="free">binary_power</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="bound">d</span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">rec</span> <span class="keyword1">else</span> <span class="bound">rec</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Binary_Exponentiation-binary_power"><span class="command">lemma</span></span> binary_power<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"binary_power <span class="main">=</span> <span class="main">(^)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"binary_power <span class="skolem">x</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> binary_power.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"Divides.divmod_nat <span class="skolem">n</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> divmod_nat_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> n2 <span class="keyword1"><span class="command">have</span></span> dr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"binary_power <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"binary_power <span class="skolem">x</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="var">?rec</span> <span class="keyword1">else</span> <span class="var">?rec</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> binary_power.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n2 <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rec</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rec</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> power_add
        <span class="keyword1"><span class="command">using</span></span> power2_eq_square power_even_eq power_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Exponentiation-binary_power_code_unfold"><span class="command">lemma</span></span> binary_power_code_unfold<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(^)</span> <span class="main">=</span> binary_power"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">declare</span></span> binary_power.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="More_Homomorphisms">
<div class="head">
<h1>Theory More_Homomorphisms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Homomorphisms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We register two homomorphism, namely lifting constants to polynomials,
  and lifting elements of some domain into their fraction field.›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> More_Homomorphisms
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Polynomial_Interpolation/Ring_Hom_Poly.html">Polynomial_Interpolation.Ring_Hom_Poly</a>
   <a href="../Jordan_Normal_Form/Determinant.html">Jordan_Normal_Form.Determinant</a> <span class="comment1">(* Only to obtain lemmas stated there after interpretation *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">coeff_lift</span> <span class="main">==</span> <span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span> <span class="main">:]</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span> inj_comm_monoid_add_hom <span class="quoted">coeff_lift</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span> inj_ab_group_add_hom <span class="quoted">coeff_lift</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span> inj_comm_semiring_hom <span class="quoted">coeff_lift</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span> inj_comm_ring_hom <span class="quoted">coeff_lift</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span> inj_idom_hom <span class="quoted">coeff_lift</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following rule is incompatible with existing simp rules.›</span></span>
<span class="keyword1"><span class="command">declare</span></span> coeff_lift_hom.hom_mult<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> coeff_lift_hom.hom_add<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> coeff_lift_hom.hom_uminus<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> to_fract_hom<span class="main">:</span> inj_comm_ring_hom <span class="quoted">to_fract</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> to_fract_hom<span class="main">:</span> idom_hom <span class="quoted">to_fract</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> to_fract_hom<span class="main">:</span> inj_idom_hom <span class="quoted">to_fract</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Coeff_Int">
<div class="head">
<h1>Theory Coeff_Int</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Polynomial coefficients with integer index›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide a function to access the coefficients of a polynomial
  via an integer index. Then index-shifting becomes more convenient,
  e.g., compare in the lemmas for accessing the coeffiencent of a product
  with a monomial there is no special case for integer coefficients, whereas
  for natural number coefficients there is a case-distinction.›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Coeff_Int
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Polynomial_Interpolation/Missing_Polynomial.html">Polynomial_Interpolation.Missing_Polynomial</a> 
  <a href="../Jordan_Normal_Form/Missing_Permutations.html">Jordan_Normal_Form.Missing_Permutations</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">coeff_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero poly <span class="main">⇒</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coeff_int</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Coeff_Int-coeff_int_eq_0"><span class="command">lemma</span></span> coeff_int_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">&gt;</span> int <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> coeff_int <span class="free">p</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>

<span class="keyword1" id="Coeff_Int-coeff_int_smult"><span class="command">lemma</span></span> coeff_int_smult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> coeff_int <span class="free">p</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Coeff_Int-coeff_int_signof_mult"><span class="command">lemma</span></span> coeff_int_signof_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>signof <span class="free">x</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> signof <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>coeff_int <span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> signof_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_int_def<span class="main">)</span>

<span class="keyword1" id="Coeff_Int-coeff_int_sum"><span class="command">lemma</span></span> coeff_int_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>sum <span class="free">p</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> coeff_int <span class="main">(</span><span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coeff_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Coeff_Int-coeff_int_0"><span class="command">lemma</span></span> coeff_int_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Coeff_Int-coeff_int_monom_mult"><span class="command">lemma</span></span> coeff_int_monom_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>monom <span class="free">a</span> <span class="free">d</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> coeff_int <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> int <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonneg_eq_int<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="free">d</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>int <span class="skolem">j</span> <span class="main">-</span> int <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> coeff_monom_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def i
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_int_def coeff_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Coeff_Int-coeff_prod_const"><span class="command">lemma</span></span> coeff_prod_const<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="free">xs</span> <span class="main">*</span> coeff <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">y</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">y</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> degree0_coeffs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> fx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">c</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">xs</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> coeff <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">*</span> coeff <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.insert_remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Coeff_Int-coeff_int_prod_const"><span class="command">lemma</span></span> coeff_int_prod_const<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">xs</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="free">y</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> coeff_int <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="free">xs</span> <span class="main">*</span> coeff_int <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coeff_prod_const<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Coeff_Int-coeff_int"><span class="command">lemma</span></span> coeff_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="free">p</span> <span class="free">n</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="free">n</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Coeff_Int-coeff_int_minus"><span class="command">lemma</span></span> coeff_int_minus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff_int <span class="free">a</span> <span class="free">i</span> <span class="main">-</span> coeff_int <span class="free">b</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_int_def<span class="main">)</span>

<span class="keyword1" id="Coeff_Int-coeff_int_pCons_0"><span class="command">lemma</span></span> coeff_int_pCons_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>pCons <span class="main">0</span> <span class="free">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff_int <span class="free">b</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nitpick.case_nat_unfold coeff_int_def coeff_pCons nat_diff_distrib'<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Subresultant">
<div class="head">
<h1>Theory Subresultant</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subresultants and the subresultant PRS›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains most of the soundness proofs of the subresultant PRS algorithm,
  where we closely follow the papers of Brown \cite{Brown} and Brown and Traub \cite{BrownTraub}.
  This is in contrast to a similar Coq formalization of Mahboubi \cite{Mahboubi06} which
  is based on polynomial determinants.

  Whereas the current file only contains an algorithm to compute the resultant of two polynomials
  efficiently, there is another theory ``Subresultant-Gcd'' which also contains the algorithm
  to compute the GCD of two polynomials via the subresultant algorithm. In both algorithms we
  integrate Lazard's optimization in the dichotomous version,
  but not the second optmization described by Ducos \cite{Ducos}.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Subresultant
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Resultant_Prelim.html">Resultant_Prelim</a>
  <a href="Dichotomous_Lazard.html">Dichotomous_Lazard</a>
  <a href="Binary_Exponentiation.html">Binary_Exponentiation</a>
  <a href="More_Homomorphisms.html">More_Homomorphisms</a>
  <a href="Coeff_Int.html">Coeff_Int</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algorithm›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">div_exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">partial_function</span></span><span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">subresultant_prs_main</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subresultant_prs_main</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
   <span class="bound">m</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
   <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
   <span class="bound">lf</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
   <span class="bound">lg</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
   <span class="bound">δ</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">-</span> <span class="bound">n</span><span class="main">;</span>
   <span class="bound">d</span> <span class="main">=</span> <span class="free">div_exp</span> <span class="bound">lg</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">δ</span><span class="main">;</span>
   <span class="bound">h</span> <span class="main">=</span> pseudo_mod <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>
  <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="bound">d</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="free">subresultant_prs_main</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>sdiv_poly <span class="bound">h</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">lf</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">^</span> <span class="bound">δ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subresultant_prs</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subresultant_prs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
    <span class="bound">h</span> <span class="main">=</span> pseudo_mod <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">;</span>
    <span class="bound">δ</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-</span> degree <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="bound">d</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">^</span> <span class="bound">δ</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="bound">d</span><span class="main">)</span>
       <span class="keyword1">else</span> subresultant_prs_main <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">δ</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">h</span><span class="main">)</span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resultant_impl_main</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_main</span> <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="keyword1">case</span> subresultant_prs <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="keyword1">of</span>
     <span class="main">(</span><span class="bound">Gk</span><span class="main">,</span><span class="bound">hk</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="bound">Gk</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">hk</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resultant_impl_generic</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_generic</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="keyword1">then</span> resultant_impl_main <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">res</span> <span class="main">=</span> resultant_impl_main <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∨</span> even <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">res</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="bound">res</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">basic_div_exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">basic_div_exp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> basic_div_exp<span class="antiquote"><span class="antiquote">}</span></span></span></span> we obtain a more generic implementation, which is however
  less efficient. It is currently not further developed, except for getting the raw soundness statement.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resultant_impl_idom_divide</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_idom_divide</span> <span class="main">=</span> resultant_impl_generic basic_div_exp"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The default variant uses the optimized computation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> dichotomous_Lazard<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  For this variant, later on optimized code-equations are proven.
  However, the implementation restricts to sort <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> factorial_ring_gcd<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">resultant_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> factorial_ring_gcd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">resultant_impl</span> <span class="main">=</span> resultant_impl_generic dichotomous_Lazard"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness Proof for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"resultant_impl <span class="main"><span class="main">=</span></span> resultant"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Subresultant-basic_div_exp"><span class="command">lemma</span></span> basic_div_exp<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_fract <span class="main">(</span>basic_div_exp <span class="free">x</span> <span class="free">y</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> basic_div_exp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> div_divide_to_fract<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pdivmod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">×</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pdivmod</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-even_sum_list"><span class="command">lemma</span></span> even_sum_list<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> even <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>sum_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span>sum_list <span class="main">(</span>map <span class="free">g</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-for_all_Suc"><span class="command">lemma</span></span> for_all_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> Suc <span class="free">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> <span class="free">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">P</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_le_eq less_le<span class="main">)</span>

<span class="comment1">(* part on pseudo_divmod *)</span>
<span class="keyword1" id="Subresultant-pseudo_mod_left_0"><span class="command">lemma</span></span> pseudo_mod_left_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def pseudo_divmod_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">x</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-pseudo_mod_right_0"><span class="command">lemma</span></span> pseudo_mod_right_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def pseudo_divmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Subresultant-snd_pseudo_divmod_main_cong"><span class="command">lemma</span></span> snd_pseudo_divmod_main_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">=</span> <span class="free">b1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a3</span> <span class="main">=</span> <span class="free">b3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a4</span> <span class="main">=</span> <span class="free">b4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a5</span> <span class="main">=</span> <span class="free">b5</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a6</span> <span class="main">=</span> <span class="free">b6</span>"</span></span> <span class="comment1">(* note that a2 = b2 is not required! *)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pseudo_divmod_main <span class="free">a1</span> <span class="free">a2</span> <span class="free">a3</span> <span class="free">a4</span> <span class="free">a5</span> <span class="free">a6</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>pseudo_divmod_main <span class="free">b1</span> <span class="free">b2</span> <span class="free">b3</span> <span class="free">b4</span> <span class="free">b5</span> <span class="free">b6</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms snd_pseudo_divmod_main <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Subresultant-snd_pseudo_mod_smult_invar_right"><span class="command">lemma</span></span> snd_pseudo_mod_smult_invar_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>pseudo_divmod_main <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="free">q</span> <span class="free">r</span> <span class="main">(</span>smult <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="free">dr</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> snd <span class="main">(</span>pseudo_divmod_main <span class="free">lc</span> <span class="free">q'</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span> <span class="free">d</span> <span class="free">dr</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">dr</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">+</span> monom <span class="main">(</span>coeff <span class="skolem">r</span> <span class="skolem">dr</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">(</span>smult <span class="free">x</span> <span class="main">(</span>monom <span class="main">(</span>coeff <span class="skolem">r</span> <span class="skolem">dr</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">dr</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rec_lhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_divmod_main <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="var">?q</span> <span class="var">?r</span> <span class="main">(</span>smult <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="var">?dr</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rec_rhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_divmod_main <span class="free">lc</span> <span class="skolem">q'</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="var">?r</span><span class="main">)</span> <span class="free">d</span> <span class="var">?dr</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="main">=</span> <span class="free">lc</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">c</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="free">lc</span> <span class="main">=</span> <span class="free">lc</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pseudo_divmod_main <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">lc</span><span class="main">)</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">(</span>smult <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="skolem">dr</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="var">?rec_lhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> snd <span class="var">?rec_rhs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> snd <span class="main">(</span>pseudo_divmod_main <span class="free">lc</span> <span class="skolem">q'</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">^</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">d</span> <span class="skolem">dr</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_main.simps Let_def
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> snd_pseudo_divmod_main_cong<span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>smult_add_right smult_diff_right smult_monom smult_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-snd_pseudo_mod_smult_invar_left"><span class="command">lemma</span></span> snd_pseudo_mod_smult_invar_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pseudo_divmod_main <span class="free">lc</span> <span class="free">q</span> <span class="main">(</span>smult <span class="free">x</span> <span class="free">r</span><span class="main">)</span> <span class="free">d</span> <span class="free">dr</span> <span class="free">n</span><span class="main">)</span>
       <span class="main">=</span> smult <span class="free">x</span> <span class="main">(</span>snd <span class="main">(</span>pseudo_divmod_main <span class="free">lc</span> <span class="free">q'</span> <span class="free">r</span> <span class="free">d</span> <span class="free">dr</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">lc</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">q'</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">dr</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sm<span class="main">:</span><span class="quoted"><span class="quoted">"smult <span class="skolem">lc</span> <span class="main">(</span>smult <span class="skolem">x</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> monom <span class="main">(</span>coeff <span class="main">(</span>smult <span class="skolem">x</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">dr</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">d</span>
          <span class="main">=</span>smult <span class="skolem">x</span> <span class="main">(</span>smult <span class="skolem">lc</span> <span class="skolem">r</span> <span class="main">-</span> monom <span class="main">(</span>coeff <span class="skolem">r</span> <span class="skolem">dr</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>smult_diff_right smult_monom smult_monom_mult mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">lc</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">lc</span> <span class="skolem">q'</span> <span class="main">+</span> monom <span class="main">(</span>coeff <span class="skolem">r</span> <span class="skolem">dr</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_main.simps Let_def Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lc</span></span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span><span class="main">]</span> sm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-snd_pseudo_mod_smult_left"><span class="command">lemma</span></span> snd_pseudo_mod_smult_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>pseudo_divmod <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>idom<span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>smult <span class="free">x</span> <span class="main">(</span>snd <span class="main">(</span>pseudo_divmod <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>snd_pseudo_mod_smult_invar_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> Polynomial.coeffs_smult<span class="main">)</span>

<span class="keyword1" id="Subresultant-pseudo_mod_smult_right"><span class="command">lemma</span></span> pseudo_mod_smult_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>idom<span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pseudo_mod <span class="free">p</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>idom<span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pseudo_mod <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_def pseudo_mod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>snd_pseudo_mod_smult_invar_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span>
                  snd_pseudo_mod_smult_invar_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> Polynomial.coeffs_smult assms<span class="main">)</span>

<span class="keyword1" id="Subresultant-pseudo_mod_zero"><span class="command">lemma</span></span> pseudo_mod_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"pseudo_mod <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">}</span> poly<span class="main">)</span>"</span></span>
<span class="quoted"><span class="quoted">"pseudo_mod <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def snd_pseudo_mod_smult_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="main">_</span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* part on prod_list *)</span>

<span class="keyword1" id="Subresultant-prod_combine"><span class="command">lemma</span></span> prod_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">l</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_mult<span class="main">)</span><span class="main">)</span> <span class="main">=</span> prod_list <span class="main">(</span>map <span class="free">f</span> <span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> prod_list_map_remove1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">j</span></span><span class="main"><span class="main">..&lt;</span></span>Suc <span class="free"><span class="free">i</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"remove1 <span class="free">i</span> <span class="main">(</span><span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">j</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> remove1_append<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-prod_list_minus_1_exp"><span class="command">lemma</span></span> prod_list_minus_1_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>sum_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

<span class="keyword1" id="Subresultant-minus_1_power_even"><span class="command">lemma</span></span> minus_1_power_even<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1<span class="main">)</span><span class="main">)</span><span class="main">^</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="free">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-minus_1_even_eqI"><span class="command">lemma</span></span> minus_1_even_eqI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"even <span class="free">k</span> <span class="main">=</span> even <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minus_1_power_even assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_mult<span class="main">)</span> prod_list_multf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> prod_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> prod_list <span class="main">(</span>map <span class="free">g</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Subresultant-inverse_prod_list"><span class="command">lemma</span></span> inverse_prod_list<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>prod_list <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> prod_list <span class="main">(</span>map inverse <span class="main">(</span><span class="free">xs</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field list<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* part on pow_int, i.e., exponentiation with integer exponent *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pow_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field <span class="main">⇒</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pow_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-pow_int_0"><span class="command">lemma</span></span> pow_int_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pow_int <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-pow_int_1"><span class="command">lemma</span></span> pow_int_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pow_int <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-exp_pow_int"><span class="command">lemma</span></span> exp_pow_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> pow_int <span class="free">x</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-pow_int_add"><span class="command">lemma</span></span> pow_int_add<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> pow_int <span class="free">x</span> <span class="free">a</span> <span class="main">*</span> pow_int <span class="free">x</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> nat <span class="free">b</span> <span class="main">=</span> nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> nat <span class="free">a</span> <span class="main">=</span> nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> nat <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> nat <span class="free">a</span> <span class="main">+</span> nat <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">-</span><span class="free">b</span><span class="main">)</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> nat <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> nat <span class="free">b</span> <span class="main">+</span> nat <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">-</span><span class="free">b</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pow_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="skolem">l</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pow_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-pow_int_mult"><span class="command">lemma</span></span> pow_int_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> pow_int <span class="free">x</span> <span class="free">a</span> <span class="main">*</span> pow_int <span class="free">y</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Subresultant-pow_int_base_1"><span class="command">lemma</span></span> pow_int_base_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pow_int <span class="main">1</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-pow_int_divide"><span class="command">lemma</span></span> pow_int_divide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> pow_int <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> pow_int <span class="free">x</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-divide_prod_assoc"><span class="command">lemma</span></span> divide_prod_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">/</span> <span class="free">y</span> <span class="main">/</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Subresultant-minus_1_inverse_pow"><span class="command">lemma</span></span> minus_1_inverse_pow<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_1_power_even<span class="main">)</span>

<span class="comment1">(* part on subresultants *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subresultant_mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subresultant_mat</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
     <span class="bound">dg</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="bound">df</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">f</span> <span class="main">=</span> coeff_int <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">g</span> <span class="main">=</span> coeff_int <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">df</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">dg</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span>
     <span class="keyword1">in</span> mat <span class="bound">n</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">dg</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="bound">dg</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">else</span> <span class="main">[:</span> <span class="bound">f</span> <span class="main">(</span><span class="bound">df</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span> <span class="main">:]</span>
      <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">jj</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">(</span><span class="bound">dg</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
       <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="bound">df</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">else</span> <span class="main">[:</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">dg</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">jj</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-subresultant_mat_dim"><span class="command">lemma</span></span> subresultant_mat_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> subresultant_mat <span class="free">j</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> S_def subresultant_mat_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subresultant'_mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subresultant'_mat</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
     <span class="bound">γ</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="bound">φ</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">f</span> <span class="main">=</span> coeff_int <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">;</span> <span class="bound">g</span> <span class="main">=</span> coeff_int <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">φ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">γ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span>
     <span class="keyword1">in</span> mat <span class="bound">n</span> <span class="bound">n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">γ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">-</span> int <span class="main">(</span><span class="bound">γ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="bound">φ</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">jj</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">(</span><span class="bound">γ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
       <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">-</span> int <span class="main">(</span><span class="bound">φ</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="bound">jj</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">γ</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">jj</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-subresultant_index_mat"><span class="command">lemma</span></span> subresultant_index_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">G</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="keyword1">then</span>
       <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">[:</span> coeff_int <span class="free">F</span> <span class="main">(</span> degree <span class="free">F</span> <span class="main">-</span> int <span class="free">i</span> <span class="main">+</span> int <span class="free">j</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">jj</span> <span class="main">=</span> <span class="free">j</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="keyword1">in</span>
       <span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span> degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">[:</span> coeff_int <span class="free">G</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> int <span class="free">i</span> <span class="main">+</span> int <span class="bound">jj</span><span class="main">)</span> <span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subresultant_mat_def Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> index_mat<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i j<span class="main">]</span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subresultant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subresultant</span> <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> det <span class="main">(</span>subresultant_mat <span class="free"><span class="bound"><span class="entity">J</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Subresultant-subresultant_smult_left"><span class="command">lemma</span></span> subresultant_smult_left<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?df</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dg</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?dg</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="var">?n</span> <span class="var">?n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?m</span> <span class="keyword1">then</span> <span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="var">?df</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="var">?S</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?S</span> <span class="main">=</span> <span class="var">?n</span>"</span></span>  <span class="quoted"><span class="quoted">"dim_row <span class="var">?cS</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?cS</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">∈</span> carrier_mat <span class="var">?n</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cS</span> <span class="main">∈</span> carrier_mat <span class="var">?n</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> carrier_mat <span class="var">?n</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> dim'<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="var">?S</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="var">?S</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dim <span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cS</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">*</span> <span class="var">?M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim' dim<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?S</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> row <span class="var">?S</span> <span class="skolem">i</span> <span class="main">∙</span> col <span class="var">?M</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> index_mult_mat<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij dim<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> row <span class="skolem">S</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> col <span class="var">?M</span> <span class="skolem">j</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scalar_prod_def S_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">S</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?cS</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_index_mat<span class="main">[</span><span class="operator">OF</span> ij<span class="main">]</span> S_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> subresultant_index_mat<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> deg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cS</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">det</span><span class="main">]</span> det_mult<span class="main">[</span><span class="operator">OF</span> C<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> C<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span> <span class="main">*</span> det <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?M</span> <span class="main">=</span> <span class="main">[:</span><span class="free">c</span> <span class="main">^</span> <span class="var">?m</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> det_upper_triangular<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ C<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"upper_triangular <span class="var">?M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> upper_triangularI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>diag_mat <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="main">(</span><span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prod_list_diag_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?m</span><span class="main">.</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="var">?m</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?m</span><span class="main">.</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?m</span><span class="main">.</span> <span class="main">[:</span> <span class="free">c</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="var">?m</span><span class="main">.</span> <span class="main">[:</span> <span class="free">c</span> <span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">c</span> <span class="main">:]</span> <span class="main">^</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="var">?m</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="var">?m</span><span class="main">..&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>diag_mat <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">c</span><span class="main">^</span><span class="var">?m</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_const_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant_swap"><span class="command">lemma</span></span> subresultant_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">g</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">+</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> change<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?k</span> <span class="main">+</span> <span class="var">?n</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?k</span> <span class="keyword1">then</span> <span class="skolem">j</span> <span class="main">+</span> <span class="var">?n</span> <span class="keyword1">else</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="var">?k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> det <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?n</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span>mat <span class="main">(</span><span class="var">?k</span> <span class="main">+</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="var">?k</span> <span class="main">+</span> <span class="var">?n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span>
    <span class="var">?A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="var">?k</span> <span class="keyword1">then</span> <span class="bound">j</span> <span class="main">+</span> <span class="var">?n</span> <span class="keyword1">else</span> <span class="bound">j</span> <span class="main">-</span> <span class="var">?k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> det <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_swap_cols<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subresultant_mat_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> subresultant_mat <span class="free">J</span> <span class="free">g</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_mat_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim_row_mat dim_col_mat nk index_mat split<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">subst</span> index_mat<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> change<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">unfold</span> if_conn<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl if_cong if_cong<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">…</span> <span class="main">=</span> subresultant <span class="free">J</span> <span class="free">g</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?n</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?n</span><span class="main">)</span> <span class="main">:]</span> <span class="main">*</span> <span class="main">…</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">g</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant_smult_right"><span class="command">lemma</span></span> subresultant_smult_right<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">f</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subresultant_swap<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    degree_smult_eq <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Subresultant-coeff_subresultant"><span class="command">lemma</span></span> coeff_subresultant<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> det <span class="main">(</span>subresultant'_mat <span class="free">J</span> <span class="free">l</span> <span class="free">F</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def subresultant_mat_def subresultant'_mat_def Let_def True
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="var">?n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> idn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="var">?M</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant'_mat <span class="free">J</span> <span class="free">l</span> <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> n p <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> coeff_int <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> coeff_int <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_int_prod_const<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> id <span class="main">=</span> subresultant_index_mat<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> n_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> M_def n_def<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id Let_def <span class="keyword1"><span class="command">using</span></span> i
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> coeff_int <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> id <span class="main">=</span> subresultant_index_mat<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> n_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> M_def n_def<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> id' <span class="main">=</span> L_def<span class="main">[</span><span class="operator">unfolded</span> subresultant'_mat_def Let_def<span class="main">,</span> <span class="operator">folded</span> n_def<span class="main">]</span> index_mat<span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> id id' split <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_splits Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="keyword1">then</span>
         coeff_int <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span><span class="main">)</span> <span class="free">l</span>
         <span class="keyword1">else</span> coeff_int <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subresultant_index_mat<span class="main">[</span><span class="operator">OF</span> n1<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> n_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> M_def n_def<span class="main">,</span> <span class="operator">unfolded</span> idn if_True Let_def<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span>
      <span class="keyword1">then</span> coeff_int <span class="free">F</span> <span class="main">(</span>int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> coeff_int <span class="free">G</span> <span class="main">(</span>int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_monom_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span>
      <span class="keyword1">then</span> coeff_int <span class="free">F</span> <span class="main">(</span>int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> coeff_int <span class="free">G</span> <span class="main">(</span>int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> n1 False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       int <span class="free">l</span> <span class="main">-</span> int <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> L_def subresultant'_mat_def Let_def n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>int <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> signof <span class="bound">p</span> <span class="main">*</span> coeff_int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def det_def subresultant_mat_dim idn if_True n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> M_def
      coeff_int_sum coeff_int_signof_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> signof <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">L</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> det <span class="skolem">L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>subresultant'_mat <span class="free">J</span> <span class="free">l</span> <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>subresultant'_mat <span class="free">J</span> <span class="free">l</span> <span class="free">F</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant'_mat_def Let_def n_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_def L_def id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def coeff_int_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant'_zero_ge"><span class="command">lemma</span></span> subresultant'_zero_ge<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> degree <span class="free">f</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>subresultant'_mat <span class="free">J</span> <span class="free">k</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="comment1">(* last row is zero *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dg</span></span> <span class="keyword2"><span class="keyword">where</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span> <span class="main">=</span> <span class="skolem">dg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">df</span></span> <span class="keyword2"><span class="keyword">where</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span> <span class="main">=</span> <span class="skolem">df</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ddf</span></span> <span class="keyword2"><span class="keyword">where</span></span> ddf<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="skolem">ddf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> ddf dg<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
            <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span>
            <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant'_mat <span class="free">J</span> <span class="free">k</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="var">?M</span> <span class="main">=</span> det <span class="main">(</span>mat <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span>
          <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
            <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span>
            <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">df</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="skolem">M</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> det <span class="var">?N</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant'_mat_def Let_def M_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">det</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> df dg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">=</span> mat <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span>
        <span class="keyword1">else</span> <span class="skolem">M</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_int_def df dg ddf <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">unfold</span> ddf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> dg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> df<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">mat<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="keyword1">else</span>
    vec <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">M</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_row_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> df<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> dg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ddf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant'_zero_lt"><span class="command">lemma</span></span> subresultant'_zero_lt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
  J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≤</span> degree <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≤</span> degree <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> degree <span class="free">f</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>subresultant'_mat <span class="free">J</span> <span class="free">k</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="comment1">(* last row is identical to last row - k *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dg</span></span> <span class="keyword2"><span class="keyword">where</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dg</span> <span class="main">=</span> degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">df</span></span> <span class="keyword2"><span class="keyword">where</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">df</span> <span class="main">=</span> degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> assms<span class="main">[</span><span class="operator">folded</span> df dg<span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
            <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span>
            <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
            <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span>
            <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>int <span class="free">k</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">df</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant'_mat <span class="free">J</span> <span class="free">k</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> mat <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">N</span> <span class="bound">j</span>
        <span class="keyword1">else</span> <span class="skolem">M</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant'_mat_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> df dg M_def N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">N</span> <span class="bound">j</span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="free">f</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="skolem">N</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="skolem">M</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?N</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> N_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> M_def N_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">insert</span> J k<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> df dg <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k J <span class="keyword1"><span class="command">unfolding</span></span> df dg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="var">?M</span> <span class="main">(</span>degree <span class="free">f</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> row <span class="var">?M</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">row</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> deg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_identical_rows<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ id<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">df</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">dg</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> deg assms<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subresultant'_mat_def Let_def df dg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant'_mat_sylvester_mat"><span class="command">lemma</span></span> subresultant'_mat_sylvester_mat<span class="main">:</span> <span class="quoted"><span class="quoted">"transpose_mat <span class="main">(</span>subresultant'_mat <span class="main">0</span> <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> sylvester_mat <span class="free">f</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dg</span></span> <span class="keyword2"><span class="keyword">where</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">=</span> <span class="skolem">dg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">df</span></span> <span class="keyword2"><span class="keyword">where</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="skolem">df</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"transpose_mat <span class="main">(</span>subresultant'_mat <span class="main">0</span> <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">+</span> degree <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="var">?M</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?M</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subresultant'_mat_def Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> sylvester_mat_dim dim df dg<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> ij<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
         <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span>
              <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span>
              <span class="keyword1">else</span> coeff_int <span class="free">f</span> <span class="main">(</span>int <span class="skolem">df</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">1</span>
              <span class="keyword1">then</span> coeff_int <span class="free">g</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="skolem">df</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>int <span class="skolem">dg</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">unfolding</span></span> subresultant'_mat_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_splits df dg<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">dg</span>
         <span class="keyword1">then</span> coeff_int <span class="free">f</span> <span class="main">(</span>int <span class="skolem">df</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span>
         <span class="keyword1">else</span> coeff_int <span class="free">g</span> <span class="main">(</span>int <span class="skolem">dg</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">b</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">b</span> <span class="keyword1">then</span> coeff_int <span class="skolem">f</span> <span class="skolem">x</span> <span class="keyword1">else</span> coeff_int <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> coeff_int <span class="skolem">f</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl cong cong<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sylvester_mat <span class="free">f</span> <span class="free">g</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">df</span> <span class="main">⟹</span> nat <span class="main">(</span>int <span class="skolem">df</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">df</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">i</span> <span class="skolem">df</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sylvester_index_mat<span class="main">[</span><span class="operator">OF</span> ij<span class="main"><span class="main">[</span></span><span class="operator">folded</span> df dg<span class="main"><span class="main">]</span></span><span class="main">]</span> df dg
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">dg</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">df</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">df</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="free">f</span> <span class="main">(</span>int <span class="skolem">df</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">df</span> <span class="keyword1">then</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">df</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> i ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_int_def *<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI  coeff_eq_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> df<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">dg</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">dg</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">dg</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="free">g</span> <span class="main">(</span>int <span class="skolem">dg</span> <span class="main">-</span> int <span class="skolem">j</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">dg</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="keyword1">then</span> coeff <span class="free">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ij i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_int_def * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI  coeff_eq_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> dg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-coeff_subresultant_0_0_resultant"><span class="command">lemma</span></span> coeff_subresultant_0_0_resultant<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>subresultant <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> resultant <span class="free">f</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"transpose_mat <span class="main">(</span>subresultant'_mat <span class="main">0</span> <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>subresultant'_mat <span class="main">0</span> <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> det <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> det_transpose<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subresultant'_mat_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> sylvester_mat <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subresultant'_mat_sylvester_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_subresultant resultant_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant_zero_ge"><span class="command">lemma</span></span> subresultant_zero_ge<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> degree <span class="free">f</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_subresultant
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> subresultant'_zero_ge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-subresultant_zero_lt"><span class="command">lemma</span></span> subresultant_zero_lt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> degree <span class="free">f</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≤</span> degree <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≤</span> degree <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_subresultant
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> subresultant'_zero_lt<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">,</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-subresultant_resultant"><span class="command">lemma</span></span> subresultant_resultant<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="main">0</span> <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">[:</span> resultant <span class="free">f</span> <span class="free">g</span> <span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">+</span> degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def subresultant_mat_def resultant_def Let_def
      sylvester_mat_def sylvester_mat_sub_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 0<span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>subresultant <span class="main">0</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> coeff <span class="main">[:</span>resultant <span class="free">f</span> <span class="free">g</span><span class="main">:]</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coeff_subresultant_0_0_resultant<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> degree <span class="free">f</span> <span class="main">+</span> degree <span class="free">g</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">≥</span> degree <span class="free">f</span> <span class="main">+</span> degree <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subresultant_zero_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> 0
        subresultant_zero_lt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 0 False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_comm_ring_hom<span class="main">)</span> subresultant_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> subresultant <span class="free">J</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> subresultant_mat_def Let_def
  <span class="keyword1"><span class="command">interpret</span></span> p<span class="main">:</span> map_poly_inj_comm_ring_hom <span class="quoted"><span class="free">hom</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def <span class="keyword1"><span class="command">unfolding</span></span> p.hom_det<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">det</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p.mat_hom <span class="main">(</span>subresultant_mat <span class="free">J</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span>
      subresultant_mat <span class="free">J</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> degree <span class="free">f</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span>degree <span class="free">g</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d degree_map_poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_int_def d map_mat_def index_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ij<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now derive properties of the resultant via the connection to subresultants.›</span></span>

<span class="keyword1" id="Subresultant-resultant_smult_left"><span class="command">lemma</span></span> resultant_smult_left<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="main">(</span>smult <span class="free">c</span> <span class="free">f</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> degree <span class="free">g</span> <span class="main">*</span> resultant <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_subresultant_0_0_resultant<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> coeff_smult
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Subresultant-resultant_smult_right"><span class="command">lemma</span></span> resultant_smult_right<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">f</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> degree <span class="free">f</span> <span class="main">*</span> resultant <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_subresultant_0_0_resultant<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> subresultant_smult_right<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> coeff_smult
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Subresultant-resultant_swap"><span class="command">lemma</span></span> resultant_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>degree <span class="free">f</span> <span class="main">*</span> degree <span class="free">g</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>resultant <span class="free">g</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_subresultant_0_0_resultant<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> subresultant_swap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> coeff <span class="bound">x</span> <span class="main">0</span>"</span></span><span class="main">]</span> coeff_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following equations are taken from Brown-Traub ``On Euclid's Algorithm and
the Theory of Subresultant'' (BT)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">B</span> <span class="free">G</span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">J</span> <span class="main">::</span> <span class="quoted">nat</span>
       <span class="keyword2"><span class="keyword">defines</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">≡</span> degree <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">≡</span> degree <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">≡</span> degree <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">db</span> <span class="main">≡</span> degree <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span>
    n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> coeff_int <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≡</span> coeff_int <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> coeff_int <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> coeff_int <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> FGH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">+</span> <span class="free">B</span> <span class="main">*</span> <span class="free">G</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dfg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">≥</span> <span class="free">dg</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span> <span class="main">∨</span> <span class="free">H</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> BT_eq_18<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>det <span class="main">(</span>mat <span class="free">n</span> <span class="free">n</span>
  <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span>
              <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">df</span> <span class="main">-</span> <span class="free">J</span>
              <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">:]</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">H</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> smult <span class="var">?m1</span> <span class="var">?right</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> BT_eq_19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">≤</span> <span class="free">J</span> <span class="main">⟹</span> <span class="free">J</span> <span class="main">&lt;</span> <span class="free">dg</span> <span class="main">⟹</span> subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
    <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">H</span> <span class="free">J</span> <span class="main">^</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">_</span> <span class="main">*</span> <span class="var">?G</span> <span class="main">*</span> <span class="var">?H</span><span class="main">)</span> <span class="free">H</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> BT_lemma_1_12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">dh</span> <span class="main">⟹</span> subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
    <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> BT_lemma_1_13'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="free">dh</span> <span class="main">⟹</span> <span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span> <span class="main">∨</span> <span class="free">H</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> subresultant <span class="free">dh</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
    <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">H</span> <span class="main">^</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">dh</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> BT_lemma_1_14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">&lt;</span> <span class="free">J</span> <span class="main">⟹</span> <span class="free">J</span> <span class="main">&lt;</span> <span class="free">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> BT_lemma_1_15'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="free">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span> <span class="main">∨</span> <span class="free">H</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> subresultant <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
    <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dg</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dg</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dfj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dfj</span> <span class="main">=</span> <span class="free">df</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dgj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dgj</span> <span class="main">=</span> <span class="free">dg</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> df dg dh db
  <span class="keyword1"><span class="command">have</span></span> F0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dfg choice df <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> G0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> choice dg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> dgh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">≥</span> <span class="free">dh</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> choice <span class="keyword1"><span class="command">unfolding</span></span> dh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FGH dfg dgh choice F0 G0 <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> dfh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">≥</span> <span class="free">dh</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dfg dgh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> choice dfg <span class="keyword1"><span class="command">have</span></span> dfh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">&gt;</span> <span class="free">dh</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dfh<span class="main">[</span><span class="operator">folded</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> FGH<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> dh<span class="main"><span class="main">]</span></span><span class="main">]</span> choice
      <span class="keyword1"><span class="command">unfolding</span></span> df <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹degree <span class="main">(</span><span class="free">F</span> <span class="main">+</span> <span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">df</span>›</span></span> degree_add_eq_left degree_add_eq_right df nat_neq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">-</span> <span class="free">B</span> <span class="main">*</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> FGH<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> True<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">B</span> <span class="main">*</span> <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> F0 G0 B0 <span class="keyword1"><span class="command">unfolding</span></span> df <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dfbg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">=</span> <span class="free">db</span> <span class="main">+</span> <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> B0 G0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> dbfg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">db</span> <span class="main">=</span> <span class="free">df</span> <span class="main">-</span> <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dfj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dgj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?dgj</span> <span class="main">+</span> <span class="var">?dfj</span> <span class="main">=</span> <span class="var">?dfj</span> <span class="main">+</span> <span class="var">?dgj</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bij</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="free">db</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span>
    <span class="keyword1">then</span> <span class="main">[:</span>  <span class="var">?bij</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">:]</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="comment1">(* this is the matrix which contains all the column-operations
     that are required to transform the subresultant-matrix of F and G into the one of G and H (
     the matrix depicted in equation (18) in BT *)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span>
              <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span>
              <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">:]</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">f</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G_F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?GF</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?GH</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span>
              <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span>
              <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">:]</span>
              <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">H</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G_H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">n</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hfg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">+</span> coeff_int <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">unfolding</span></span> FGH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f g h <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dM1<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="var">?M</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> det_upper_triangular<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prod_list_diag_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="var">?m1</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_swap<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">F</span> <span class="main">=</span> det <span class="var">?G_F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def n norm subresultant_mat_def g f Let_def d<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> dfj_def dgj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> det <span class="main">(</span><span class="var">?G_F</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> det_mult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dM1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G_F</span> <span class="main">*</span> <span class="var">?M</span> <span class="main">=</span> <span class="var">?G_H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim_col_mat dim_row_mat<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?G_F</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> row <span class="main">(</span><span class="var">?G_F</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">∙</span> col <span class="var">?M</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?GH</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"col <span class="var">?M</span> <span class="skolem">j</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True i j<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> True i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">dfj</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> jd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">+</span> <span class="skolem">dfj</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> idj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">H</span> <span class="keyword1">else</span> <span class="main">[:</span><span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">d</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> idr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?GH</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> jd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="free">db</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">[:</span><span class="var">?bij</span> <span class="bound">i</span> <span class="skolem">j</span><span class="main">:]</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="var">?GF</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?m</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?GF</span> <span class="skolem">i</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">[:</span> <span class="var">?bi</span> <span class="bound">k</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="bound">k</span><span class="main">)</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Gb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?G</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">[:</span><span class="var">?bi</span> <span class="bound">k</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?off</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>int <span class="free">db</span> <span class="main">-</span> int <span class="skolem">dfj</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> int <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> off0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?off</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False dfg j <span class="keyword1"><span class="command">unfolding</span></span> dfj_def d_def dbfg n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> nat_0_le<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">off</span></span> <span class="keyword2"><span class="keyword">where</span></span> off<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="skolem">off</span> <span class="main">=</span> <span class="var">?off</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">off</span> <span class="main">≤</span> int <span class="skolem">dfj</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> off <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">off</span> <span class="main">≤</span> <span class="skolem">dfj</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> split1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">off</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">off</span> <span class="main">+</span> Suc <span class="free">db</span> <span class="main">≤</span> <span class="skolem">dfj</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> off <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> split2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">off</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..</span> <span class="skolem">off</span> <span class="main">+</span> <span class="free">db</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">+</span> Suc <span class="free">db</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g_b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">[:</span><span class="free">b</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> int <span class="skolem">off</span><span class="main">)</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">off</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">[:</span>coeff <span class="free">B</span> <span class="bound">k</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span>
                   <span class="keyword1">else</span> <span class="main">[:</span><span class="free">f</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Fb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?F</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">[:</span><span class="var">?bi</span> <span class="bound">k</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Pj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span>  monom <span class="main">1</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="keyword1">else</span> <span class="main">[:</span><span class="free">f</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">d</span><span class="main">)</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"col <span class="var">?M</span> <span class="skolem">j</span> <span class="main">=</span> vec <span class="free">n</span> <span class="var">?m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> j i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="var">?G_F</span> <span class="skolem">i</span> <span class="main">∙</span> col <span class="var">?M</span> <span class="skolem">j</span> <span class="main">=</span> sum <span class="var">?P</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Suc <span class="skolem">j</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?P</span> <span class="main">…</span> <span class="main">=</span> sum <span class="var">?P</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">+</span> <span class="var">?P</span> <span class="skolem">j</span> <span class="main">+</span> sum <span class="var">?P</span> <span class="main">{</span>Suc <span class="skolem">j</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?P</span> <span class="main">{</span>Suc <span class="skolem">j</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?Pj</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> jd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?P</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?Q</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> d_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> jd<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?Q</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?Q</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?Q</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">+</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> idj
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?Q</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?Gb</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?Q</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">+</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?Fb</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">+</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
        <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">+</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">db</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k j False <span class="keyword1"><span class="command">unfolding</span></span> n db<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> dfbg dfj_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">db</span> <span class="main">-</span> int <span class="skolem">k</span> <span class="main">+</span> int <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="var">?k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Fb</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?Gb</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?g_b</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">k</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">dfj</span></span> <span class="main"><span class="main">-</span></span> Suc <span class="bound"><span class="bound">k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def off<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">dfj</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">dfj</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
          <span class="quoted"><span class="quoted">"int <span class="free">db</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> int <span class="skolem">d</span> <span class="main">=</span> int <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">off</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> off<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">=</span> sum <span class="var">?g_b</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">off</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> split1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g_b</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">off</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b coeff_int_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..</span> <span class="skolem">off</span> <span class="main">+</span> <span class="free">db</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">+</span> Suc <span class="free">db</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> split2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">+</span> Suc <span class="free">db</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">(</span>int <span class="skolem">k</span> <span class="main">-</span> int <span class="skolem">off</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b db
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g_b</span> <span class="main">{</span><span class="skolem">off</span> <span class="main">..</span> <span class="skolem">off</span> <span class="main">+</span> <span class="free">db</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?gb</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">db</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.atLeastAtMost_shift_bounds <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?g_b</span></span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">off</span></span> <span class="quoted"><span class="free">db</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"row <span class="var">?G_F</span> <span class="skolem">i</span> <span class="main">∙</span> col <span class="var">?M</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?H</span> <span class="main">=</span> <span class="var">?Pj</span> <span class="main">+</span> sum <span class="var">?gb</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">db</span><span class="main">}</span> <span class="main">-</span> <span class="var">?H</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?E</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="var">?E</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"coeff <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> Bsum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> monom <span class="main">(</span><span class="var">?b</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> db
        <span class="keyword1"><span class="command">using</span></span> atMost_atLeast0 poly_as_sum_of_monoms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> i_n<span class="main">:</span> False
        <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ii</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="main">[:</span><span class="free">f</span> <span class="var">?ii</span><span class="main">:]</span> <span class="main">+</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>
          <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="var">?b</span> <span class="bound">k</span><span class="main">:]</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">[:</span><span class="free">h</span> <span class="var">?ii</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="var">?e</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> E_def id if_False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">f</span> <span class="var">?ii</span> <span class="main">+</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>
          <span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b</span> <span class="bound">k</span><span class="main">)</span> <span class="main">-</span>
          <span class="free">h</span> <span class="var">?ii</span><span class="main">:]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">[:</span> <span class="var">?e</span> <span class="main">:]</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_diff coeff_add coeff_sum coeff_const
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="var">?e</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?e</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b</span> <span class="bound">k</span><span class="main">)</span>
          <span class="main">-</span> coeff_int <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="var">?ii</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> hfg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> monom <span class="main">(</span><span class="var">?b</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bsum <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> monom <span class="main">(</span><span class="var">?b</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_distrib_right<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff_int <span class="main">…</span> <span class="var">?ii</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="var">?ii</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> coeff_int_sum coeff_int_monom_mult g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="bound">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="free">db</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">dfj</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">off</span><span class="main">)</span> <span class="main">=</span> <span class="var">?ii</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False i j off dfg
            <span class="keyword1"><span class="command">unfolding</span></span> dbfg d_def dfj_def n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?jj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">dgj</span> <span class="main">-</span> Suc <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="skolem">off</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">-</span> Suc <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dfg False j <span class="keyword1"><span class="command">unfolding</span></span> off dbfg dfj_def d_def dgj_def n
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">F</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span> <span class="free">db</span><span class="main">.</span>
          monom <span class="main">1</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">off</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span> <span class="main">*</span> <span class="main">[:</span> <span class="var">?b</span> <span class="bound">k</span> <span class="main">:]</span><span class="main">)</span> <span class="main">-</span> monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">H</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">+</span> <span class="var">?sum</span> <span class="main">-</span> <span class="var">?mon</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> id E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mon</span> <span class="main">=</span> monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">F</span> <span class="main">+</span> monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> FGH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">+</span> <span class="var">?sum</span> <span class="main">-</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?sum</span> <span class="main">-</span> <span class="main">(</span>monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">-</span> <span class="var">?GB</span> <span class="main">*</span> <span class="free">B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>
          <span class="main">(</span>monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">off</span> <span class="main">-</span> <span class="var">?jj</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span> <span class="var">?b</span> <span class="bound">k</span> <span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">off</span> <span class="main">≥</span> int <span class="var">?jj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j False i True
            <span class="keyword1"><span class="command">unfolding</span></span> off d_def dfj_def dgj_def dfbg n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">+</span> <span class="skolem">off</span> <span class="main">=</span> <span class="var">?jj</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">off</span> <span class="main">-</span> <span class="var">?jj</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"monom <span class="var">?one</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">off</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">(</span><span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="var">?jj</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">off</span> <span class="main">-</span> <span class="var">?jj</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id<span class="main">[</span><span class="operator">folded</span> mult_monom<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>  monom <span class="main">1</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="skolem">off</span> <span class="main">-</span> <span class="var">?jj</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="var">?b</span> <span class="bound">k</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?sum</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">-</span> <span class="main">(</span>monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">1</span> <span class="var">?jj</span> <span class="main">*</span> <span class="free">G</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?sum</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>  monom <span class="main">1</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">[:</span><span class="var">?b</span> <span class="bound">k</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">db</span><span class="main">.</span>  monom <span class="main">(</span><span class="var">?b</span> <span class="bound">k</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Bsum <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> id<span class="main">[</span><span class="operator">folded</span> E_def<span class="main">,</span> <span class="operator">unfolded</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?G_H</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?G_F</span> <span class="main">*</span> <span class="var">?M</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?G_H</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> eq_18<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="var">?m1</span> <span class="main">(</span>det <span class="var">?G_H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dfj_def dgj_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> dgh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span> <span class="main">&gt;</span> int <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g dg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> g0 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">≤</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">dg</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> n_dfj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="skolem">dfj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> n dfj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> eq_18
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?G_H</span> <span class="main">=</span> prod_list <span class="main">(</span>diag_mat <span class="var">?G_H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> det_lower_triangular<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> ij j <span class="keyword1"><span class="command">have</span></span> if_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟷</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G_H</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?GH</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ij j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> True g0<span class="main">[</span><span class="operator">OF</span> ij j<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False * ij j dfg<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dfj_def dh<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> if_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G_H</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_list_diag_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n dfj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">*</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.union_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="skolem">dfj</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n_dfj<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g coeff_int_def dg<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">(</span>lead_coeff <span class="free">G</span><span class="main">)</span><span class="main">^</span><span class="skolem">dfj</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_const_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_dfj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">*</span> <span class="var">?GH</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.union_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?GH</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dgj</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_dfj <span class="keyword1"><span class="command">unfolding</span></span> dgj_def dfj_def n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> n_dfj <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span> <span class="main">{</span><span class="skolem">dfj</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">h</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">h</span> <span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">dfj</span><span class="main">)</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prod_constant <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_const_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">dfj</span> <span class="main">=</span> <span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n dfj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="free">df</span> <span class="main">-</span> <span class="skolem">dfj</span> <span class="main">=</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * dfg <span class="keyword1"><span class="command">unfolding</span></span> dfj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">J</span> <span class="main">=</span> coeff <span class="free">H</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span><span class="var">?m1</span> <span class="main">*</span> <span class="var">?G</span> <span class="main">*</span> <span class="var">?H</span><span class="main">)</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dfj_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> eq_19 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">dh</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dhj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dhj</span> <span class="main">=</span> <span class="free">dh</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> n_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dhj_def dgj_def n <span class="keyword1"><span class="command">using</span></span> J dfg dgh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?split</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"split_block <span class="var">?G_H</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="var">?G_H</span> <span class="main">=</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"dim_col <span class="var">?G_H</span> <span class="main">=</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">UL</span></span> <span class="skolem"><span class="skolem">UR</span></span> <span class="skolem"><span class="skolem">LL</span></span> <span class="skolem"><span class="skolem">LR</span></span> <span class="keyword2"><span class="keyword">where</span></span> spl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?split</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">UL</span><span class="main">,</span><span class="skolem">UR</span><span class="main">,</span><span class="skolem">LL</span><span class="main">,</span><span class="skolem">LR</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?split</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> spl' <span class="main">=</span> spl<span class="main">[</span><span class="operator">unfolded</span> split_block_def Let_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LR</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subresultant_mat <span class="free">J</span> <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LR</span> <span class="main">=</span> mat <span class="main">(</span><span class="skolem">dgj</span> <span class="main">+</span> <span class="skolem">dhj</span><span class="main">)</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">+</span> <span class="skolem">dhj</span><span class="main">)</span>
       <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?GH</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> spl' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?LR</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subresultant_mat_def Let_def dhj_def dgj_def d<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim_row_mat dim_col_mat index_mat split dfj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">dh</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dgh dfg J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">+</span> <span class="main">(</span><span class="free">dh</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> n_add dhj_def dgj_def <span class="keyword1"><span class="command">using</span></span> dgh dfg J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">dh</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> id5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">dh</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> id6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">df</span> <span class="main">-</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">dh</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="free">dh</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dgh dfg J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> h<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id3 id4 id5 id6
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> id1 if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> id2 refl refl<span class="main"><span class="main">]</span></span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> id2 refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">LR</span> <span class="main">=</span> <span class="var">?LR</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">note</span></span> spl <span class="main">=</span> spl<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?UR</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">+</span> <span class="skolem">dhj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">UR</span> <span class="main">=</span> mat <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="skolem">dgj</span> <span class="main">+</span> <span class="skolem">dhj</span><span class="main">)</span>
       <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> spl' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?UR</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim_row_mat dim_col_mat index_mat split dfj_def index_zero_mat<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> in1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">unfolding</span></span> dgj_def dhj_def n_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">df</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&lt;</span> int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 J <span class="keyword1"><span class="command">unfolding</span></span> dgj_def dhj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dg g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> g <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">&lt;</span> int <span class="free">df</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 J <span class="keyword1"><span class="command">unfolding</span></span> dgj_def dhj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dh h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> h <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in1 g h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">UR</span> <span class="main">=</span> <span class="var">?UR</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">note</span></span> spl <span class="main">=</span> spl<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">[:</span>lead_coeff <span class="free">G</span><span class="main">:]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?UL</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">UL</span> <span class="main">=</span> mat <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?GH</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> spl' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?UL</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> dim_row_mat dim_col_mat index_mat split<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span> <span class="main">=</span> <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g dg coeff_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> eq <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&lt;</span> int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g dg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coeff_int_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> lt <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">dfj</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">unfolding</span></span> n_add dhj_def dgj_def dfj_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?GH</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">[:</span><span class="free">g</span> <span class="main">(</span>int <span class="free">dg</span> <span class="main">-</span> int <span class="skolem">i</span> <span class="main">+</span> int <span class="skolem">j</span><span class="main">)</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?GH</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq lt * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">UL</span> <span class="main">=</span> <span class="var">?UL</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">note</span></span> spl <span class="main">=</span> spl<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> split_block<span class="main">[</span><span class="operator">OF</span> spl dim<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> GH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?G_H</span> <span class="main">=</span> four_block_mat <span class="var">?UL</span> <span class="var">?UR</span> <span class="skolem">LL</span> <span class="var">?LR</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?UL</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="var">?UR</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">LL</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="var">?LR</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span> <span class="main">(</span><span class="skolem">dhj</span> <span class="main">+</span> <span class="skolem">dgj</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> GH<span class="main">,</span> <span class="operator">of</span> <span class="quoted">det</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?G_H</span> <span class="main">=</span> det <span class="main">(</span>four_block_mat <span class="var">?UL</span> <span class="var">?UR</span> <span class="skolem">LL</span> <span class="var">?LR</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> GH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> det <span class="var">?UL</span> <span class="main">*</span> det <span class="var">?LR</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_four_block_mat_upper_right_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?LR</span> <span class="main">=</span> subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?UL</span> <span class="main">=</span> prod_list <span class="main">(</span>diag_mat <span class="var">?UL</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_lower_triangular<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">df</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">dh</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_diag_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_const_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> det<span class="main">:</span> <span class="quoted"><span class="quoted">"det <span class="var">?G_H</span> <span class="main">=</span> <span class="main">[:</span>lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">:]</span> <span class="main">*</span> subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span><span class="var">?m1</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">J</span> <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_18 det <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">&lt;</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">dg</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">≤</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> eq_19<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">J</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">H</span> <span class="free">J</span> <span class="main">^</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">H</span> <span class="free">J</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> J<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dh<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">^</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="free">dh</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span> <span class="main">∨</span> <span class="free">H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> choice <span class="keyword1"><span class="command">have</span></span> dgh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">dh</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
      <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dh</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">H</span> <span class="main">^</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="free">dh</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_19<span class="main">[</span><span class="operator">unfolded</span> J<span class="main">,</span> <span class="operator">OF</span> le_refl dgh<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> dh <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="free">dg</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span> <span class="main">∨</span> <span class="free">H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> choice <span class="keyword1"><span class="command">have</span></span> dgh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">&gt;</span> <span class="free">dh</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dh</span> <span class="main">≤</span> <span class="free">dg</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">dg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dgh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">-</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">df</span> <span class="main">-</span> <span class="free">dg</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">-</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">-</span> <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dfg dgh <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="main">(</span><span class="free">dg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> smult <span class="main">(</span>
      <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dg</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="free">df</span> <span class="main">-</span> <span class="free">dg</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq_19<span class="main">[</span><span class="operator">unfolded</span> J<span class="main">,</span> <span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> BT_lemma_1_13 <span class="main">=</span> BT_lemma_1_13'<span class="main">[</span><span class="operator">OF</span> _ _ _ refl<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> BT_lemma_1_15 <span class="main">=</span> BT_lemma_1_15'<span class="main">[</span><span class="operator">OF</span> _ _ _ refl<span class="main">]</span>

<span class="keyword1" id="Subresultant-subresultant_product"><span class="command">lemma</span></span> subresultant_product<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="free">B</span> <span class="main">*</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">F</span> <span class="main">≥</span> degree <span class="free">G</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
   <span class="keyword1">if</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">F</span> <span class="keyword1">then</span> smult <span class="main">(</span>lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">G</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> J<span class="main">:</span> True
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> J <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">0</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">∨</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_13<span class="main">[</span><span class="operator">OF</span> eq FG lt lt<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="main">0</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> BT_lemma_1_14<span class="main">[</span><span class="operator">OF</span> eq FG lt<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_15<span class="main">[</span><span class="operator">OF</span> eq FG lt lt<span class="main">]</span> J <span class="keyword1"><span class="command">have</span></span> 01<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="main">(</span>degree <span class="free">G</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> J <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">J</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">G</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="free">J</span> <span class="main">=</span> degree <span class="free">G</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> 00 01 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> J<span class="main">:</span> False
  <span class="keyword1"><span class="command">hence</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">G</span> <span class="main">-</span> <span class="free">J</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> False"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mat <span class="var">?n</span> <span class="var">?n</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span>
              <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> monom <span class="main">1</span> <span class="main">(</span><span class="var">?n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>
              <span class="keyword1">else</span> <span class="main">[:</span>coeff_int <span class="free">G</span> <span class="main">(</span>int <span class="main">(</span>degree <span class="free">G</span><span class="main">)</span> <span class="main">-</span> int <span class="bound">i</span> <span class="main">+</span> int <span class="bound">j</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> det <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_def subresultant_mat_def Let_def dg * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="var">?M</span> <span class="main">=</span> prod_list <span class="main">(</span>diag_mat <span class="var">?M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> det_lower_triangular<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?n</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coeff_int_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="var">?M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_diag_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">F</span> <span class="keyword1">then</span> smult <span class="main">(</span>lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">F</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?P</span> <span class="main">*</span> <span class="free">G</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> id
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span><span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_const_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">J</span> <span class="free">F</span> <span class="free">G</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">J</span> <span class="main">&lt;</span> degree <span class="free">F</span> <span class="keyword1">then</span> smult <span class="main">(</span>lead_coeff <span class="free">G</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">F</span> <span class="main">-</span> <span class="free">J</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-resultant_pseudo_mod_0"><span class="command">lemma</span></span> resultant_pseudo_mod_0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide poly<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dfg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≥</span> degree <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> lead_coeff <span class="free">g</span><span class="main">^</span>degree <span class="free">f</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?df</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dg</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> pd<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_divmod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> pd <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> pseudo_mod <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms pd <span class="keyword1"><span class="command">have</span></span> pd<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_divmod <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pseudo_divmod<span class="main">[</span><span class="operator">OF</span> g pd<span class="main">]</span> g
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">a</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> lead_coeff <span class="free">g</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="var">?df</span> <span class="main">-</span> <span class="var">?dg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a dfg <span class="keyword1"><span class="command">have</span></span> dfg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">≤</span> degree <span class="main">(</span>smult <span class="skolem">a</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g0<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> coeff <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leading_coeff_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> prod <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">a</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> subresultant_product<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this dfg<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> subresultant_resultant
    resultant_smult_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> coeff <span class="bound">x</span> <span class="main">0</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a g0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> primitive_remainder_sequence <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> lead_coeff <span class="main">(</span><span class="free">F</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">n</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">F</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> δ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">δ</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> F12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> F0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">F</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> β0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">β</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pmod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟹</span> smult <span class="main">(</span><span class="free">β</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Subresultant-f10"><span class="command">lemma</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f <span class="keyword1"><span class="command">using</span></span> F12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-f0"><span class="command">lemma</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-n_gt"><span class="command">lemma</span></span> n_gt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> Suc <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> pmod <span class="main">=</span> pmod<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> assms F0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pseudo_mod<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> pmod<span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">using</span></span> β0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Subresultant-n_ge"><span class="command">lemma</span></span> n_ge<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n12 n_gt<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>

<span class="keyword1" id="Subresultant-n_ge_trans"><span class="command">lemma</span></span> n_ge_trans<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">jj</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="skolem">jj</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> j<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> j
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">jj</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_ge<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-delta_gt"><span class="command">lemma</span></span> delta_gt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_gt<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> δ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-k2"><span class="command">lemma</span></span> k2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases linorder_not_le F0 F12<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_order<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Subresultant-k0"><span class="command">lemma</span></span> k0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Subresultant-ni2"><span class="command">lemma</span></span> ni2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">n</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_numeral δ delta_gt k2 le_imp_less_Suc le_less n_ge_trans not_le one_le_numeral
      semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> zero_less_diff<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> subresultant_prs_locale <span class="main">=</span> primitive_remainder_sequence <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">β</span></span> <span class="keyword2"><span class="keyword">for</span></span>
       <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide fract poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">1</span> <span class="main">=</span> map_poly to_fract <span class="free">G1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="numeral">2</span> <span class="main">=</span> map_poly to_fract <span class="free">G2</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-α0"><span class="command">lemma</span></span> α0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> α <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-α_char"><span class="command">lemma</span></span> α_char<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"α <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> triv<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n12
    <span class="keyword1"><span class="command">unfolding</span></span> n degree_eq_length_coeffs One_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True α_def n δ degree_eq_length_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>triv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> F0<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> delta_gt<span class="main">[</span><span class="operator">unfolded</span> δ n degree_eq_length_coeffs<span class="main">,</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>δ n degree_eq_length_coeffs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> smult <span class="main">(</span>α <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>pdivmod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-beta_F_as_sum"><span class="command">lemma</span></span> beta_F_as_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> Q <span class="free">i</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ik<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> False"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> f0_b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="main">(</span>coeff <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span>coeffs <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span><span class="quoted"><span class="quoted">"inverse <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_char<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ik<span class="main">]</span> power_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> alpha0<span class="main">:</span><span class="quoted"><span class="quoted">"α <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def f <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> α_inv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"α <span class="free">i</span> <span class="main">*</span> inverse <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_class.field_inverse<span class="main">[</span><span class="operator">OF</span> alpha0<span class="main">]</span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> field_class.field_inverse<span class="main">[</span><span class="operator">OF</span> alpha0<span class="main">,</span><span class="operator">unfolded</span> inv<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> c_times_Q<span class="main">:</span><span class="quoted"><span class="quoted">"smult <span class="var">?c</span> <span class="main">(</span>Q <span class="free">i</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>pdivmod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pdivmod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>smult <span class="var">?c</span> <span class="main">(</span>Q <span class="free">i</span><span class="main">)</span><span class="main">,</span> smult <span class="var">?c</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c_times_Q
    <span class="keyword1"><span class="command">unfolding</span></span> pdivmod_via_pseudo_divmod pmod<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> f n c_times_Q
              pseudo_mod_smult_right<span class="main">[</span><span class="operator">OF</span> f0_b<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> f0 if_False Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> pdivmod_pdivmodrel<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> pr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> smult <span class="var">?c</span> <span class="main">(</span>Q <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> smult <span class="var">?c</span> <span class="main">(</span> smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eucl_rel_poly_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>α <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Q <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
                   <span class="main">+</span> smult <span class="main">(</span>inverse <span class="main">(</span>α <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span> smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?t</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
                   <span class="keyword1"><span class="command">unfolding</span></span> inv<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="main">-</span> <span class="var">?t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Q <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> smult_diff_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="main">-</span> <span class="var">?t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
  BT_lemma_2_21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="free">i</span> <span class="main">⟹</span> smult <span class="main">(</span>α <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?eq_21</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  BT_lemma_2_22<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>α <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="main">(</span><span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq_22</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  BT_lemma_2_23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?eq_23</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  BT_lemma_2_24<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq_24</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> ik<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> beta_F_as_sum <span class="main">=</span> beta_F_as_sum<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ik<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> α0<span class="main">:</span><span class="quoted"><span class="quoted">"α <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> α_def f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> α0pow<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> α <span class="free">i</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> df<span class="main">:</span><span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>smult <span class="main">(</span>α <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="numeral">2</span>"</span></span><span class="main">]</span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> assms α0 β0 <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> degree_smult_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>idom_divide<span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="main">(</span>smult <span class="bound">c</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> degree <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> n_lt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> semiring_normalization_rules<span class="main">(</span>30<span class="main">)</span> mult.commute
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> fract<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">^</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="free">i</span> <span class="main">=</span> <span class="free">β</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_minus_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="numeral">2</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> max_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> diff_add_assoc<span class="main">[</span><span class="operator">OF</span> n_ge<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">have</span></span> ns <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nat_minus_add_max<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> degree <span class="main">(</span>smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> β0 <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_12<span class="main">[</span><span class="operator">OF</span> beta_F_as_sum df j<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?eq_21</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subresultant_smult_right<span class="main">[</span><span class="operator">OF</span> β0<span class="main">]</span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span>
                degree_smult_eq<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> degree_smult_eq<span class="main">[</span><span class="operator">OF</span> β0<span class="main">]</span> n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> δ s ns
      <span class="keyword1"><span class="command">using</span></span> f n
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_13<span class="main">[</span><span class="operator">OF</span> beta_F_as_sum df df<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?eq_22</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> lead_coeff_smult smult_smult
                degree_smult_eq<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> degree_smult_eq<span class="main">[</span><span class="operator">OF</span> β0<span class="main">]</span> n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> δ s ns
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> * ** coeff_smult f mult.assoc n<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="main">(</span><span class="free">β</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> β0 <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_14<span class="main">[</span><span class="operator">OF</span> beta_F_as_sum df j<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?eq_23</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> smult_eq_0_iff <span class="keyword1"><span class="command">using</span></span> α0pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> BT_lemma_1_15<span class="main">[</span><span class="operator">OF</span> beta_F_as_sum df df<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?eq_24</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subresultant_smult_left<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> *** degree_smult_eq<span class="main">[</span><span class="operator">OF</span> α0<span class="main">]</span> n<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f δ
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult.commute<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-BT_eq_30"><span class="command">lemma</span></span> BT_eq_30<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span>
    smult <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> smult <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">β</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
        <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> Suc.prems<span class="main">(</span>1-2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∈</span> set <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"remove1 <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>remove1_append<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> n_gt<span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">unfolded</span> this<span class="main">]</span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> smult <span class="bound">c</span> <span class="bound">d</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">⟹</span> smult <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span> <span class="bound">d</span> <span class="main">=</span> smult <span class="bound">x</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> smult <span class="bound">c</span> <span class="bound">d</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">⟹</span> smult <span class="bound">c</span> <span class="main">(</span>smult <span class="bound">x</span> <span class="bound">d</span><span class="main">)</span> <span class="main">=</span> smult <span class="bound">x</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_map_remove1<span class="main">[</span><span class="operator">OF</span> inset<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">unfolded</span> r1<span class="main">]</span>
      *<span class="main">[</span><span class="operator">OF</span> Suc.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> j<span class="main"><span class="main">]</span></span><span class="main">]</span>
      **<span class="main">[</span><span class="operator">OF</span> BT_lemma_2_21<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prems<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>6<span class="main"><span class="main"><span class="main">)</span></span></span> Suc.prems<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-nonzero_alphaprod"><span class="command">lemma</span></span> nonzero_alphaprod<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> prod_list_zero_iff <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> α0<span class="main">)</span>

<span class="keyword1" id="Subresultant-BT_eq_30'"><span class="command">lemma</span></span> BT_eq_30'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span>
  <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>
     <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> smult <span class="main">(</span><span class="var">?mm</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">*</span> <span class="var">?f</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">β</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                     <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonzero_alphaprod<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> BT_eq_30<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>inverse <span class="var">?a</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> smult_smult<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="var">?a</span> <span class="main">*</span> <span class="var">?d</span><span class="main">)</span>
    <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="var">?a</span> <span class="main">*</span> <span class="var">?d</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">*</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_multf inverse_prod_list map_map o_def
      power_inverse<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> power_mult_distrib divide_inverse_commute
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> <span class="var">?mm</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> prod_list_minus_1_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For defining the subresultant PRS, we mainly follow Brown's ``The Subresultant PRS Algorithm'' (B).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="free">n</span> <span class="numeral">2</span> <span class="keyword1">then</span> sdiv_poly <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span>lead_coeff <span class="free">G2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">G2</span><span class="main">)</span> <span class="main">(</span>lead_coeff <span class="free">G2</span><span class="main">)</span> <span class="keyword1">else</span> subresultant <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ff</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> to_fract <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ffp</span> <span class="main">≡</span> map_poly ff"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> map_poly_hom<span class="main">:</span> map_poly_inj_idom_hom <span class="quoted">to_fract</span><span class="keyword1"><span class="command">..</span></span>

<span class="comment1">(* for σ and τ we only take additions, so that no negative number-problems occur *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>σ <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span> <span class="free">f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">.</span>
  <span class="main">(</span><span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Θ</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>τ <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span><span class="main">.</span>
  <span class="main">(</span><span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* is eq 29 in BT *)</span>
<span class="keyword1" id="Subresultant-fundamental_theorem_eq_4"><span class="command">lemma</span></span> fundamental_theorem_eq_4<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>γ <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_ge_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> subresultant <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">G1</span> <span class="free">G2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">ffp</span><span class="main">,</span> <span class="operator">unfolded</span> to_fract_hom.subresultant_hom<span class="main">,</span> <span class="operator">folded</span> F1 F2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subresultant <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> eq_24 <span class="main">=</span> BT_lemma_2_24<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> fract"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?o</span> <span class="main">^</span> <span class="var">?m1</span>  <span class="main">*</span> <span class="var">?d1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"α <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> α0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> eq_24<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>inverse <span class="var">?c0</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     smult <span class="main">(</span>inverse <span class="var">?c0</span> <span class="main">*</span> <span class="var">?c1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> id3 <span class="main">=</span> BT_eq_30'<span class="main">[</span><span class="operator">OF</span> this lt<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span>  <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?m</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"γ <span class="free">i</span> <span class="main">=</span> <span class="var">?o</span> <span class="main">^</span> <span class="main">(</span><span class="var">?m1</span> <span class="main">+</span> <span class="var">?m2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="var">?c0</span> <span class="main">*</span> <span class="var">?d1</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">*</span> <span class="var">?f2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"γ <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>σ <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> γ_def prod_list_multf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">m1</span> <span class="main">=</span> even <span class="skolem">m2</span> <span class="main">⟹</span> <span class="skolem">c1</span> <span class="main">=</span> <span class="skolem">c2</span> <span class="main">⟹</span> <span class="var">?o</span><span class="main">^</span><span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">c1</span> <span class="main">=</span> <span class="var">?o</span><span class="main">^</span><span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
      <span class="keyword1"><span class="command">unfolding</span></span> minus_1_power_even <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> n_ge_trans<span class="main">[</span><span class="operator">OF</span> _ l<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> l i <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> n1 n2 <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> n2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> id n2 this
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> diff <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> diff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?b2</span> <span class="main">*</span> <span class="var">?b</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="var">?b2</span> <span class="main">*</span> <span class="var">?f2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="var">?b</span> <span class="free">i</span> <span class="main">*</span> <span class="var">?f</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> <span class="var">?b</span> <span class="free">i</span> <span class="main">*</span> <span class="var">?f</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="var">?f</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="free">i</span> <span class="main">*</span> inverse <span class="var">?c0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> <span class="var">?f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_add<span class="main">[</span><span class="operator">OF</span> f0<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?b'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">l</span><span class="main">)</span>
         <span class="main">=</span> inverse <span class="var">?c0</span> <span class="main">*</span> <span class="var">?d1</span> <span class="main">*</span> <span class="var">?b2</span> <span class="main">*</span> <span class="var">?f2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>σ <span class="free">i</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?m'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="var">?m'</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>even <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?m'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?m'</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="var">?m'</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> even <span class="var">?m2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> even_sum_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> diff<span class="main">(</span>3<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> l<span class="main">]</span> diff<span class="main">(</span>3<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> l1<span class="main">]</span> l2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="var">?m'</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> even <span class="var">?m1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="var">?m1</span> <span class="main">=</span> even <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ id
          <span class="keyword1"><span class="command">using</span></span> diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?m'</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>even <span class="var">?m2</span> <span class="main">=</span> even <span class="var">?m1</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?m2</span> <span class="main">+</span> <span class="var">?m1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> even_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">+</span> <span class="var">?m1</span> <span class="main">=</span> <span class="var">?m1</span> <span class="main">+</span> <span class="var">?m2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>σ <span class="free">i</span><span class="main">)</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?m1</span> <span class="main">+</span> <span class="var">?m2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id1 id3 id2 smult_smult id4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* equation 28 in BT *)</span>
<span class="keyword1" id="Subresultant-fundamental_theorem_eq_5"><span class="command">lemma</span></span> fundamental_theorem_eq_5<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> BT_lemma_2_23<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_ge_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">j</span> <span class="main">=</span> subresultant <span class="free">j</span> <span class="free">G1</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">ffp</span><span class="main">,</span> <span class="operator">unfolded</span> to_fract_hom.subresultant_hom<span class="main">,</span> <span class="operator">folded</span> F1 F2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="free">j</span><span class="main">)</span> <span class="main">=</span> subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> eq_30 <span class="main">=</span> BT_eq_30<span class="main">[</span><span class="operator">OF</span> this lt<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">β</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonzero_alphaprod<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> eq_30<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>inverse <span class="var">?c3</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="var">?c3</span> <span class="main">*</span> <span class="var">?c2</span><span class="main">)</span>
     <span class="main">(</span>subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id1 id2 id3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* equation 27 in BT *)</span>
<span class="keyword1" id="Subresultant-fundamental_theorem_eq_6"><span class="command">lemma</span></span> fundamental_theorem_eq_6<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="main">(</span><span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>Θ <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span><span class="main">=</span><span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nlt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_gt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> αnz<span class="main">:</span><span class="quoted"><span class="quoted">"α <span class="free">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> α0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">f</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> smult <span class="bound">a</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">f</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span> fract<span class="main">)</span><span class="main">)</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">xs</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> prod_list <span class="main">(</span>map <span class="bound">f</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">*</span> prod_list <span class="main">(</span>map <span class="bound">g</span> <span class="bound">xs</span><span class="main">)</span>
         <span class="main">=</span> <span class="bound">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">g</span><span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span> <span class="main">::</span> comm_monoid_mult<span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">ac_simps</span></span> prod_list_multf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span><span class="main">.</span> <span class="free">β</span> <span class="free">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="main">(</span>α <span class="free">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">β</span> <span class="free">i</span> <span class="main">/</span> α <span class="free">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>inverse_eq_divide power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ****<span class="main">:</span><span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">(</span><span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms nlt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">-</span><span class="numeral">2</span>"</span></span><span class="main">]</span> nlt n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> nge<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *****<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">::</span>  <span class="tfree">'a</span> fract<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">::</span>  <span class="tfree">'a</span> fract<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> nge <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> minus_1_even_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> even_sum_list<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> n_ge_trans assms
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="free">n</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>R <span class="main">(</span><span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> subresultant <span class="main">(</span><span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def F1 F2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> to_fract_hom.subresultant_hom ni2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> smult
     <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="bound">x</span> <span class="main">/</span> α <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="free">i</span> <span class="main">/</span> α <span class="free">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
       <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
        <span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="free">F</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BT_eq_30'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nlt<span class="main">]</span> **
              *<span class="main">[</span><span class="operator">OF</span> αnz BT_lemma_2_22<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> smult_smult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">ac_simps</span></span> *** <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Θ_def τ_def
    <span class="keyword1"><span class="command">using</span></span> prod_combine<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> δ assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">ac_simps</span></span> exp_pow_int<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power_add ***** ****<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* equation 26 in BT *)</span>
<span class="keyword1" id="Subresultant-fundamental_theorem_eq_7"><span class="command">lemma</span></span> fundamental_theorem_eq_7<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_divmod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> k2 <span class="keyword1"><span class="command">have</span></span> Fk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> k2 F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Q</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pseudo_divmod<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Fk this<span class="main">]</span> Fk <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="free">k</span> <span class="main">*</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> id <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">*</span> <span class="free">F</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> n_ge<span class="main">[</span><span class="operator">unfolded</span> n<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> k2 c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">F</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>smult <span class="skolem">c</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subresultant_product<span class="main">[</span><span class="operator">OF</span> id this<span class="main">,</span> <span class="operator">unfolded</span> subresultant_smult_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> j
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"subresultant <span class="free">j</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">n</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> k2 n_ge_trans not_le one_le_numeral order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> k2 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> BT_eq_30<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">unfolded</span> *<span class="main">]</span> nonzero_alphaprod<span class="main">[</span><span class="operator">OF</span> le_refl<span class="main">]</span> ** F1 F2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>R_def F0 to_fract_hom.subresultant_hom<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> R <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> R <span class="main">(</span><span class="free">n</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-gamma_delta_beta_3"><span class="command">lemma</span></span> gamma_delta_beta_3<span class="main">:</span> <span class="quoted"><span class="quoted">"γ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="numeral">3</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="free">β</span> <span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ_def δ α_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> δ<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def nat_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pow_int_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> f20<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def nat_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
   <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="free">β</span> <span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>  <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">β</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="numeral">3</span> <span class="main">*</span> <span class="free">β</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pow_int_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> f20<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="numeral">3</span> <span class="main">*</span> <span class="free">β</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"σ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">n</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> σ_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fract<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">-</span> <span class="free">n</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n12<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"γ <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">β</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">h</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-smult_inverse_sdiv_poly"><span class="command">lemma</span></span> smult_inverse_sdiv_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> ffp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> range ffp"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">=</span> sdiv_poly <span class="free">q'</span> <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> ff <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> qq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> ffp <span class="free">q'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ffp <span class="free">p'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="skolem">i</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ff <span class="main">(</span>coeff <span class="free">q'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> ff <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qq xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cpi<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> ff <span class="main">(</span>coeff <span class="free">q'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> ff <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> ffp <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ffp <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> cpi<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ff <span class="main">(</span>coeff <span class="free">q'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> ff <span class="free">x'</span> <span class="main">∈</span> range ff"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"ff <span class="main">(</span>coeff <span class="free">q'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> ff <span class="free">x'</span> <span class="main">=</span> ff <span class="main">(</span>coeff <span class="free">q'</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="free">x'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> div_divide_to_fract<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="main">(</span>ffp <span class="free">p'</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpi id p'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sdiv_poly_def coeff_map_poly<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> subresultant_prs_locale2 <span class="main">=</span> subresultant_prs_locale <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span> <span class="keyword2"><span class="keyword">for</span></span>
       <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> idom_divide fract poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> β3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> βi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="numeral">4</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> h <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Subresultant-B_eq_17_main"><span class="command">lemma</span></span> B_eq_17_main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span>
    h <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">f</span> <span class="free">i</span>
   <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span>α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> h <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fi0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> fract<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> f20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n12 <span class="keyword1"><span class="command">unfolding</span></span> δ numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="numeral">2</span><span class="main">)</span>
      <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">β</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> β3<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span> <span class="main">…</span> <span class="main">*</span> <span class="free">f</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pow_int_divide exp_pow_int power_add pow_int_add<span class="main">[</span><span class="operator">OF</span> f20<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> pow_int_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n12<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> δ numeral_2_eq_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ri hi exp_pow_int<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> f20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> i less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span> Suc <span class="skolem">i</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">P</span> <span class="main">*</span> pow_int <span class="main">(</span>h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span>
    <span class="keyword1"><span class="command">hence</span></span> hi0<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> hii<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span>h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> n_gt<span class="main">[</span><span class="operator">OF</span> ii<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">*</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pow_int_add<span class="main">[</span><span class="operator">OF</span> hi0<span class="main">]</span> P_def Q_def pow_int_divide<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> R_def S_def <span class="keyword1"><span class="command">using</span></span> IH i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="skolem">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
      <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">P</span> <span class="main">*</span> α <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pow_int_divide<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> P_def id Fract_conv_to_fract <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> βi<span class="main">[</span><span class="operator">OF</span> cc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"α <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">P</span> <span class="main">*</span>  <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> Suc <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
      <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a1</span> <span class="main">*</span> <span class="var">?fi1</span> <span class="main">*</span> <span class="skolem">P</span> <span class="main">*</span> <span class="var">?fi2</span> <span class="main">/</span> <span class="var">?a2</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">/</span> <span class="var">?c</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_divide<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a1</span> <span class="main">/</span> <span class="var">?a2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?fi1</span> <span class="main">*</span> <span class="var">?fi2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">/</span> <span class="var">?c</span><span class="main">)</span> <span class="main">*</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">/</span> <span class="var">?a2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> δ <span class="keyword1"><span class="command">using</span></span> i less<span class="main">(</span>2-<span class="main">)</span> n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fi1</span> <span class="main">*</span> <span class="var">?fi2</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">+</span> int <span class="main">(</span>Suc <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_add<span class="main">[</span><span class="operator">OF</span> fi0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">/</span> <span class="var">?c</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> Q_def exp_pow_int pow_int_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span>
      <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">*</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_pow_int R_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hi ri <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> id<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> hii<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> IH fi0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-B_eq_17"><span class="command">lemma</span></span> B_eq_17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span>
    h <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">f</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span>α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> B_eq_17_main <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Subresultant-B_theorem_2"><span class="command">lemma</span></span> B_theorem_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟹</span> γ <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> gamma_delta_beta_3 β3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2-<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"γ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span> <span class="skolem">i</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">l</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">l</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">i</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> fi0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fi0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> less<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> set <span class="skolem">L</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">using</span></span> f0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> j α0 β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"α <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> Q this
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> L0 <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="skolem">i</span> <span class="main">=</span> γ <span class="skolem">i</span> <span class="main">/</span> γ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="skolem">i</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">/</span>
      <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
       <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a1</span> <span class="main">*</span> <span class="var">?f1</span> <span class="main">*</span> <span class="var">?L1</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">(</span><span class="var">?a2</span> <span class="main">*</span> <span class="var">?f2</span> <span class="main">*</span> <span class="var">?L2</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> γ_def id P_def Q_def R_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a1</span> <span class="main">*</span> <span class="var">?a2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> divide_prod_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">*</span> <span class="var">?a2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">R</span> <span class="skolem">i</span> <span class="bound">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P_def prod_list_multf divide_prod_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">R</span> <span class="skolem">i</span> <span class="bound">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_zero_iff <span class="keyword1"><span class="command">using</span></span> L0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>int <span class="var">?exp</span> <span class="main">+</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span> <span class="skolem">i</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def Q_def
      exp_pow_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>int <span class="var">?exp</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="main">1</span> <span class="main">+</span> int <span class="var">?exp</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f1</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pow_int_add<span class="main">[</span><span class="operator">OF</span> fi0<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">i</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">β</span> <span class="skolem">i</span> <span class="main">/</span> α <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def R_def Fract_conv_to_fract <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"α <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="var">?exp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">i</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span> <span class="free">β</span> <span class="skolem">i</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?exp</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?β</span> <span class="main">*</span> <span class="var">?f12</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="var">?f12</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>  <span class="var">?β</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">*</span> <span class="var">?f12</span><span class="main">)</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_add<span class="main">[</span><span class="operator">OF</span> fi0<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="var">?exp</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">L</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def id
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">L</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">l</span> <span class="skolem">L</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">L</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">l</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> L<span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> l α0 β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"α <span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> B0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">l</span> <span class="main">#</span> <span class="skolem">L</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">l</span> <span class="main">#</span> <span class="skolem">L</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
            <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l1</span> <span class="main">*</span> <span class="var">?L1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?l2</span> <span class="main">*</span> <span class="var">?L2</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l1</span> <span class="main">/</span> <span class="var">?l2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L1</span> <span class="main">/</span> <span class="var">?L2</span> <span class="main">=</span> pow_int <span class="main">(</span>prod_list <span class="main">(</span>map <span class="skolem">A</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l1</span> <span class="main">/</span> <span class="var">?l2</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_divide pow_int_add<span class="main">[</span><span class="operator">OF</span> B0<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="var">?exp</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i l less<span class="main">(</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> n_ge_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="var">?exp</span> <span class="main">=</span> int <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> δ <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id2 <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> pow_int <span class="main">(</span>inverse <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">…</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="skolem">B</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pow_int <span class="main">(</span><span class="skolem">A</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="var">?exp</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span>prod_list <span class="main">(</span>map <span class="skolem">A</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="var">?exp</span><span class="main">)</span>
          <span class="main">=</span> pow_int <span class="main">(</span>prod_list <span class="main">(</span>map <span class="skolem">A</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">#</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> int <span class="var">?exp</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_int_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="var">?exp</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="var">?exp</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> βi<span class="main">[</span><span class="operator">OF</span> iii<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="skolem">i</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="var">?exp</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span>pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span>
      pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>int <span class="var">?exp</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="var">?exp</span> <span class="main">/</span>
      <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">l</span><span class="main">)</span> <span class="main">^</span> <span class="var">?exp</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">*</span> <span class="var">?f1</span> <span class="main">*</span> <span class="var">?H</span> <span class="main">/</span> <span class="var">?L</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_divide exp_pow_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>int <span class="var">?exp</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pow_int_add<span class="main">[</span><span class="operator">OF</span> fi0'<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span>
      <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a2</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">*</span> <span class="var">?L</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> B_eq_17<span class="main">[</span><span class="operator">OF</span> iv<span class="main">]</span> A_def id L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fract<span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="var">?exp</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="var">?exp</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"γ <span class="skolem">i</span> <span class="main">=</span> <span class="var">?a1</span> <span class="main">*</span> <span class="var">?f1</span> <span class="main">*</span> <span class="main">(</span><span class="var">?a2</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">*</span> <span class="var">?L</span><span class="main">)</span> <span class="main">^</span> <span class="var">?exp</span> <span class="main">/</span> <span class="var">?L</span> <span class="main">^</span> <span class="var">?exp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?a1</span> <span class="main">*</span> <span class="var">?a2</span><span class="main">^</span><span class="var">?exp</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?f1</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">^</span> <span class="var">?exp</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?L</span><span class="main">^</span><span class="var">?exp</span> <span class="main">/</span> <span class="var">?L</span> <span class="main">^</span> <span class="var">?exp</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> power_mult_distrib power_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="var">?L</span> <span class="main">^</span> <span class="var">?exp</span> <span class="main">/</span> <span class="var">?L</span> <span class="main">^</span> <span class="var">?exp</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list_zero_iff <span class="keyword1"><span class="command">using</span></span> L0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f1</span> <span class="main">/</span> <span class="var">?f2</span> <span class="main">^</span> <span class="var">?exp</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int pow_int_divide
      pow_int_add<span class="main">[</span><span class="operator">OF</span> fi0'<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a2</span><span class="main">^</span><span class="var">?exp</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?exp</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> semiring_normalization_rules<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="var">?exp</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?exp</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">^</span> <span class="var">?e</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="var">?e</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?exp</span> <span class="main">+</span> σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?exp</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i3</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">≥</span> <span class="skolem">m1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m2_def m1_def <span class="keyword1"><span class="command">using</span></span> n_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> i less<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> Suc <span class="skolem">i3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i3_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ii</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">ii</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ii</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">&lt;</span> <span class="skolem">ii</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="skolem">D</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> <span class="skolem">ii</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">ii</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="skolem">D</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> <span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> map <span class="skolem">D</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> <span class="skolem">ii</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">D</span> <span class="skolem">ii</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="skolem">D</span> <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">ii</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">D</span> <span class="skolem">ii</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">ii</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">ii</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">(</span><span class="skolem">ii</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="keyword2"><span class="keyword">where</span></span> DL<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="skolem">D</span> <span class="skolem">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">kk</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">L</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="skolem">i</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">B</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">D</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">l</span>
        <span class="keyword1"><span class="command">unfolding</span></span> A_def B_def C_def D_def ring_distribs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="skolem">i</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">e</span> <span class="main">=</span> even <span class="var">?e</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> even <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?exp</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>σ <span class="skolem">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?g</span> <span class="main">+</span> <span class="var">?j</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">A</span> <span class="skolem">i</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> σ_def id A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="var">?l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">B</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">C</span> <span class="skolem">i</span> <span class="main">+</span>
          <span class="var">?l</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">l</span> <span class="main">*</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A sum_list_addf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_list_triv len<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Suc <span class="var">?l</span> <span class="main">*</span> <span class="skolem">B</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">C</span> <span class="skolem">i</span> <span class="main">+</span>
          <span class="var">?l</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">D</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?i</span> <span class="main">+</span> <span class="var">?j</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_list_mult_const <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs numeral_2_eq_2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?j</span> <span class="main">=</span>
          <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">kk</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="skolem">L</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?h</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?f</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> DL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">e</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?g</span> <span class="main">+</span> <span class="var">?i</span> <span class="main">+</span> <span class="var">?h</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> even <span class="main">(</span><span class="var">?g</span> <span class="main">+</span> <span class="var">?i</span> <span class="main">+</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">+</span> <span class="var">?i</span> <span class="main">+</span> <span class="var">?h</span> <span class="main">=</span>
         <span class="skolem">i3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span><span class="main">)</span>
         <span class="main">+</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m0</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span>
         <span class="main">+</span> <span class="main">(</span><span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span><span class="main">)</span><span class="main">)</span>
         <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m2</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">i3</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> Suc <span class="skolem">i3</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">i3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> idd B_def D_def C_def δ
        m1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> m2_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> m0_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> i3_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id4
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m0</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m0</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">l3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"even <span class="skolem">e</span> <span class="main">=</span> even <span class="main">(</span><span class="skolem">i3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span><span class="main">)</span>  <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">l1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">l2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">l3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> even <span class="main">(</span><span class="skolem">i3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> even <span class="main">(</span><span class="skolem">i3</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m2</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">+</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">m2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">i3</span> <span class="main">*</span> <span class="main">…</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"γ <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Subresultant-B_theorem_3_b"><span class="command">lemma</span></span> B_theorem_3_b<span class="main">:</span> <span class="quoted"><span class="quoted">"Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> ff <span class="main">(</span>lead_coeff <span class="main">(</span>H <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> fundamental_theorem_eq_6<span class="main"><span class="main">[</span></span><span class="operator">folded</span> H_def<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">lead_coeff</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
  lead_coeff_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Subresultant-B_theorem_3_main"><span class="command">lemma</span></span> B_theorem_3_main<span class="main">:</span> <span class="quoted"><span class="quoted">"Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">/</span> γ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">f</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span>α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> ff0 <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="free">i</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="free">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">d</span> <span class="main">::</span> <span class="tfree">'a</span> fract<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">AB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AB</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">β</span> <span class="bound">l</span> <span class="main">/</span> α <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ABP</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ABP</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="skolem">AB</span> <span class="bound">l</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">PR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PR</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">ABP</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">PR2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PR2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">AB</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">/</span> γ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> τ <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
    <span class="skolem">PR</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">/</span>
    pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">ABP</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">AB</span> <span class="bound">l</span><span class="main">)</span> <span class="main">*</span>
        <span class="skolem">AB</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id prod_list.append map_append Θ_def γ_def divide_prod_assoc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add AB_def ABP_def PR_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> fract<span class="main">)</span> <span class="main">^</span> τ <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>τ <span class="free">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> τ_def σ_def True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">l</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>τ <span class="free">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> σ_def τ_def id a_def b_def sum_list_addf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">+</span> <span class="skolem">b</span> <span class="bound">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">b</span> <span class="bound">l</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> a_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> length <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_list_addf c_def sum_list_const_mult sum_list_triv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_list_addf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="numeral">3</span> <span class="main">#</span> <span class="main">[</span><span class="numeral">4</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="main">(</span>Suc <span class="numeral">3</span><span class="main">)</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="main">(</span>Suc <span class="numeral">3</span><span class="main">)</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">sum_list</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="free">n</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"τ <span class="free">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
      <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span>  length <span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def b_def e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"τ <span class="free">i</span> <span class="main">+</span> σ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_1_even_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> <span class="skolem">ABP</span> <span class="bound">l</span> <span class="main">*</span> <span class="skolem">AB</span> <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">PR</span> <span class="main">*</span> <span class="skolem">PR2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> PR_def prod_list_multf PR2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">PR</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">/</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> int <span class="main">(</span><span class="free">δ</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>
    <span class="main">/</span> <span class="main">(</span><span class="skolem">PR</span> <span class="main">*</span> <span class="skolem">PR2</span> <span class="main">*</span> <span class="skolem">AB</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span>pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">/</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>int <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">δ</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">PR</span> <span class="main">/</span> <span class="skolem">PR</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">PR2</span> <span class="main">*</span> <span class="skolem">AB</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> exp_pow_int<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_int_divide <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> pow_int <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pow_int_divide pow_int_add<span class="main">[</span><span class="operator">OF</span> ff0<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pow_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PR</span> <span class="main">/</span> <span class="skolem">PR</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PR</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> PR_def prod_list_zero_iff set_map
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">ABP</span> <span class="main">`</span> set <span class="main">[</span><span class="numeral">3</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ABP</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> jk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"α <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> α0 f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AB</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ABP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> AB_def<span class="main">]</span> 1<span class="main">(</span>1<span class="main">)</span> β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PR2</span> <span class="main">*</span> <span class="skolem">AB</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="skolem">AB</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id PR2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span> inverse <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> AB_def
    inverse_prod_list map_map o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-B_theorem_3"><span class="command">lemma</span></span> B_theorem_3<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="free">i</span> <span class="main">=</span> Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"h <span class="free">i</span> <span class="main">=</span> ff <span class="main">(</span>lead_coeff <span class="main">(</span>H <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span> <span class="main">/</span> γ <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B_theorem_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">1</span> <span class="main">+</span> <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">f</span> <span class="free">i</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="numeral">3</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> α <span class="bound">l</span> <span class="main">/</span> <span class="free">β</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> B_theorem_3_main<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> h <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_eq_17<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"h <span class="free">i</span> <span class="main">=</span> Θ <span class="free">i</span> <span class="main">*</span> <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"h <span class="free">i</span> <span class="main">=</span> ff <span class="main">(</span>lead_coeff <span class="main">(</span>H <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B_theorem_3_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Subresultant-h0"><span class="command">lemma</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> h <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> h.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-deg_G12"><span class="command">lemma</span></span> deg_G12<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">G1</span> <span class="main">≥</span> degree <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n12
  <span class="keyword1"><span class="command">unfolding</span></span> n F1 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Subresultant-R0"><span class="command">lemma</span></span> R0<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R <span class="main">0</span> <span class="main">=</span> <span class="main">[:</span> resultant <span class="free">G1</span> <span class="free">G2</span> <span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"degree <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> F2 F12 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdiv_poly <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> degree <span class="free">G1</span><span class="main">:]</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span> <span class="main">^</span> degree <span class="free">G1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">unfolding</span></span> sdiv_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> dp <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G2 F12
    <span class="keyword1"><span class="command">unfolding</span></span> R_def δ n F1 F2 Suc_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mult.commute dp<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> False n12 <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"degree <span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">G2</span> <span class="main">≤</span> degree <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n F2 F1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="main">0</span> <span class="main">=</span> subresultant <span class="main">0</span> <span class="free">G1</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span> resultant <span class="free">G1</span> <span class="free">G2</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subresultant_resultant <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">div_exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> div_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">n</span><span class="main">.</span>
     <span class="main">(</span>to_fract <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract
     <span class="main">⟹</span> to_fract <span class="main">(</span><span class="free">div_exp</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Subresultant-subresultant_prs_main"><span class="command">lemma</span></span> subresultant_prs_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_main <span class="free">div_exp</span> <span class="free">Gi_1</span> <span class="free">Gi</span> <span class="free">hi_1</span> <span class="main">=</span> <span class="main">(</span><span class="free">Gk</span><span class="main">,</span> <span class="free">hk</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">i</span> <span class="main">=</span> ffp <span class="free">Gi</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> ffp <span class="free">Gi_1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> ff <span class="free">hi_1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span> <span class="main">∧</span> h <span class="free">k</span> <span class="main">=</span> ff <span class="free">hk</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">j</span> <span class="main">∈</span> range ffp <span class="main">∧</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> range ff<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Gi_1</span></span> <span class="quoted"><span class="free">Gi</span></span> <span class="quoted"><span class="free">hi_1</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">m</span> <span class="skolem">Gi_1</span> <span class="skolem">Gi</span> <span class="skolem">hi_1</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> less<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> m <span class="main">=</span> less<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> less<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> id <span class="main">=</span> less<span class="main">(</span>4-6<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> i <span class="main">=</span> less<span class="main">(</span>7-8<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pmod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="skolem">Gi_1</span> <span class="skolem">Gi</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ni</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">Gi</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ni_1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">Gi_1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">Gi</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gi_1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">Gi_1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?ni_1</span> <span class="main">-</span> <span class="var">?ni</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hi</span></span> <span class="keyword2"><span class="keyword">where</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hi</span> <span class="main">=</span> <span class="free">div_exp</span> <span class="var">?gi</span> <span class="skolem">hi_1</span> <span class="var">?d1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">divisor</span></span> <span class="keyword2"><span class="keyword">where</span></span> div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">divisor</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="var">?d1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="var">?gi_1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">hi_1</span> <span class="main">^</span> <span class="var">?d1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G1_p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> G1_p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G1_p1</span> <span class="main">=</span> sdiv_poly <span class="var">?pmod</span> <span class="skolem">divisor</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> subresultant_prs_main.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">div_exp</span></span> <span class="quoted"><span class="skolem">Gi_1</span></span><span class="main"><span class="main">]</span></span> Let_def<span class="main">,</span>
      <span class="operator">folded</span> hi<span class="main">,</span> <span class="operator">folded</span> div<span class="main">,</span> <span class="operator">folded</span> G1_p1<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> h_i<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> hi_ff<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">∈</span> range ff"</span></span> <span class="keyword1"><span class="command">using</span></span> B_theorem_3<span class="main">[</span><span class="operator">OF</span> _ i<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ n <span class="keyword1"><span class="command">using</span></span> id<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> ff <span class="var">?gi</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> fi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> ff <span class="var">?gi_1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> ff <span class="main">(</span>lead_coeff <span class="skolem">Gi</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> ff <span class="skolem">hi_1</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h_i fi id <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> idh<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">=</span> ff <span class="skolem">hi</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hi_ff h_i fi id
      <span class="keyword1"><span class="command">unfolding</span></span> hi d1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> div_exp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?gi</span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">δ</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">hi_1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> eq'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> βi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ff <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="skolem">Gi_1</span> <span class="main">*</span> <span class="skolem">hi_1</span> <span class="main">^</span> <span class="free">δ</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> range ff"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> beta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> range ff"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> ffp <span class="var">?pmod</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> to_fract_hom.pseudo_mod_hom<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?pmod</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pm i pmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> i β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> res eq <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Gk</span> <span class="main">=</span> <span class="skolem">Gi</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">hk</span> <span class="main">=</span> <span class="skolem">hi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pmod
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span> <span class="main">∧</span> h <span class="free">k</span> <span class="main">=</span> ff <span class="free">hk</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> res idh<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> beta <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> res eq <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span>
         <span class="quoted"><span class="quoted">"subresultant_prs_main <span class="free">div_exp</span> <span class="skolem">Gi</span> <span class="skolem">G1_p1</span> <span class="skolem">hi</span> <span class="main">=</span> <span class="main">(</span><span class="free">Gk</span><span class="main">,</span> <span class="free">hk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> m False i <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span>Suc <span class="skolem">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">j</span> <span class="main">∈</span> range ffp <span class="main">∧</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> range ff<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="skolem">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">j</span> <span class="main">∈</span> range ffp  <span class="main">∧</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> range ff<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> for_all_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> id<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> beta<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> m res<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> si<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ id<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> idh ii<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> F_ffp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> range ffp"</span></span> <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_eq_4<span class="main">[</span><span class="operator">OF</span> ii<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> B_theorem_2<span class="main">[</span><span class="operator">OF</span> iii<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> pmod<span class="main">[</span><span class="operator">OF</span> iii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> Fsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> ffp <span class="skolem">G1_p1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smult_inverse_sdiv_poly<span class="main"><span class="main">[</span></span><span class="operator">OF</span> F_ffp Fsi G1_p1 _ pm<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> ff <span class="skolem">divisor</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> βi<span class="main">[</span><span class="operator">OF</span> iv<span class="main">]</span> div d1 * fi1
            <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-subresultant_prs"><span class="command">lemma</span></span> subresultant_prs<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant_prs <span class="free">div_exp</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="free">Gk</span><span class="main">,</span> <span class="free">hk</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span> <span class="main">∧</span> h <span class="free">k</span> <span class="main">=</span> ff <span class="free">hk</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">F</span> <span class="free">i</span> <span class="main">∈</span> range ffp<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟶</span> <span class="free">β</span> <span class="free">i</span> <span class="main">∈</span> range ff<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pmod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="free">G1</span> <span class="free">G2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> ffp <span class="var">?pmod</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> to_fract_hom.pseudo_mod_hom<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> F1 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">G2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">G2</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span> degree <span class="free">G1</span> <span class="main">-</span> <span class="var">?n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">=</span> <span class="var">?g2</span> <span class="main">^</span> <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?pmod</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">&lt;</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k2 pmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> subresultant_prs_def Let_def eq<span class="main">,</span> <span class="operator">folded</span> d1<span class="main">,</span> <span class="operator">folded</span> h2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> idh2<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="numeral">2</span> <span class="main">=</span> ff <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h2 d1 h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> δ n F1
    <span class="keyword1"><span class="command">using</span></span> F2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 f <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span> <span class="main">∧</span> h <span class="free">k</span> <span class="main">=</span> ff <span class="free">hk</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">⟶</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">F</span> <span class="skolem">i</span> <span class="main">∈</span> range ffp <span class="main">∧</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> range ff<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> res <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gk</span> <span class="main">=</span> <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">hk</span> <span class="main">=</span> <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True idh2 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> this if_False<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> F_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> ffp <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> ff <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> idh2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">G2</span> <span class="main">=</span> <span class="free">n</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">using</span></span> F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> False k2 <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span> <span class="main">∧</span> h <span class="free">k</span> <span class="main">=</span> ff <span class="free">hk</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="numeral">3</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">j</span> <span class="main">∈</span> range ffp <span class="main">∧</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> range ff<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subresultant_prs_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> res _ F_2 h2 le_refl k3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pow</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> fract"</span></span>
      <span class="keyword1"><span class="command">from</span></span> pmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> k3
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">β</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pseudo_mod <span class="main">(</span>ffp <span class="free">G1</span><span class="main">)</span> <span class="main">(</span>ffp <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F1 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ffp <span class="main">(</span>pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_fract_hom.pseudo_mod_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> β3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> ffp <span class="main">(</span>pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> <span class="var">?pow</span> <span class="main">:]</span> <span class="main">*</span> <span class="free">F</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="var">?pow</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">F</span> <span class="numeral">3</span> <span class="main">=</span> ffp <span class="main">(</span>pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">i</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ffp <span class="main">(</span>pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> δ n d1 <span class="keyword1"><span class="command">using</span></span> F1 F2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> F3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="numeral">3</span> <span class="main">=</span> ffp <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>12<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>i3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ik<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">i</span> <span class="main">∈</span> range ffp"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 12
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> F1 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> i3
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> ik
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="main">|</span> <span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="free">i</span> <span class="main">∈</span> range ff"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="free">i</span> <span class="main">=</span> ff <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">δ</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 3 β3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">with</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-resultant_impl_main"><span class="command">lemma</span></span> resultant_impl_main<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl_main <span class="free">div_exp</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> resultant <span class="free">G1</span> <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> F12<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Gk</span></span> <span class="skolem"><span class="skolem">hk</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant_prs <span class="free">div_exp</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Gk</span><span class="main">,</span> <span class="skolem">hk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> subresultant_prs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="skolem">Gk</span>"</span></span> <span class="quoted"><span class="quoted">"h <span class="free">k</span> <span class="main">=</span> ff <span class="skolem">hk</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resultant_impl_main <span class="free">div_exp</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="main">(</span><span class="free">F</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">hk</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_main_def sub split * <span class="keyword1"><span class="command">using</span></span> F2 F12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> resultant <span class="free">G1</span> <span class="free">G2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> fundamental_theorem_eq_7<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> * R0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> H_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">,</span> <span class="operator">unfolded</span> True<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">0</span> <span class="main">=</span> H <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> k2 <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> B_theorem_3<span class="main">[</span><span class="operator">OF</span> k3<span class="main">]</span> R0 R <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"h <span class="free">k</span> <span class="main">=</span> ff <span class="main">(</span>resultant <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> *<span class="main">]</span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hk</span> <span class="main">=</span> resultant <span class="free">G1</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2<span class="main">:</span> True
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> degree <span class="main">(</span><span class="free">F</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">hk</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">hk</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> pmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">,</span> <span class="operator">unfolded</span> 2<span class="main">]</span> β0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F1 F2 to_fract_hom.pseudo_mod_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> subresultant_prs_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">div_exp</span></span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span><span class="main">,</span> <span class="operator">unfolded</span> sub Let_def this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Gk</span> <span class="main">=</span> <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hk</span> <span class="main">=</span> lead_coeff <span class="free">G2</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">G1</span> <span class="main">-</span> degree <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> F12 F1 F2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> resultant_pseudo_mod_0<span class="main">[</span><span class="operator">OF</span> pm deg_G12 this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> lead_coeff <span class="free">G2</span> <span class="main">^</span> degree <span class="free">G1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True<span class="main">[</span><span class="operator">unfolded</span> 2 n F2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> res 2 F2 id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹At this point, we have soundness of the resultant-implementation, provided that we can
  instantiate the locale by constructing suitable values of F, b, h, etc. Now we show the
  existence of suitable locale parameters by constructively computing them.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide poly"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">F</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">h</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span>
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> map_poly to_fract <span class="free">G1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> map_poly to_fract <span class="free">G2</span>
  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span>
   <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
   <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
         <span class="free">h</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">(</span>lead_coeff <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free">F</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span>lead_coeff <span class="main">(</span><span class="free">F</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">h</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>degree <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span><span class="free">F</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measure <span class="main">(</span>case_sum <span class="main">(</span><span class="main">λ</span> <span class="bound">fi</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">fi</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span>  <span class="main">(</span>case_sum <span class="main">(</span><span class="main">λ</span> <span class="bound">bi</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">bi</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">hi</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">hi</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">termination_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> h.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> b.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> F.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subresultant-Fb0"><span class="command">lemma</span></span> Fb0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>F <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> F <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> b <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> h <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>0<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> F <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> less<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> less<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"h <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> 2 F2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bi<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hi bi F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> F <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subresultant-k_exists"><span class="command">lemma</span></span> k_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> F <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span>F <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span> <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ii</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span>F <span class="main">(</span><span class="var">?ii</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>F <span class="var">?i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> Fi<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="var">?ii</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> F <span class="var">?i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?mod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> smult <span class="main">(</span>inverse <span class="main">(</span>b <span class="var">?ii</span><span class="main">)</span><span class="main">)</span> <span class="var">?mod</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ii</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"F <span class="var">?ii</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> Fi<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="var">?ii</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>b <span class="var">?ii</span><span class="main">)</span><span class="main">)</span> <span class="var">?mod</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mod</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Fi1<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="var">?i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pseudo_mod<span class="main">[</span><span class="operator">OF</span> Fi1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"F <span class="main"><span class="main">(</span></span><span class="var"><span class="var">?ii</span></span> <span class="main"><span class="main">-</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">]</span> mod <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?mod</span> <span class="main">&lt;</span> degree <span class="main">(</span>F <span class="var">?i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>F <span class="var">?ii</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span>F <span class="var">?i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span>F <span class="var">?ii</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>coeffs <span class="main">(</span>F <span class="var">?i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ i refl<span class="main">,</span> <span class="operator">folded</span> less<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subresultant-k"><span class="command">lemma</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span>Suc k<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> k <span class="main">⟹</span> F <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span>Suc k<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">using</span></span> k_exists <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI2_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> k"</span></span> <span class="keyword1"><span class="command">from</span></span> not_less_Least<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> k_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-enter_subresultant_prs"><span class="command">lemma</span></span> enter_subresultant_prs<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">G1</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span> <span class="bound">n</span> <span class="bound">d</span> <span class="bound">f</span> <span class="bound">k</span> <span class="bound">b</span><span class="main">.</span> subresultant_prs_locale2 <span class="bound">F</span> <span class="bound">n</span> <span class="bound">d</span> <span class="bound">f</span> <span class="bound">k</span> <span class="bound">b</span> <span class="free">G1</span> <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> G2 len <span class="keyword1"><span class="command">have</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> deg_le<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>F <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>F <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F.simps degree_eq_length_coeffs<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> G2 G1 <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F2<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Fb0 <span class="main">=</span> Fb0<span class="main">[</span><span class="operator">OF</span> G1 G2<span class="main">]</span>
  <span class="keyword1"><span class="command">interpret</span></span> s<span class="main">:</span> subresultant_prs_locale <span class="quoted">F</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> lead_coeff <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted">k</span> <span class="quoted">b</span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> deg_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> F1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> F2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> k<span class="main">(</span>1<span class="main">)</span> F1 <span class="keyword1"><span class="command">have</span></span> k0<span class="main">:</span> <span class="quoted"><span class="quoted">"k <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted">k</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> Fk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>F <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>k <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"F <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> k<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> k<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> k"</span></span> <span class="keyword1"><span class="command">using</span></span> k0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> k"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc k"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> Suc k"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Fj<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> F1 F2 k0 <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> Suc <span class="skolem">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> j2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fj<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> Fb0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F <span class="main">1</span> <span class="main">=</span> map_poly to_fract <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F <span class="numeral">2</span> <span class="main">=</span> map_poly to_fract <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc k"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Fk<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> Fi<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?mod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> smult <span class="main">(</span>inverse <span class="main">(</span>b <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="var">?mod</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
      Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>b <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>F <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?mod</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?mod</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Fi <span class="keyword1"><span class="command">have</span></span> Fi<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="skolem">i</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>b <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="var">?mod</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>b <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> b<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">note</span></span> s.h.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_locale2 F <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> lead_coeff <span class="main">(</span>F <span class="bound">i</span><span class="main">)</span><span class="main">)</span> k b <span class="free">G1</span> <span class="free">G2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"b <span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>F <span class="main">1</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span>Suc <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b.simps numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc k"</span></span>
    <span class="keyword1"><span class="command">with</span></span> s.F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> bi<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                    h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b.simps
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> k <span class="main">⟹</span> s.h <span class="skolem">i</span> <span class="main">=</span> h <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h.simps s.h.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> s.F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> s.h.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> sh<span class="main">:</span> <span class="quoted"><span class="quoted">"s.h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"b <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
         s.h <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="main">(</span>F <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> degree <span class="main">(</span>F <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sh bi * <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we obtain the soundness lemma outside the locale.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">div_exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> div_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">n</span><span class="main">.</span>
     <span class="main">(</span>to_fract <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> range to_fract
     <span class="main">⟹</span> to_fract <span class="main">(</span><span class="free">div_exp</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_fract <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> <span class="main">(</span>to_fract <span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Subresultant-resultant_impl_main"><span class="command">lemma</span></span> resultant_impl_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">G1</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant_impl_main <span class="free">div_exp</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> resultant <span class="free">G1</span> <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> G2<span class="main">:</span> False
  <span class="keyword1"><span class="command">from</span></span> enter_subresultant_prs<span class="main">[</span><span class="operator">OF</span> len G2<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">b</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_locale2 <span class="skolem">F</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">f</span> <span class="skolem">k</span> <span class="skolem">b</span> <span class="free">G1</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> subresultant_prs_locale2 <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> resultant_impl_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> div_exp<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> G2<span class="main">:</span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> G2
    resultant_impl_main_def <span class="keyword1"><span class="command">using</span></span> resultant_const<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> resultant_impl_generic<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl_generic <span class="free">div_exp</span> <span class="main">=</span> resultant"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"resultant_impl_generic <span class="free">div_exp</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> resultant <span class="skolem">f</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="skolem">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_generic_def resultant_impl_main<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="skolem">g</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> resultant_impl_main<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_generic_def resultant_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Subresultant-resultant_impl"><span class="command">lemma</span></span> resultant_impl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl <span class="main">=</span> resultant"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> resultant_impl_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dichotomous_Lazard<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Subresultant-resultant_impl_idom_divide"><span class="command">lemma</span></span> resultant_impl_idom_divide<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl_idom_divide <span class="main">=</span> resultant"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_idom_divide_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> resultant_impl_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> basic_div_exp<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Equations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following code-equations, we only compute the required values, e.g., $h_k$
  is not required if $n_k &gt; 0$, we compute $(-1)^{\ldots} * \ldots$ via a case-analysis,
  and we perform special cases for $\delta_i = 1$, which is the most frequent case.›</span></span>

<span class="keyword1"><span class="command">partial_function</span></span><span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">subresultant_prs_main_impl</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subresultant_prs_main_impl</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Gi_1</span></span></span> <span class="free"><span class="bound"><span class="entity">Gi</span></span></span> <span class="free"><span class="bound"><span class="entity">ni_1</span></span></span> <span class="free"><span class="bound"><span class="entity">d1_1</span></span></span> <span class="free"><span class="bound"><span class="entity">hi_2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
     <span class="bound">gi_1</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">Gi_1</span></span></span><span class="main">;</span>
     <span class="bound">ni</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">Gi</span></span></span><span class="main">;</span>
     <span class="bound">hi_1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d1_1</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="bound">gi_1</span> <span class="free"><span class="bound"><span class="entity">hi_2</span></span></span> <span class="free"><span class="bound"><span class="entity">d1_1</span></span></span><span class="main">)</span><span class="main">;</span>
     <span class="bound">d1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ni_1</span></span></span> <span class="main">-</span> <span class="bound">ni</span><span class="main">;</span>
     <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free"><span class="bound"><span class="entity">Gi_1</span></span></span> <span class="free"><span class="bound"><span class="entity">Gi</span></span></span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Gi</span></span></span><span class="main">,</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> lead_coeff <span class="free"><span class="bound"><span class="entity">Gi</span></span></span>
      <span class="keyword1">else</span> dichotomous_Lazard <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">Gi</span></span></span><span class="main">)</span> <span class="bound">hi_1</span> <span class="bound">d1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span>
       <span class="bound">gi</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">Gi</span></span></span><span class="main">;</span>
       <span class="bound">divisor</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">d1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">hi_1</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">)</span> <span class="main">;</span>
       <span class="bound">Gi_p1</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
       <span class="keyword1">in</span> <span class="free">subresultant_prs_main_impl</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Gi</span></span></span> <span class="bound">Gi_p1</span> <span class="bound">ni</span> <span class="bound">d1</span> <span class="bound">hi_1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subresultant_prs_impl</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subresultant_prs_impl</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
    <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">;</span>
    <span class="bound">n2</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">;</span>
    <span class="bound">delta_1</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="main">-</span> <span class="bound">n2</span><span class="main">)</span><span class="main">;</span>
    <span class="bound">g2</span> <span class="main">=</span> lead_coeff <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">;</span>
    <span class="bound">h2</span> <span class="main">=</span> <span class="bound">g2</span> <span class="main">^</span> <span class="bound">delta_1</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">,</span><span class="bound">h2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">let</span>
      <span class="bound">G3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">delta_1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">pmod</span><span class="main">;</span>
      <span class="bound">g3</span> <span class="main">=</span> lead_coeff <span class="bound">G3</span><span class="main">;</span>
      <span class="bound">n3</span> <span class="main">=</span> degree <span class="bound">G3</span><span class="main">;</span>
      <span class="bound">d2</span> <span class="main">=</span> <span class="bound">n2</span> <span class="main">-</span> <span class="bound">n3</span><span class="main">;</span>
      <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="bound">G3</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">G3</span><span class="main">,</span> <span class="keyword1">if</span> <span class="bound">d2</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g3</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="bound">g3</span> <span class="bound">h2</span> <span class="bound">d2</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">divisor</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">d2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="main">^</span> <span class="bound">d2</span><span class="main">;</span> <span class="bound">G4</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
         <span class="keyword1">in</span> subresultant_prs_main_impl <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">G3</span> <span class="bound">G4</span> <span class="bound">n3</span> <span class="bound">d2</span> <span class="bound">h2</span>
    <span class="main">)</span>"</span></span>

<span class="keyword1" id="Subresultant-subresultant_prs_impl"><span class="command">lemma</span></span> subresultant_prs_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant_prs_impl <span class="free">f</span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>subresultant_prs dichotomous_Lazard <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">=</span> lead_coeff <span class="free">G2</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">G1</span> <span class="main">-</span> degree <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G3</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">G1</span> <span class="main">-</span> degree <span class="free">G2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G4</span> <span class="main">=</span> sdiv_poly <span class="main">(</span>pseudo_mod <span class="free">G2</span> <span class="skolem">G3</span><span class="main">)</span>
       <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">G2</span> <span class="main">-</span> degree <span class="skolem">G3</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="free">G2</span> <span class="main">*</span>
        <span class="skolem">h2</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">G2</span> <span class="main">-</span> degree <span class="skolem">G3</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">=</span> degree <span class="free">G2</span> <span class="main">-</span> degree <span class="skolem">G3</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dl1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">::</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> dichotomous_Lazard <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span> <span class="skolem">g</span> <span class="skolem">h</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dichotomous_Lazard dichotomous_Lazard.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subresultant_prs_impl_def subresultant_prs_def Let_def
      subresultant_prs_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted">dichotomous_Lazard</span> <span class="quoted"><span class="free">G2</span></span><span class="main">]</span>
      if_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> dl1
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> h2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">unfold</span> G3_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> G4_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> d2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> subresultant_prs_main_impl.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> subresultant_prs_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted">dichotomous_Lazard</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_main_impl <span class="free">f</span> <span class="skolem">G3</span> <span class="skolem">G4</span> <span class="main">(</span>degree <span class="skolem">G3</span><span class="main">)</span> <span class="skolem">d2</span> <span class="skolem">h2</span> <span class="main">=</span>
      <span class="free">f</span> <span class="main">(</span>subresultant_prs_main dichotomous_Lazard <span class="skolem">G3</span> <span class="skolem">G4</span> <span class="main">(</span>dichotomous_Lazard <span class="main">(</span>lead_coeff <span class="skolem">G3</span><span class="main">)</span> <span class="skolem">h2</span> <span class="skolem">d2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">G4</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">G3</span></span> <span class="quoted"><span class="skolem">d2</span></span> <span class="quoted"><span class="skolem">h2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_measure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">degree</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">G4</span> <span class="skolem">G3</span> <span class="skolem">d2</span> <span class="skolem">h2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="skolem">G3</span> <span class="skolem">G4</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G3</span></span></span></span><span class="main">]</span> Let_def dl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?M</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="skolem">G3</span> <span class="main">-</span> degree <span class="skolem">G4</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> lead_coeff <span class="skolem">G3</span> <span class="main">*</span>
            <span class="main">(</span>dichotomous_Lazard <span class="main">(</span>lead_coeff <span class="skolem">G3</span><span class="main">)</span> <span class="skolem">h2</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>degree <span class="skolem">G3</span> <span class="main">-</span> degree <span class="skolem">G4</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sdiv_poly <span class="var">?M</span> <span class="var">?c</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">G4</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> G4<span class="main">:</span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?N</span> <span class="main">≤</span> degree <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdiv_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_map_poly_le<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> degree <span class="skolem">G4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pseudo_mod<span class="main">[</span><span class="operator">OF</span> G4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G3</span></span></span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G3</span></span></span></span><span class="main">]</span> Let_def id if_False dl1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 0<span class="main">:</span> True
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">unfolding</span></span> simp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G3</span></span></span></span><span class="main">]</span> Let_def <span class="keyword1"><span class="command">unfolding</span></span> dl1 simp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_rec</span> <span class="main">=</span> subresultant_prs_main_impl <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">Gk</span><span class="main">,</span><span class="bound">hk</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> degree <span class="bound">Gk</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">hk</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_start</span> <span class="main">=</span> subresultant_prs_impl <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">Gk</span><span class="main">,</span><span class="bound">hk</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> degree <span class="bound">Gk</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">hk</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">resultant_impl_Lazard</span> <span class="main">=</span> resultant_impl_main dichotomous_Lazard"</span></span>

<span class="keyword1" id="Subresultant-resultant_impl_start_code"><span class="command">lemma</span></span> resultant_impl_start_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"resultant_impl_start <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">G1</span> <span class="free">G2</span><span class="main">;</span>
          <span class="bound">n2</span> <span class="main">=</span> degree <span class="free">G2</span><span class="main">;</span>
          <span class="bound">n1</span> <span class="main">=</span> degree <span class="free">G1</span><span class="main">;</span>
          <span class="bound">g2</span> <span class="main">=</span> lead_coeff <span class="free">G2</span><span class="main">;</span>
          <span class="bound">d1</span> <span class="main">=</span> <span class="bound">n1</span> <span class="main">-</span> <span class="bound">n2</span>
         <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">n2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">^</span> <span class="bound">d1</span> <span class="keyword1">else</span> <span class="main">0</span>
            <span class="keyword1">else</span> <span class="keyword1">let</span>
                 <span class="bound">G3</span> <span class="main">=</span> <span class="keyword1">if</span> even <span class="bound">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">pmod</span> <span class="keyword1">else</span> <span class="bound">pmod</span><span class="main">;</span>
                 <span class="bound">n3</span> <span class="main">=</span> degree <span class="bound">G3</span><span class="main">;</span>
                 <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">G2</span> <span class="bound">G3</span>
                 <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span>
                    <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">n3</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
                     <span class="keyword1">let</span> <span class="bound">d2</span> <span class="main">=</span> <span class="bound">n2</span> <span class="main">-</span> <span class="bound">n3</span><span class="main">;</span>
                         <span class="bound">g3</span> <span class="main">=</span> lead_coeff <span class="bound">G3</span>
                        <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d2</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g3</span> <span class="keyword1">else</span>
                            dichotomous_Lazard <span class="bound">g3</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">)</span> <span class="bound">d2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>
                    <span class="keyword1">else</span> <span class="keyword1">let</span>
                           <span class="bound">h2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">)</span><span class="main">;</span>
                           <span class="bound">d2</span> <span class="main">=</span> <span class="bound">n2</span> <span class="main">-</span> <span class="bound">n3</span><span class="main">;</span>
                           <span class="bound">divisor</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d2</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="bound">d2</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="main">^</span> <span class="bound">d2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="main">^</span> <span class="bound">d2</span><span class="main">)</span><span class="main">;</span>
                           <span class="bound">G4</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
                         <span class="keyword1">in</span> resultant_impl_rec <span class="bound">G3</span> <span class="bound">G4</span> <span class="bound">n3</span> <span class="bound">d2</span> <span class="bound">h2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">G1</span> <span class="main">-</span> degree <span class="free">G2</span> <span class="main">=</span> <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="skolem">pmod</span> <span class="keyword1">else</span> <span class="skolem">pmod</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">pmod</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">pmod</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">d2</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="skolem">d2</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="main">^</span> <span class="skolem">d2</span> <span class="keyword1">else</span> <span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="main">^</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">d2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="main">^</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d2</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">g2</span> <span class="skolem">h2</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_start_def subresultant_prs_impl_def resultant_impl_rec_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Let_def split
    <span class="keyword1"><span class="command">unfolding</span></span> d1
    <span class="keyword1"><span class="command">unfolding</span></span> id1
    <span class="keyword1"><span class="command">unfolding</span></span> id3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl if_cong if_cong<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant-resultant_impl_rec_code"><span class="command">lemma</span></span> resultant_impl_rec_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"resultant_impl_rec <span class="free">Gi_1</span> <span class="free">Gi</span> <span class="free">ni_1</span> <span class="free">d1_1</span> <span class="free">hi_2</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">ni</span> <span class="main">=</span> degree <span class="free">Gi</span><span class="main">;</span>
        <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">Gi_1</span> <span class="free">Gi</span>
     <span class="keyword1">in</span>
     <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span>
        <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">ni</span> <span class="main">=</span> <span class="main">0</span>
          <span class="keyword1">then</span>
            <span class="keyword1">let</span>
              <span class="bound">d1</span> <span class="main">=</span> <span class="free">ni_1</span> <span class="main">-</span> <span class="bound">ni</span><span class="main">;</span>
              <span class="bound">gi</span> <span class="main">=</span> lead_coeff <span class="free">Gi</span>
            <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi</span> <span class="keyword1">else</span>
              <span class="keyword1">let</span> <span class="bound">gi_1</span> <span class="main">=</span> lead_coeff <span class="free">Gi_1</span><span class="main">;</span>
                  <span class="bound">hi_1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d1_1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="bound">gi_1</span> <span class="free">hi_2</span> <span class="free">d1_1</span><span class="main">)</span> <span class="keyword1">in</span>
                dichotomous_Lazard <span class="bound">gi</span> <span class="bound">hi_1</span> <span class="bound">d1</span>
          <span class="keyword1">else</span> <span class="main">0</span>
        <span class="keyword1">else</span> <span class="keyword1">let</span>
           <span class="bound">d1</span> <span class="main">=</span> <span class="free">ni_1</span> <span class="main">-</span> <span class="bound">ni</span><span class="main">;</span>
           <span class="bound">gi_1</span> <span class="main">=</span> lead_coeff <span class="free">Gi_1</span><span class="main">;</span>
           <span class="bound">hi_1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d1_1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="bound">gi_1</span> <span class="free">hi_2</span> <span class="free">d1_1</span><span class="main">)</span><span class="main">;</span>
           <span class="bound">divisor</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="bound">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="main">^</span> <span class="bound">d1</span> <span class="keyword1">else</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">;</span>
           <span class="bound">Gi_p1</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
       <span class="keyword1">in</span> resultant_impl_rec <span class="free">Gi</span> <span class="bound">Gi_p1</span> <span class="bound">ni</span> <span class="bound">d1</span> <span class="bound">hi_1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_rec_def subresultant_prs_main_impl.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">Gi_1</span></span><span class="main">]</span> split Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_rec_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ if_cong _<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant-resultant_impl_Lazard_code"><span class="command">lemma</span></span> resultant_impl_Lazard_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl_Lazard <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> degree <span class="free">G1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>
     <span class="keyword1">else</span> resultant_impl_start <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_Lazard_def resultant_impl_main_def
   resultant_impl_start_def subresultant_prs_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Subresultant-resultant_impl_code"><span class="command">lemma</span></span> resultant_impl_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"resultant_impl <span class="free">f</span> <span class="free">g</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">g</span><span class="main">)</span> <span class="keyword1">then</span> resultant_impl_Lazard <span class="free">f</span> <span class="free">g</span>
     <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">res</span> <span class="main">=</span> resultant_impl_Lazard <span class="free">g</span> <span class="free">f</span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">f</span><span class="main">)</span> <span class="main">∨</span> even <span class="main">(</span>degree <span class="free">g</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">res</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="bound">res</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_def resultant_impl_generic_def resultant_impl_Lazard_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Subresultant-resultant_code"><span class="command">lemma</span></span> resultant_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> resultant_impl <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Subresultant_Gcd">
<div class="head">
<h1>Theory Subresultant_Gcd</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Computing the Gcd via the subresultant PRS›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory now formalizes how the subresultant PRS can be used to calculate the gcd
  of two polynomials. Moreover, it proves the connection between resultants and gcd, namely that
  the resultant is 0 iff the degree of the gcd is non-zero.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Subresultant_Gcd
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Subresultant.html">Subresultant</a>
  <a href="../Polynomial_Factorization/Missing_Polynomial_Factorial.html">Polynomial_Factorization.Missing_Polynomial_Factorial</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algorithm›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gcd_impl_primitive</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gcd_impl_primitive</span> <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> normalize <span class="main">(</span>primitive_part <span class="main">(</span>fst <span class="main">(</span>subresultant_prs dichotomous_Lazard <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gcd_impl_main</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gcd_impl_main</span> <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">G2</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> normalize <span class="free"><span class="bound"><span class="entity">G1</span></span></span> <span class="keyword1">else</span>
   smult <span class="main">(</span>gcd <span class="main">(</span>content <span class="free"><span class="bound"><span class="entity">G1</span></span></span><span class="main">)</span> <span class="main">(</span>content <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>gcd_impl_primitive <span class="main">(</span>primitive_part <span class="free"><span class="bound"><span class="entity">G1</span></span></span><span class="main">)</span> <span class="main">(</span>primitive_part <span class="free"><span class="bound"><span class="entity">G2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gcd_impl</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gcd_impl</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="keyword1">then</span> gcd_impl_main <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>  <span class="keyword1">else</span> gcd_impl_main <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness Proof for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"gcd_impl <span class="main"><span class="main">=</span></span> gcd"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">locale</span></span> subresultant_prs_gcd <span class="main">=</span> subresultant_prs_locale2 <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">δ</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">β</span></span> <span class="quoted"><span class="free">G1</span></span> <span class="quoted"><span class="free">G2</span></span> <span class="keyword2"><span class="keyword">for</span></span>
       <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span>  <span class="main">{</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">}</span> fract poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">δ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fract"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G1</span> <span class="free">G2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The subresultant PRS computes the gcd up to a scalar multiple.›</span></span>

<span class="keyword1" id="Subresultant_Gcd-subresultant_prs_gcd"><span class="command">lemma</span></span> subresultant_prs_gcd<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subresultant_prs dichotomous_Lazard <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="free">Gk</span><span class="main">,</span> <span class="free">hk</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> smult <span class="bound">a</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="bound">b</span> <span class="main">(</span>normalize <span class="free">Gk</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> subresultant_prs<span class="main">[</span><span class="operator">OF</span> dichotomous_Lazard assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> Fk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">k</span> <span class="main">=</span> ffp <span class="free">Gk</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">H</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">i</span> <span class="main">=</span> ffp <span class="bound">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟶</span> <span class="free">β</span> <span class="bound">i</span> <span class="main">=</span> ff <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="skolem"><span class="skolem">beta</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    FH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">F</span> <span class="bound">i</span> <span class="main">=</span> ffp <span class="main">(</span><span class="skolem">H</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    beta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="free">k</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">i</span> <span class="main">=</span> ff <span class="main">(</span><span class="skolem">beta</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Fk FH<span class="main">[</span><span class="operator">OF</span> k0<span class="main">]</span> FH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> FH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> FH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">k</span>"</span></span><span class="main">]</span> F1 F2
  <span class="keyword1"><span class="command">have</span></span> border<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="free">k</span> <span class="main">=</span> <span class="free">Gk</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">1</span> <span class="main">=</span> <span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> smult <span class="bound">a</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="bound">b</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> border<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> ik <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> imk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> i2
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">a</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="skolem">b</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">β</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> ffp <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_fract_hom.pseudo_mod_hom<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> M_def
         <span class="keyword1"><span class="command">using</span></span> i2 FH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> β0 <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> i2 ik <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> Suc <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pmod<span class="main">[</span><span class="operator">OF</span> 3<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pseudo_mod <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> beta<span class="main">[</span><span class="operator">OF</span> 3<span class="main">,</span> <span class="operator">folded</span> c_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> ff <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pm<span class="main">[</span><span class="operator">unfolded</span> cd M<span class="main">]</span> FH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ffp <span class="main">(</span>smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ffp <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> pm<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_hom.injectivity<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ik F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> i2 FH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Hi0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pseudo_mod<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">H</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">i</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">,</span> <span class="operator">folded</span> M_def<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">+</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> pm<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Q</span> <span class="main">*</span> <span class="skolem">H</span> <span class="skolem">i</span> <span class="main">+</span> smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> gcd_add_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="skolem">Q</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>smult <span class="skolem">c</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> gcd_smult_ex<span class="main">[</span><span class="operator">OF</span> c<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>smult <span class="skolem">d</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smult <span class="skolem">e</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> gcd.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> gcd_smult_ex<span class="main">[</span><span class="operator">OF</span> d<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> smult <span class="skolem">e</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> gcd.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">b</span>"</span></span><span class="main">]</span> arg_cong<span class="main">[</span><span class="operator">OF</span> IH<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">e</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="skolem">e</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>gcd <span class="main">(</span><span class="skolem">H</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> smult_smult
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a b c e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> k0 le_refl<span class="main">,</span> <span class="operator">unfolded</span> border<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">a</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="skolem">b</span> <span class="main">(</span>normalize <span class="free">Gk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Subresultant_Gcd-gcd_impl_primitive"><span class="command">lemma</span></span> gcd_impl_primitive<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"primitive_part <span class="free">G1</span> <span class="main">=</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"primitive_part <span class="free">G2</span> <span class="main">=</span> <span class="free">G2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd_impl_primitive <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> gcd <span class="free">G1</span> <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted">primitive_part</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"content"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted">normalize</span>
  <span class="keyword1"><span class="command">from</span></span> F2 F0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> k2 <span class="keyword1"><span class="command">have</span></span> G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Gk</span></span> <span class="skolem"><span class="skolem">hk</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant_prs dichotomous_Lazard <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Gk</span><span class="main">,</span> <span class="skolem">hk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> impl<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd_impl_primitive <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_primitive_def sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> subresultant_prs_gcd<span class="main">[</span><span class="operator">OF</span> sub<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">a</span> <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> smult <span class="skolem">b</span> <span class="main">(</span><span class="var">?n</span> <span class="skolem">Gk</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> unit_factor <span class="main">(</span>gcd <span class="free">G1</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> smult <span class="main">(</span>unit_factor <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> G2 <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> primitive_part_smult primitive_part_gcd assms
     primitive_part_normalize c_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> smult <span class="main">(</span>unit_factor <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> c a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_smult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> is_unitE<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> de<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> smult <span class="main">(</span>unit_factor <span class="skolem">b</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">e</span> <span class="main">*</span> <span class="bound">x</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">*</span> gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> a_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> de <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">using</span></span> b e
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_smult_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> unit_factor <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Gk</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subresultant_prs<span class="main">[</span><span class="operator">OF</span> dichotomous_Lazard sub<span class="main">]</span> F0<span class="main">[</span><span class="operator">OF</span> k0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> is_unitE<span class="main">[</span><span class="operator">OF</span> b<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id dac <span class="keyword1"><span class="command">using</span></span> bc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">Gk</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="var">?pp</span> <span class="skolem">Gk</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">Gk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_normalize<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> impl <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Subresultant_Gcd-gcd_impl_main"><span class="command">lemma</span></span> gcd_impl_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">G1</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">G2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd_impl_main <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> gcd <span class="free">G1</span> <span class="free">G2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> G1<span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> G2<span class="main">:</span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"primitive_part"</span></span>
    <span class="keyword1"><span class="command">from</span></span> G2 <span class="keyword1"><span class="command">have</span></span> G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="free">G2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span><span class="var">?pp</span> <span class="free">G1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="main">(</span><span class="var">?pp</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> enter_subresultant_prs<span class="main">[</span><span class="operator">OF</span> len G2<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">b</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_locale2 <span class="skolem">F</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">f</span> <span class="skolem">k</span> <span class="skolem">b</span> <span class="main">(</span><span class="var">?pp</span> <span class="free">G1</span><span class="main">)</span> <span class="main">(</span><span class="var">?pp</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> subresultant_prs_locale2 <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">interpret</span></span> subresultant_prs_gcd <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pp</span> <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_main_def gcd_poly_decompose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G1</span></span><span class="main">]</span> id if_False <span class="keyword1"><span class="command">using</span></span> G1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_impl_primitive<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_main_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> len <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_main_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> gcd_impl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gcd_impl <span class="main">=</span> gcd"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gcd_impl <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> gcd <span class="skolem">f</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="skolem">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_def gcd_impl_main<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="skolem">g</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> gcd_impl_main<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_def gcd.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The implementation also reveals an important connection between resultant and gcd.›</span></span>

<span class="keyword1" id="Subresultant_Gcd-resultant_0_gcd"><span class="command">lemma</span></span> resultant_0_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> degree <span class="main">(</span>gcd <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> len <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"primitive_part <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"primitive_part <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"content"</span></span>
      <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="var">?f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="var">?g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Gk</span></span> <span class="skolem"><span class="skolem">hk</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subresultant_prs dichotomous_Lazard <span class="var">?f</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Gk</span><span class="main">,</span><span class="skolem">hk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> cf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> enter_subresultant_prs<span class="main">[</span><span class="operator">OF</span> len this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">b</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"subresultant_prs_locale2 <span class="skolem">F</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">f</span> <span class="skolem">k</span> <span class="skolem">b</span> <span class="var">?f</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">interpret</span></span> subresultant_prs_locale2 <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">from</span></span> subresultant_prs<span class="main">[</span><span class="operator">OF</span> dichotomous_Lazard sub<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"h <span class="skolem">k</span> <span class="main">=</span> ff <span class="skolem">hk</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> h0<span class="main">[</span><span class="operator">OF</span> le_refl<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hk</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> hk0 <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"resultant <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> resultant <span class="main">(</span>smult <span class="main">(</span><span class="var">?c</span> <span class="skolem">f</span><span class="main">)</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>smult <span class="main">(</span><span class="var">?c</span> <span class="skolem">g</span><span class="main">)</span> <span class="var">?g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> resultant <span class="var">?f</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> resultant_smult_left<span class="main">[</span><span class="operator">OF</span> cf<span class="main">]</span> resultant_smult_right<span class="main">[</span><span class="operator">OF</span> cg<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> cf cg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> resultant_impl_main dichotomous_Lazard <span class="var">?f</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> resultant_impl_def resultant_impl_main_def 
        resultant_impl_generic_def <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span>degree <span class="skolem">Gk</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> resultant_impl_main_def sub split <span class="keyword1"><span class="command">using</span></span> g hk0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">Gk</span> <span class="main">=</span> degree <span class="main">(</span>gcd_impl_primitive <span class="var">?f</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_primitive_def sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span>gcd_impl_main <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_main_def <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span>gcd <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> gcd_impl_def <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>resultant <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="main">(</span>gcd <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>resultant <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="main">(</span>gcd <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>resultant <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="main">(</span>gcd <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> resultant_def sylvester_mat_def sylvester_mat_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>resultant <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="main">(</span>gcd <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">g</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gcd.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> resultant_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code Equations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">gcd_impl_rec</span> <span class="main">=</span> subresultant_prs_main_impl fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">gcd_impl_start</span> <span class="main">=</span> subresultant_prs_impl fst"</span></span>

<span class="keyword1" id="Subresultant_Gcd-gcd_impl_rec_code"><span class="command">lemma</span></span> gcd_impl_rec_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd_impl_rec <span class="free">Gi_1</span> <span class="free">Gi</span> <span class="free">ni_1</span> <span class="free">d1_1</span> <span class="free">hi_2</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">Gi_1</span> <span class="free">Gi</span>
     <span class="keyword1">in</span>
     <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">Gi</span>
        <span class="keyword1">else</span> <span class="keyword1">let</span>
           <span class="bound">ni</span> <span class="main">=</span> degree <span class="free">Gi</span><span class="main">;</span>
           <span class="bound">d1</span> <span class="main">=</span> <span class="free">ni_1</span> <span class="main">-</span> <span class="bound">ni</span><span class="main">;</span>
           <span class="bound">gi_1</span> <span class="main">=</span> lead_coeff <span class="free">Gi_1</span><span class="main">;</span>
           <span class="bound">hi_1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d1_1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="keyword1">else</span> dichotomous_Lazard <span class="bound">gi_1</span> <span class="free">hi_2</span> <span class="free">d1_1</span><span class="main">)</span><span class="main">;</span>
           <span class="bound">divisor</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="bound">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="main">^</span> <span class="bound">d1</span> <span class="keyword1">else</span> <span class="bound">gi_1</span> <span class="main">*</span> <span class="bound">hi_1</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">;</span>
           <span class="bound">Gi_p1</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
       <span class="keyword1">in</span> gcd_impl_rec <span class="free">Gi</span> <span class="bound">Gi_p1</span> <span class="bound">ni</span> <span class="bound">d1</span> <span class="bound">hi_1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_rec_def subresultant_prs_main_impl.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">Gi_1</span></span><span class="main">]</span> split Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_rec_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Subresultant_Gcd-gcd_impl_start_code"><span class="command">lemma</span></span> gcd_impl_start_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd_impl_start <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">G1</span> <span class="free">G2</span>
         <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">G2</span>
            <span class="keyword1">else</span> <span class="keyword1">let</span>
                 <span class="bound">n2</span> <span class="main">=</span> degree <span class="free">G2</span><span class="main">;</span>
                 <span class="bound">n1</span> <span class="main">=</span> degree <span class="free">G1</span><span class="main">;</span>
                 <span class="bound">d1</span> <span class="main">=</span> <span class="bound">n1</span> <span class="main">-</span> <span class="bound">n2</span><span class="main">;</span>
                 <span class="bound">G3</span> <span class="main">=</span> <span class="keyword1">if</span> even <span class="bound">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">pmod</span> <span class="keyword1">else</span> <span class="bound">pmod</span><span class="main">;</span>
                 <span class="bound">pmod</span> <span class="main">=</span> pseudo_mod <span class="free">G2</span> <span class="bound">G3</span>
                 <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pmod</span> <span class="main">=</span> <span class="main">0</span>
                    <span class="keyword1">then</span> <span class="bound">G3</span>
                    <span class="keyword1">else</span> <span class="keyword1">let</span>
                           <span class="bound">g2</span> <span class="main">=</span> lead_coeff <span class="free">G2</span><span class="main">;</span>
                           <span class="bound">n3</span> <span class="main">=</span> degree <span class="bound">G3</span><span class="main">;</span>
                           <span class="bound">h2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">^</span> <span class="bound">d1</span><span class="main">)</span><span class="main">;</span>
                           <span class="bound">d2</span> <span class="main">=</span> <span class="bound">n2</span> <span class="main">-</span> <span class="bound">n3</span><span class="main">;</span>
                           <span class="bound">divisor</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">d2</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="bound">d2</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="main">^</span> <span class="bound">d2</span> <span class="keyword1">else</span> <span class="bound">g2</span> <span class="main">*</span> <span class="bound">h2</span> <span class="main">^</span> <span class="bound">d2</span><span class="main">)</span><span class="main">;</span>
                           <span class="bound">G4</span> <span class="main">=</span> sdiv_poly <span class="bound">pmod</span> <span class="bound">divisor</span>
                         <span class="keyword1">in</span> gcd_impl_rec <span class="bound">G3</span> <span class="bound">G4</span> <span class="bound">n3</span> <span class="bound">d2</span> <span class="bound">h2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">G1</span> <span class="main">-</span> degree <span class="free">G2</span> <span class="main">=</span> <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> even <span class="skolem">d1</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="skolem">pmod</span> <span class="keyword1">else</span> <span class="skolem">pmod</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">pmod</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">pmod</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_start_def subresultant_prs_impl_def gcd_impl_rec_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Let_def split
    <span class="keyword1"><span class="command">unfolding</span></span> d1
    <span class="keyword1"><span class="command">unfolding</span></span> id1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subresultant_Gcd-gcd_impl_main_code"><span class="command">lemma</span></span> gcd_impl_main_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd_impl_main <span class="free">G1</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">G1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">G2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> normalize <span class="free">G1</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="bound">c1</span> <span class="main">=</span> content <span class="free">G1</span><span class="main">;</span>
      <span class="bound">c2</span> <span class="main">=</span> content <span class="free">G2</span><span class="main">;</span>
      <span class="bound">p1</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="bound">c1</span><span class="main">)</span> <span class="free">G1</span><span class="main">;</span>
      <span class="bound">p2</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="bound">c2</span><span class="main">)</span> <span class="free">G2</span>
     <span class="keyword1">in</span> smult <span class="main">(</span>gcd <span class="bound">c1</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">(</span>normalize <span class="main">(</span>primitive_part <span class="main">(</span>gcd_impl_start <span class="bound">p1</span> <span class="bound">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gcd_impl_main_def Let_def primitive_part_def gcd_impl_start_def gcd_impl_primitive_def
    subresultant_prs_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> gcd_via_subresultant<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> gcd_impl <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that we did not activate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> gcd_via_subresultant<span class="antiquote"><span class="antiquote">}</span></span></span></span> as code-equation, since according to our experiments,
  the subresultant-gcd algorithm is not always more efficient than the currently active equation.
  In particular, on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"int poly"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gcd_impl<span class="antiquote"><span class="antiquote">}</span></span></span></span> performs worse, but on multi-variate polynomials,
  e.g., <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"int poly poly poly"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gcd_impl<span class="antiquote"><span class="antiquote">}</span></span></span></span> is preferable.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>