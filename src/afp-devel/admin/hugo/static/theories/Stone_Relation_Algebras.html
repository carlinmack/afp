<div id="Fixpoints">
<div class="head">
<h1>Theory Fixpoints</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Fixpoints
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fixpoints›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory develops a fixpoint calculus based on partial orders.
Besides fixpoints we consider least prefixpoints and greatest postfixpoints of functions on a partial order.
We do not assume that the underlying structure is complete or that all functions are continuous or isotone.
Assumptions about the existence of fixpoints and necessary properties of the involved functions will be stated explicitly in each theorem.
This way, the results can be instantiated by various structures, such as complete lattices and Kleene algebras, which impose different kinds of restriction.
See, for example, \cite{AartsBackhouseBoitenDoornbosGasterenGeldropHoogendijkVoermansWoude1995,DaveyPriestley2002} for fixpoint calculi in complete lattices.
Our fixpoint calculus contains similar rules, in particular:
\begin{itemize}
\item unfold rule,
\item fixpoint operators preserve isotonicity,
\item square rule,
\item rolling rule,
\item various fusion rules,
\item exchange rule and
\item diagonal rule.
\end{itemize}
All of our rules are based on existence rather than completeness of the underlying structure.
We have applied results from this theory in \cite{Guttmann2012c} and subsequent papers for unifying and reasoning about the semantics of recursion in various relational and matrix-based computation models.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fixpoints

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Stone_Algebras/Lattice_Basics.html">Stone_Algebras.Lattice_Basics</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The whole calculus is based on partial orders only.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first define when an element $x$ is a least/greatest (pre/post)fixpoint of a given function $f$.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_fixpoint</span>               <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_fixpoint</span>              <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_prefixpoint</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_prefixpoint</span>           <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_postfixpoint</span>           <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_postfixpoint</span>          <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_least_fixpoint</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_least_fixpoint</span>        <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_greatest_fixpoint</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_greatest_fixpoint</span>     <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_least_prefixpoint</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_least_prefixpoint</span>     <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_greatest_postfixpoint</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_greatest_postfixpoint</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">≥</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next follows the existence of the corresponding fixpoints for a given function $f$.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_fixpoint</span>              <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_fixpoint</span>              <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_fixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_prefixpoint</span>           <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_prefixpoint</span>           <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_prefixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_postfixpoint</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_postfixpoint</span>          <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_postfixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_least_fixpoint</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_least_fixpoint</span>        <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_least_fixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_greatest_fixpoint</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_greatest_fixpoint</span>     <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_greatest_fixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_least_prefixpoint</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_least_prefixpoint</span>     <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_least_prefixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_greatest_postfixpoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">has_greatest_postfixpoint</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> is_greatest_postfixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The actual least/greatest (pre/post)fixpoints of a given function $f$ are extracted by the following operators.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">the_least_fixpoint</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span> _"</span>  <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">μ</span></span>  <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span> <span class="main">.</span> is_least_fixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">the_greatest_fixpoint</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span> _"</span>  <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ν</span></span>  <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span> <span class="main">.</span> is_greatest_fixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">the_least_prefixpoint</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">pμ</span> _"</span> <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">pμ</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span> <span class="main">.</span> is_least_prefixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">the_greatest_postfixpoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">pν</span> _"</span> <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">pν</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span> <span class="main">.</span> is_greatest_postfixpoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We start with basic consequences of the above definitions.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_fixpoint_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">x</span> <span class="main">.</span> is_least_fixpoint <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_least_fixpoint_def is_least_fixpoint_def antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_fixpoint_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">x</span> <span class="main">.</span> is_greatest_fixpoint <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_greatest_fixpoint_def is_greatest_fixpoint_def antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> least_prefixpoint_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">x</span> <span class="main">.</span> is_least_prefixpoint <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_least_prefixpoint_def is_least_prefixpoint_def antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_postfixpoint_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">x</span> <span class="main">.</span> is_greatest_postfixpoint <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_greatest_postfixpoint_def is_greatest_postfixpoint_def antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> is_least_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_fixpoint_unique theI' the_least_fixpoint_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> is_greatest_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greatest_fixpoint_unique theI' the_greatest_fixpoint_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> least_prefixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> is_least_prefixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_prefixpoint_unique theI' the_least_prefixpoint_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_postfixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> is_greatest_postfixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greatest_postfixpoint_unique theI' the_greatest_postfixpoint_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> least_fixpoint_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_least_fixpoint_def antisym the_equality the_least_fixpoint_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_fixpoint_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_greatest_fixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_fixpoint greatest_fixpoint_unique has_greatest_fixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> least_prefixpoint_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_prefixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">pμ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_least_prefixpoint_def least_prefixpoint least_prefixpoint_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_postfixpoint_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_greatest_postfixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">pν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_postfixpoint greatest_postfixpoint_unique has_greatest_postfixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> least_fixpoint_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟷</span> has_least_fixpoint <span class="free">f</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_least_fixpoint_def least_fixpoint_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> least_prefixpoint_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_least_prefixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟷</span> has_least_prefixpoint <span class="free">f</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">pμ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_least_prefixpoint_def least_prefixpoint_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_fixpoint_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_greatest_fixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟷</span> has_greatest_fixpoint <span class="free">f</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_fixpoint_same has_greatest_fixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_postfixpoint_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_greatest_postfixpoint <span class="free">f</span> <span class="free">x</span> <span class="main">⟷</span> has_greatest_postfixpoint <span class="free">f</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">pν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_postfixpoint_same has_greatest_postfixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next come the unfold rules for least/greatest (pre/post)fixpoints.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_least_fixpoint_def least_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pmu_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">pμ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_greatest_fixpoint_def greatest_fixpoint<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pnu_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">pν</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_postfixpoint is_greatest_postfixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Pre-/postfixpoints of isotone functions are fixpoints.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_prefixpoint_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> is_least_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_least_fixpoint_def is_least_prefixpoint_def least_prefixpoint antisym isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pmu_mu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">pμ</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> least_fixpoint_same least_prefixpoint_fixpoint<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greatest_postfixpoint_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> is_greatest_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_postfixpoint is_greatest_fixpoint_def is_greatest_postfixpoint_def antisym isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pnu_nu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">pν</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greatest_fixpoint_same greatest_postfixpoint_fixpoint<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The fixpoint operators preserve isotonicity.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pmu_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="keyword1">pμ</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">pμ</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_least_prefixpoint_def least_prefixpoint order_trans lifted_less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pmu_isotone pmu_mu <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> pnu_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="keyword1">pν</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">pν</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_postfixpoint is_greatest_postfixpoint_def order_trans lifted_less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pnu_isotone pnu_nu <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The square rule for fixpoints of a function applied twice.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_least_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> antisym is_least_fixpoint_def isotone_def least_fixpoint_char least_fixpoint_unique o_apply<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">f</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> antisym is_greatest_fixpoint_def isotone_def greatest_fixpoint_char greatest_fixpoint_unique o_apply<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The rolling rule for fixpoints of the composition of two functions.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_roll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> comp_apply is_least_fixpoint_def least_fixpoint<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> least_fixpoint<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> comp_def is_least_fixpoint_def least_fixpoint isotone_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_roll<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> greatest_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_greatest_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> greatest_fixpoint<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_def is_greatest_fixpoint_def isotone_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> comp_apply greatest_fixpoint is_greatest_fixpoint_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Least (pre)fixpoints are below greatest (post)fixpoints.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_below_nu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_fixpoint is_greatest_fixpoint_def mu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pmu_below_pnu_fix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">pμ</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">pν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_postfixpoint has_fixpoint_def is_fixpoint_def is_greatest_postfixpoint_def is_least_prefixpoint_def least_prefixpoint order_refl order_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pmu_below_pnu_iso<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">pμ</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">pν</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> greatest_postfixpoint_fixpoint is_greatest_fixpoint_def is_least_fixpoint_def least_prefixpoint_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Several variants of the fusion rule for fixpoints follow.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> galois_char isotone_def order_lesseq_imp mu_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint galois_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">g</span> <span class="main">⟹</span> has_least_fixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">≤≤</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mu_fusion_1 lifted_less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_equal_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">g</span> <span class="main">⟹</span> has_least_fixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">h</span><span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">u</span><span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym least_fixpoint least_prefixpoint_fixpoint is_least_fixpoint_def mu_fusion_1 pmu_mu<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_equal_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">g</span> <span class="main">⟹</span> has_least_prefixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">pμ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_least_prefixpoint_def least_fixpoint_char least_prefixpoint least_prefixpoint_fixpoint antisym galois_char isotone_def mu_fusion_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_equal_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> comp_eq_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">)</span> mu_fusion_equal_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> pmu_mu<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_fusion_equal_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">pμ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">l</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">l</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> comp_eq_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">pμ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> mu_fusion_equal_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="free">h</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">pμ</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> pmu_mu<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> order_trans galois_char isotone_def nu_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> greatest_postfixpoint is_greatest_postfixpoint_def ord.galois_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">g</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">≤≤</span> <span class="free">u</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">h</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_fusion_1 lifted_less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_equal_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">g</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_fixpoint_char greatest_postfixpoint_fixpoint is_greatest_fixpoint_def antisym nu_fusion_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_equal_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> isotone <span class="free">h</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">g</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">pν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_fixpoint_char greatest_postfixpoint greatest_postfixpoint_fixpoint is_greatest_postfixpoint_def antisym galois_char nu_fusion_1 isotone_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_equal_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> comp_eq_dest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">)</span> nu_fusion_equal_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span> pnu_nu<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_fusion_equal_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">pν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">u</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> comp_eq_dest <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">pν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> nu_fusion_equal_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">h</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">pν</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> pnu_nu<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next come the exchange rules for replacing the first/second function in a composition.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_exchange_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤≤</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> rewriteL_comp_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> comp_apply least_fixpoint_char least_prefixpoint_fixpoint isotone_def mu_roll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> comp_apply least_fixpoint_char least_prefixpoint_fixpoint isotone_def mu_fusion_2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">pμ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> galois_char isotone_def least_fixpoint_char least_prefixpoint_fixpoint o_apply<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_exchange_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3-5<span class="main"><span class="main">)</span></span> galois_char isotone_def least_fixpoint_char least_prefixpoint_fixpoint mu_roll o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> isotone_def mu_exchange_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">)</span></span> mu_roll<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_exchange_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">k</span> <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">k</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">k</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">k</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>6<span class="main">)</span> least_fixpoint_char least_prefixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> least_fixpoint_char least_prefixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> least_fixpoint_char least_prefixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"has_least_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> least_fixpoint_char least_prefixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 assms antisym galois_char lifted_reflexive mu_exchange_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="free">l</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">k</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 assms antisym galois_char lifted_reflexive mu_exchange_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_exchange_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">≤≤</span> <span class="free">u</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">≤≤</span> <span class="free">u</span> <span class="main">∘</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> o_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> greatest_fixpoint_char greatest_postfixpoint_fixpoint isotone_def nu_fusion_2 o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> greatest_fixpoint_char greatest_postfixpoint_fixpoint isotone_def nu_roll o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">pν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> greatest_postfixpoint is_greatest_postfixpoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> galois_char greatest_fixpoint_char greatest_postfixpoint_fixpoint isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_exchange_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">≤≤</span> <span class="free">u</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">)</span></span> nu_roll<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> isotone_def nu_exchange_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3-5<span class="main"><span class="main">)</span></span> galois_char greatest_fixpoint_char greatest_postfixpoint_fixpoint isotone_def nu_roll o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_exchange_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"galois <span class="free">k</span> <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isotone <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">t</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">t</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∘</span> <span class="free">h</span> <span class="main">∘</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">t</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> greatest_fixpoint_char greatest_postfixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> greatest_fixpoint_char greatest_postfixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">t</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>6<span class="main">)</span> greatest_fixpoint_char greatest_postfixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"has_greatest_fixpoint <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> greatest_fixpoint_char greatest_postfixpoint_fixpoint galois_char isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">u</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">t</span> <span class="main">∘</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 assms antisym galois_char lifted_reflexive nu_exchange_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">h</span> <span class="main">∘</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 assms antisym galois_char lifted_reflexive nu_exchange_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results generalise parts of \cite[Exercise 8.27]{DaveyPriestley2002} from continuous functions on complete partial orders to the present setting.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_commute_fixpoint_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> has_least_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> is_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_fixpoint_def mu_roll<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_commute_fixpoint_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">g</span> <span class="main">⟹</span> has_least_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> is_fixpoint <span class="free">g</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mu_commute_fixpoint_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mu_commute_least_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> has_least_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_least_fixpoint <span class="free">g</span> <span class="main">⟹</span> has_least_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="free">g</span> <span class="main">≤</span> <span class="keyword1">μ</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_least_fixpoint_def least_fixpoint mu_roll<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The converse of the preceding result is claimed for continuous $f$, $g$ on a complete partial order; it is unknown whether it holds without these additional assumptions.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_commute_fixpoint_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> is_fixpoint <span class="free">f</span> <span class="main">(</span><span class="keyword1">ν</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_fixpoint_def nu_roll<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_commute_fixpoint_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">g</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> is_fixpoint <span class="free">g</span> <span class="main">(</span><span class="keyword1">ν</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_commute_fixpoint_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_commute_greatest_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">f</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="free">g</span> <span class="main">⟹</span> has_greatest_fixpoint <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">f</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">f</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greatest_fixpoint is_greatest_fixpoint_def nu_roll<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finally, we show a number of versions of the diagonal rule for functions with two arguments.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_diagonal_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isotone <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> has_least_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_least_prefixpoint <span class="var">?g</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> least_prefixpoint pmu_mu <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="var">?g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms is_least_fixpoint_def least_fixpoint_char least_prefixpoint_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_least_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>2<span class="main">)</span> is_least_fixpoint_def is_least_prefixpoint_def least_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> least_fixpoint_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mu_diagonal_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> isotone <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> isotone <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> has_least_prefixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> has_least_prefixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">μ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mu_diagonal_1<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def lifted_less_eq_def mu_isotone <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> has_least_fixpoint_def least_prefixpoint_fixpoint <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_diagonal_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isotone <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> has_greatest_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_greatest_postfixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_greatest_postfixpoint <span class="var">?g</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> greatest_postfixpoint pnu_nu <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="var">?g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms is_greatest_fixpoint_def greatest_fixpoint_char greatest_postfixpoint_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_greatest_fixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>2<span class="main">)</span> is_greatest_fixpoint_def is_greatest_postfixpoint_def greatest_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> greatest_fixpoint_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_diagonal_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> isotone <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> isotone <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> has_greatest_postfixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> has_greatest_postfixpoint <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nu_diagonal_1<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def lifted_less_eq_def nu_isotone <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> has_greatest_fixpoint_def greatest_postfixpoint_fixpoint <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Semirings">
<div class="head">
<h1>Theory Semirings</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Semirings
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory develops a hierarchy of idempotent semirings.
All kinds of semiring considered here are bounded semilattices, but many lack additional properties typically assumed for semirings.
In particular, we consider the variants of semirings, in which
\begin{itemize}
\item multiplication is not required to be associative;
\item a right zero and unit of multiplication need not exist;
\item multiplication has a left residual;
\item multiplication from the left is not required to distribute over addition;
\item the semilattice order has a greatest element.
\end{itemize}
We have applied results from this theory a number of papers for unifying computation models.
For example, see \cite{Guttmann2012c} for various relational and matrix-based computation models and \cite{BerghammerGuttmann2015b} for multirelational models.

The main results in this theory relate different ways of defining reflexive-transitive closures as discussed in \cite{BerghammerGuttmann2015b}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Semirings

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Fixpoints.html">Fixpoints</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Idempotent Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definitions are standard for relations.
Putting them into a general class that depends only on the signature facilitates reuse.
Coreflexives are sometimes called partial identities, subidentities, monotypes or tests.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> times_one_ord <span class="main">=</span> times <span class="main">+</span> one <span class="main">+</span> ord
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">reflexive</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reflexive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">≡</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">coreflexive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">transitive</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">transitive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dense_rel</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dense_rel</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">idempotent</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">idempotent</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">preorder</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">preorder</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>    <span class="main">≡</span> reflexive <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> transitive <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">coreflexives</span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> coreflexive <span class="bound">x</span> <span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The first algebra is a very weak idempotent semiring, in which multiplication is not necessarily associative.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> non_associative_left_semiring <span class="main">=</span> bounded_semilattice_sup_bot <span class="main">+</span> times <span class="main">+</span> one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_left_sub_dist_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_right_dist_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_left_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_left_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_sub_right_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> times_one_ord <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first show basic isotonicity and subdistributivity properties of multiplication.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_left_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_right_dist_sup sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_right_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_sub_dist_sup sup.bounded_iff sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_trans mult_left_isotone mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> affine_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def mult_right_isotone sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_left_sub_dist_sup_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_left_sub_dist_sup_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_right_sub_dist_sup_left<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_right_sub_dist_sup_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> case_split_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dual_order.trans mult_left_one mult_left_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> case_split_left_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_one mult_right_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next we consider under which semiring operations the above properties are closed.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="free">x</span> <span class="main">⟹</span> reflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="free">x</span> <span class="main">⟹</span> reflexive <span class="free">y</span> <span class="main">⟹</span> reflexive <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="free">y</span> <span class="main">⟹</span> coreflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="free">y</span> <span class="main">⟹</span> coreflexive <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transitive bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transitive <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dense_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_rel bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dense_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_rel <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dense_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_rel <span class="free">x</span> <span class="main">⟹</span> dense_rel <span class="free">y</span> <span class="main">⟹</span> dense_rel <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_dist_sup order_lesseq_imp sup.mono mult_left_sub_dist_sup_left mult_left_sub_dist_sup_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> idempotent_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"idempotent bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> idempotent_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"idempotent <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> preorder_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_transitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> transitive <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> preorder_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder <span class="free">x</span> <span class="main">⟹</span> idempotent <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> antisym mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We study the following three ways of defining reflexive-transitive closures.
Each of them is given as a least prefixpoint, but the underlying functions are different.
They implement left recursion, right recursion and symmetric recursion, respectively.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Lf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lf</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="main">1</span> <span class="main">⊔</span> <span class="bound">x</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Rf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Rf</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sf</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="main">1</span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊔</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lstar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lstar</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">pμ</span> <span class="main">(</span>Lf <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rstar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rstar</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">pμ</span> <span class="main">(</span>Rf <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sstar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sstar</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">pμ</span> <span class="main">(</span>Sf <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
All functions are isotone and, therefore, if the prefixpoints exist they are also fixpoints.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lstar_rec_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="main">(</span>Lf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def sup_right_divisibility sup_right_isotone mult_right_sub_dist_sup_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rstar_rec_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def sup_right_divisibility sup_right_isotone mult_left_sub_dist_sup_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sstar_rec_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isotone <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isotone_def sup_right_isotone mult_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lstar_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Lf <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> lstar <span class="free">y</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span>Lf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pmu_mu lstar_rec_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rstar_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> rstar <span class="free">y</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pmu_mu rstar_rec_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sstar_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> sstar <span class="free">y</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pmu_mu sstar_rec_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sstar_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> sstar <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_trans pmu_unfold sup_ge1 sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The fixpoint given by right recursion is always below the one given by symmetric recursion.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rstar_below_sstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rstar <span class="free">y</span> <span class="main">≤</span> sstar <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> sstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rf <span class="free">y</span> <span class="main">(</span>sstar <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> Sf <span class="free">y</span> <span class="main">(</span>sstar <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sup.cobounded1 sup.mono mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> sstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Our next structure adds one half of the associativity property.
This inequality holds, for example, for multirelations under the compositions defined by Parikh and Peleg \cite{Parikh1983,Peleg1987}.
The converse inequality requires up-closed multirelations for Parikh's composition.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> pre_left_semiring <span class="main">=</span> non_associative_left_semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_semi_associative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_one_associative <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.antisym mult_left_isotone mult_left_one mult_semi_associative mult_sub_right_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_sup_associative_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_semi_associative mult_one_associative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rstar_increasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE mult_right_isotone mult_sub_right_one sup.absorb_iff2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For the next structure we add a left residual operation.
Such a residual is available, for example, for multirelations.

The operator notation for binary division is introduced in a class that requires a unary inverse.
This is appropriate for fields, but too strong in the present context of semirings.
We therefore reintroduce it without requiring a unary inverse.
›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  inverse_divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span>
  divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_pre_left_semiring <span class="main">=</span> pre_left_semiring <span class="main">+</span> divide <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lres_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">/</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first derive basic properties of left residuals from the Galois connection.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lres_left_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">/</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">/</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans lres_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lres_right_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">/</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">/</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans lres_galois mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lres_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lres_galois<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lres_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_sub_right_one order_trans lres_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lres_mult_sub_lres_lres<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lres_galois mult_semi_associative order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_lres_sub_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">/</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans lres_galois mult_right_isotone lres_inverse lres_mult_sub_lres_lres<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
With the help of a left residual, it follows that left recursion is below right recursion.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lstar_below_rstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Lf <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lres_galois mult_lres_sub_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_supE pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> lres_galois rstar_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">/</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Lf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> lres_galois pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Moreover, right recursion gives the same result as symmetric recursion.
The next proof follows an argument of \cite[Satz 10.1.5]{Berghammer2012}.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rstar_sstar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Rf <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"has_least_prefixpoint <span class="main">(</span>Sf <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rstar <span class="free">y</span> <span class="main">=</span> sstar <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> rstar <span class="free">y</span><span class="main">)</span> <span class="main">*</span> rstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> rstar <span class="free">y</span><span class="main">)</span> <span class="main">*</span> rstar <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_dist_sup mult_semi_associative sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone sup_right_isotone lres_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span> <span class="main">/</span> rstar <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span> <span class="main">/</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lres_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rstar <span class="free">y</span> <span class="main">*</span> rstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint lres_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> rstar <span class="free">y</span> <span class="main">*</span> rstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rstar_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Sf <span class="free">y</span> <span class="main">(</span>rstar <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> pmu_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sstar <span class="free">y</span> <span class="main">≤</span> rstar <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_least_prefixpoint_def least_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms antisym rstar_below_sstar<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In the next structure we add full associativity of multiplication, as well as a right unit.
Still, multiplication does not need to have a right zero and does not need to distribute over addition from the left.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> idempotent_left_semiring <span class="main">=</span> non_associative_left_semiring <span class="main">+</span> monoid_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> pre_left_semiring
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_right_mult_decreasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> bot <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_least mult_1_right mult_right_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result shows that for dense coreflexives there are two equivalent ways to express that a property is preserved.
In the setting of Kleene algebras, this is well known for tests, which form a Boolean subalgebra.
The point here is that only very few properties of tests are needed to show the equivalence.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> test_preserves_equation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dense_rel <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coreflexive <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> antisym mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_left_isotone mult_left_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next structure has both distributivity properties of multiplication.
Only a right zero is missing from full semirings.
This is important as many computation models do not have a right zero of sequential composition.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> idempotent_left_zero_semiring <span class="main">=</span> idempotent_left_semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_left_dist_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> case_split_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dual_order.trans mult_1_right mult_right_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> case_split_right_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right mult_left_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This is the first structure we can connect to the semirings provided by Isabelle/HOL.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> semiring<span class="main">:</span> ordered_semiring <span class="quoted">sup</span> <span class="quoted">bot</span> <span class="quoted">less_eq</span> <span class="quoted">less</span> <span class="quoted">times</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> sup_right_isotone <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> semiring<span class="main">:</span> semiring_numeral <span class="quoted"><span class="main">1</span></span> <span class="quoted">times</span> <span class="quoted">sup</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Completing this part of the hierarchy, we obtain idempotent semirings by adding a right zero of multiplication.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> idempotent_semiring <span class="main">=</span> idempotent_left_zero_semiring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_right_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> bot <span class="main">=</span> bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> semiring<span class="main">:</span> semiring_0 <span class="quoted">sup</span> <span class="quoted">bot</span> <span class="quoted">times</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounded Idempotent Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
All of the following semirings have a greatest element in the underlying semilattice order.
With this element, we can express further standard properties of relations.
We extend each class in the above hierarchy in turn.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> times_top <span class="main">=</span> times <span class="main">+</span> top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vector</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vector</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>     <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">covector</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">covector</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">≡</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">total</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">total</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">surjective</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">surjective</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> top"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">vectors</span>   <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> vector <span class="bound">x</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">covectors</span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> covector <span class="bound">x</span> <span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_non_associative_left_semiring <span class="main">=</span> non_associative_left_semiring <span class="main">+</span> top <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sup_right_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> top <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> times_top <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first give basic properties of the greatest element.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sup_left_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">⊔</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup_right_top sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> top_greatest <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> top_left_mult_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> top <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_left_one top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> top_right_mult_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_right_isotone mult_sub_right_one order_trans top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> top_mult_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">*</span> top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym top_left_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Closure of the above properties under the semiring operations is considered next.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> vector <span class="free">y</span> <span class="main">⟹</span> vector <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> total_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> total_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> total_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="free">x</span> <span class="main">⟹</span> total <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym mult_sub_right_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="free">x</span> <span class="main">⟹</span> surjective <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup mult_left_sub_dist_sup_left sup_left_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transitive top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> dense_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_rel top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> idempotent_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"idempotent top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> preorder_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some closure properties require at least half of associativity.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_pre_left_semiring <span class="main">=</span> pre_left_semiring <span class="main">+</span> bounded_non_associative_left_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">y</span> <span class="main">⟹</span> vector <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym mult_semi_associative top_right_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="free">x</span> <span class="main">⟹</span> surjective <span class="free">y</span> <span class="main">⟹</span> surjective <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym mult_semi_associative top_greatest<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next consider residuals with the greatest element.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_residuated_pre_left_semiring <span class="main">=</span> residuated_pre_left_semiring <span class="main">+</span> bounded_pre_left_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lres_top_decreasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> top <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lres_inverse order.trans top_right_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> top_lres_absorb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">/</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> antisym lres_galois top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_lres_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> covector <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym mult_lres_sub_assoc top_left_mult_increasing<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some closure properties require full associativity.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_idempotent_left_semiring <span class="main">=</span> bounded_pre_left_semiring <span class="main">+</span> idempotent_left_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> covector <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="free">x</span> <span class="main">⟹</span> total <span class="free">y</span> <span class="main">⟹</span> total <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some closure properties require distributivity from the left.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_idempotent_left_zero_semiring <span class="main">=</span> bounded_idempotent_left_semiring <span class="main">+</span> idempotent_left_zero_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> covector <span class="free">y</span> <span class="main">⟹</span> covector <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Our final structure is an idempotent semiring with a greatest element.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_idempotent_semiring <span class="main">=</span> bounded_idempotent_left_zero_semiring <span class="main">+</span> idempotent_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebras">
<div class="head">
<h1>Theory Relation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The main structures introduced in this theory are Stone relation algebras.
They generalise Tarski's relation algebras \cite{Tarski1941} by weakening the Boolean algebra lattice structure to a Stone algebra.
Our motivation is to generalise relation-algebraic methods from unweighted graphs to weighted graphs.
Unlike unweighted graphs, weighted graphs do not form a Boolean algebra because there is no complement operation on the edge weights.
However, edge weights form a Stone algebra, and matrices over edge weights (that is, weighted graphs) form a Stone relation algebra.

The development in this theory is described in our papers \cite{Guttmann2016c,Guttmann2017b}.
Our main application there is the verification of Prim's minimum spanning tree algorithm.
Related work about fuzzy relations \cite{Goguen1967,Winter2001b}, Dedekind categories \cite{KawaharaFurusawa2001} and rough relations \cite{Comer1993,Pawlak1996} is also discussed in these papers.
In particular, Stone relation algebras do not assume that the underlying lattice is complete or a Heyting algebra, and they do not assume that composition has residuals.

We proceed in two steps.
First, we study the positive fragment in the form of single-object bounded distributive allegories \cite{FreydScedrov1990}.
Second, we extend these structures by a pseudocomplement operation with additional axioms to obtain Stone relation algebras.

Tarski's relation algebras are then obtained by a simple extension that imposes a Boolean algebra.
See, for example, \cite{BirdMoor1997,HirschHodkinson2002,Maddux1996,Maddux2006,Schmidt2011,SchmidtStroehlein1993} for further details about relations and relation algebras, and \cite{AndrekaMikulas2011,BredihinSchein1978} for algebras of relations with a smaller signature.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Stone_Algebras/P_Algebras.html">Stone_Algebras.P_Algebras</a> <a href="Semirings.html">Semirings</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Single-Object Bounded Distributive Allegories›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We start with developing bounded distributive allegories.
The following definitions concern properties of relations that require converse in addition to lattice and semiring operations.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> conv <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">conv</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span></span></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> bounded_distrib_allegory_signature <span class="main">=</span> inf <span class="main">+</span> sup <span class="main">+</span> times <span class="main">+</span> conv <span class="main">+</span> bot <span class="main">+</span> top <span class="main">+</span> one <span class="main">+</span> ord
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> times_one_ord <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">subclass</span></span> times_top <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">total_var</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">total_var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">surjective_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">surjective_var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">univalent</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">univalent</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">injective</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">injective</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mapping</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapping</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>        <span class="main">≡</span> univalent <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> total <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bijective</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bijective</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> injective <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> surjective <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">point</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">point</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>          <span class="main">≡</span> vector <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> bijective <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">arc</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">arc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>            <span class="main">≡</span> bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">∧</span> bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span> <span class="comment1">(* earlier name: atom *)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">symmetric</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">symmetric</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>      <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">antisymmetric</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">antisymmetric</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">asymmetric</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">asymmetric</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>     <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">linear</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">linear</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>         <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">equivalence</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">equivalence</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>    <span class="main">≡</span> preorder <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> symmetric <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">order</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">order</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>          <span class="main">≡</span> preorder <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> antisymmetric <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">linear_order</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">linear_order</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>   <span class="main">≡</span> order <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> linear <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We reuse the relation algebra axioms given in \cite{Maddux1996} except for one -- see lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>conv_complement_sub›</span></span></span></span> below -- which we replace with the Dedekind rule (or modular law) <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>dedekind_1›</span></span></span></span>.
The Dedekind rule or variants of it are known from \cite{BirdMoor1997,FreydScedrov1990,KawaharaFurusawaMori1999,SchmidtStroehlein1993}.
We add <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>comp_left_zero›</span></span></span></span>, which follows in relation algebras but not in the present setting.
The main change is that only a bounded distributive lattice is required, not a Boolean algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_distrib_allegory <span class="main">=</span> bounded_distrib_lattice <span class="main">+</span> times <span class="main">+</span> one <span class="main">+</span> conv <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp_associative      <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp_right_dist_sup   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp_left_zero  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp_left_one   <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_involutive <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_dist_sup         <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_dist_comp        <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dedekind_1            <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_distrib_allegory_signature <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Many properties of relation algebras already follow in bounded distributive allegories.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_sup le_iff_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_order<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot<span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_order bot_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top<span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive conv_order eq_iff top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> conv_order <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_order conv_involutive inf.boundedI inf.cobounded1 inf.cobounded2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_inf_bot_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⟷</span> bot <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_dist_inf conv_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_one conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_dist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sup conv_involutive conv_dist_sup conv_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup sup.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sup le_iff_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_left_isotone comp_right_isotone order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_subdist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_increasing_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_subdist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_increasing_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> bot <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_zero conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_one conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_conjugate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> conjugate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_zero bot.extremum_unique conv_involutive dedekind_1 inf.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_conjugate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> conjugate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_conjugate<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> conjugate_def<span class="main"><span class="main">]</span></span> conv_inf_bot_iff conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We still obtain a semiring structure.
›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_idempotent_semiring
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comp_right_isotone comp_right_dist_sup comp_associative comp_left_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> inf<span class="main">:</span> semiring_0 <span class="quoted">sup</span> <span class="quoted">bot</span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 inf_sup_distrib1 inf_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abel_semigroup.commute comp_left_conjugate conjugate_def inf.abel_semigroup_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_conjugate conjugate_def inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_additive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"additive <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> additive <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> additive <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> additive <span class="main">(</span><span class="main">λ</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup additive_def comp_right_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dedekind_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf conv_order conv_dist_comp dedekind_1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The intersection with a vector can still be exported from the first argument of a composition, and many other properties of vectors and covectors continue to hold.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_inf_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_subdist_inf comp_right_isotone inf.sup_left_isotone order_lesseq_imp top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_right_isotone dedekind_2 inf_commute inf_mono order_refl order_trans top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> vector <span class="free">y</span> <span class="main">⟹</span> vector <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_inf_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_inf_one_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_inf_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_inf_comp_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right dedekind_1 conv_dist_inf conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_left_isotone comp_right_isotone inf_le2 inf_mono order_refl inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_isotone antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_inf_comp_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span>top <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 inf_top_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_left_isotone conv_dist_comp conv_order conv_top eq_refl inf_le1 inf_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_left_subdist_inf antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_inf_comp_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_inf_comp_1 covector_inf_comp_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> covector <span class="free">y</span> <span class="main">⟹</span> covector <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_subdist_inf inf.antisym top_left_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_conv_covector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟷</span> covector <span class="main">(</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_conv_vector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">v</span> <span class="main">⟷</span> vector <span class="main">(</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_conv_covector<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_comp_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_isotone comp_right_subdist_inf inf.boundedE inf.boundedI inf.cobounded2 top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_right_isotone dedekind_1 inf_commute inf_mono order_refl order_trans top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_restrict_comp_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_inf_comp_3 eq_refl inf.sup_monoid.add_commute inf_top_right le_supE sup.orderE top_left_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_restrict_comp_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_dist_inf conv_order conv_top inf.sup_monoid.add_commute vector_restrict_comp_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_comp_inf_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> covector_conv_vector covector_inf_comp_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We still have two ways to represent surjectivity and totality.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="free">x</span> <span class="main">⟷</span> surjective_var <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"surjective_var <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 comp_left_one inf_absorb2 top_greatest<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"surjective_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_associative comp_left_one top_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_isotone conv_top conv_dist_comp conv_involutive top_greatest top_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="free">x</span> <span class="main">⟷</span> total_var <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top conv_dist_comp conv_involutive surjective_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_conv_total<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="free">x</span> <span class="main">⟷</span> total <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> total_conv_surjective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="free">x</span> <span class="main">⟷</span> surjective <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> surjective_conv_total<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> injective_conv_univalent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟷</span> univalent <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_conv_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟷</span> injective <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We continue with studying further closure properties.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> univalent <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_subdist_inf comp_right_subdist_inf conv_dist_inf inf.cobounded1 order_lesseq_imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_mult_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univalent <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_left_isotone comp_right_one conv_one conv_order comp_associative conv_dist_comp conv_involutive<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_left_isotone comp_associative dual_order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> injective_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> injective_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> injective_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> injective <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf injective_conv_univalent univalent_inf_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> injective_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> injective <span class="free">y</span> <span class="main">⟹</span> injective <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injective_conv_univalent conv_dist_comp univalent_mult_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="free">x</span> <span class="main">⟹</span> mapping <span class="free">y</span> <span class="main">⟹</span> mapping <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative univalent_mult_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bijective <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bijective <span class="free">x</span> <span class="main">⟹</span> bijective <span class="free">y</span> <span class="main">⟹</span> bijective <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injective_mult_closed comp_associative<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_conv_mapping<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bijective <span class="free">x</span> <span class="main">⟷</span> mapping <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> surjective_conv_total<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_conv_bijective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="free">x</span> <span class="main">⟷</span> bijective <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_conv_surjective<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="free">x</span> <span class="main">⟹</span> reflexive <span class="free">y</span> <span class="main">⟹</span> reflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="free">x</span> <span class="main">⟹</span> reflexive <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> symmetric <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_one comp_right_subdist_inf conv_dist_inf conv_dist_comp conv_involutive dedekind_1 inf.absorb1 inf_absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transitive <span class="free">x</span> <span class="main">⟹</span> transitive <span class="free">y</span> <span class="main">⟹</span> transitive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> comp_left_subdist_inf inf.cobounded1 inf.sup_mono inf_le2 mult_right_isotone order.trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transitive <span class="free">x</span> <span class="main">⟹</span> transitive <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_order conv_dist_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> dense_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_rel <span class="free">x</span> <span class="main">⟹</span> dense_rel <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_order conv_dist_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> idempotent_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"idempotent <span class="free">x</span> <span class="main">⟹</span> idempotent <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> preorder_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder <span class="free">x</span> <span class="main">⟹</span> preorder <span class="free">y</span> <span class="main">⟹</span> preorder <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> transitive_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> preorder_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder <span class="free">x</span> <span class="main">⟹</span> preorder <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_conv_closed transitive_conv_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">x</span> <span class="main">⟹</span> symmetric <span class="free">y</span> <span class="main">⟹</span> symmetric <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">x</span> <span class="main">⟹</span> symmetric <span class="free">y</span> <span class="main">⟹</span> symmetric <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">x</span> <span class="main">⟹</span> symmetric <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> one_inf_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf coreflexive_symmetric inf.cobounded1 symmetric_one_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"antisymmetric bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"antisymmetric <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"antisymmetric <span class="free">x</span> <span class="main">⟹</span> antisymmetric <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">⊓</span></span></span> <span class="free"><span class="free"><span class="free">x</span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone inf.coboundedI2 inf.sup_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"antisymmetric <span class="free">x</span> <span class="main">⟹</span> antisymmetric <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"asymmetric bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"asymmetric <span class="free">x</span> <span class="main">⟹</span> asymmetric <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf inf.mult_zero_left inf.left_commute inf_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"asymmetric <span class="free">x</span> <span class="main">⟹</span> asymmetric <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear <span class="free">x</span> <span class="main">⟹</span> linear <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_sup sup_assoc sup_commute sup_top_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_reflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear <span class="free">x</span> <span class="main">⟹</span> reflexive <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_inf_conv inf.distrib_left inf.cobounded2 inf.orderE reflexive_top_closed sup.idem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear <span class="free">x</span> <span class="main">⟹</span> linear <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_comp_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"linear <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"linear <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"linear <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflexive <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> linear_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case_split_left case_split_right le_supI sup.cobounded1 sup.cobounded2 sup.idem reflexive_conv_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp top_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="free">y</span> <span class="main">⟹</span> equivalence <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_dist_inf preorder_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> order_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"order <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> order_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">⟹</span> order <span class="free">y</span> <span class="main">⟹</span> order <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> antisymmetric_inf_closed transitive_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> order_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">⟹</span> order <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute reflexive_conv_closed transitive_conv_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_order_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear_order <span class="free">x</span> <span class="main">⟹</span> linear_order <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equivalence_top_closed conv_dist_sup inf_commute reflexive_conv_closed transitive_conv_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show a fact about equivalences.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_comp_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym comp_right_subdist_inf dedekind_1 eq_iff inf.absorb1 inf.absorb2 mult_1_right mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result generalises the fact that composition with a test amounts to intersection with the corresponding vector.
Both tests and vectors can be used to represent sets as relations.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_top_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_left_one coreflexive_symmetric dedekind_1 inf_top_left order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> comp_left_isotone comp_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_top_inf_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_top_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> coreflexive_comp_top_inf coreflexive_comp_top_inf_one inf.mult_assoc inf.absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_inf_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coreflexive <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms coreflexive_comp_top_inf inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute inf.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms coreflexive_comp_inf coreflexive_comp_top_inf mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> coreflexive_comp_top_inf coreflexive_inf_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> test_comp_test_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comp_right_one comp_right_subdist_inf coreflexive_comp_top_inf inf.left_commute inf.orderE inf_le2 mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> test_comp_test_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="main">.</span> <span class="main">(</span><span class="bound">v</span> <span class="main">⊓</span> <span class="bound">u</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="bound">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> conv_dist_comp conv_involutive coreflexive_comp_top_inf inf.cobounded2 inf.left_commute inf.sup_monoid.add_commute symmetric_one_closed mult_assoc symmetric_top_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> idempotent <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_univalent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> univalent <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_idempotent coreflexive_symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> injective <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_idempotent coreflexive_symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_commutative<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_inf inf.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_dedekind<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> coreflexive <span class="free">y</span> <span class="main">⟹</span> coreflexive <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_inf inf.coboundedI1 inf.left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Also the equational version of the Dedekind rule continues to hold.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dedekind_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dedekind_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dedekind_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_right_isotone inf_mono conv_order inf.cobounded1 order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_isotone inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dedekind<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_eq inf.cobounded1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_export_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_inf_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_export_comp_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_export_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We solve a few exercises from \cite{SchmidtStroehlein1993}.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex231a <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded1 inf.idem inf_right_idem comp_left_one conv_one coreflexive_comp_top_inf dedekind_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex231b <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_dist_inf conv_involutive conv_one ex231a<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex231c<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone ex231a inf_le2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex231d<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_isotone comp_right_isotone top_greatest order_trans ex231c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex231e <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex231d antisym comp_associative mult_right_isotone top.extremum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> injective <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf conv_involutive inf.absorb2 top_right_mult_increasing univalent_inf_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> arc <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_univalent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> univalent <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_conv_closed arc_injective univalent_conv_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> injective_codomain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_right_one dual_order.trans inf.boundedI inf.cobounded1 inf.sup_monoid.add_commute mult_right_isotone one_inf_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_idempotent inf.cobounded1 inf.cobounded2 mult_left_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result generalises \cite[Exercise 2]{Oliveira2009}.
It is used to show that the while-loop preserves injectivity of the constructed tree.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> injective_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">t</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">t</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_dist_sup conv_dist_sup semiring.distrib_right sup.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms coreflexive_symmetric conv_dist_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> injective_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">t</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot <span class="main">⟹</span> arc <span class="free">e</span> <span class="main">⟹</span> injective <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_injective injective_sup bot_least <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">t</span> <span class="main">⟹</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> univalent <span class="free">e</span> <span class="main">⟹</span> univalent <span class="main">(</span><span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injective_sup conv_dist_sup conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> point_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top comp_associative conv_dist_comp conv_involutive vector_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vv_transitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_left_isotone comp_right_isotone top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> epm_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf.absorb2 top.extremum dedekind_2 inf.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_isotone mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> coreflexive_comp_top_inf inf.sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> top_left_mult_increasing antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_inf_vector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top covector_inf_comp_3 comp_associative conv_dist_comp inf.commute vector_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inf_vector_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.commute vector_export_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_inf_covector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_comp_inf covector_mult_closed<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Well-known distributivity properties of univalent and injective relations over meet continue to hold.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_comp_left_dist_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_right_isotone<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative dedekind<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_left_isotone comp_right_isotone inf.sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> injective_comp_right_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> univalent_comp_left_dist_inf conv_dist_comp conv_involutive conv_dist_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_covector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> vector <span class="free">w</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_comp_inf inf_top_left vector_conv_covector<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_inf_vector_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span>top <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf_vector conv_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The shunting properties for bijective relations and mappings continue to hold.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shunt_bijective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comp_associative mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 inf_commute inf_top.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shunt_mapping<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> shunt_bijective mapping_conv_bijective conv_order conv_dist_comp conv_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_reverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> shunt_bijective<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp conv_involutive conv_order shunt_bijective<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_expanded<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top comp_associative conv_dist_comp conv_involutive vector_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_top_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms epm_3 top_right_mult_increasing vector_inf_comp vector_mult_closed vector_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_top_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms epm_3 top_right_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf_vector_1 conv_dist_comp conv_involutive conv_top inf.absorb1 top_right_mult_increasing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arc_eq_1›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arc_eq_2›</span></span></span></span> were contributed by Nicolas Robinson-O'Brien.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_eq_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms arc_top_arc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym ex231c<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_eq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_eq_1 assms conv_involutive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> points_arc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point <span class="free">x</span> <span class="main">⟹</span> point <span class="free">y</span> <span class="main">⟹</span> arc <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp conv_involutive equivalence_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> point_arc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point <span class="free">x</span> <span class="main">⟹</span> arc <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> points_arc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Single-Object Pseudocomplemented Distributive Allegories›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We extend single-object bounded distributive allegories by a pseudocomplement operation.
The following definitions concern properties of relations that require a pseudocomplement.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_signature <span class="main">=</span> bounded_distrib_allegory_signature <span class="main">+</span> uminus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">irreflexive</span>         <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">irreflexive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>         <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">strict_linear</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_linear</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>       <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">strict_order</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_order</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>        <span class="main">≡</span> irreflexive <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> transitive <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">linear_strict_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">linear_strict_order</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> strict_order <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> strict_linear <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following variants are useful for the graph model.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pp_mapping</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp_mapping</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>          <span class="main">≡</span> univalent <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> total <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pp_bijective</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp_bijective</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>        <span class="main">≡</span> injective <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> surjective <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pp_point</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp_point</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>            <span class="main">≡</span> vector <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> pp_bijective <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pp_arc</span>              <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp_arc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>              <span class="main">≡</span> pp_bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">∧</span> pp_bijective <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> pd_allegory <span class="main">=</span> bounded_distrib_allegory <span class="main">+</span> p_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> relation_algebra_signature <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subclass</span></span> pd_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_inf conv_order bot_least conv_involutive pseudo_complement sup.absorb2 sup.cobounded2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement_1 conv_dist_sup conv_involutive sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_sub_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_zero conv_dist_comp conv_involutive dedekind_1 inf_import_p inf_p inf_right_idem ppp pseudo_complement regular_closed_bot<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_sub_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pseudo_complement conv_complement_sub_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_sub <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement_sub_leq sup.absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> complement_conv_sub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_complement_sub_leq conv_order conv_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following so-called Schr\"oder equivalences, or De Morgan's Theorem K, hold only with a pseudocomplemented element on both right-hand sides.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_3_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pseudo_complement schroeder_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_4_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pseudo_complement schroeder_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_pp_semi_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_complement_sub_leq schroeder_3_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result looks similar to a property of (anti)domain.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_comp_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_pp_semi_commute comp_right_isotone inf.eq_iff p_antitone pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_comp_semi_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> complement_conv_sub schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> p_pp_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pp_comp_semi_commute comp_left_isotone inf.eq_iff p_antitone pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_comp_subdist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> theorem24xxiii<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dedekind_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_right_isotone conv_complement_sub_leq inf.sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_right_subdist_inf antisym inf.coboundedI2 inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Even in Stone relation algebras, we do not obtain the backward implication in the following result.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_complement_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> vector <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complement_conv_sub conv_top eq_iff top_right_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_complement_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">x</span> <span class="main">⟹</span> covector <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement_sub_leq conv_top eq_iff top_left_mult_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_vector_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_bot conv_complement conv_complement_sub_inf conv_dist_comp conv_involutive inf_top.right_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreflexive bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreflexive <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreflexive <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="free">y</span> <span class="main">⟹</span> irreflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreflexive <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_complement conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_complement_irreflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflexive <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_complement_reflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreflexive <span class="free">x</span> <span class="main">⟷</span> reflexive <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_complement_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">x</span> <span class="main">⟹</span> symmetric <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_irreflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"asymmetric <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.mult_not_zero inf.left_commute inf.right_idem inf.sup_monoid.add_commute pseudo_complement one_inf_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_asymmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear <span class="free">x</span> <span class="main">⟹</span> asymmetric <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_complement p_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_linear_sup_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_linear <span class="free">x</span> <span class="main">⟹</span> strict_linear <span class="free">y</span> <span class="main">⟹</span> strict_linear <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> conv_dist_sup sup.right_idem sup_assoc sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_linear_irreflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_linear <span class="free">x</span> <span class="main">⟹</span> irreflexive <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup_left_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_linear_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_linear <span class="free">x</span> <span class="main">⟹</span> strict_linear <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_order <span class="free">x</span> <span class="main">⟷</span> asymmetric <span class="free">x</span> <span class="main">∧</span> transitive <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asymmetric_irreflexive comp_right_one irreflexive_conv_closed conv_dist_comp dual_order.trans pseudo_complement schroeder_3_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_order bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_order <span class="free">x</span> <span class="main">⟹</span> strict_order <span class="free">y</span> <span class="main">⟹</span> strict_order <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.coboundedI1 transitive_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_order <span class="free">x</span> <span class="main">⟹</span> strict_order <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irreflexive_conv_closed transitive_conv_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> order_strict_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"irreflexive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"antisymmetric <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> antisymmetric_inf_closed assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> coreflexive_symmetric irreflexive_inf_closed coreflexive_transitive dedekind_1 inf_idem mult_1_right semiring.mult_not_zero strict_order_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf inf.absorb2 inf.sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inf.antisym reflexive_conv_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_bot pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"transitive <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comp_isotone inf.boundedI inf.cobounded1 inf.order_lesseq_imp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_order<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_order <span class="free">x</span> <span class="main">⟹</span> order <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> strict_order_var<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup mult_right_dist_sup sup.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> conv_dist_sup coreflexive_bot_closed sup.absorb2 sup_inf_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_strict_order_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear_strict_order <span class="free">x</span> <span class="main">⟹</span> linear_strict_order <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreflexive_conv_closed sup_monoid.add_commute transitive_conv_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> linear_order_strict_order<span class="main">:</span>
  <span class="quoted"><span class="quoted">"linear_order <span class="free">x</span> <span class="main">⟹</span> linear_strict_order <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> order_strict_order <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_dist_inf coreflexive_symmetric eq_iff inf.absorb2 inf.distrib_left inf.sup_monoid.add_commute top.extremum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> regular_conv_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> regular <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We show a number of facts about equivalences.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_comp_left_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement_sub_leq preorder_idempotent<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> equivalence_comp_right_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="free">x</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equivalence_comp_left_complement conv_complement conv_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The pseudocomplement of tests is given by the following operation.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">coreflexive_complement</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">''</span>"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">'</span></span> <span class="main">≡</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_top_coreflexive_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span><span class="main">'</span> <span class="main">=</span> <span class="free">x</span> <span class="main">'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_comp_top_inf_one inf.commute inf_import_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_inf_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_comp_top_inf inf.sup_relative_same_increasing inf_import_p inf_le1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> double_coreflexive_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">'</span><span class="main">'</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.sup_monoid.add_commute inf_import_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_pp_dist_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coreflexive <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">'</span><span class="main">'</span> <span class="main">=</span> <span class="free">x</span> <span class="main">'</span><span class="main">'</span> <span class="main">*</span> <span class="free">y</span> <span class="main">'</span><span class="main">'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">'</span><span class="main">'</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> double_coreflexive_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms coreflexive_comp_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_inf inf.left_commute inf.sup_monoid.add_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">'</span><span class="main">'</span> <span class="main">*</span> <span class="free">y</span> <span class="main">'</span><span class="main">'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> double_coreflexive_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_pseudo_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coreflexive <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_bijective_conv_mapping<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_bijective <span class="free">x</span> <span class="main">⟷</span> pp_mapping <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement surjective_conv_total<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_arc_expanded<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pp_arc <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_arc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp equivalence_top_closed vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive equivalence_top_closed vector_top_closed mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive ex231c<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"top <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_dist_comp conv_involutive equivalence_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl mult_assoc p_comp_pp p_pp_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_complement_closed covector_comp_inf covector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_inf_covector inf_top.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_left_isotone comp_right_isotone pp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_left_isotone comp_right_isotone pp_isotone comp_left_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_left_isotone comp_right_isotone pp_isotone comp_right_one<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 top_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"pp_arc <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp equivalence_top_closed vector_top_closed<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_right_isotone top_le pp_comp_semi_commute<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp coreflexive_symmetric vector_conv_covector vector_top_closed mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_dist_comp equivalence_top_closed inf.orderE inf_top.left_neutral mult_right_isotone pp_comp_semi_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following operation represents states with infinite executions of non-strict computations.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> N_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_mult_closed vector_complement_closed vector_inf_one_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_comp_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_N_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> N <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_complement_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_vector_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative vector_complement_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_vector_top_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_comp_top comp_associative vector_top_closed vector_complement_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_below_inf_one_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone p_antitone top_right_mult_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> N_below_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_below_inf_one_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> N_comp_N<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N <span class="free">x</span> <span class="main">*</span> N <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_comp inf.mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N bot <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> N_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N top <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> n_split_omega_mult_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">xo</span> <span class="main">=</span> <span class="free">xo</span> <span class="main">⟹</span> vector <span class="free">xo</span> <span class="main">⟹</span> N top <span class="main">*</span> <span class="free">xo</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">*</span> N <span class="free">xo</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> N_top N_vector_top_pp comp_associative comp_left_one<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Many of the following results have been derived for verifying Prim's minimum spanning tree algorithm.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ee<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms covector_vector_comp comp_associative mult_left_isotone mult_right_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bot_unique comp_associative mult_right_isotone semiring.mult_not_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> et<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> comp_isotone mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> covector_vector_comp le_bot mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> conv_order conv_dist_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_associative comp_isotone<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">t</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> covector_vector_comp le_bot mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ve_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> comp_right_isotone dual_order.trans top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> covector_inf_comp_3 vector_conv_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_top_right vector_inf_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex231c comp_associative mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> coreflexive_comp_top_inf le_infE mult_semi_associative point_injective<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.antisym mult_left_isotone top_right_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring.distrib_left semiring.distrib_right sup_assoc mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">*</span> <span class="free">v</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> covector_vector_comp antisym bot_least comp_associative mult_left_isotone mult_right_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vTeT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⟹</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_bot ev conv_dist_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result is used to show that the while-loop of Prim's algorithm preserves that the constructed tree is a subgraph of g.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prim_subgraph_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_supI1 mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_right_isotone conv_dist_sup inf.sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf.boundedE mult_right_isotone order.trans top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_left_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right vector_export_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">e</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup mult_left_dist_sup sup.assoc sup.orderI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone mult_right_sub_dist_sup_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊔</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result shows how to apply the Schr\"oder equivalence to the middle factor in a composition of three relations.
Again the elements on the right-hand side need to be pseudocomplemented.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> triple_schroeder_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_assoc p_antitone_iff schroeder_3_p schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The rotation versions of the Schr\"oder equivalences continue to hold, again with pseudocomplemented elements on the right-hand side.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_5_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> schroeder_3_p schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_6_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> schroeder_3_p schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_conv_compl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟹</span> top <span class="main">*</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_complement_closed vector_conv_covector<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Composition commutes, relative to the diversity relation.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_commute_below_diversity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_one conv_dist_comp conv_one schroeder_3_p schroeder_4_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_injective_below_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">y</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_antitone_iff comp_associative comp_right_isotone comp_right_one schroeder_4_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_univalent_below_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_inf pseudo_complement semiring.mult_zero_right univalent_comp_left_dist_inf<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Bijective relations and mappings can be exported from a pseudocomplement.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_bijective_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bijective <span class="free">y</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_injective_below_complement complement_conv_sub antisym shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> comp_mapping_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> comp_bijective_complement conv_complement conv_dist_comp conv_involutive total_conv_surjective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following facts are used in the correctness proof of Kruskal's minimum spanning tree algorithm.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_injective_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"covector <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> injective_inf_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.sup_monoid.add_assoc inf.sup_right_divisibility inf_import_p inf_p<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_inf_covector comp_isotone inf.cobounded2 inf.left_idem<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 21 schroeder_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">q</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> bot_unique conv_bot conv_complement covector_complement_closed p_antitone p_bot regular_closed_bot schroeder_5_p<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> schroeder_5_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> conv_bot conv_dist_comp covector_comp_inf inf.absorb1 inf.cobounded2 inf.sup_monoid.add_commute inf_left_commute inf_p schroeder_4_p<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 conv_dist_comp coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 conv_dist_comp coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">*</span> <span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_left_dist_sup comp_right_dist_sup conv_dist_sup sup.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 5 6 7 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_exchange_injective_inv_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"covector <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">q</span> <span class="main">⊓</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> kruskal_injective_inv<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted">bot</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_exchange_acyclic_inv_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">w</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative comp_inf_vector_1 conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">d</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms epm_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_subgraph_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">h</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">e</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">q</span> <span class="main">≤</span> <span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf.coboundedI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊓</span> <span class="free">q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf.coboundedI1 conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> conv_complement conv_dist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>2<span class="main">)</span> inf.absorb1 semiring.add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">h</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">e</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI1 le_supI2 pp_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?h</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_isotone order_trans p_antitone_inf p_supdist_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="var">?h</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_pp_semi_commute order_lesseq_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stone Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We add <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pp_dist_comp›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pp_one›</span></span></span></span>, which follow in relation algebras but not in the present setting.
The main change is that only a Stone algebra is required, not a Boolean algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_relation_algebra <span class="main">=</span> pd_allegory <span class="main">+</span> stone_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pp_dist_comp <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pp_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following property is a simple consequence of the Stone axiom.
We cannot hope to remove the double complement in it.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_0_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_top conv_dist_sup stone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> theorem24xxiv_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_dist_inf theorem24xxiii<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_linear<span class="main">:</span>
  <span class="quoted"><span class="quoted">"asymmetric <span class="free">x</span> <span class="main">⟷</span> linear <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement inf.distrib_left inf_p maddux_3_11_pp p_bot p_dist_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_linear_asymmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_linear <span class="free">x</span> <span class="main">⟹</span> antisymmetric <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement eq_refl p_dist_sup pp_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> regular_complement_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> regular_mult_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">y</span> <span class="main">⟹</span> regular <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> regular_one_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following variants of total and surjective are useful for graphs.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_total<span class="main">:</span>
  <span class="quoted"><span class="quoted">"total <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">*</span>top<span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dense_pp pp_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_surjective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"surjective <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">(</span>top<span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_bot p_comp_pp p_top pp_dist_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Bijective elements and mappings are necessarily regular, that is, invariant under double-complement.
This implies that points are regular.
Moreover, also arcs are regular.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bijective <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_bijective_complement mult_left_one regular_one_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapping <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bijective_regular conv_complement conv_involutive total_conv_surjective<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_regular<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_isotone top_left_mult_increasing top_right_mult_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span>top <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> top <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bijective_regular conv_top conv_dist_comp conv_involutive mapping_regular<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative dedekind_1 inf.commute inf_top.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_right_one conv_top comp_associative conv_dist_comp conv_involutive mult_right_isotone vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym pp_increasing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
lemma conv_complement_0 [simp]: "x<span class="hidden">⇧</span><sup>T</sup> ⊔ (-x)<span class="hidden">⇧</span><sup>T</sup> = top" nitpick [expect=genuine] oops
lemma schroeder_3: "x * y ≤ z ⟷ x<span class="hidden">⇧</span><sup>T</sup> * -z ≤ -y" nitpick [expect=genuine] oops
lemma schroeder_4: "x * y ≤ z ⟷ -z * y<span class="hidden">⇧</span><sup>T</sup> ≤ -x" nitpick [expect=genuine] oops
lemma theorem24xxiv: "-(x * y) ⊔ (x * z) = -(x * (y ⊓ -z)) ⊔ (x * z)" nitpick [expect=genuine] oops
lemma vector_N: "x = x * top ⟶ N(x) = x ⊓ 1" nitpick [expect=genuine] oops
lemma N_vector [simp]: "N(x * top) = x * top ⊓ 1" nitpick [expect=genuine] oops
lemma N_vector_top [simp]: "N(x * top) * top = x * top" nitpick [expect=genuine] oops
lemma N_below_inf_one: "N(x) ≤ x ⊓ 1" nitpick [expect=genuine] oops
lemma N_below: "N(x) ≤ x" nitpick [expect=genuine] oops
lemma n_split_omega_mult: "xs * xo = xo ∧ xo * top = xo ⟶ N(top) * xo = xs * N(xo) * top" nitpick [expect=genuine] oops
lemma complement_vector: "vector v ⟷ vector (-v)" nitpick [expect=genuine] oops
lemma complement_covector: "covector v ⟷ covector (-v)" nitpick [expect=genuine] oops
lemma triple_schroeder: "x * y * z ≤ w ⟷ x<span class="hidden">⇧</span><sup>T</sup> * -w * z<span class="hidden">⇧</span><sup>T</sup> ≤ -y" nitpick [expect=genuine] oops
lemma schroeder_5: "x * y ≤ z ⟷ y * -z<span class="hidden">⇧</span><sup>T</sup> ≤ -x<span class="hidden">⇧</span><sup>T</sup>" nitpick [expect=genuine] oops
lemma schroeder_6: "x * y ≤ z ⟷ -z<span class="hidden">⇧</span><sup>T</sup> * x ≤ -y<span class="hidden">⇧</span><sup>T</sup>" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every Stone algebra can be expanded to a Stone relation algebra by identifying the semiring and lattice structures and taking identity as converse.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> stone_algebra <span class="main">&lt;</span> comp_inf<span class="main">:</span> stone_relation_algebra <span class="keyword2"><span class="keyword">where</span></span> one <span class="main">=</span> <span class="quoted">top</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">inf</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">id</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 7
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inf.assoc inf_sup_distrib2 inf_left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every bounded linear order can be expanded to a Stone algebra, which can be expanded to a Stone relation algebra by reusing some of the operations.
In particular, composition is meet, its identity is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> and converse is the identity function.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linorder_stone_relation_algebra_expansion <span class="main">=</span> linorder_stone_algebra_expansion <span class="main">+</span> times <span class="main">+</span> conv <span class="main">+</span> one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> times_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> min <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subclass</span></span> stone_relation_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_right_dist_sup inf_commute inf_assoc inf_left_commute pp_dist_inf min_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> times_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="free">y</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_dense min_inf times_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For a relation algebra, we only require that the underlying lattice is a Boolean algebra.
In fact, the only missing axiom is that double-complement is the identity.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra <span class="main">=</span> boolean_algebra <span class="main">+</span> stone_relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_complement_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We now obtain the original formulations of the Schr\"oder equivalences.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> schroeder_3_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">z</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> schroeder_4_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> theorem24xxiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> theorem24xxiv_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_N<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> N<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_N_pp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> N_vector <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N<span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> N_vector_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"N<span class="main">(</span><span class="free">x</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_vector_top_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> N_below_inf_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_below_inf_one_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> N_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"N<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> N_below_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> n_split_omega_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">*</span> <span class="free">xo</span> <span class="main">=</span> <span class="free">xo</span> <span class="main">⟹</span> <span class="free">xo</span> <span class="main">*</span> top <span class="main">=</span> <span class="free">xo</span> <span class="main">⟹</span> N<span class="main">(</span>top<span class="main">)</span> <span class="main">*</span> <span class="free">xo</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">*</span> N<span class="main">(</span><span class="free">xo</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_split_omega_mult_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> complement_vector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">v</span> <span class="main">⟷</span> vector <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> complement_covector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"covector <span class="free">v</span> <span class="main">⟷</span> covector <span class="main">(</span><span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> covector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> triple_schroeder<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⟷</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">-</span><span class="free">w</span> <span class="main">*</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_schroeder_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">*</span> <span class="main">-</span><span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement schroeder_5_p<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> schroeder_6<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement schroeder_5_p<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We briefly look at the so-called Tarski rule.
In some models of Stone relation algebras it only holds for regular elements, so we add this as an assumption.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_relation_algebra_tarski <span class="main">=</span> stone_relation_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tarski<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟹</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We can then show, for example, that every arc is contained in a pseudocomplemented relation or its pseudocomplement.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_in_partition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms arc_expanded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms arc_regular tarski <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_2 inf.cobounded1 inf.boundedI inf_commute mult_assoc inf.absorb2 top.extremum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_complement conv_dist_comp conv_dist_inf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone mult_left_isotone mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_isotone inf.sup_right_isotone mult_1_left mult_semi_associative<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_1 inf_commute inf_top_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf mult_left_isotone mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> top <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc mult_right_isotone top_left_mult_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_isotone mult_1_right<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_bot_arc_in_partition_xor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⟶</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_absorb1 shunting_1_pp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> arc_in_partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> point_in_vector_or_pseudo_complement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms bijective_regular regular_closed_inf regular_closed_p shunting_1_pp tarski vector_complement_closed vector_inf_closed vector_mult_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> epm_3 inf.absorb_iff1 inf.cobounded1 inf_top.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms antisym comp_bijective_complement inf.sup_monoid.add_commute mult_left_one pseudo_complement regular_one_closed point_in_vector_or_pseudo_complement<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> point_in_vector_or_complement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">-</span><span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms point_in_vector_or_pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> point_in_vector_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf.absorb1 shunting_var_p sup_commute point_in_vector_or_complement<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> point_atomic_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> inf.absorb2 pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms point_in_vector_or_pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> point_in_vector_or_complement_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms point_in_vector_or_pseudo_complement p_antitone_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next three lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arc_in_arc_or_complement›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>arc_in_sup_arc›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>different_arc_in_sup_arc›</span></span></span></span> were contributed by Nicolas Robinson-O'Brien.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_in_arc_or_complement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms arc_in_partition arc_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_in_sup_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> arc_in_arc_or_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.boundedE inf.sup_monoid.add_commute maddux_3_13 sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> different_arc_in_sup_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arc_in_arc_or_complement assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> eq_iff p_antitone_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms arc_in_sup_arc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_lesseq_imp p_inf_sup_below sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_tarski <span class="main">=</span> relation_algebra <span class="main">+</span> stone_relation_algebra_tarski

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finally, the above axioms of relation algebras do not imply that they contain at least two elements.
This is necessary, for example, to show that arcs are not empty.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_relation_algebra_consistent <span class="main">=</span> stone_relation_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> consistent<span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">≠</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_not_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> consistent mult_right_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_consistent <span class="main">=</span> relation_algebra <span class="main">+</span> stone_relation_algebra_consistent

<span class="keyword1"><span class="command">class</span></span> stone_relation_algebra_tarski_consistent <span class="main">=</span> stone_relation_algebra_tarski <span class="main">+</span> stone_relation_algebra_consistent
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_in_partition_xor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_bot_arc_in_partition_xor arc_not_bot<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Subalgebras">
<div class="head">
<h1>Theory Relation_Subalgebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Subalgebras of Relation Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subalgebras of Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this theory we consider the algebraic structure of regular elements, coreflexives, vectors and covectors in Stone relation algebras.
These elements form important subalgebras and substructures of relation algebras.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Subalgebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Stone_Algebras/Stone_Construction.html">Stone_Algebras.Stone_Construction</a> <a href="Relation_Algebras.html">Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The regular elements of a Stone relation algebra form a relation subalgebra.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> regular <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_relation_algebra</span><span class="main">)</span> <span class="quoted">relation_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">times</span>
  <span class="keyword1"><span class="command">using</span></span> regular_mult_closed regular_closed_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">conv_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">conv</span>
  <span class="keyword1"><span class="command">using</span></span> conv_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">using</span></span> regular_one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_regular.rep_eq Rep_regular_inject comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_regular.rep_eq Rep_regular_inject mult_right_dist_sup sup_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_regular.rep_eq Rep_regular_inject bot_regular.rep_eq semiring.mult_zero_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_regular.rep_eq times_regular.rep_eq Rep_regular_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Rep_regular_inject conv_regular.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_regular_inject conv_dist_sup conv_regular.rep_eq sup_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_regular.rep_eq times_regular.rep_eq Rep_regular_inject conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_regular.rep_eq dedekind_1 inf_regular.rep_eq less_eq_regular.rep_eq times_regular.rep_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The coreflexives (tests) in an idempotent semiring form a bounded idempotent subsemiring.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> coreflexive <span class="main">=</span> <span class="quoted"><span class="quoted">"coreflexives<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>non_associative_left_semiring set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> simp_coreflexive <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> Rep_coreflexive <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_coreflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_coreflexive

<span class="keyword1"><span class="command">instantiation</span></span> coreflexive <span class="main">::</span> <span class="main">(</span><span class="quoted">idempotent_semiring</span><span class="main">)</span> <span class="quoted">bounded_idempotent_semiring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">times</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_mult_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="main">1</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_coreflexive.rep_eq less_eq_coreflexive.rep_eq less_le_not_le<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_coreflexive.rep_eq order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_coreflexive_inject bot_coreflexive.rep_eq less_eq_coreflexive.rep_eq sup_coreflexive.rep_eq<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>5<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring.distrib_left less_eq_coreflexive.rep_eq sup_coreflexive.rep_eq times_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_coreflexive.rep_eq times_coreflexive.rep_eq Rep_coreflexive_inject mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_coreflexive.rep_eq bot_coreflexive.rep_eq Rep_coreflexive_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_coreflexive.rep_eq times_coreflexive.rep_eq Rep_coreflexive_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_coreflexive.rep_eq less_eq_coreflexive.rep_eq times_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sup_coreflexive.rep_eq top_coreflexive.rep_eq Rep_coreflexive_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Abs_coreflexive_cases Abs_coreflexive_inverse mem_Collect_eq sup.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_coreflexive.rep_eq mult.assoc times_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> times_coreflexive.rep_eq Rep_coreflexive_inject mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Rep_coreflexive_inject one_coreflexive.rep_eq times_coreflexive.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_coreflexive.rep_eq times_coreflexive.rep_eq Rep_coreflexive_inject mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_coreflexive.rep_eq bot_coreflexive.rep_eq Rep_coreflexive_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The coreflexives (tests) in a Stone relation algebra form a Stone relation algebra where the pseudocomplement is taken relative to the identity relation and converse is the identity function.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> coreflexive <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_relation_algebra</span><span class="main">)</span> <span class="quoted">stone_relation_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> minus_coreflexive <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">conv_coreflexive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> coreflexive <span class="main">⇒</span> <span class="tfree">'a</span> coreflexive"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">id</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inf_coreflexive.rep_eq less_eq_coreflexive.rep_eq<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_coreflexive_inject inf_coreflexive.rep_eq sup_coreflexive.rep_eq sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_coreflexive_inject bot_coreflexive.rep_eq top_greatest coreflexive_pseudo_complement inf_coreflexive.rep_eq less_eq_coreflexive.rep_eq one_coreflexive.rep_eq one_coreflexive_def top_coreflexive_def uminus_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_coreflexive_inject maddux_3_21_pp one_coreflexive.rep_eq one_coreflexive_def pp_dist_inf pp_one regular_closed_p sup_coreflexive.rep_eq sup_right_top top_coreflexive_def uminus_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.assoc mult_right_dist_sup<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_coreflexive_inject conv_coreflexive.rep_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Rep_coreflexive_inject conv_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_coreflexive_inject top_greatest conv_coreflexive.rep_eq coreflexive_commutative less_eq_coreflexive.rep_eq one_coreflexive.rep_eq one_coreflexive_def times_coreflexive.rep_eq top_coreflexive_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> conv_coreflexive.rep_eq less_eq_coreflexive.rep_eq one_coreflexive.rep_eq times_coreflexive.rep_eq inf_coreflexive.rep_eq Rep_coreflexive_inject<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> coreflexive_dedekind Rep_coreflexive mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_coreflexive Rep_coreflexive_inject coreflexive_pp_dist_comp mem_Collect_eq times_coreflexive.rep_eq uminus_coreflexive.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_coreflexive_inverse inf.commute inf.idem inf_import_p one_coreflexive.rep_eq pp_one uminus_coreflexive.rep_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Vectors in a Stone relation algebra form a Stone subalgebra.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> vector <span class="main">=</span> <span class="quoted"><span class="quoted">"vectors<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bounded_pre_left_semiring set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> surjective_top_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> simp_vector <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> Rep_vector <span class="free">x</span> <span class="main">*</span> top <span class="main">=</span> Rep_vector <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_vector

<span class="keyword1"><span class="command">instantiation</span></span> vector <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_relation_algebra</span><span class="main">)</span> <span class="quoted">stone_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_sup_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_inf_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_complement_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vector <span class="main">⇒</span> <span class="tfree">'a</span> vector <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Rep_vector_inject top_vector.rep_eq bot_vector.rep_eq less_le_not_le inf_vector.rep_eq sup_vector.rep_eq less_eq_vector.rep_eq less_vector.rep_eq<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>12<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_vector_inject inf_vector.rep_eq sup_inf_distrib1 sup_vector.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_vector_inject bot_vector_def bot_vector.rep_eq pseudo_complement inf_vector.rep_eq less_eq_vector.rep_eq uminus_vector.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_vector.rep_eq uminus_vector.rep_eq Rep_vector_inverse stone top_vector.abs_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Covectors in a Stone relation algebra form a Stone subalgebra.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> covector <span class="main">=</span> <span class="quoted"><span class="quoted">"covectors<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>bounded_pre_left_semiring set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> surjective_top_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> simp_covector <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> top <span class="main">*</span> Rep_covector <span class="free">x</span> <span class="main">=</span> Rep_covector <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_covector

<span class="keyword1"><span class="command">instantiation</span></span> covector <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_relation_algebra</span><span class="main">)</span> <span class="quoted">stone_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_sup_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_inf_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> covector_complement_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_covector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> covector <span class="main">⇒</span> <span class="tfree">'a</span> covector <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Rep_covector_inject less_eq_covector.rep_eq inf_covector.rep_eq bot_covector.rep_eq top_covector.rep_eq sup_covector.rep_eq less_le_not_le less_covector.rep_eq<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>12<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_covector_inject inf_covector.rep_eq sup_inf_distrib1 sup_covector.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_covector_inject bot_covector_def bot_covector.rep_eq pseudo_complement inf_covector.rep_eq less_eq_covector.rep_eq uminus_covector.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_covector.rep_eq uminus_covector.rep_eq Rep_covector_inverse stone top_covector.abs_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Matrix_Relation_Algebras">
<div class="head">
<h1>Theory Matrix_Relation_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Matrix Relation Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Matrix Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory gives matrix models of Stone relation algebras and more general structures.
We consider only square matrices.
The main result is that matrices over Stone relation algebras form a Stone relation algebra.

We use the monoid structure underlying semilattices to provide finite sums, which are necessary for defining the composition of two matrices.
See \cite{ArmstrongFosterStruthWeber2016,ArmstrongGomesStruthWeber2016} for similar liftings to matrices for semirings and relation algebras.
A technical difference is that those theories are mostly based on semirings whereas our hierarchy is mostly based on lattices (and our semirings directly inherit from semilattices).

Relation algebras have both a semiring and a lattice structure such that semiring addition and lattice join coincide.
In particular, finite sums and finite suprema coincide.
Isabelle/HOL has separate theories for semirings and lattices, based on separate addition and join operations and different operations for finite sums and finite suprema.
Reusing results from both theories is beneficial for relation algebras, but not always easy to realise.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_Relation_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Relation_Algebras.html">Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite Suprema›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We consider finite suprema in idempotent semirings and Stone relation algebras.
We mostly use the first of the following notations, which denotes the supremum of expressions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t(x)›</span></span></span></span> over all <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> from the type of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>.
For finite types, this is implemented in Isabelle/HOL as the repeated application of binary suprema.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_sum_sup_monoid"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>bounded_semilattice_sup_bot <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⨆⇩</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_sum_sup_monoid_bounded"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>bounded_semilattice_sup_bot <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⨆⇘</span>_<span class="keyword1">∈</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>51<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⨆⇩</span><span class="free">x</span> <span class="free">t</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">XCONST</span> sup_monoid.sum <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="main">.</span> <span class="free">t</span><span class="main">)</span> <span class="main">{</span> <span class="free">x</span> <span class="main">.</span> <span class="keyword1">CONST</span> True <span class="main">}</span>"</span>
  <span class="quoted">"⨆<span class="hidden">⇘</span><sub><span class="free">x</span><span class="main">∈</span><span class="free">X</span></sub><span class="hidden">⇙</span> <span class="free">t</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">XCONST</span> sup_monoid.sum <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="main">.</span> <span class="free">t</span><span class="main">)</span> <span class="free">X</span>"</span>

<span class="keyword1"><span class="command">context</span></span> idempotent_semiring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following induction principles are useful for comparing two suprema.
The first principle works because types are not empty.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_sup_induct <span class="main">[</span><span class="operator">case_names</span> one sup<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span> <span class="bound">I</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">∉</span> <span class="bound">I</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span> <span class="main">⊔</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">j</span> <span class="main">⊔</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span> <span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>singleton <span class="skolem">i</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> one <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bot_sup_induct <span class="main">[</span><span class="operator">case_names</span> bot sup<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> bot bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span> <span class="bound">I</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">∉</span> <span class="bound">I</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span> <span class="main">⊔</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">j</span> <span class="main">⊔</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">i</span><span class="main">∈</span><span class="bound">I</span></sub><span class="hidden">⇙</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> bot sup <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Now many properties of finite suprema follow by simple applications of the above induction rules.
In particular, we show distributivity of composition, isotonicity and the upper-bound property.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_right_dist_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_dist_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_left_dist_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> leq_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ub_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">k</span> <span class="main">.</span> True <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_code sup_monoid.sum.insert sup_ge1 mk_disjoint_insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lub_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lub_sum_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.trans ub_sum lub_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> stone_relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In Stone relation algebras, we can also show that converse,  double complement and meet distribute over finite suprema.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conv_dist_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_dist_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> one_sup_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sup <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_right_dist_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comp_inf.comp_right_dist_sum<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Square Matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Because our semiring and relation algebra type classes only work for homogeneous relations, we only look at square matrices.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We use standard matrix operations.
The Stone algebra structure is lifted componentwise.
Composition is matrix multiplication using given composition and supremum operations.
Its unit lifts given zero and one elements into an identity matrix.
Converse is matrix transpose with an additional componentwise transpose.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_eq_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>ord<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>                                           <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">≼</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_matrix</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>ord<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>                                           <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≺</span>"</span> 50<span class="main">)</span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">≺</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≼</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≼</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sup_matrix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>sup<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                                 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 65<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inf_matrix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>inf<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                                 <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 67<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minus_matrix</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>uminus<span class="main">,</span>inf<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                        <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊖</span>"</span> 65<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊖</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">⊓</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">implies_matrix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>implies<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                             <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊘</span>"</span> 65<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊘</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span> <span class="main">↝</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">times_matrix</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>times<span class="main">,</span>bounded_semilattice_sup_bot<span class="main">}</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊙</span>"</span> 70<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊙</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uminus_matrix</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>uminus<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                                                <span class="main">(</span><span class="quoted">"<span class="keyword1">⊖</span> _"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊖</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span>    <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conv_matrix</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>conv<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>                                                  <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>t</sup></span></span>      <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bot_matrix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bot<span class="main">)</span> square"</span></span>                                                                     <span class="main">(</span><span class="quoted">"<span class="keyword1">mbot</span>"</span><span class="main">)</span>         <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">mbot</span></span>   <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">top_matrix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>top<span class="main">)</span> square"</span></span>                                                                     <span class="main">(</span><span class="quoted">"<span class="keyword1">mtop</span>"</span><span class="main">)</span>         <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">mtop</span></span>   <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">.</span> top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_matrix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>one<span class="main">,</span>bot<span class="main">}</span><span class="main">)</span> square"</span></span>                                                               <span class="main">(</span><span class="quoted">"<span class="keyword1">mone</span>"</span><span class="main">)</span>         <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">mone</span></span>   <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stone Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first lift the Stone algebra structure.
Because all operations are componentwise, this also works for infinite matrices.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_order<span class="main">:</span> order <span class="keyword2"><span class="keyword">where</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"less_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>order<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_matrix_def order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_matrix_def antisym ext<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_semilattice_sup<span class="main">:</span> semilattice_sup <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"less_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>semilattice_sup<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def less_eq_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_semilattice_inf<span class="main">:</span> semilattice_inf <span class="keyword2"><span class="keyword">where</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"less_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>semilattice_inf<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def less_eq_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_bounded_semilattice_sup_bot<span class="main">:</span> bounded_semilattice_sup_bot <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_sup_bot<span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def less_eq_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_bounded_semilattice_inf_top<span class="main">:</span> bounded_semilattice_inf_top <span class="keyword2"><span class="keyword">where</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted"><span class="quoted">"top_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_semilattice_inf_top<span class="main">)</span> square"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_matrix_def top_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_lattice<span class="main">:</span> lattice <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"less_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>lattice<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_distrib_lattice<span class="main">:</span> distrib_lattice <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted"><span class="quoted">"less_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice<span class="main">)</span> square <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square <span class="main">⇒</span> bool"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1 sup_matrix_def inf_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_bounded_lattice<span class="main">:</span> bounded_lattice <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_lattice<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_bounded_distrib_lattice<span class="main">:</span> bounded_distrib_lattice <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_distrib_lattice<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_p_algebra<span class="main">:</span> p_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>p_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> inf_matrix_def bot_matrix_def less_eq_matrix_def uminus_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pseudo_complement<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_pd_algebra<span class="main">:</span> pd_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>pd_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In particular, matrices over Stone algebras form a Stone algebra.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_stone_algebra<span class="main">:</span> stone_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>stone_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def uminus_matrix_def top_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_heyting_stone_algebra<span class="main">:</span> heyting_stone_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>heyting_stone_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> implies <span class="main">=</span> <span class="quoted">implies_matrix</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> inf_matrix_def sup_matrix_def bot_matrix_def top_matrix_def less_eq_matrix_def uminus_matrix_def implies_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_boolean_algebra<span class="main">:</span> boolean_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>boolean_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> minus <span class="main">=</span> <span class="quoted">minus_matrix</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def uminus_matrix_def top_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def uminus_matrix_def minus_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next, we lift the semiring structure.
Because of composition, this requires a restriction to finite matrices.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_monoid<span class="main">:</span> monoid_mult <span class="keyword2"><span class="keyword">where</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted"><span class="quoted">"one_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_right_dist_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sup_monoid.sum.swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_left_dist_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">⊙</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mone</span> <span class="main">⊙</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">k</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_left_one mult_left_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mone</span> <span class="main">⊙</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mone</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mone</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult.right_neutral semiring.mult_zero_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mone</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_idempotent_semiring<span class="main">:</span> idempotent_semiring <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>idempotent_semiring<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">≼</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">⊕</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">⊕</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">⊕</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="skolem">f</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> bot <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">⊙</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≼</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mone</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_left_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_monoid.sum.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mbot</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="keyword1">mbot</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_bounded_idempotent_semiring<span class="main">:</span> bounded_idempotent_semiring <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>bounded_idempotent_semiring<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊕</span> <span class="keyword1">mtop</span> <span class="main">=</span> <span class="keyword1">mtop</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">e</span> <span class="main">⊔</span> <span class="keyword1">mtop</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">e</span> <span class="main">⊔</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">mtop</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">=</span> <span class="keyword1">mtop</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stone Relation Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finally, we show that matrices over Stone relation algebras form a Stone relation algebra.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_stone_relation_algebra<span class="main">:</span> stone_relation_algebra <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">sup_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> inf <span class="main">=</span> <span class="quoted">inf_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">less_eq_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">less_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted"><span class="quoted">"bot_matrix <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>stone_relation_algebra<span class="main">)</span> square"</span></span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">top_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> uminus <span class="main">=</span> <span class="quoted">uminus_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> one <span class="main">=</span> <span class="quoted">one_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> times <span class="main">=</span> <span class="quoted">times_matrix</span> <span class="keyword2"><span class="keyword">and</span></span> conv <span class="main">=</span> <span class="quoted">conv_matrix</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_monoid.mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">h</span> <span class="main">⊕</span> <span class="skolem">g</span> <span class="main">⊙</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_idempotent_semiring.mult_right_dist_sup<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mbot</span> <span class="main">⊙</span> <span class="skolem">f</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">⊙</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊕</span> <span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def conv_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊕</span> <span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊕</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊕</span> <span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> conv_dist_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">≼</span> <span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf_right_dist_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> leq_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> dedekind_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> leq_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> comp_right_isotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inf.sup_right_isotone<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ub_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> pp_dist_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pp_dist_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="main">(</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="skolem">f</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?o</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> square"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">⊖</span><span class="var">?o</span> <span class="main">=</span> <span class="var">?o</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="var">?o</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="var">?o</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">-</span>bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?o</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="var">?o</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?o</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Linear_Order_Matrices">
<div class="head">
<h1>Theory Linear_Order_Matrices</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Matrices over Bounded Linear Orders
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Matrices over Bounded Linear Orders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this theory we characterise relation-algebraic properties of matrices over bounded linear orders (for example, extended real numbers) in terms of the entries in the matrices.
We consider, in particular, the following properties: univalent, injective, total, surjective, mapping, bijective, vector, covector, point, arc, reflexive, coreflexive, irreflexive, symmetric, antisymmetric, asymmetric.
We also consider the effect of composition with the matrix of greatest elements and with coreflexives (tests).
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Linear_Order_Matrices

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Matrix_Relation_Algebras.html">Matrix_Relation_Algebras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> non_trivial_linorder_stone_relation_algebra_expansion <span class="main">=</span> linorder_stone_relation_algebra_expansion <span class="main">+</span> non_trivial
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> non_trivial_bounded_order <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Before we look at matrices, we generalise selectivity to finite suprema.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> linorder_finite_sup_selective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>linorder_stone_algebra_expansion"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> comp_inf.one_sup_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> sup_selective <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> linorder_top_finite_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>linorder_stone_algebra_expansion"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≠</span> top"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≠</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms linorder_finite_sup_selective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results show the effect of composition with the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> matrix from the left and from the right.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_top_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> times_matrix_def top_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv comp_right_one one_def sup_monoid.sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> top_comp_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> times_matrix_def top_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv comp_left_one one_def sup_monoid.sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We characterise univalent matrices: in each row, at most one entry may be different from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.univalent <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.ub_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> bot.extremum_uniqueI times_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bot.extremum_uniqueI less_eq_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv one_matrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.univalent <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">i</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms semiring.mult_not_zero sup_monoid.sum.neutral<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> univalent_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.univalent <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> univalent_linorder_matrix_1 univalent_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Injective matrices can then be characterised by applying converse: in each column, at most one entry may be different from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> injective_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.injective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">⟶</span> <span class="bound">j</span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.injective_conv_univalent univalent_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next come total matrices: each row has a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entry.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.total_var <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_eq_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def top.extremum_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">j</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">j</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">j</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_top_finite_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.total_var <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">i</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">i</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms comp_inf.ub_sum sup.absorb2 sup_top_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> total_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.total <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> total_linorder_matrix_1 total_linorder_matrix_2 matrix_stone_relation_algebra.total_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Surjective matrices are again characterised by applying converse: each column has a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entry.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> surjective_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.surjective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.surjective_conv_total total_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A mapping therefore means that each row has exactly one <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entry and all others are <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.mapping <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> total_linorder_matrix univalent_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> comp_inf.mult_1_right comp_inf.mult_right_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.mapping <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃!</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mapping_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> bot_not_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Conversely, bijective means that each column has exactly one <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entry and all others are <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.bijective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.bijective_conv_mapping mapping_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bijective_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.bijective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃!</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.bijective_conv_mapping mapping_linorder_matrix_unique<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We derive algebraic characterisations of matrices in which each row has an entry that is different from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_total_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span> <span class="main">⟹</span> <span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix linorder_finite_sup_selective<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">mbot</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_matrix_def bot_not_top<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_total_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix uminus_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym assms bot.extremum comp_inf.ub_sum uminus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_matrix_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_total_linorder_matrix_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pp_total_linorder_matrix_1 pp_total_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_total_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.total <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_stone_relation_algebra.pp_total pp_total_linorder_matrix_1 pp_total_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_mapping_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_mapping <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> pp_total_linorder_matrix univalent_linorder_matrix_1 univalent_linorder_matrix_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_mapping_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_mapping <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃!</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pp_mapping_linorder_matrix <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_total_linorder_matrix univalent_linorder_matrix<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next follow matrices in which each column has an entry that is different from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_surjective_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊖</span><span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⊖</span><span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="keyword1">mbot</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_stone_relation_algebra.conv_involutive<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">⊖</span><span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mbot</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_stone_relation_algebra.conv_complement matrix_stone_relation_algebra.conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pp_total_linorder_matrix_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_surjective_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.surjective <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_stone_relation_algebra.pp_surjective pp_surjective_linorder_matrix_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_bijective_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_bijective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.pp_bijective_conv_mapping pp_mapping_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_bijective_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_bijective <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">∃!</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.pp_bijective_conv_mapping pp_mapping_linorder_matrix_unique<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The regular matrices are those which contain only <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span> or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entries.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> regular_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_p_algebra.regular <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_p_algebra.regular <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span> <span class="main">=</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">.</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_matrix_def ext<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Vectors are precisely the row-constant matrices.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_linorder_matrix_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.vector <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_top_linorder_matrix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.vector <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms vector_linorder_matrix_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vector_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.vector <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms linorder_finite_sup_selective<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vector_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.vector <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vector_linorder_matrix_1 vector_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Hence covectors are precisely the column-constant matrices.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> covector_linorder_matrix_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.covector <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms top_comp_linorder_matrix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> covector_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_bounded_idempotent_semiring.covector <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.covector_conv_vector vector_linorder_matrix<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv conv_matrix_def conv_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A point is a matrix that has exactly one row, which is constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span>, and all other rows are constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> point_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.point <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vector_linorder_matrix bijective_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> point_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.point <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vector_linorder_matrix bijective_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bot_not_top<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_point_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_point <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vector_linorder_matrix pp_bijective_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_point_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_point <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">i</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> vector_linorder_matrix pp_bijective_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An arc is a matrix that has exactly one <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> entry and all other entries are <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.arc <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.point <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms matrix_bounded_idempotent_semiring.vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> point_linorder_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.point <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms matrix_bounded_idempotent_semiring.vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> point_linorder_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> old.prod.case conv_matrix_def conv_def matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_comp_linorder_matrix<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI comp_inf.ub_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_not_top linorder_finite_sup_selective<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> imp_disjL<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">m</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI comp_inf.ub_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> old.prod.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_arc_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_arc <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.pp_arc_expanded<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Pair_inject semiring.mult_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 linorder_finite_sup_selective <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Pair_inject semiring.mult_not_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_dist_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 linorder_finite_sup_selective <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">=</span> <span class="keyword1">mtop</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"top <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_inf.ub_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_inf.ub_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> top <span class="main">*</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def top_matrix_def uminus_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_monoid.sum.cong comp_inf.mult_1_left times_inf comp_inf.mult_1_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 top.extremum_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="main">⊖</span><span class="main">⊖</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.arc <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_stone_relation_algebra.arc_expanded<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms bot_not_top matrix_stone_relation_algebra.pp_arc_expanded pp_arc_linorder_matrix_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">≼</span> <span class="keyword1">mone</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms bot_not_top matrix_stone_relation_algebra.pp_arc_expanded pp_arc_linorder_matrix_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">=</span> <span class="keyword1">mtop</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> comp_inf.ub_sum top_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">≤</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> comp_inf.ub_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> top <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def top_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup_monoid.sum.cong comp_inf.mult_1_left times_inf comp_inf.mult_1_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 top.extremum_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mtop</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arc_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.arc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_linorder_matrix_1 arc_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> arc_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.arc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">=</span> top <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> arc_linorder_matrix bot_not_top<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> arc_linorder_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_arc_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_arc <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_point <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms matrix_bounded_idempotent_semiring.vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_point_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_point <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms matrix_bounded_idempotent_semiring.vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">⊙</span> <span class="keyword1">mtop</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_point_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">mtop</span> <span class="main">⊙</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> old.prod.case conv_matrix_def conv_def matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.conv_top<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">k</span> <span class="main">.</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">l</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_comp_linorder_matrix<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI comp_inf.ub_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_finite_sup_selective<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> imp_disjL<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">m</span></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_top_linorder_matrix<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI comp_inf.ub_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> old.prod.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pp_arc_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_arc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pp_arc_linorder_matrix_1 pp_arc_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> pp_arc_linorder_matrix_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>non_trivial_linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.pp_arc <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">e</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">e</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">d</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> pp_arc_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pp_arc_linorder_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Reflexive matrices are those with a constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> diagonal.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.reflexive <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_eq_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.extremum_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.reflexive <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflexive_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.reflexive <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reflexive_linorder_matrix_1 reflexive_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Coreflexive matrices are those in which all non-diagonal entries are <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.coreflexive <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms less_eq_matrix_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot.extremum_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.coreflexive <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.coreflexive <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coreflexive_linorder_matrix_1 coreflexive_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Irreflexive matrices are those with a constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span> diagonal.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_linorder_matrix_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.irreflexive <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="keyword1">mone</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_eq_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot.extremum_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_linorder_matrix_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.irreflexive <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_matrix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊖</span><span class="keyword1">mone</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">mone</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊖</span><span class="keyword1">mone</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_matrix_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreflexive_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.irreflexive <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irreflexive_linorder_matrix_1 irreflexive_linorder_matrix_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
As usual, symmetric matrices are those which do not change under transposition.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> symmetric_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.symmetric <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv cond_case_prod_eta conv_matrix_def conv_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Antisymmetric matrices are characterised as follows: each entry not on the diagonal or its mirror entry across the diagonal must be <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> antisymmetric_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.antisymmetric <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.antisymmetric <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def inf_matrix_def less_eq_matrix_def one_matrix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> inf.absorb_iff1 inf.cobounded1 inf_bot_right inf_dense<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For asymmetric matrices the diagonal is included: each entry or its mirror entry across the diagonal must be <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymmetric_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.asymmetric <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_stone_relation_algebra.asymmetric <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> conv_matrix_def inf_matrix_def conv_def id_def bot_matrix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> bot.extremum bot.extremum_uniqueI case_prod_conv old.prod.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> inf.absorb_iff1 inf.cobounded1 inf_bot_right inf_dense<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In a transitive matrix, the weight of one of the edges on an indirect route must be below the weight of the direct edge.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transitive_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.transitive <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∨</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.transitive <span class="free">f</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">.</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_matrix_def less_eq_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lub_sum_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∨</span> <span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We finally show the effect of composing with a coreflexive (test) from the left and from the right.
This amounts to a restriction of each row or column to the entry on the diagonal of the coreflexive.
In this case, restrictions are formed by meets.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coreflexive_comp_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.coreflexive <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="free">i</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms coreflexive_linorder_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>⨆<span class="hidden">⇘</span><sub><span class="bound">k</span><span class="main">∈</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">i</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> UNIV_def brouwer.inf_bot_right finite_UNIV insert_def sup_monoid.sum.insert_remove<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> linorder_finite_sup_selective sup_not_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="keyword1">mtop</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms matrix_stone_relation_algebra.coreflexive_comp_top_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆⇩</span><span class="bound"><span class="bound">k</span></span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_matrix_def comp_top_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> comp_coreflexive_linorder_matrix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>finite<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>linorder_stone_relation_algebra_expansion<span class="main">)</span> square"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_idempotent_semiring.coreflexive <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">⊙</span> <span class="free">g</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_matrix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">⊙</span> <span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms matrix_stone_relation_algebra.conv_dist_comp matrix_stone_relation_algebra.coreflexive_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">f</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms coreflexive_comp_linorder_matrix<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> conv_def old.prod.case conv_matrix_def inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>