<div id="Prover">
<div class="head">
<h1>Theory Prover</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Prover
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> ex_image_cong_iff <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Formulas"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> pred <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> var <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">datatype</span></span> form <span class="main">=</span> 
  PAtom <span class="quoted">pred</span> <span class="quoted"><span class="quoted">"var list"</span></span>
  <span class="main">|</span> NAtom <span class="quoted">pred</span> <span class="quoted"><span class="quoted">"var list"</span></span>
  <span class="main">|</span> FConj <span class="quoted">form</span> <span class="quoted">form</span>
  <span class="main">|</span> FDisj <span class="quoted">form</span> <span class="quoted">form</span>
  <span class="main">|</span> FAll <span class="quoted">form</span>
  <span class="main">|</span> FEx <span class="quoted">form</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">preSuc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">=&gt;</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preSuc</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preSuc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="free">preSuc</span> <span class="free"><span class="bound"><span class="entity">list</span></span></span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> <span class="bound">n</span><span class="main">#</span><span class="main">(</span><span class="free">preSuc</span> <span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">fv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form <span class="main">=&gt;</span> var list"</span></span> <span class="comment1">― ‹shouldn't need to be more constructive than this›</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>PAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>NAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>FDisj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>FAll <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> preSuc <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv</span> <span class="main">(</span>FEx <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> preSuc <span class="main">(</span><span class="free">fv</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bump</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var <span class="main">=&gt;</span> var<span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>var <span class="main">=&gt;</span> var<span class="main">)</span>"</span></span> <span class="comment1">― ‹substitute a different var for 0›</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bump</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="main">0</span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> Suc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> nat<span class="main">)</span> <span class="main">=&gt;</span> form <span class="main">=&gt;</span> form"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>PAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>PAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>NAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>NAtom <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> FConj <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FDisj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> FDisj <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FAll <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> FAll <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>bump <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FEx <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> FEx <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>bump <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-size_subst"><span class="command">lemma</span></span> size_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> size <span class="main">(</span>subst <span class="bound">m</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> size <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">finst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form <span class="main">=&gt;</span> var <span class="main">=&gt;</span> form"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finst</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span>subst <span class="main">(</span><span class="main">%</span> <span class="bound">v</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">v</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-size_finst"><span class="command">lemma</span></span> size_finst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>finst <span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> size <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finst_def<span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> seq <span class="main">=</span> <span class="quoted"><span class="quoted">"form list"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> nform <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> form"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> nseq <span class="main">=</span> <span class="quoted"><span class="quoted">"nform list"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">s_of_ns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> seq"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">s_of_ns</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">=</span> map snd <span class="free"><span class="bound"><span class="entity">ns</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ns_of_s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"seq <span class="main">=&gt;</span> nseq"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ns_of_s</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">flatten</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list <span class="main">=&gt;</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">flatten</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">flatten</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">@</span><span class="main">(</span><span class="free">flatten</span> <span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sfv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"seq <span class="main">=&gt;</span> var list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sfv</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> flatten <span class="main">(</span>map fv <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-sfv_nil"><span class="command">lemma</span></span> sfv_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"sfv <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sfv_def<span class="main">)</span>
<span class="keyword1" id="Prover-sfv_cons"><span class="command">lemma</span></span> sfv_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"sfv <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fv <span class="free">a</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>sfv <span class="free">list</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sfv_def<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">maxvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var list <span class="main">=&gt;</span> var"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maxvar</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxvar</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">maxvar</span> <span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-maxvar"><span class="command">lemma</span></span> maxvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="free">vs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">≤</span> maxvar <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">newvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var list <span class="main">=&gt;</span> var"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newvar</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>maxvar <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹note that for newvar to be constructive, need an operation to get a different var from a given set›</span>

<span class="keyword1" id="Prover-newvar"><span class="command">lemma</span></span> newvar<span class="main">:</span> <span class="quoted"><span class="quoted">"newvar <span class="free">vs</span> <span class="main">∉</span> <span class="main">(</span>set <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_pos_if_in_set maxvar newvar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="comment1">(*lemmas newvar_sfv = newvar[of "sfv s"]*)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> nseq list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subs</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subs</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">in</span>
                <span class="keyword1">case</span> <span class="bound">f</span> <span class="keyword1">of</span>
                        PAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">=&gt;</span> <span class="keyword1">if</span> NAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="main">(</span>map snd <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>PAtom <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
                        <span class="main">|</span> NAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">=&gt;</span> <span class="keyword1">if</span> PAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="main">(</span>map snd <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>NAtom <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> 
                        <span class="main">|</span> FConj <span class="bound">f</span> <span class="bound">g</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
                        <span class="main">|</span> FDisj <span class="bound">f</span> <span class="bound">g</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
                        <span class="main">|</span> FAll <span class="bound">f</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="bound">f</span> <span class="main">(</span>newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
                        <span class="main">|</span> FEx <span class="bound">f</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="bound">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Suc <span class="bound">m</span><span class="main">,</span>FEx <span class="bound">f</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
                <span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Derivations"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">is_axiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"seq <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_axiom</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">is_axiom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">?</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> PAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">&amp;</span> NAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">?</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> NAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">&amp;</span> PAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">list</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">*</span> nseq<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">s</span> <span class="main">::</span> <span class="quoted">nseq</span>
<span class="keyword2"><span class="keyword">where</span></span>
  init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">deriv</span> <span class="free">s</span>"</span></span>
<span class="main">|</span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">deriv</span> <span class="free">s</span> <span class="main">==&gt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:</span> set <span class="main">(</span>subs <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">deriv</span> <span class="free">s</span>"</span></span>
  <span class="comment1">― ‹the closure of the branch at isaxiom›</span>

<span class="comment1">(*lemma step': "(n,x) ∈ deriv s ==&gt; y : set (subs x) ==&gt; ~ is_axiom (s_of_ns x) ==&gt; (Suc n,y) ∈ deriv s"*)</span>

<span class="keyword1" id="Prover-patom"><span class="command">lemma</span></span> patom<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> natom<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fconj1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FConj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FConj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">f</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fconj2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FConj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FConj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">g</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fdisj<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FDisj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FDisj <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">f</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">g</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fall<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FAll <span class="free">f</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FAll <span class="free">f</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="free">f</span> <span class="main">(</span>newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FAll <span class="free">f</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> fex<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FEx <span class="free">f</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">,</span>FEx <span class="free">f</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="free">f</span> <span class="free">m</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Suc <span class="free">m</span><span class="main">,</span>FEx <span class="free">f</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> deriv<span class="main">(</span><span class="free">nfs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> step <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> not_is_axiom_subs <span class="main">=</span> patom natom fconj1 fconj2 fdisj fall fex
  
<span class="keyword1"><span class="command">lemmas</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> init
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> init step

<span class="keyword1" id="Prover-deriv0"><span class="command">lemma</span></span> deriv0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> deriv.cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*
lemma deriv_exists: "(n,x) ∈ deriv s ==&gt; x ≠ [] ==&gt; ~ is_axiom (s_of_ns x) ==&gt; (∃y. (Suc n, y) ∈ deriv s &amp; y : set (subs x))"
  apply(case_tac x) apply(simp)
  apply(case_tac a) apply(case_tac b)
       apply(auto simp add: Let_def s_of_ns_def intro: step) 
  apply(rule_tac x= "list @ [(0, form1)]" in exI)
  apply(simp)
  apply(rule step) apply(assumption) apply(simp add: Let_def) 
  done
*)</span>

<span class="keyword1" id="Prover-deriv_upwards"><span class="command">lemma</span></span> deriv_upwards<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">list</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">zs</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span> <span class="bound">zs</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> <span class="bound">zs</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="free">list</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-deriv_downwards"><span class="command">lemma</span></span> deriv_downwards <span class="comment1">(*derivSucE*)</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> <span class="free">x</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="bound">y</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> deriv.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span><span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> nat lista a<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"NAtom <span class="improper">nat</span> <span class="improper">lista</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="improper">list</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"PAtom <span class="improper">nat</span> <span class="improper">lista</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="improper">list</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-deriv_deriv_child"><span class="command">lemma</span></span> deriv_deriv_child<span class="comment1">(*derivSuc*)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="bound">y</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="bound">y</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> deriv_downwards<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> deriv_downwards <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> deriv.cases<span class="main">)</span> <span class="comment1">― ‹blast needs some help with the reasoning, hence derivSucE›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*
lemma deriv_not_nil: "s ≠ [] ==&gt; ∀t. (n,t) ∈ deriv s --&gt; t ≠ []"
  apply(induct_tac n)
  apply(force)
  apply (blast dest: derivSucE deriv_exists); 
  done
*)</span>

<span class="keyword1" id="Prover-deriv_progress"><span class="command">lemma</span></span> deriv_progress<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">a</span><span class="main">#</span><span class="free">list</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">zs</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span> <span class="free">list</span><span class="main">@</span><span class="bound">zs</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">#</span><span class="free">list</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_is_axiom_subs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">inc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> nseq <span class="main">=&gt;</span> nat <span class="main">*</span> nseq"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inc</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">fs</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">,</span> <span class="bound">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-inj_inc"><span class="command">lemma</span></span> inj_inc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj inc"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inc_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-deriv"><span class="command">lemma</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">y</span> <span class="main">=</span> insert <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>inc <span class="main">`</span> <span class="main">(</span>Union <span class="main">(</span>deriv <span class="main">`</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="free">y</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">w</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="free">y</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_paired_all<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inc_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> deriv_deriv_child inc_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-deriv_is_axiom"><span class="command">lemma</span></span> deriv_is_axiom<span class="main">:</span> <span class="quoted"><span class="quoted">"is_axiom <span class="main">(</span>s_of_ns <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> deriv <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> deriv.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">aa</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ba</span></span><span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
<span class="keyword1" id="Prover-is_axiom_finite_deriv"><span class="command">lemma</span></span> is_axiom_finite_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"is_axiom <span class="main">(</span>s_of_ns <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> finite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_is_axiom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Failing path"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">failing_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">*</span> nseq<span class="main">)</span> set <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">*</span> nseq<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">failing_path</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">&amp;</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">failing_path</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fn</span> <span class="main">=</span> <span class="free">failing_path</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">in</span> 
  <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">fsucn</span><span class="main">.</span> <span class="bound">fsucn</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">&amp;</span> fst <span class="bound">fsucn</span> <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&amp;</span> <span class="main">(</span>snd <span class="bound">fsucn</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="bound">fn</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="bound">fsucn</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="bound">fsucn</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> loc1 <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> failing_path <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_is_axiom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-infinite_union"><span class="command">lemma</span></span> infinite_union<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span> <span class="main">==&gt;</span> infinite <span class="main">(</span>Union <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">&amp;</span> infinite <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-infinite_inj_infinite_image"><span class="command">lemma</span></span> infinite_inj_infinite_image<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">Z</span> <span class="main">==&gt;</span> infinite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">Z</span><span class="main">)</span> <span class="main">=</span> infinite <span class="free">Z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_imageD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Prover-inj_inj_on"><span class="command">lemma</span></span> inj_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">==&gt;</span> inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_inj_on<span class="main">)</span>

<span class="keyword1" id="Prover-collect_disj"><span class="command">lemma</span></span> collect_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">|</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="keyword1">Un</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

<span class="keyword1" id="Prover-t"><span class="command">lemma</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span><span class="main">}</span> <span class="main">==&gt;</span> finite <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">w</span> <span class="main">&amp;</span> <span class="free">P</span> <span class="bound">w</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Prover-finite_subs"><span class="command">lemma</span></span> finite_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="free">y</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">w</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> subs.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> t <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collect_disj<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> fSuc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[|</span>
  <span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">&amp;</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"snd <span class="main"><span class="main">(</span></span><span class="free"><span class="free">f</span></span> <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> finite_insert<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>deriv <span class="main">`</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">w</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> infinite_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_subs<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span> <span class="improper">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_axiom_finite_deriv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_inj_infinite_image inj_inj_on<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> is_path_f_0<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> f0<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> is_path_f'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">~</span> is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fSuc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> is_path_f<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">&amp;</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fSuc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Models"</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> U

<span class="keyword1"><span class="command">type_synonym</span></span> model <span class="main">=</span> <span class="quoted"><span class="quoted">"U set <span class="main">*</span> <span class="main">(</span>pred <span class="main">=&gt;</span> U list <span class="main">=&gt;</span> bool<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> env <span class="main">=</span> <span class="quoted"><span class="quoted">"var <span class="main">=&gt;</span> U"</span></span> 

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">FEval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"model <span class="main">=&gt;</span> env <span class="main">=&gt;</span> form <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>PAtom <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">IP</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">MI</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">in</span> <span class="bound">IP</span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>NAtom <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">IP</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">MI</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">in</span> <span class="main">~</span> <span class="main">(</span><span class="bound">IP</span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span><span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>FDisj <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>FAll <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">MI</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="main">(</span><span class="main">%</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">y</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="bound">m</span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>FEx <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">MI</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free">FEval</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="main">(</span><span class="main">%</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">y</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="bound">m</span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-and_lem"><span class="command">lemma</span></span> and_lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">c</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">b</span><span class="main">=</span><span class="free">d</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="main">&amp;</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">&amp;</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Prover-or_lem"><span class="command">lemma</span></span> or_lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">c</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">b</span><span class="main">=</span><span class="free">d</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="main">|</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">|</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*lemma all_eq_all: "∀x. P x = Q x ==&gt; (∀x. P x) = (∀x. Q x)" by blast*)</span>

<span class="keyword1" id="Prover-ball_eq_ball"><span class="command">lemma</span></span> ball_eq_ball<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Prover-bex_eq_bex"><span class="command">lemma</span></span> bex_eq_bex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Prover-preSuc"><span class="command">lemma</span></span> preSuc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> Suc <span class="bound">n</span> <span class="main">∈</span> set <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>preSuc <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-FEval_cong"><span class="command">lemma</span></span> FEval_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>fv <span class="free">A</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="bound">e1</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">e2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">--&gt;</span> FEval <span class="free">MI</span> <span class="bound">e1</span> <span class="free">A</span> <span class="main">=</span> FEval <span class="free">MI</span> <span class="bound">e2</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>PAtom <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FEval.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fv.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> map_cong<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NAtom <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> list.map_cong0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FConj <span class="skolem">A1</span> <span class="skolem">A2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FDisj <span class="skolem">A1</span> <span class="skolem">A2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FAll <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FEval.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> Nitpick.case_nat_unfold One_nat_def Suc_pred fv.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> gr0I preSuc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FEx <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FEval.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> Nitpick.case_nat_unfold One_nat_def Suc_pred fv.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> gr0I preSuc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SEval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"model <span class="main">=&gt;</span> env <span class="main">=&gt;</span> form list <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SEval</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SEval</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>FEval <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">|</span> <span class="free">SEval</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-SEval_def2"><span class="command">lemma</span></span> SEval_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"SEval <span class="free">m</span> <span class="free">e</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">&amp;</span> FEval <span class="free">m</span> <span class="free">e</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Prover-SEval_append"><span class="command">lemma</span></span> SEval_append<span class="main">:</span> <span class="quoted"><span class="quoted">"SEval <span class="free">m</span> <span class="free">e</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>SEval <span class="free">m</span> <span class="free">e</span> <span class="free">xs</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span>SEval <span class="free">m</span> <span class="free">e</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Prover-all_eq_all"><span class="command">lemma</span></span> all_eq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Prover-all_conj"><span class="command">lemma</span></span> all_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Prover-SEval_cong"><span class="command">lemma</span></span> SEval_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>sfv <span class="free">s</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">e1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">e2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">--&gt;</span> SEval <span class="free">m</span> <span class="free">e1</span> <span class="free">s</span> <span class="main">=</span> SEval <span class="free">m</span> <span class="free">e2</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> or_lem<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_env</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"model <span class="main">=&gt;</span> env <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_env</span> <span class="free"><span class="bound"><span class="entity">MI</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">MI</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Svalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Svalid</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">MI</span> <span class="bound">e</span><span class="main">.</span> is_env <span class="bound">MI</span> <span class="bound">e</span> <span class="main">--&gt;</span> SEval <span class="bound">MI</span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>

<span class="keyword1" id="Prover-fold_compose1"><span class="command">lemma</span></span> fold_compose1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-FEval_subst"><span class="command">lemma</span></span> FEval_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span>FEval <span class="free">MI</span> <span class="bound">e</span> <span class="main">(</span>subst <span class="bound">f</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>FEval <span class="free">MI</span> <span class="main">(</span><span class="bound">e</span> <span class="keyword1">o</span> <span class="bound">f</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fold_compose1 map_map<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fold_compose1 map_map<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ball_eq_ball<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bump_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> case_nat <span class="improper">m</span> <span class="improper">e</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="main">0</span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> Suc <span class="main">(</span><span class="improper">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="improper">e</span> <span class="main">(</span><span class="improper">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">u</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bex_eq_bex<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bump_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> case_nat <span class="improper">m</span> <span class="improper">e</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">=&gt;</span> <span class="main">0</span> <span class="main">|</span> Suc <span class="bound">n</span> <span class="main">=&gt;</span> Suc <span class="main">(</span><span class="improper">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="main">(</span><span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="improper">e</span> <span class="main">(</span><span class="improper">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">u</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*
lemma bump_f_x_0[simp]: "bump f x 0 = x" apply(simp add: bump_def) done

lemma bump_id_suc[simp]: "bump id x (Suc n) = Suc n" apply(simp add: bump_def) done

lemma bump_id_0[simp]: "bump id 0 = id" apply(rule ext) apply(simp add: bump_def) apply(case_tac x) apply(auto) done
*)</span>

<span class="keyword1" id="Prover-FEval_finst"><span class="command">lemma</span></span> FEval_finst<span class="main">:</span> <span class="quoted"><span class="quoted">"FEval <span class="free">mo</span> <span class="free">e</span> <span class="main">(</span>finst <span class="free">A</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> FEval <span class="free">mo</span> <span class="main">(</span>case_nat <span class="main">(</span><span class="free">e</span> <span class="free">u</span><span class="main">)</span> <span class="free">e</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finst_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_subst<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="keyword1">o</span> case_nat <span class="free">u</span> <span class="main">(</span><span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>case_nat <span class="main">(</span><span class="free">e</span> <span class="free">u</span><span class="main">)</span> <span class="free">e</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-ball_maxscope"><span class="command">lemma</span></span> ball_maxscope<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">|</span> <span class="free">Q</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="free">Q</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Prover-sound_FAll"><span class="command">lemma</span></span> sound_FAll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> set <span class="main">(</span>sfv <span class="main">(</span>FAll <span class="free">f</span><span class="main">#</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="main">[</span>finst <span class="free">f</span> <span class="free">u</span><span class="main">]</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="main">(</span>FAll <span class="free">f</span><span class="main">#</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> SEval.simps<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> M I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ball_maxscope<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_finst<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="comment1">― ‹this is the goal›</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e</span><span class="main">(</span><span class="free">u</span><span class="main">:=</span><span class="improper">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"SEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span><span class="improper">e</span><span class="main">(</span><span class="free">u</span> <span class="main">:=</span><span class="improper">m</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> SEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="improper">e</span> <span class="free">s</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SEval_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="main">(</span><span class="improper">e</span><span class="main">(</span><span class="free">u</span> <span class="main">:=</span><span class="improper">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> FEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="improper">e</span><span class="main">)</span> <span class="free">f</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> FEval_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> preSuc<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nat</span> <span class="main">∈</span> set <span class="main">(</span>fv <span class="main">(</span>FAll <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹phew, that really was a bit more difficult than expected›</span>
    <span class="comment1">― ‹note that we can avoid maxscoping at the cost of instantiating the hyp twice- an additional time for M›</span>

    <span class="comment1">― ‹different proof, instantiating quantifier twice, avoiding maxscoping›</span>
<span class="keyword1" id="Prover-sound_FAll'"><span class="command">lemma</span></span> sound_FAll'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> set <span class="main">(</span>sfv <span class="main">(</span>FAll <span class="free">f</span><span class="main">#</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="main">[</span>finst <span class="free">f</span> <span class="free">u</span><span class="main">]</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="main">(</span>FAll <span class="free">f</span><span class="main">#</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> SEval.simps<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> M I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"SEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span> <span class="improper">I</span><span class="main">)</span> <span class="improper">e</span> <span class="free">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="comment1">― ‹second instantiation›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_finst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e</span><span class="main">(</span><span class="free">u</span><span class="main">:=</span><span class="improper">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"SEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span><span class="improper">e</span><span class="main">(</span><span class="free">u</span> <span class="main">:=</span><span class="improper">m</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> SEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="improper">e</span> <span class="free">s</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SEval_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="main">(</span><span class="improper">e</span><span class="main">(</span><span class="free">u</span> <span class="main">:=</span><span class="improper">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> FEval <span class="main">(</span><span class="improper">M</span><span class="main">,</span><span class="improper">I</span><span class="main">)</span> <span class="main">(</span>case_nat <span class="improper">m</span> <span class="improper">e</span><span class="main">)</span> <span class="free">f</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> FEval_cong<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> preSuc<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nat</span> <span class="main">∈</span> set <span class="main">(</span>fv <span class="main">(</span>FAll <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sfv_cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹not much better, probably slightly worse›</span>

<span class="comment1">(*
lemma sound_FAll: "u ∉ sfv ((0,FAll f)#s) ==&gt; SEval m e (map snd (s@[(0,finst u f)])) ==&gt; SEval m e (map snd ((0,FAll f)#s))"
  apply(simp)
  apply(rule all_maxscope)
  apply(rule)
  apply(simp add: SEval_append)
  apply(erule disjE)
  apply(simp)
  apply(rule disjI1)
  apply(simp add: FEval_finst)
  apply(subgoal_tac "FEval m (case_nat (e u) e) f = FEval m (case_nat x e) f") apply(simp)
  apply(rule FEval_cong[rule_format])
  apply(case_tac xa)
  apply(simp)
  oops -- "and this isn't provable- the heart of the rules-preserve-validity debate"
*)</span>


<span class="keyword1" id="Prover-sound_FEx"><span class="command">lemma</span></span> sound_FEx<span class="main">:</span> <span class="quoted"><span class="quoted">"Svalid <span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="main">[</span>finst <span class="free">f</span> <span class="free">u</span><span class="main">,</span>FEx <span class="free">f</span><span class="main">]</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="main">(</span>FEx <span class="free">f</span><span class="main">#</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> SEval.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ms m<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_append<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_finst<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ms</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-max_exists"><span class="command">lemma</span></span> max_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">X</span><span class="main">::</span>nat set<span class="main">)</span> <span class="main">==&gt;</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">--&gt;</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> finite_induct<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"max <span class="improper">x</span> <span class="improper">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="comment1">― ‹poor max lemmas in lib›</span>

<span class="keyword1" id="Prover-inj_finite_image_eq_finite"><span class="command">lemma</span></span> inj_finite_image_eq_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">Z</span> <span class="main">==&gt;</span> finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">Z</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">Z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_imageD<span class="main">)</span> 

<span class="keyword1" id="Prover-finite_inc"><span class="command">lemma</span></span> finite_inc<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inc <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_finite_image_eq_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> B<span class="main"><span class="main">=</span></span><span class="quoted">UNIV</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subset_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-finite_deriv_deriv"><span class="command">lemma</span></span> finite_deriv_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> finite  <span class="main">(</span>deriv <span class="main">`</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="free">s</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">w</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="free">s</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> deriv<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">init</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_FEx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_FEx</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">of</span>
      PAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">=&gt;</span> False
    <span class="main">|</span> NAtom <span class="bound">p</span> <span class="bound">vs</span> <span class="main">=&gt;</span> False
    <span class="main">|</span> FConj <span class="bound">f</span> <span class="bound">g</span> <span class="main">=&gt;</span> False
    <span class="main">|</span> FDisj <span class="bound">f</span> <span class="bound">g</span> <span class="main">=&gt;</span> False
    <span class="main">|</span> FAll <span class="bound">f</span> <span class="main">=&gt;</span> False
    <span class="main">|</span> FEx <span class="bound">f</span> <span class="main">=&gt;</span> True<span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-is_FEx"><span class="command">lemma</span></span> is_FEx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> is_FEx <span class="main">(</span>PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span>
  <span class="main">&amp;</span> <span class="main">~</span> is_FEx <span class="main">(</span>NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span>
  <span class="main">&amp;</span> <span class="main">~</span> is_FEx <span class="main">(</span>FConj <span class="free">f</span> <span class="free">g</span><span class="main">)</span>
  <span class="main">&amp;</span> <span class="main">~</span> is_FEx <span class="main">(</span>FDisj <span class="free">f</span> <span class="free">g</span><span class="main">)</span>
  <span class="main">&amp;</span> <span class="main">~</span> is_FEx <span class="main">(</span>FAll <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_FEx_def<span class="main">)</span>

<span class="keyword1" id="Prover-index0"><span class="command">lemma</span></span> index0<span class="main">:</span> <span class="quoted"><span class="quoted">"init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">u</span> <span class="bound">m</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="bound">u</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">~</span> is_FEx <span class="bound">A</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> init_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> 
  <span class="comment1">― ‹inversion on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span>"</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> deriv_downwards<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def s_of_ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_FEx_def Let_def s_of_ns_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-soundness'"><span class="command">lemma</span></span> soundness'<span class="main">:</span> <span class="quoted"><span class="quoted">"init <span class="free">s</span> <span class="main">==&gt;</span> finite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">m</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">y</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span> <span class="bound">t</span><span class="main">.</span> <span class="free">h</span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span> <span class="main">--&gt;</span> Svalid <span class="main">(</span>s_of_ns <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span><span class="main">)</span>
    <span class="comment1">― ‹base case›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span><span class="main">=</span><span class="free">m</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> gs g<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_def2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"is_axiom <span class="main">(</span>s_of_ns <span class="improper">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="comment1">― ‹base case, is axiom›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> 
      <span class="comment1">― ‹base case, is axiom, starts with PAtom›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>PAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span> <span class="main">|</span> FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>NAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"NAtom <span class="improper">p</span> <span class="improper">vs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> 
      <span class="comment1">― ‹base case, is axiom, starts with NAtom›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>PAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span> <span class="main">|</span> FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>NAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"PAtom <span class="improper">p</span> <span class="improper">vs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> 
    
    <span class="comment1">― ‹base case, not is axiom: if not a satax, then subs holds... but this can't be›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> deriv_upwards<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> 
   
     <span class="comment1">― ‹step case, by case analysis›</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"is_axiom <span class="main">(</span>s_of_ns <span class="improper">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="comment1">― ‹step case, is axiom›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> gs g<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_def2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>PAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span> <span class="main">|</span> FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>NAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"NAtom <span class="improper">p</span> <span class="improper">vs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>PAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span> <span class="main">|</span> FEval <span class="main">(</span><span class="improper">gs</span><span class="main">,</span><span class="improper">g</span><span class="main">)</span> <span class="improper">e</span> <span class="main">(</span>NAtom <span class="improper">p</span> <span class="improper">vs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"PAtom <span class="improper">p</span> <span class="improper">vs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> 

     <span class="comment1">― ‹we hit FAll/ FEx cases first›</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">f</span> <span class="bound">list</span><span class="main">.</span> <span class="improper">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span>FAll <span class="bound">f</span><span class="main">)</span><span class="main">#</span><span class="bound">list</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">na</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> u<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"FAll <span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> index0<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> deriv.step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>  <span class="comment1">― ‹nice use of simp to instantiate›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> finst <span class="improper"><span class="improper">f</span></span> <span class="main"><span class="main">(</span></span>newvar <span class="main"><span class="main">(</span></span>sfv <span class="main"><span class="main">(</span></span>s_of_ns <span class="improper"><span class="improper">t</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="improper">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="improper">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> newvar<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> sound_FAll<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">f</span> <span class="bound">list</span><span class="main">.</span> <span class="improper">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span>FEx <span class="bound">f</span><span class="main">)</span><span class="main">#</span><span class="bound">list</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> deriv.step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="comment1">― ‹nice use of simp to instantiate›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> finst <span class="improper">f</span> <span class="improper">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="improper">a</span><span class="main">,</span> FEx <span class="improper">f</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> finst <span class="improper">f</span> <span class="improper">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="improper">a</span><span class="main">,</span> FEx <span class="improper">f</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Svalid <span class="main">(</span>s_of_ns <span class="main">(</span><span class="improper">list</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="improper">f</span> <span class="improper">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="improper">a</span><span class="main">,</span> FEx <span class="improper">f</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> sound_FEx<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   
  <span class="comment1">― ‹now for other cases›</span> 
      <span class="comment1">― ‹case empty list›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> gs g<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_def2<span class="main">)</span>
  <span class="comment1">― ‹na t in deriv, so too is subs›</span>
   <span class="comment1">― ‹if not a satax, then subs holds...›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> patom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nat lista<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> PAtom <span class="improper"><span class="improper">nat</span></span> <span class="improper"><span class="improper">lista</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">gs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> <span class="comment1">― ‹weirdly, simp succeeds, force and blast fail›</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> natom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nat lista<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> NAtom <span class="improper"><span class="improper">nat</span></span> <span class="improper"><span class="improper">lista</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">gs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> fconj1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> fconj2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form1 form2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="improper"><span class="improper">form1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">gs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="improper"><span class="improper">form2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">gs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"FConj <span class="improper">form1</span> <span class="improper">form2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">fa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> fdisj<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form1 form2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">list</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="improper"><span class="improper">form1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="improper"><span class="improper">form2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">arith</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">gs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"FDisj <span class="improper">form1</span> <span class="improper">form2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"FDisj <span class="improper">form1</span> <span class="improper">form2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="comment1">― ‹all case›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"s_of_ns <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def ns_of_s_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def ns_of_s_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-soundness"><span class="command">lemma</span></span> soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> Svalid <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"init <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> init_def ns_of_s_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> max_exists<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span>ns_of_s <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> soundness'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"ns_of_s <span class="free"><span class="free">s</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Contains, Considers"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted">"<span class="entity">contains</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> <span class="main">(</span>nat<span class="main">*</span>nseq<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nform <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">contains</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nf</span></span></span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">considers</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> <span class="main">(</span>nat<span class="main">*</span>nseq<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nform <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">considers</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nf</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> snd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">=&gt;</span> False <span class="main">|</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">nf</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> progress<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">#</span><span class="free">list</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">zs'</span><span class="main">.</span> snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">list</span><span class="main">@</span><span class="bound">zs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_considers'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span> <span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> snd <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span><span class="main">@</span><span class="bound">y</span><span class="main">#</span><span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">zs'</span><span class="main">.</span> snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span><span class="main">#</span><span class="bound">zs'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ys</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> progress<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> u v<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-list_decomp"><span class="command">lemma</span></span> list_decomp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">xs</span><span class="main">@</span><span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="bound">ys</span><span class="main">)</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∉</span> set <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="improper">a</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">#</span><span class="improper">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_considers<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="free">y</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">m</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def considers_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> list_decomp<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> contains_considers'<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_patoms<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span> <span class="main">--&gt;</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> PAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_path_f<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_is_axiom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list_decomp<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> progress<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_natoms<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span> <span class="main">--&gt;</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> NAtom <span class="free">p</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_path_f<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_is_axiom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list_decomp<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> progress<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_fconj<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> FConj <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">g</span><span class="main">)</span> <span class="main">|</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FConj <span class="free">g</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_fdisj<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> FDisj <span class="free">g</span> <span class="free">h</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">g</span><span class="main">)</span> <span class="main">&amp;</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FDisj <span class="free">g</span> <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def Let_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_fall<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> FAll <span class="free">g</span><span class="main">)</span> 
  <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> contains <span class="free">f</span> <span class="main">(</span>Suc<span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="free">g</span> <span class="main">(</span>newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹may need constraint on fv›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FAll <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def Let_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> contains_propagates_fex<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span> 
  <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> 
  <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>finst <span class="free">g</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>
  <span class="main">&amp;</span> <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">m</span><span class="main">,</span>FEx <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span>FEx <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="improper">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def Let_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="improper">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">― ‹also need that if contains one, then contained an original at beginning›</span>
  <span class="comment1">― ‹existentials: show that for exists formulae, if Suc m is marker, then there must have been m›</span>
  <span class="comment1">― ‹show this by showing that nodes are upwardly closed, i.e. if never contains (m,x), then never contains (Suc m, x), by induction on n›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> FEx_downward<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">,</span>FEx <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>subs <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">aa</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ba</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ab</span><span class="main">,</span> FEx <span class="improper">form</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="improper">m</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> FEx0<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span>FEx <span class="free">g</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n'</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> FEx_downward<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> FEx_upward'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n'</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc<span class="main">(</span><span class="improper">n'</span><span class="main">+</span><span class="improper">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">n'</span><span class="main">+</span><span class="improper">m</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n'</span><span class="main">+</span><span class="improper">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def considers_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="comment1">― ‹FIXME contains and considers aren't buying us much›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> FEx_upward<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n'</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> finst <span class="free">g</span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n'</span> <span class="main">(</span><span class="improper">m'</span><span class="main">,</span> FEx <span class="free">g</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> m <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FEx0<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> FEx_upward'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> contains_propagates_fex <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Models 2"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="free">ntou</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> U"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> ntou<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">ntou</span>"</span></span>  <span class="comment1">― ‹assume universe set is infinite›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uton</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"U <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uton</span> <span class="main">=</span> inv ntou"</span></span>

<span class="keyword1" id="Prover-uton_ntou"><span class="command">lemma</span></span> uton_ntou<span class="main">:</span> <span class="quoted"><span class="quoted">"uton <span class="main">(</span>ntou <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uton_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ntou inv_f_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-map_uton_ntou"><span class="command">lemma</span></span> map_uton_ntou<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map uton <span class="main">(</span>map ntou <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uton_ntou<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-ntou_uton"><span class="command">lemma</span></span> ntou_uton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> range ntou <span class="main">==&gt;</span> ntou <span class="main">(</span>uton <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uton_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Falsifying Model From Failing Path"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">model</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> model"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">model</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>range ntou<span class="main">,</span> <span class="main">%</span> <span class="bound">p</span> <span class="bound">ms</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> failing_path <span class="main">(</span>deriv <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">~</span> contains <span class="bound">f</span> <span class="bound">n</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span>PAtom <span class="bound">p</span> <span class="main">(</span>map uton <span class="bound">ms</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> loc2 <span class="main">=</span> loc1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">mo</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mo</span> <span class="main">=</span> model <span class="free">s</span>"</span></span>

<span class="keyword1" id="Prover-is_env_model_ntou"><span class="command">lemma</span></span> is_env_model_ntou<span class="main">:</span> <span class="quoted"><span class="quoted">"is_env <span class="main">(</span>model <span class="free">s</span><span class="main">)</span> ntou"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc1<span class="main">)</span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">(</span>contains <span class="free">f</span> <span class="free">n</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span> is_FEx <span class="free">A</span> <span class="main">==&gt;</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> index0<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc2<span class="main">)</span> model'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> FEval_subst
  <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> is_axiom.simps
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> size <span class="bound">A</span> <span class="main">=</span> <span class="free">h</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">~</span> <span class="main">(</span>FEval <span class="free">mo</span> ntou <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> nat_less_induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">A</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mo Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def Let_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mo Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def Let_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">&amp;</span> <span class="improper">ma</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nat list m na nb ma<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">?</span> <span class="bound">y</span><span class="main">.</span> considers <span class="free">f</span> <span class="main">(</span><span class="improper">nb</span><span class="main">+</span><span class="improper">na</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> PAtom <span class="improper">nat</span> <span class="improper">list</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_considers<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contains_propagates_patoms<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"contains <span class="free">f</span> <span class="main">(</span><span class="improper">na</span><span class="main">+</span><span class="improper">nb</span><span class="main">+</span><span class="improper">y</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> NAtom <span class="improper">nat</span> <span class="improper">list</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nb</span><span class="main">+</span><span class="improper">na</span><span class="main">=</span><span class="improper">na</span><span class="main">+</span><span class="improper">nb</span>"</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"is_axiom <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">na</span><span class="main">+</span><span class="improper">nb</span><span class="main">+</span><span class="improper">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> is_axiom_finite_deriv<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_path_f<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">na</span> <span class="main">+</span> <span class="improper">nb</span> <span class="main">+</span> <span class="improper">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_of_ns_def is_axiom.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> contains_propagates_natoms contains_propagates_patoms<span class="main">)</span>

     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> contains_propagates_fconj<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form1 form2 m na<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">form1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> contains_propagates_fdisj<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form1 form2 m na<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">form1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>

   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> contains_propagates_fall<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="comment1">― ‹all case›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form m na y<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"finst <span class="improper">form</span> <span class="main">(</span>newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">na</span> <span class="main">+</span> <span class="improper">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_finst<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ntou <span class="main">(</span>newvar <span class="main">(</span>sfv <span class="main">(</span>s_of_ns <span class="main">(</span>snd <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">na</span> <span class="main">+</span> <span class="improper">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> 
   <span class="keyword1"><span class="command">using</span></span> is_env_model_ntou<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def mo<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> FEval.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> FEx_upward<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> form m na ma<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m'</span><span class="main">.</span> <span class="main">~</span> FEval <span class="free">mo</span> ntou <span class="main">(</span>finst <span class="improper">form</span> <span class="bound">m'</span><span class="main">)</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"size <span class="improper">form</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"finst <span class="improper">form</span> <span class="improper">m'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FEval_finst id_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"uton <span class="improper">ma</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">m'</span><span class="main">.</span> <span class="main">~</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">m'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">P</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ma</span> <span class="main">∈</span> range ntou"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ntou_uton<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mo model_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc2<span class="main">)</span> model<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="bound">n</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">~</span> <span class="main">(</span>FEval <span class="free">mo</span> ntou <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> model'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loc2<span class="main">)</span> completeness'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">mA</span> <span class="main">∈</span> set <span class="free">s</span><span class="main">.</span> <span class="main">~</span> FEval <span class="free">mo</span> ntou <span class="main">(</span>snd <span class="bound">mA</span><span class="main">)</span>"</span></span> <span class="comment1">― ‹FIXME tidy deriv s so that s consists of formulae only?›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> model<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">mA</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> is_path_f_0<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> init_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="comment1">― ‹FIXME very ugly›</span>

<span class="keyword1"><span class="command">thm</span></span> loc2.completeness'<span class="main">[</span><span class="operator">simplified</span> loc2_def loc2_axioms_def loc1_def<span class="main">]</span>

<span class="keyword1" id="Prover-completeness'"><span class="command">lemma</span></span> completeness'<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="free">s</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">mA</span> <span class="main">∈</span> set <span class="free">s</span><span class="main">.</span> <span class="main">~</span> FEval <span class="main">(</span>model <span class="free">s</span><span class="main">)</span> ntou <span class="main">(</span>snd <span class="bound">mA</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> loc2.completeness'<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> loc2_def loc2_axioms_def loc1_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-completeness''"><span class="command">lemma</span></span> completeness''<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> init <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">--&gt;</span> <span class="main">~</span> FEval <span class="main">(</span>model <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span> ntou <span class="bound">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> completeness'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ns_of_s_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-completeness"><span class="command">lemma</span></span> completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span> Svalid <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"init <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> init_def ns_of_s_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> completeness''<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Svalid_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEval_def2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span>model <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span>model <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ntou"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_env_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">― ‹FIXME silly splitting of quantified pairs›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Sound and Complete"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Svalid <span class="free">s</span> <span class="main">=</span> finite <span class="main">(</span>deriv <span class="main">(</span>ns_of_s <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> soundness completeness <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Algorithm"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">iter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="comment1">― ‹fold for nats›</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iter</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iter</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free">iter</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-iter"><span class="command">lemma</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>iter <span class="free">g</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>iter <span class="free">g</span> <span class="bound">a</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-ex_iter'"><span class="command">lemma</span></span> ex_iter'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>iter <span class="free">g</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="free">a</span> <span class="main">|</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>iter <span class="free">g</span> <span class="main">(</span><span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">nat</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="comment1">― ‹version suitable for computation›</span>
<span class="keyword1" id="Prover-ex_iter"><span class="command">lemma</span></span> ex_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>iter <span class="free">g</span> <span class="free">a</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">R</span> <span class="free">a</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>iter <span class="free">g</span> <span class="main">(</span><span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ex_iter'<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq list <span class="main">=&gt;</span> nat <span class="main">=&gt;</span> nseq list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> iter <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> flatten <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Prover-f_upwards"><span class="command">lemma</span></span> f_upwards<span class="main">:</span> <span class="quoted"><span class="quoted">"f <span class="free">s</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">==&gt;</span> f <span class="free">s</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-flatten_append"><span class="command">lemma</span></span> flatten_append<span class="main">:</span> <span class="quoted"><span class="quoted">"flatten <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>flatten <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>flatten <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Prover-set_flatten"><span class="command">lemma</span></span> set_flatten<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flatten <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Union <span class="main">(</span>set <span class="main">`</span> set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-f"><span class="command">lemma</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> deriv_downwards<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> list_decomp<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flatten_append f_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_flatten<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-deriv_f"><span class="command">lemma</span></span> deriv_f<span class="main">:</span> <span class="quoted"><span class="quoted">"deriv <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> set <span class="main">(</span>map <span class="main">(</span>Pair <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>

<span class="keyword1" id="Prover-finite_f"><span class="command">lemma</span></span> finite_f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span>f <span class="free">s</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>

<span class="keyword1" id="Prover-finite_deriv"><span class="command">lemma</span></span> finite_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> max_exists<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="main">(</span>Suc <span class="improper">x</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="improper">x</span><span class="main">,</span> <span class="improper">a</span><span class="main">)</span> <span class="main">∈</span> deriv <span class="free">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="main">(</span><span class="improper">m</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> f_upwards<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="improper">m</span><span class="main">}</span> <span class="keyword1">Un</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="improper">m</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"UNIV<span class="main">::</span>nat set"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">UN</span> <span class="bound">x</span><span class="main">:</span>Collect <span class="main">(</span><span class="main">(≤)</span> <span class="improper">m</span><span class="main">)</span><span class="main">.</span> Pair <span class="bound">x</span> <span class="main">`</span> set <span class="main">(</span>f <span class="main">[</span><span class="free">s</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">x</span><span class="main">:</span>Collect <span class="main">(</span><span class="main">(≤)</span> <span class="improper">m</span><span class="main">)</span><span class="main">.</span> <span class="main">{}</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SUP_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">-</span><span class="improper">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Prover-ex_iter_fSucn"><span class="command">lemma</span></span> ex_iter_fSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> iter <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="free">flat</span> <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>iter <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="free">flat</span> <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="free">flat</span> <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_iter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="free">flat</span> <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">l</span></span> <span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prove'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prove'</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> iter <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> flatten <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">m</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-prove'"><span class="command">lemma</span></span> prove'<span class="main">:</span> <span class="quoted"><span class="quoted">"prove' <span class="free">l</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> prove' <span class="main">(</span><span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> flatten <span class="main">(</span>map subs <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prove'_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ex_iter_fSucn<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹this is the main claim for efficiency- we have a tail recursive implementation via this lemma›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prove</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nseq <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prove</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> prove' <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prover-finite_deriv_prove"><span class="command">lemma</span></span> finite_deriv_prove<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deriv <span class="free">s</span><span class="main">)</span> <span class="main">=</span> prove <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_deriv prove_def prove'_def f_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Computation"</span></span>

  <span class="comment1">― ‹a sample formula to prove›</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">|</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹convert to our form›</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">|</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">~</span> <span class="free">A</span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="main">~</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">my_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">my_f</span> <span class="main">=</span> FDisj 
  <span class="main">(</span>FAll <span class="main">(</span>FConj <span class="main">(</span>NAtom <span class="main">0</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>NAtom <span class="main">1</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span>FDisj <span class="main">(</span>FEx <span class="main">(</span>PAtom <span class="main">1</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>FEx <span class="main">(</span>PAtom <span class="main">0</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">― ‹we compute by rewriting›</span>

<span class="keyword1" id="Prover-membership_simps"><span class="command">lemma</span></span> membership_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> ss <span class="main">=</span> list.inject if_True if_False flatten.simps list.map
  bump_def sfv_def filter.simps is_axiom.simps fst_conv snd_conv
  form.simps collect_disj inc_def finst_def ns_of_s_def s_of_ns_def
  Let_def newvar_def subs.simps split_beta append_Nil append_Cons
  subst.simps nat.simps fv.simps maxvar.simps preSuc.simps simp_thms
  membership_simps

<span class="keyword1"><span class="command">lemmas</span></span> prove'_Nil <span class="main">=</span> prove' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prove'_Cons <span class="main">=</span> prove' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">l</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">l</span>

<span class="keyword1" id="Prover-search"><span class="command">lemma</span></span> search<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>deriv <span class="main">[</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>my_f<span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> my_f_def finite_deriv_prove prove_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prove'_Nil prove'_Cons ss<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sprove</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sprove</span> <span class="main">≡</span> prove <span class="keyword1">o</span> ns_of_s"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">check</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">check</span> <span class="free"><span class="bound"><span class="entity">formula</span></span></span> <span class="main">≡</span> Sprove <span class="main">[</span><span class="free"><span class="bound"><span class="entity">formula</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"form <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">formula</span></span></span> <span class="main">≡</span> Svalid <span class="main">[</span><span class="free"><span class="bound"><span class="entity">formula</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"check <span class="main">=</span> valid"</span></span> <span class="keyword1"><span class="command">using</span></span> soundness completeness finite_deriv_prove <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">max</span> <span class="entity">x</span> <span class="entity">y</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">x</span> &gt; <span class="entity">y</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">y</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">flatten</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">flatten</span> <span class="main">(</span><span class="entity">a</span>::<span class="entity">list</span><span class="main">)</span> <span class="main">=</span> <span class="entity">a</span> @ <span class="main">(</span><span class="entity">flatten</span> <span class="entity">list</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">type</span></span> <span class="entity">pred</span> <span class="main">=</span> int<span class="main">;</span>

<span class="keyword1"><span class="keyword">type</span></span> <span class="entity">var</span> <span class="main">=</span> int<span class="main">;</span>

<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">form</span> <span class="main">=</span> 
    <span class="entity">PAtom</span> <span class="keyword2"><span class="keyword">of</span></span> pred * <span class="main">(</span>var list<span class="main">)</span>
  <span class="main">|</span> <span class="entity">NAtom</span> <span class="keyword2"><span class="keyword">of</span></span> pred * <span class="main">(</span>var list<span class="main">)</span>
  <span class="main">|</span> <span class="entity">FConj</span> <span class="keyword2"><span class="keyword">of</span></span> form * form
  <span class="main">|</span> <span class="entity">FDisj</span> <span class="keyword2"><span class="keyword">of</span></span> form * form
  <span class="main">|</span> <span class="entity">FAll</span>  <span class="keyword2"><span class="keyword">of</span></span> form
  <span class="main">|</span> <span class="entity">FEx</span>   <span class="keyword2"><span class="keyword">of</span></span> form<span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">preSuc</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">preSuc</span> <span class="main">(</span><span class="entity">a</span>::<span class="entity">list</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">a</span> <span class="main">=</span> <span class="inner_numeral">0</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">preSuc</span> <span class="entity">list</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">a</span>-<span class="inner_numeral">1</span><span class="main">)</span>::<span class="main">(</span><span class="entity">preSuc</span> <span class="entity">list</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">PAtom</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">vs</span>
  <span class="main">|</span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">NAtom</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">vs</span>
  <span class="main">|</span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">FConj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">fv</span> <span class="entity">f</span><span class="main">)</span> @ <span class="main">(</span><span class="entity">fv</span> <span class="entity">g</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">FDisj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">fv</span> <span class="entity">f</span><span class="main">)</span> @ <span class="main">(</span><span class="entity">fv</span> <span class="entity">g</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">FAll</span> <span class="entity">f</span><span class="main">)</span> <span class="main">=</span> <span class="entity">preSuc</span> <span class="main">(</span><span class="entity">fv</span> <span class="entity">f</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">fv</span> <span class="main">(</span><span class="entity">FEx</span> <span class="entity">f</span><span class="main">)</span>  <span class="main">=</span> <span class="entity">preSuc</span> <span class="main">(</span><span class="entity">fv</span> <span class="entity">f</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">PAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">PAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span>map <span class="entity">r</span> <span class="entity">vs</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">NAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">NAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span>map <span class="entity">r</span> <span class="entity">vs</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">FConj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">FConj</span> <span class="main">(</span><span class="entity">subst</span> <span class="entity">r</span> <span class="entity">f</span><span class="main">,</span><span class="entity">subst</span> <span class="entity">r</span> <span class="entity">g</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">FDisj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">FDisj</span> <span class="main">(</span><span class="entity">subst</span> <span class="entity">r</span> <span class="entity">f</span><span class="main">,</span><span class="entity">subst</span> <span class="entity">r</span> <span class="entity">g</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">FAll</span> <span class="entity">f</span><span class="main">)</span> <span class="main">=</span> <span class="entity">FAll</span> <span class="main">(</span><span class="entity">subst</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_numeral">0</span> <span class="main">=&gt;</span> <span class="inner_numeral">0</span> <span class="main">|</span> <span class="entity">v</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">r</span> <span class="main">(</span><span class="entity">v</span>-<span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span>+<span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">f</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">subst</span> <span class="entity">r</span> <span class="main">(</span><span class="entity">FEx</span> <span class="entity">f</span><span class="main">)</span>  <span class="main">=</span> <span class="entity">FEx</span>  <span class="main">(</span><span class="entity">subst</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_numeral">0</span> <span class="main">=&gt;</span> <span class="inner_numeral">0</span> <span class="main">|</span> <span class="entity">v</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">r</span> <span class="main">(</span><span class="entity">v</span>-<span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span>+<span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">f</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">finst</span> <span class="entity">body</span> <span class="entity">w</span> <span class="main">=</span> <span class="entity">subst</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="inner_numeral">0</span> <span class="main">=&gt;</span> <span class="entity">w</span> <span class="main">|</span> <span class="entity">v</span> <span class="main">=&gt;</span> <span class="entity">v</span>-<span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">body</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">s_of_ns</span> <span class="entity">ns</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">y</span><span class="main">)</span> <span class="entity">ns</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ns_of_s</span> <span class="entity">s</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">y</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">y</span><span class="main">)</span><span class="main">)</span> <span class="entity">s</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sfv</span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">flatten</span> <span class="main">(</span>map <span class="entity">fv</span> <span class="entity">s</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">maxvar</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="inner_numeral">0</span>
  <span class="main">|</span> <span class="entity">maxvar</span> <span class="main">(</span><span class="entity">a</span>::<span class="entity">list</span><span class="main">)</span> <span class="main">=</span> <span class="entity">max</span> <span class="entity">a</span> <span class="main">(</span><span class="entity">maxvar</span> <span class="entity">list</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">newvar</span> <span class="entity">vs</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">vs</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_numeral">0</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="entity">maxvar</span> <span class="entity">vs</span><span class="main">)</span>+<span class="inner_numeral">1</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">test</span> <span class="main">[</span><span class="main">]</span> <span class="main">_</span> <span class="main">=</span> false
  <span class="main">|</span> <span class="entity">test</span> <span class="main">(</span><span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">y</span><span class="main">)</span>::<span class="entity">list</span><span class="main">)</span> <span class="entity">z</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">y</span> <span class="main">=</span> <span class="entity">z</span> <span class="keyword2"><span class="keyword">then</span></span> true <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">test</span> <span class="entity">list</span> <span class="entity">z</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">subs</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">]</span><span class="main">]</span>
  <span class="main">|</span> <span class="entity">subs</span> <span class="main">(</span><span class="entity">x</span>::<span class="entity">xs</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">n</span><span class="main">,</span><span class="entity">f'</span><span class="main">)</span> <span class="main">=</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">f'</span> <span class="keyword2"><span class="keyword">of</span></span>
      <span class="entity">PAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">test</span> <span class="entity">xs</span> <span class="main">(</span><span class="entity">NAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">PAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
    <span class="main">|</span> <span class="entity">NAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">test</span> <span class="entity">xs</span> <span class="main">(</span><span class="entity">PAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">NAtom</span> <span class="main">(</span><span class="entity">p</span><span class="main">,</span><span class="entity">vs</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
    <span class="main">|</span> <span class="entity">FConj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">f</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
    <span class="main">|</span> <span class="entity">FDisj</span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">f</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">g</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
    <span class="main">|</span> <span class="entity">FAll</span> <span class="entity">f</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">finst</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">newvar</span> <span class="main">(</span><span class="entity">sfv</span> <span class="main">(</span><span class="entity">s_of_ns</span> <span class="main">(</span><span class="entity">x</span>::<span class="entity">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
    <span class="main">|</span> <span class="entity">FEx</span> <span class="entity">f</span>  <span class="main">=&gt;</span> <span class="main">[</span><span class="entity">xs</span> @ <span class="main">[</span><span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="entity">finst</span> <span class="entity">f</span> <span class="entity">n</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="entity">n</span>+<span class="inner_numeral">1</span><span class="main">,</span><span class="entity">f'</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">step</span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">flatten</span> <span class="main">(</span>map <span class="entity">subs</span> <span class="entity">s</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prove'</span> <span class="entity">s</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">s</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span> <span class="keyword2"><span class="keyword">then</span></span> true <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">prove'</span> <span class="main">(</span><span class="entity">step</span> <span class="entity">s</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prove</span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">prove'</span> <span class="main">[</span><span class="entity">s</span><span class="main">]</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">check</span> <span class="entity">f</span> <span class="main">=</span> <span class="main">(</span><span class="entity">prove</span> o <span class="entity">ns_of_s</span><span class="main">)</span> <span class="main">[</span><span class="entity">f</span><span class="main">]</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">my_f</span> <span class="main">=</span> <span class="entity">FDisj</span> <span class="main">(</span>
  <span class="main">(</span><span class="entity">FAll</span> <span class="main">(</span><span class="entity">FConj</span> <span class="main">(</span><span class="main">(</span><span class="entity">NAtom</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="main">[</span><span class="inner_numeral">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">NAtom</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="main">[</span><span class="inner_numeral">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="entity">FDisj</span> <span class="main">(</span><span class="main">(</span><span class="entity">FEx</span> <span class="main">(</span><span class="main">(</span><span class="entity">PAtom</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="main">[</span><span class="inner_numeral">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">FEx</span> <span class="main">(</span><span class="entity">PAtom</span> <span class="main">(</span><span class="inner_numeral">0</span><span class="main">,</span><span class="main">[</span><span class="inner_numeral">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="entity">check</span> <span class="entity">my_f</span><span class="main">;</span>

›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>